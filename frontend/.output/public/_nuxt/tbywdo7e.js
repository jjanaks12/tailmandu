import{u as Lu,_ as ce}from"./CYqblDeG.js";import{u as Rp,a as Bp}from"./qK-Ygz8H.js";import{c as $p}from"./DkQOv5sH.js";import{u as Fp}from"./Bs1c9Rm5.js";import{u as is,a as Vp}from"./DHK_nE_D.js";import{u as Zp,P as Hp}from"./MmWKOBWl.js";import{P as rs}from"./IQQXW68s.js";import{e as _t,M as Au,r as q,f as tt,o as z,w as T,N as ln,g as w,E as ni,q as xe,b as S,O as Wp,h as bt,P as jp,Q as qp,R as ss,n as Bt,l as cn,c as K,a as D,i as ia,d as Z,S as Up,T as ra,U as Kp,m as Jp,V as Gp,W as Yp,X as Xp,Y as Qp,K as he,v as Xt,z as Iu,u as Nu,Z as tm,_ as em,$ as cc,a0 as uc,F as gt,t as st,a1 as as,I as sa,G as oa,x as se,a2 as nm,y as Mn,a3 as im,a4 as rm,a5 as co,a6 as uo,s as Du,B as sm}from"./BWYtlrHP.js";import{c as ls}from"./CPYLdFy8.js";import{R as om}from"./C7MXhZiL.js";import{R as am}from"./CNKI_BAz.js";import{f as dc}from"./D1YfuqZ-.js";import{S as hi,B as lm,I as cm,U as um,a as dm,R as hm,W as fm,H as pm,b as mm,c as gm,d as _m,e as ym,f as vm,L as bm,g as xm,Q as wm,M as zu,h as km,i as Sm,T as Mm,j as Cm}from"./De20xas8.js";import{L as fi}from"./LkxdYki6.js";import{d as Tm}from"./CfwLjDUh.js";import{X as Fi}from"./CeBvLeEG.js";import{L as Ru}from"./Br_3Wix7.js";import{_ as Dn,a as zn,b as Rn,c as Bn}from"./BuH3ov0T.js";import{_ as Qi}from"./CIAn11Ei.js";import{c as cs}from"./DhHgq7Ur.js";import{P as us}from"./C4TblBlo.js";import{M as ds}from"./EtSUb4p2.js";import{_ as hs}from"./BjuGCfxb.js";import{_ as aa}from"./CO-fVa-8.js";import{_ as la}from"./C-0p64mD.js";import{_ as Bu}from"./VryhHoaF.js";import{_ as $u,$ as $r}from"./CPGpR553.js";import{_ as ca,a as ua,b as da,c as ha,d as fa}from"./C5gjHF55.js";import{_ as Fu}from"./BsxdJAUY.js";import{E as It,a as vt,F as fs}from"./CwtqrsYf.js";import{T as Vu,P as Fr}from"./BsENs-da.js";import{u as Pm}from"./pvFOUAvB.js";import{R as Em}from"./fkC6Eo9m.js";import"./BSfqQtg2.js";import"./CsGHxWZ1.js";import"./D5ct0Dmc.js";import"./kRIii9yh.js";import"./DRhRLM69.js";import"./CqZ6nps_.js";import"./VAG_O_SR.js";import"./DjqI5AnR.js";function Om(n,t){for(var e=0;e<t.length;e++){const i=t[e];if(typeof i!="string"&&!Array.isArray(i)){for(const s in i)if(s!=="default"&&!(s in n)){const o=Object.getOwnPropertyDescriptor(i,s);o&&Object.defineProperty(n,s,o.get?o:{enumerable:!0,get:()=>i[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}const[pa,Lm]=$p("TabsRoot");var Am=_t({__name:"TabsRoot",props:{defaultValue:{type:null,required:!1},orientation:{type:String,required:!1,default:"horizontal"},dir:{type:String,required:!1},activationMode:{type:String,required:!1,default:"automatic"},modelValue:{type:null,required:!1},unmountOnHide:{type:Boolean,required:!1,default:!0},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},emits:["update:modelValue"],setup(n,{emit:t}){const e=n,i=t,{orientation:s,unmountOnHide:o,dir:a}=Au(e),c=Fp(a);is();const u=Vp(e,"modelValue",i,{defaultValue:e.defaultValue,passive:e.modelValue===void 0}),h=q();return Lm({modelValue:u,changeModelValue:f=>{u.value=f},orientation:s,dir:c,unmountOnHide:o,activationMode:e.activationMode,baseId:Zp(void 0,"reka-tabs"),tabsList:h}),(f,m)=>(z(),tt(w(rs),{dir:w(c),"data-orientation":w(s),"as-child":f.asChild,as:f.as},{default:T(()=>[ln(f.$slots,"default",{modelValue:w(u)})]),_:3},8,["dir","data-orientation","as-child","as"]))}}),Im=Am;function Zu(n,t){return`${n}-trigger-${t}`}function Hu(n,t){return`${n}-content-${t}`}var Nm=_t({__name:"TabsContent",props:{value:{type:[String,Number],required:!0},forceMount:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(n){const t=n,{forwardRef:e}=is(),i=pa(),s=ni(()=>Zu(i.baseId,t.value)),o=ni(()=>Hu(i.baseId,t.value)),a=ni(()=>t.value===i.modelValue.value),c=q(a.value);return xe(()=>{requestAnimationFrame(()=>{c.value=!1})}),(u,h)=>(z(),tt(w(Hp),{present:u.forceMount||a.value,"force-mount":""},{default:T(({present:f})=>[S(w(rs),{id:o.value,ref:w(e),"as-child":u.asChild,as:u.as,role:"tabpanel","data-state":a.value?"active":"inactive","data-orientation":w(i).orientation.value,"aria-labelledby":s.value,hidden:!f,tabindex:"0",style:Wp({animationDuration:c.value?"0s":void 0})},{default:T(()=>[!w(i).unmountOnHide.value||f?ln(u.$slots,"default",{key:0}):bt("v-if",!0)]),_:2},1032,["id","as-child","as","data-state","data-orientation","aria-labelledby","hidden","style"])]),_:3},8,["present"]))}}),Dm=Nm,zm=_t({__name:"TabsList",props:{loop:{type:Boolean,required:!1,default:!0},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(n){const t=n,{loop:e}=Au(t),{forwardRef:i,currentElement:s}=is(),o=pa();return o.tabsList=s,(a,c)=>(z(),tt(w(om),{"as-child":"",orientation:w(o).orientation.value,dir:w(o).dir.value,loop:w(e)},{default:T(()=>[S(w(rs),{ref:w(i),role:"tablist","as-child":a.asChild,as:a.as,"aria-orientation":w(o).orientation.value},{default:T(()=>[ln(a.$slots,"default")]),_:3},8,["as-child","as","aria-orientation"])]),_:3},8,["orientation","dir","loop"]))}}),Rm=zm,Bm=_t({__name:"TabsTrigger",props:{value:{type:[String,Number],required:!0},disabled:{type:Boolean,required:!1,default:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"button"}},setup(n){const t=n,{forwardRef:e}=is(),i=pa(),s=ni(()=>Zu(i.baseId,t.value)),o=ni(()=>Hu(i.baseId,t.value)),a=ni(()=>t.value===i.modelValue.value);return(c,u)=>(z(),tt(w(am),{"as-child":"",focusable:!c.disabled,active:a.value},{default:T(()=>[S(w(rs),{id:s.value,ref:w(e),role:"tab",type:c.as==="button"?"button":void 0,as:c.as,"as-child":c.asChild,"aria-selected":a.value?"true":"false","aria-controls":o.value,"data-state":a.value?"active":"inactive",disabled:c.disabled,"data-disabled":c.disabled?"":void 0,"data-orientation":w(i).orientation.value,onMousedown:u[0]||(u[0]=qp(h=>{!c.disabled&&h.ctrlKey===!1?w(i).changeModelValue(c.value):h.preventDefault()},["left"])),onKeydown:u[1]||(u[1]=jp(h=>w(i).changeModelValue(c.value),["enter","space"])),onFocus:u[2]||(u[2]=()=>{const h=w(i).activationMode!=="manual";!a.value&&!c.disabled&&h&&w(i).changeModelValue(c.value)})},{default:T(()=>[ln(c.$slots,"default")]),_:3},8,["id","type","as","as-child","aria-selected","aria-controls","data-state","disabled","data-disabled","data-orientation"])]),_:3},8,["focusable","active"]))}}),$m=Bm;const Wu=_t({__name:"Tabs",props:{defaultValue:{},orientation:{},dir:{},activationMode:{},modelValue:{},unmountOnHide:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},emits:["update:modelValue"],setup(n,{emit:t}){const e=n,i=t,s=ss(e,"class"),o=Rp(s,i);return(a,c)=>(z(),tt(w(Im),Bt({"data-slot":"tabs"},w(o),{class:w(ls)("flex flex-col gap-2",e.class)}),{default:T(()=>[ln(a.$slots,"default")]),_:3},16,["class"]))}}),ju=_t({__name:"TabsContent",props:{value:{},forceMount:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(n){const t=n,e=ss(t,"class");return(i,s)=>(z(),tt(w(Dm),Bt({"data-slot":"tabs-content",class:w(ls)("flex-1 outline-none",t.class)},w(e)),{default:T(()=>[ln(i.$slots,"default")]),_:3},16,["class"]))}}),qu=_t({__name:"TabsList",props:{loop:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(n){const t=n,e=ss(t,"class");return(i,s)=>(z(),tt(w(Rm),Bt({"data-slot":"tabs-list"},w(e),{class:w(ls)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t.class)}),{default:T(()=>[ln(i.$slots,"default")]),_:3},16,["class"]))}}),Uu=_t({__name:"TabsTrigger",props:{value:{},disabled:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(n){const t=n,e=ss(t,"class"),i=Bp(e);return(s,o)=>(z(),tt(w($m),Bt({"data-slot":"tabs-trigger"},w(i),{class:w(ls)("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t.class)}),{default:T(()=>[ln(s.$slots,"default")]),_:3},16,["class"]))}}),Fm={class:"bg-accent aspect-[1030/350] -mt-12 -mx-12 relative z-10"},Vm={key:0,class:""},Zm=["src","alt"],Hm=["diabled"],Wm=["disabled"],jm=["src"],qm={key:1,class:"relative"},Um={class:"absolute top-2 right-2"},Km=_t({__name:"imageUpload",props:{trailRace:{}},emits:["update"],setup(n,{emit:t}){const e=n,{axios:i}=cn(),s=t,{can:o}=Lu(),a=q(""),c=q(!1),u=q(!1),h=m=>{const _=m.target.files??[];if(_?.length==0)return;const y=new FileReader,v=_[0];y.onload=()=>{a.value=y.result},v&&y.readAsDataURL(v)},f=async()=>{u.value=!0,await i.put(`/events/${e.trailRace.id}/upload_thumbnail`,{image:a.value}),u.value=!1,c.value=!0,s("update")};return xe(()=>{e.trailRace.image_id||(c.value=!0)}),(m,_)=>{const y=ce;return z(),K("div",Fm,[m.trailRace.image_id!=null&&(!w(c)||!w(o)("event_edit"))?(z(),K("figure",Vm,[D("img",{src:w(ia)(m.trailRace?.thumbnail?.file_name),alt:m.trailRace.name,class:"w-full h-full object-cover absolute top-0 left-0 z-0"},null,8,Zm)])):(z(),K("label",{key:1,class:"bg-gray-100 hover:bg-gray-200 h-full flex justify-center items-center cursor-pointer transition-colors overflow-hidden",diabled:w(u)},[D("input",{type:"file",class:"hidden",onChange:h,disabled:w(u),accept:".jpg, .jpeg, .png"},null,40,Wm),w(a)?(z(),K("img",{key:0,src:w(a),alt:"Trail race preview image",class:"w-full h-full object-cover absolute top-0 left-0 z-0"},null,8,jm)):(z(),K("span",qm,"Upload image"))],8,Hm)),D("div",Um,[m.trailRace.image_id!=null&&!w(c)?(z(),tt(y,{key:0,onClick:_[0]||(_[0]=v=>c.value=!0),permissions:"event_edit"},{default:T(()=>[..._[1]||(_[1]=[Z("Edit image",-1)])]),_:1})):bt("",!0),w(c)&&w(a)?(z(),tt(y,{key:1,variant:"secondary",size:"sm",onClick:f,disabled:w(u),permissions:"event_edit"},{default:T(()=>[w(u)?(z(),tt(w(fi),{key:1,class:"animate-spin relative"})):(z(),tt(w(hi),{key:0})),_[2]||(_[2]=Z(" Save ",-1))]),_:1},8,["disabled"])):bt("",!0)])])}}});function Wt(n){this.content=n}Wt.prototype={constructor:Wt,find:function(n){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===n)return t;return-1},get:function(n){var t=this.find(n);return t==-1?void 0:this.content[t+1]},update:function(n,t,e){var i=e&&e!=n?this.remove(e):this,s=i.find(n),o=i.content.slice();return s==-1?o.push(e||n,t):(o[s+1]=t,e&&(o[s]=e)),new Wt(o)},remove:function(n){var t=this.find(n);if(t==-1)return this;var e=this.content.slice();return e.splice(t,2),new Wt(e)},addToStart:function(n,t){return new Wt([n,t].concat(this.remove(n).content))},addToEnd:function(n,t){var e=this.remove(n).content.slice();return e.push(n,t),new Wt(e)},addBefore:function(n,t,e){var i=this.remove(t),s=i.content.slice(),o=i.find(n);return s.splice(o==-1?s.length:o,0,t,e),new Wt(s)},forEach:function(n){for(var t=0;t<this.content.length;t+=2)n(this.content[t],this.content[t+1])},prepend:function(n){return n=Wt.from(n),n.size?new Wt(n.content.concat(this.subtract(n).content)):this},append:function(n){return n=Wt.from(n),n.size?new Wt(this.subtract(n).content.concat(n.content)):this},subtract:function(n){var t=this;n=Wt.from(n);for(var e=0;e<n.content.length;e+=2)t=t.remove(n.content[e]);return t},toObject:function(){var n={};return this.forEach(function(t,e){n[t]=e}),n},get size(){return this.content.length>>1}};Wt.from=function(n){if(n instanceof Wt)return n;var t=[];if(n)for(var e in n)t.push(e,n[e]);return new Wt(t)};function Ku(n,t,e){for(let i=0;;i++){if(i==n.childCount||i==t.childCount)return n.childCount==t.childCount?null:e;let s=n.child(i),o=t.child(i);if(s==o){e+=s.nodeSize;continue}if(!s.sameMarkup(o))return e;if(s.isText&&s.text!=o.text){for(let a=0;s.text[a]==o.text[a];a++)e++;return e}if(s.content.size||o.content.size){let a=Ku(s.content,o.content,e+1);if(a!=null)return a}e+=s.nodeSize}}function Ju(n,t,e,i){for(let s=n.childCount,o=t.childCount;;){if(s==0||o==0)return s==o?null:{a:e,b:i};let a=n.child(--s),c=t.child(--o),u=a.nodeSize;if(a==c){e-=u,i-=u;continue}if(!a.sameMarkup(c))return{a:e,b:i};if(a.isText&&a.text!=c.text){let h=0,f=Math.min(a.text.length,c.text.length);for(;h<f&&a.text[a.text.length-h-1]==c.text[c.text.length-h-1];)h++,e--,i--;return{a:e,b:i}}if(a.content.size||c.content.size){let h=Ju(a.content,c.content,e-1,i-1);if(h)return h}e-=u,i-=u}}class A{constructor(t,e){if(this.content=t,this.size=e||0,e==null)for(let i=0;i<t.length;i++)this.size+=t[i].nodeSize}nodesBetween(t,e,i,s=0,o){for(let a=0,c=0;c<e;a++){let u=this.content[a],h=c+u.nodeSize;if(h>t&&i(u,s+c,o||null,a)!==!1&&u.content.size){let f=c+1;u.nodesBetween(Math.max(0,t-f),Math.min(u.content.size,e-f),i,s+f)}c=h}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,e,i,s){let o="",a=!0;return this.nodesBetween(t,e,(c,u)=>{let h=c.isText?c.text.slice(Math.max(t,u)-u,e-u):c.isLeaf?s?typeof s=="function"?s(c):s:c.type.spec.leafText?c.type.spec.leafText(c):"":"";c.isBlock&&(c.isLeaf&&h||c.isTextblock)&&i&&(a?a=!1:o+=i),o+=h},0),o}append(t){if(!t.size)return this;if(!this.size)return t;let e=this.lastChild,i=t.firstChild,s=this.content.slice(),o=0;for(e.isText&&e.sameMarkup(i)&&(s[s.length-1]=e.withText(e.text+i.text),o=1);o<t.content.length;o++)s.push(t.content[o]);return new A(s,this.size+t.size)}cut(t,e=this.size){if(t==0&&e==this.size)return this;let i=[],s=0;if(e>t)for(let o=0,a=0;a<e;o++){let c=this.content[o],u=a+c.nodeSize;u>t&&((a<t||u>e)&&(c.isText?c=c.cut(Math.max(0,t-a),Math.min(c.text.length,e-a)):c=c.cut(Math.max(0,t-a-1),Math.min(c.content.size,e-a-1))),i.push(c),s+=c.nodeSize),a=u}return new A(i,s)}cutByIndex(t,e){return t==e?A.empty:t==0&&e==this.content.length?this:new A(this.content.slice(t,e))}replaceChild(t,e){let i=this.content[t];if(i==e)return this;let s=this.content.slice(),o=this.size+e.nodeSize-i.nodeSize;return s[t]=e,new A(s,o)}addToStart(t){return new A([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new A(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e}maybeChild(t){return this.content[t]||null}forEach(t){for(let e=0,i=0;e<this.content.length;e++){let s=this.content[e];t(s,i,e),i+=s.nodeSize}}findDiffStart(t,e=0){return Ku(this,t,e)}findDiffEnd(t,e=this.size,i=t.size){return Ju(this,t,e,i)}findIndex(t){if(t==0)return Sr(0,t);if(t==this.size)return Sr(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let e=0,i=0;;e++){let s=this.child(e),o=i+s.nodeSize;if(o>=t)return o==t?Sr(e+1,o):Sr(e,i);i=o}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(t=>t.toJSON()):null}static fromJSON(t,e){if(!e)return A.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new A(e.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return A.empty;let e,i=0;for(let s=0;s<t.length;s++){let o=t[s];i+=o.nodeSize,s&&o.isText&&t[s-1].sameMarkup(o)?(e||(e=t.slice(0,s)),e[e.length-1]=o.withText(e[e.length-1].text+o.text)):e&&e.push(o)}return new A(e||t,i)}static from(t){if(!t)return A.empty;if(t instanceof A)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new A([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}A.empty=new A([],0);const ho={index:0,offset:0};function Sr(n,t){return ho.index=n,ho.offset=t,ho}function Vr(n,t){if(n===t)return!0;if(!(n&&typeof n=="object")||!(t&&typeof t=="object"))return!1;let e=Array.isArray(n);if(Array.isArray(t)!=e)return!1;if(e){if(n.length!=t.length)return!1;for(let i=0;i<n.length;i++)if(!Vr(n[i],t[i]))return!1}else{for(let i in n)if(!(i in t)||!Vr(n[i],t[i]))return!1;for(let i in t)if(!(i in n))return!1}return!0}let pt=class No{constructor(t,e){this.type=t,this.attrs=e}addToSet(t){let e,i=!1;for(let s=0;s<t.length;s++){let o=t[s];if(this.eq(o))return t;if(this.type.excludes(o.type))e||(e=t.slice(0,s));else{if(o.type.excludes(this.type))return t;!i&&o.type.rank>this.type.rank&&(e||(e=t.slice(0,s)),e.push(this),i=!0),e&&e.push(o)}}return e||(e=t.slice()),i||e.push(this),e}removeFromSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t}isInSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1}eq(t){return this==t||this.type==t.type&&Vr(this.attrs,t.attrs)}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");let i=t.marks[e.type];if(!i)throw new RangeError(`There is no mark type ${e.type} in this schema`);let s=i.create(e.attrs);return i.checkAttrs(s.attrs),s}static sameSet(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++)if(!t[i].eq(e[i]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&t.length==0)return No.none;if(t instanceof No)return[t];let e=t.slice();return e.sort((i,s)=>i.type.rank-s.type.rank),e}};pt.none=[];class Zr extends Error{}class B{constructor(t,e,i){this.content=t,this.openStart=e,this.openEnd=i}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,e){let i=Yu(this.content,t+this.openStart,e);return i&&new B(i,this.openStart,this.openEnd)}removeBetween(t,e){return new B(Gu(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,e){if(!e)return B.empty;let i=e.openStart||0,s=e.openEnd||0;if(typeof i!="number"||typeof s!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new B(A.fromJSON(t,e.content),i,s)}static maxOpen(t,e=!0){let i=0,s=0;for(let o=t.firstChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.firstChild)i++;for(let o=t.lastChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.lastChild)s++;return new B(t,i,s)}}B.empty=new B(A.empty,0,0);function Gu(n,t,e){let{index:i,offset:s}=n.findIndex(t),o=n.maybeChild(i),{index:a,offset:c}=n.findIndex(e);if(s==t||o.isText){if(c!=e&&!n.child(a).isText)throw new RangeError("Removing non-flat range");return n.cut(0,t).append(n.cut(e))}if(i!=a)throw new RangeError("Removing non-flat range");return n.replaceChild(i,o.copy(Gu(o.content,t-s-1,e-s-1)))}function Yu(n,t,e,i){let{index:s,offset:o}=n.findIndex(t),a=n.maybeChild(s);if(o==t||a.isText)return i&&!i.canReplace(s,s,e)?null:n.cut(0,t).append(e).append(n.cut(t));let c=Yu(a.content,t-o-1,e,a);return c&&n.replaceChild(s,a.copy(c))}function Jm(n,t,e){if(e.openStart>n.depth)throw new Zr("Inserted content deeper than insertion position");if(n.depth-e.openStart!=t.depth-e.openEnd)throw new Zr("Inconsistent open depths");return Xu(n,t,e,0)}function Xu(n,t,e,i){let s=n.index(i),o=n.node(i);if(s==t.index(i)&&i<n.depth-e.openStart){let a=Xu(n,t,e,i+1);return o.copy(o.content.replaceChild(s,a))}else if(e.content.size)if(!e.openStart&&!e.openEnd&&n.depth==i&&t.depth==i){let a=n.parent,c=a.content;return Tn(a,c.cut(0,n.parentOffset).append(e.content).append(c.cut(t.parentOffset)))}else{let{start:a,end:c}=Gm(e,n);return Tn(o,td(n,a,c,t,i))}else return Tn(o,Hr(n,t,i))}function Qu(n,t){if(!t.type.compatibleContent(n.type))throw new Zr("Cannot join "+t.type.name+" onto "+n.type.name)}function Do(n,t,e){let i=n.node(e);return Qu(i,t.node(e)),i}function Cn(n,t){let e=t.length-1;e>=0&&n.isText&&n.sameMarkup(t[e])?t[e]=n.withText(t[e].text+n.text):t.push(n)}function zi(n,t,e,i){let s=(t||n).node(e),o=0,a=t?t.index(e):s.childCount;n&&(o=n.index(e),n.depth>e?o++:n.textOffset&&(Cn(n.nodeAfter,i),o++));for(let c=o;c<a;c++)Cn(s.child(c),i);t&&t.depth==e&&t.textOffset&&Cn(t.nodeBefore,i)}function Tn(n,t){return n.type.checkContent(t),n.copy(t)}function td(n,t,e,i,s){let o=n.depth>s&&Do(n,t,s+1),a=i.depth>s&&Do(e,i,s+1),c=[];return zi(null,n,s,c),o&&a&&t.index(s)==e.index(s)?(Qu(o,a),Cn(Tn(o,td(n,t,e,i,s+1)),c)):(o&&Cn(Tn(o,Hr(n,t,s+1)),c),zi(t,e,s,c),a&&Cn(Tn(a,Hr(e,i,s+1)),c)),zi(i,null,s,c),new A(c)}function Hr(n,t,e){let i=[];if(zi(null,n,e,i),n.depth>e){let s=Do(n,t,e+1);Cn(Tn(s,Hr(n,t,e+1)),i)}return zi(t,null,e,i),new A(i)}function Gm(n,t){let e=t.depth-n.openStart,s=t.node(e).copy(n.content);for(let o=e-1;o>=0;o--)s=t.node(o).copy(A.from(s));return{start:s.resolveNoCache(n.openStart+e),end:s.resolveNoCache(s.content.size-n.openEnd-e)}}class Vi{constructor(t,e,i){this.pos=t,this.path=e,this.parentOffset=i,this.depth=e.length/3-1}resolveDepth(t){return t==null?this.depth:t<0?this.depth+t:t}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(t){return this.path[this.resolveDepth(t)*3]}index(t){return this.path[this.resolveDepth(t)*3+1]}indexAfter(t){return t=this.resolveDepth(t),this.index(t)+(t==this.depth&&!this.textOffset?0:1)}start(t){return t=this.resolveDepth(t),t==0?0:this.path[t*3-1]+1}end(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size}before(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]}after(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]+this.path[t*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;let i=this.pos-this.path[this.path.length-1],s=t.child(e);return i?t.child(e).cut(i):s}get nodeBefore(){let t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):t==0?null:this.parent.child(t-1)}posAtIndex(t,e){e=this.resolveDepth(e);let i=this.path[e*3],s=e==0?0:this.path[e*3-1]+1;for(let o=0;o<t;o++)s+=i.child(o).nodeSize;return s}marks(){let t=this.parent,e=this.index();if(t.content.size==0)return pt.none;if(this.textOffset)return t.child(e).marks;let i=t.maybeChild(e-1),s=t.maybeChild(e);if(!i){let c=i;i=s,s=c}let o=i.marks;for(var a=0;a<o.length;a++)o[a].type.spec.inclusive===!1&&(!s||!o[a].isInSet(s.marks))&&(o=o[a--].removeFromSet(o));return o}marksAcross(t){let e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;let i=e.marks,s=t.parent.maybeChild(t.index());for(var o=0;o<i.length;o++)i[o].type.spec.inclusive===!1&&(!s||!i[o].isInSet(s.marks))&&(i=i[o--].removeFromSet(i));return i}sharedDepth(t){for(let e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0}blockRange(t=this,e){if(t.pos<this.pos)return t.blockRange(this);for(let i=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);i>=0;i--)if(t.pos<=this.end(i)&&(!e||e(this.node(i))))return new Wr(this,t,i);return null}sameParent(t){return this.pos-this.parentOffset==t.pos-t.parentOffset}max(t){return t.pos>this.pos?t:this}min(t){return t.pos<this.pos?t:this}toString(){let t="";for(let e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset}static resolve(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");let i=[],s=0,o=e;for(let a=t;;){let{index:c,offset:u}=a.content.findIndex(o),h=o-u;if(i.push(a,c,s+u),!h||(a=a.child(c),a.isText))break;o=h-1,s+=u+1}return new Vi(e,i,o)}static resolveCached(t,e){let i=hc.get(t);if(i)for(let o=0;o<i.elts.length;o++){let a=i.elts[o];if(a.pos==e)return a}else hc.set(t,i=new Ym);let s=i.elts[i.i]=Vi.resolve(t,e);return i.i=(i.i+1)%Xm,s}}class Ym{constructor(){this.elts=[],this.i=0}}const Xm=12,hc=new WeakMap;class Wr{constructor(t,e,i){this.$from=t,this.$to=e,this.depth=i}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const Qm=Object.create(null);class ve{constructor(t,e,i,s=pt.none){this.type=t,this.attrs=e,this.marks=s,this.content=i||A.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(t){return this.content.child(t)}maybeChild(t){return this.content.maybeChild(t)}forEach(t){this.content.forEach(t)}nodesBetween(t,e,i,s=0){this.content.nodesBetween(t,e,i,s,this)}descendants(t){this.nodesBetween(0,this.content.size,t)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(t,e,i,s){return this.content.textBetween(t,e,i,s)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)}sameMarkup(t){return this.hasMarkup(t.type,t.attrs,t.marks)}hasMarkup(t,e,i){return this.type==t&&Vr(this.attrs,e||t.defaultAttrs||Qm)&&pt.sameSet(this.marks,i||pt.none)}copy(t=null){return t==this.content?this:new ve(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new ve(this.type,this.attrs,this.content,t)}cut(t,e=this.content.size){return t==0&&e==this.content.size?this:this.copy(this.content.cut(t,e))}slice(t,e=this.content.size,i=!1){if(t==e)return B.empty;let s=this.resolve(t),o=this.resolve(e),a=i?0:s.sharedDepth(e),c=s.start(a),h=s.node(a).content.cut(s.pos-c,o.pos-c);return new B(h,s.depth-a,o.depth-a)}replace(t,e,i){return Jm(this.resolve(t),this.resolve(e),i)}nodeAt(t){for(let e=this;;){let{index:i,offset:s}=e.content.findIndex(t);if(e=e.maybeChild(i),!e)return null;if(s==t||e.isText)return e;t-=s+1}}childAfter(t){let{index:e,offset:i}=this.content.findIndex(t);return{node:this.content.maybeChild(e),index:e,offset:i}}childBefore(t){if(t==0)return{node:null,index:0,offset:0};let{index:e,offset:i}=this.content.findIndex(t);if(i<t)return{node:this.content.child(e),index:e,offset:i};let s=this.content.child(e-1);return{node:s,index:e-1,offset:i-s.nodeSize}}resolve(t){return Vi.resolveCached(this,t)}resolveNoCache(t){return Vi.resolve(this,t)}rangeHasMark(t,e,i){let s=!1;return e>t&&this.nodesBetween(t,e,o=>(i.isInSet(o.marks)&&(s=!0),!s)),s}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),ed(this.marks,t)}contentMatchAt(t){let e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e}canReplace(t,e,i=A.empty,s=0,o=i.childCount){let a=this.contentMatchAt(t).matchFragment(i,s,o),c=a&&a.matchFragment(this.content,e);if(!c||!c.validEnd)return!1;for(let u=s;u<o;u++)if(!this.type.allowsMarks(i.child(u).marks))return!1;return!0}canReplaceWith(t,e,i,s){if(s&&!this.type.allowsMarks(s))return!1;let o=this.contentMatchAt(t).matchType(i),a=o&&o.matchFragment(this.content,e);return a?a.validEnd:!1}canAppend(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let t=pt.none;for(let e=0;e<this.marks.length;e++){let i=this.marks[e];i.type.checkAttrs(i.attrs),t=i.addToSet(t)}if(!pt.sameSet(t,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(e=>e.type.name)}`);this.content.forEach(e=>e.check())}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(e=>e.toJSON())),t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");let i;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");i=e.marks.map(t.markFromJSON)}if(e.type=="text"){if(typeof e.text!="string")throw new RangeError("Invalid text node in JSON");return t.text(e.text,i)}let s=A.fromJSON(t,e.content),o=t.nodeType(e.type).create(e.attrs,s,i);return o.type.checkAttrs(o.attrs),o}}ve.prototype.text=void 0;class jr extends ve{constructor(t,e,i,s){if(super(t,e,null,s),!i)throw new RangeError("Empty text nodes are not allowed");this.text=i}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):ed(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(t,e){return this.text.slice(t,e)}get nodeSize(){return this.text.length}mark(t){return t==this.marks?this:new jr(this.type,this.attrs,this.text,t)}withText(t){return t==this.text?this:new jr(this.type,this.attrs,t,this.marks)}cut(t=0,e=this.text.length){return t==0&&e==this.text.length?this:this.withText(this.text.slice(t,e))}eq(t){return this.sameMarkup(t)&&this.text==t.text}toJSON(){let t=super.toJSON();return t.text=this.text,t}}function ed(n,t){for(let e=n.length-1;e>=0;e--)t=n[e].type.name+"("+t+")";return t}class Ln{constructor(t){this.validEnd=t,this.next=[],this.wrapCache=[]}static parse(t,e){let i=new tg(t,e);if(i.next==null)return Ln.empty;let s=nd(i);i.next&&i.err("Unexpected trailing text");let o=ag(og(s));return lg(o,i),o}matchType(t){for(let e=0;e<this.next.length;e++)if(this.next[e].type==t)return this.next[e].next;return null}matchFragment(t,e=0,i=t.childCount){let s=this;for(let o=e;s&&o<i;o++)s=s.matchType(t.child(o).type);return s}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let t=0;t<this.next.length;t++){let{type:e}=this.next[t];if(!(e.isText||e.hasRequiredAttrs()))return e}return null}compatible(t){for(let e=0;e<this.next.length;e++)for(let i=0;i<t.next.length;i++)if(this.next[e].type==t.next[i].type)return!0;return!1}fillBefore(t,e=!1,i=0){let s=[this];function o(a,c){let u=a.matchFragment(t,i);if(u&&(!e||u.validEnd))return A.from(c.map(h=>h.createAndFill()));for(let h=0;h<a.next.length;h++){let{type:f,next:m}=a.next[h];if(!(f.isText||f.hasRequiredAttrs())&&s.indexOf(m)==-1){s.push(m);let _=o(m,c.concat(f));if(_)return _}}return null}return o(this,[])}findWrapping(t){for(let i=0;i<this.wrapCache.length;i+=2)if(this.wrapCache[i]==t)return this.wrapCache[i+1];let e=this.computeWrapping(t);return this.wrapCache.push(t,e),e}computeWrapping(t){let e=Object.create(null),i=[{match:this,type:null,via:null}];for(;i.length;){let s=i.shift(),o=s.match;if(o.matchType(t)){let a=[];for(let c=s;c.type;c=c.via)a.push(c.type);return a.reverse()}for(let a=0;a<o.next.length;a++){let{type:c,next:u}=o.next[a];!c.isLeaf&&!c.hasRequiredAttrs()&&!(c.name in e)&&(!s.type||u.validEnd)&&(i.push({match:c.contentMatch,type:c,via:s}),e[c.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(t){if(t>=this.next.length)throw new RangeError(`There's no ${t}th edge in this content match`);return this.next[t]}toString(){let t=[];function e(i){t.push(i);for(let s=0;s<i.next.length;s++)t.indexOf(i.next[s].next)==-1&&e(i.next[s].next)}return e(this),t.map((i,s)=>{let o=s+(i.validEnd?"*":" ")+" ";for(let a=0;a<i.next.length;a++)o+=(a?", ":"")+i.next[a].type.name+"->"+t.indexOf(i.next[a].next);return o}).join(`
`)}}Ln.empty=new Ln(!0);class tg{constructor(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(t){return this.next==t&&(this.pos++||!0)}err(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")}}function nd(n){let t=[];do t.push(eg(n));while(n.eat("|"));return t.length==1?t[0]:{type:"choice",exprs:t}}function eg(n){let t=[];do t.push(ng(n));while(n.next&&n.next!=")"&&n.next!="|");return t.length==1?t[0]:{type:"seq",exprs:t}}function ng(n){let t=sg(n);for(;;)if(n.eat("+"))t={type:"plus",expr:t};else if(n.eat("*"))t={type:"star",expr:t};else if(n.eat("?"))t={type:"opt",expr:t};else if(n.eat("{"))t=ig(n,t);else break;return t}function fc(n){/\D/.test(n.next)&&n.err("Expected number, got '"+n.next+"'");let t=Number(n.next);return n.pos++,t}function ig(n,t){let e=fc(n),i=e;return n.eat(",")&&(n.next!="}"?i=fc(n):i=-1),n.eat("}")||n.err("Unclosed braced range"),{type:"range",min:e,max:i,expr:t}}function rg(n,t){let e=n.nodeTypes,i=e[t];if(i)return[i];let s=[];for(let o in e){let a=e[o];a.isInGroup(t)&&s.push(a)}return s.length==0&&n.err("No node type or group '"+t+"' found"),s}function sg(n){if(n.eat("(")){let t=nd(n);return n.eat(")")||n.err("Missing closing paren"),t}else if(/\W/.test(n.next))n.err("Unexpected token '"+n.next+"'");else{let t=rg(n,n.next).map(e=>(n.inline==null?n.inline=e.isInline:n.inline!=e.isInline&&n.err("Mixing inline and block content"),{type:"name",value:e}));return n.pos++,t.length==1?t[0]:{type:"choice",exprs:t}}}function og(n){let t=[[]];return s(o(n,0),e()),t;function e(){return t.push([])-1}function i(a,c,u){let h={term:u,to:c};return t[a].push(h),h}function s(a,c){a.forEach(u=>u.to=c)}function o(a,c){if(a.type=="choice")return a.exprs.reduce((u,h)=>u.concat(o(h,c)),[]);if(a.type=="seq")for(let u=0;;u++){let h=o(a.exprs[u],c);if(u==a.exprs.length-1)return h;s(h,c=e())}else if(a.type=="star"){let u=e();return i(c,u),s(o(a.expr,u),u),[i(u)]}else if(a.type=="plus"){let u=e();return s(o(a.expr,c),u),s(o(a.expr,u),u),[i(u)]}else{if(a.type=="opt")return[i(c)].concat(o(a.expr,c));if(a.type=="range"){let u=c;for(let h=0;h<a.min;h++){let f=e();s(o(a.expr,u),f),u=f}if(a.max==-1)s(o(a.expr,u),u);else for(let h=a.min;h<a.max;h++){let f=e();i(u,f),s(o(a.expr,u),f),u=f}return[i(u)]}else{if(a.type=="name")return[i(c,void 0,a.value)];throw new Error("Unknown expr type")}}}}function id(n,t){return t-n}function pc(n,t){let e=[];return i(t),e.sort(id);function i(s){let o=n[s];if(o.length==1&&!o[0].term)return i(o[0].to);e.push(s);for(let a=0;a<o.length;a++){let{term:c,to:u}=o[a];!c&&e.indexOf(u)==-1&&i(u)}}}function ag(n){let t=Object.create(null);return e(pc(n,0));function e(i){let s=[];i.forEach(a=>{n[a].forEach(({term:c,to:u})=>{if(!c)return;let h;for(let f=0;f<s.length;f++)s[f][0]==c&&(h=s[f][1]);pc(n,u).forEach(f=>{h||s.push([c,h=[]]),h.indexOf(f)==-1&&h.push(f)})})});let o=t[i.join(",")]=new Ln(i.indexOf(n.length-1)>-1);for(let a=0;a<s.length;a++){let c=s[a][1].sort(id);o.next.push({type:s[a][0],next:t[c.join(",")]||e(c)})}return o}}function lg(n,t){for(let e=0,i=[n];e<i.length;e++){let s=i[e],o=!s.validEnd,a=[];for(let c=0;c<s.next.length;c++){let{type:u,next:h}=s.next[c];a.push(u.name),o&&!(u.isText||u.hasRequiredAttrs())&&(o=!1),i.indexOf(h)==-1&&i.push(h)}o&&t.err("Only non-generatable nodes ("+a.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function rd(n){let t=Object.create(null);for(let e in n){let i=n[e];if(!i.hasDefault)return null;t[e]=i.default}return t}function sd(n,t){let e=Object.create(null);for(let i in n){let s=t&&t[i];if(s===void 0){let o=n[i];if(o.hasDefault)s=o.default;else throw new RangeError("No value supplied for attribute "+i)}e[i]=s}return e}function od(n,t,e,i){for(let s in t)if(!(s in n))throw new RangeError(`Unsupported attribute ${s} for ${e} of type ${s}`);for(let s in n){let o=n[s];o.validate&&o.validate(t[s])}}function ad(n,t){let e=Object.create(null);if(t)for(let i in t)e[i]=new ug(n,i,t[i]);return e}let mc=class ld{constructor(t,e,i){this.name=t,this.schema=e,this.spec=i,this.markSet=null,this.groups=i.group?i.group.split(" "):[],this.attrs=ad(t,i.attrs),this.defaultAttrs=rd(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(i.inline||t=="text"),this.isText=t=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Ln.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(t){return this.groups.indexOf(t)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1}compatibleContent(t){return this==t||this.contentMatch.compatible(t.contentMatch)}computeAttrs(t){return!t&&this.defaultAttrs?this.defaultAttrs:sd(this.attrs,t)}create(t=null,e,i){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new ve(this,this.computeAttrs(t),A.from(e),pt.setFrom(i))}createChecked(t=null,e,i){return e=A.from(e),this.checkContent(e),new ve(this,this.computeAttrs(t),e,pt.setFrom(i))}createAndFill(t=null,e,i){if(t=this.computeAttrs(t),e=A.from(e),e.size){let a=this.contentMatch.fillBefore(e);if(!a)return null;e=a.append(e)}let s=this.contentMatch.matchFragment(e),o=s&&s.fillBefore(A.empty,!0);return o?new ve(this,t,e.append(o),pt.setFrom(i)):null}validContent(t){let e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(let i=0;i<t.childCount;i++)if(!this.allowsMarks(t.child(i).marks))return!1;return!0}checkContent(t){if(!this.validContent(t))throw new RangeError(`Invalid content for node ${this.name}: ${t.toString().slice(0,50)}`)}checkAttrs(t){od(this.attrs,t,"node",this.name)}allowsMarkType(t){return this.markSet==null||this.markSet.indexOf(t)>-1}allowsMarks(t){if(this.markSet==null)return!0;for(let e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0}allowedMarks(t){if(this.markSet==null)return t;let e;for(let i=0;i<t.length;i++)this.allowsMarkType(t[i].type)?e&&e.push(t[i]):e||(e=t.slice(0,i));return e?e.length?e:pt.none:t}static compile(t,e){let i=Object.create(null);t.forEach((o,a)=>i[o]=new ld(o,e,a));let s=e.spec.topNode||"doc";if(!i[s])throw new RangeError("Schema is missing its top node type ('"+s+"')");if(!i.text)throw new RangeError("Every schema needs a 'text' type");for(let o in i.text.attrs)throw new RangeError("The text node type should not have attributes");return i}};function cg(n,t,e){let i=e.split("|");return s=>{let o=s===null?"null":typeof s;if(i.indexOf(o)<0)throw new RangeError(`Expected value of type ${i} for attribute ${t} on type ${n}, got ${o}`)}}class ug{constructor(t,e,i){this.hasDefault=Object.prototype.hasOwnProperty.call(i,"default"),this.default=i.default,this.validate=typeof i.validate=="string"?cg(t,e,i.validate):i.validate}get isRequired(){return!this.hasDefault}}class ps{constructor(t,e,i,s){this.name=t,this.rank=e,this.schema=i,this.spec=s,this.attrs=ad(t,s.attrs),this.excluded=null;let o=rd(this.attrs);this.instance=o?new pt(this,o):null}create(t=null){return!t&&this.instance?this.instance:new pt(this,sd(this.attrs,t))}static compile(t,e){let i=Object.create(null),s=0;return t.forEach((o,a)=>i[o]=new ps(o,s++,e,a)),i}removeFromSet(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t}isInSet(t){for(let e=0;e<t.length;e++)if(t[e].type==this)return t[e]}checkAttrs(t){od(this.attrs,t,"mark",this.name)}excludes(t){return this.excluded.indexOf(t)>-1}}class ma{constructor(t){this.linebreakReplacement=null,this.cached=Object.create(null);let e=this.spec={};for(let s in t)e[s]=t[s];e.nodes=Wt.from(t.nodes),e.marks=Wt.from(t.marks||{}),this.nodes=mc.compile(this.spec.nodes,this),this.marks=ps.compile(this.spec.marks,this);let i=Object.create(null);for(let s in this.nodes){if(s in this.marks)throw new RangeError(s+" can not be both a node and a mark");let o=this.nodes[s],a=o.spec.content||"",c=o.spec.marks;if(o.contentMatch=i[a]||(i[a]=Ln.parse(a,this.nodes)),o.inlineContent=o.contentMatch.inlineContent,o.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!o.isInline||!o.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=o}o.markSet=c=="_"?null:c?gc(this,c.split(" ")):c==""||!o.inlineContent?[]:null}for(let s in this.marks){let o=this.marks[s],a=o.spec.excludes;o.excluded=a==null?[o]:a==""?[]:gc(this,a.split(" "))}this.nodeFromJSON=s=>ve.fromJSON(this,s),this.markFromJSON=s=>pt.fromJSON(this,s),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(t,e=null,i,s){if(typeof t=="string")t=this.nodeType(t);else if(t instanceof mc){if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}else throw new RangeError("Invalid node type: "+t);return t.createChecked(e,i,s)}text(t,e){let i=this.nodes.text;return new jr(i,i.defaultAttrs,t,pt.setFrom(e))}mark(t,e){return typeof t=="string"&&(t=this.marks[t]),t.create(e)}nodeType(t){let e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e}}function gc(n,t){let e=[];for(let i=0;i<t.length;i++){let s=t[i],o=n.marks[s],a=o;if(o)e.push(o);else for(let c in n.marks){let u=n.marks[c];(s=="_"||u.spec.group&&u.spec.group.split(" ").indexOf(s)>-1)&&e.push(a=u)}if(!a)throw new SyntaxError("Unknown mark type: '"+t[i]+"'")}return e}function dg(n){return n.tag!=null}function hg(n){return n.style!=null}class Ce{constructor(t,e){this.schema=t,this.rules=e,this.tags=[],this.styles=[];let i=this.matchedStyles=[];e.forEach(s=>{if(dg(s))this.tags.push(s);else if(hg(s)){let o=/[^=]*/.exec(s.style)[0];i.indexOf(o)<0&&i.push(o),this.styles.push(s)}}),this.normalizeLists=!this.tags.some(s=>{if(!/^(ul|ol)\b/.test(s.tag)||!s.node)return!1;let o=t.nodes[s.node];return o.contentMatch.matchType(o)})}parse(t,e={}){let i=new yc(this,e,!1);return i.addAll(t,pt.none,e.from,e.to),i.finish()}parseSlice(t,e={}){let i=new yc(this,e,!0);return i.addAll(t,pt.none,e.from,e.to),B.maxOpen(i.finish())}matchTag(t,e,i){for(let s=i?this.tags.indexOf(i)+1:0;s<this.tags.length;s++){let o=this.tags[s];if(mg(t,o.tag)&&(o.namespace===void 0||t.namespaceURI==o.namespace)&&(!o.context||e.matchesContext(o.context))){if(o.getAttrs){let a=o.getAttrs(t);if(a===!1)continue;o.attrs=a||void 0}return o}}}matchStyle(t,e,i,s){for(let o=s?this.styles.indexOf(s)+1:0;o<this.styles.length;o++){let a=this.styles[o],c=a.style;if(!(c.indexOf(t)!=0||a.context&&!i.matchesContext(a.context)||c.length>t.length&&(c.charCodeAt(t.length)!=61||c.slice(t.length+1)!=e))){if(a.getAttrs){let u=a.getAttrs(e);if(u===!1)continue;a.attrs=u||void 0}return a}}}static schemaRules(t){let e=[];function i(s){let o=s.priority==null?50:s.priority,a=0;for(;a<e.length;a++){let c=e[a];if((c.priority==null?50:c.priority)<o)break}e.splice(a,0,s)}for(let s in t.marks){let o=t.marks[s].spec.parseDOM;o&&o.forEach(a=>{i(a=vc(a)),a.mark||a.ignore||a.clearMark||(a.mark=s)})}for(let s in t.nodes){let o=t.nodes[s].spec.parseDOM;o&&o.forEach(a=>{i(a=vc(a)),a.node||a.ignore||a.mark||(a.node=s)})}return e}static fromSchema(t){return t.cached.domParser||(t.cached.domParser=new Ce(t,Ce.schemaRules(t)))}}const cd={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},fg={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},ud={ol:!0,ul:!0},Zi=1,zo=2,Ri=4;function _c(n,t,e){return t!=null?(t?Zi:0)|(t==="full"?zo:0):n&&n.whitespace=="pre"?Zi|zo:e&~Ri}class Mr{constructor(t,e,i,s,o,a){this.type=t,this.attrs=e,this.marks=i,this.solid=s,this.options=a,this.content=[],this.activeMarks=pt.none,this.match=o||(a&Ri?null:t.contentMatch)}findWrapping(t){if(!this.match){if(!this.type)return[];let e=this.type.contentMatch.fillBefore(A.from(t));if(e)this.match=this.type.contentMatch.matchFragment(e);else{let i=this.type.contentMatch,s;return(s=i.findWrapping(t.type))?(this.match=i,s):null}}return this.match.findWrapping(t.type)}finish(t){if(!(this.options&Zi)){let i=this.content[this.content.length-1],s;if(i&&i.isText&&(s=/[ \t\r\n\u000c]+$/.exec(i.text))){let o=i;i.text.length==s[0].length?this.content.pop():this.content[this.content.length-1]=o.withText(o.text.slice(0,o.text.length-s[0].length))}}let e=A.from(this.content);return!t&&this.match&&(e=e.append(this.match.fillBefore(A.empty,!0))),this.type?this.type.create(this.attrs,e,this.marks):e}inlineContext(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!cd.hasOwnProperty(t.parentNode.nodeName.toLowerCase())}}class yc{constructor(t,e,i){this.parser=t,this.options=e,this.isOpen=i,this.open=0,this.localPreserveWS=!1;let s=e.topNode,o,a=_c(null,e.preserveWhitespace,0)|(i?Ri:0);s?o=new Mr(s.type,s.attrs,pt.none,!0,e.topMatch||s.type.contentMatch,a):i?o=new Mr(null,null,pt.none,!0,null,a):o=new Mr(t.schema.topNodeType,null,pt.none,!0,null,a),this.nodes=[o],this.find=e.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(t,e){t.nodeType==3?this.addTextNode(t,e):t.nodeType==1&&this.addElement(t,e)}addTextNode(t,e){let i=t.nodeValue,s=this.top,o=s.options&zo?"full":this.localPreserveWS||(s.options&Zi)>0;if(o==="full"||s.inlineContext(t)||/[^ \t\r\n\u000c]/.test(i)){if(o)o!=="full"?i=i.replace(/\r?\n|\r/g," "):i=i.replace(/\r\n?/g,`
`);else if(i=i.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(i)&&this.open==this.nodes.length-1){let a=s.content[s.content.length-1],c=t.previousSibling;(!a||c&&c.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(i=i.slice(1))}i&&this.insertNode(this.parser.schema.text(i),e,!/\S/.test(i)),this.findInText(t)}else this.findInside(t)}addElement(t,e,i){let s=this.localPreserveWS,o=this.top;(t.tagName=="PRE"||/pre/.test(t.style&&t.style.whiteSpace))&&(this.localPreserveWS=!0);let a=t.nodeName.toLowerCase(),c;ud.hasOwnProperty(a)&&this.parser.normalizeLists&&pg(t);let u=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(c=this.parser.matchTag(t,this,i));t:if(u?u.ignore:fg.hasOwnProperty(a))this.findInside(t),this.ignoreFallback(t,e);else if(!u||u.skip||u.closeParent){u&&u.closeParent?this.open=Math.max(0,this.open-1):u&&u.skip.nodeType&&(t=u.skip);let h,f=this.needsBlock;if(cd.hasOwnProperty(a))o.content.length&&o.content[0].isInline&&this.open&&(this.open--,o=this.top),h=!0,o.type||(this.needsBlock=!0);else if(!t.firstChild){this.leafFallback(t,e);break t}let m=u&&u.skip?e:this.readStyles(t,e);m&&this.addAll(t,m),h&&this.sync(o),this.needsBlock=f}else{let h=this.readStyles(t,e);h&&this.addElementByRule(t,u,h,u.consuming===!1?c:void 0)}this.localPreserveWS=s}leafFallback(t,e){t.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode(`
`),e)}ignoreFallback(t,e){t.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),e,!0)}readStyles(t,e){let i=t.style;if(i&&i.length)for(let s=0;s<this.parser.matchedStyles.length;s++){let o=this.parser.matchedStyles[s],a=i.getPropertyValue(o);if(a)for(let c=void 0;;){let u=this.parser.matchStyle(o,a,this,c);if(!u)break;if(u.ignore)return null;if(u.clearMark?e=e.filter(h=>!u.clearMark(h)):e=e.concat(this.parser.schema.marks[u.mark].create(u.attrs)),u.consuming===!1)c=u;else break}}return e}addElementByRule(t,e,i,s){let o,a;if(e.node)if(a=this.parser.schema.nodes[e.node],a.isLeaf)this.insertNode(a.create(e.attrs),i,t.nodeName=="BR")||this.leafFallback(t,i);else{let u=this.enter(a,e.attrs||null,i,e.preserveWhitespace);u&&(o=!0,i=u)}else{let u=this.parser.schema.marks[e.mark];i=i.concat(u.create(e.attrs))}let c=this.top;if(a&&a.isLeaf)this.findInside(t);else if(s)this.addElement(t,i,s);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach(u=>this.insertNode(u,i,!1));else{let u=t;typeof e.contentElement=="string"?u=t.querySelector(e.contentElement):typeof e.contentElement=="function"?u=e.contentElement(t):e.contentElement&&(u=e.contentElement),this.findAround(t,u,!0),this.addAll(u,i),this.findAround(t,u,!1)}o&&this.sync(c)&&this.open--}addAll(t,e,i,s){let o=i||0;for(let a=i?t.childNodes[i]:t.firstChild,c=s==null?null:t.childNodes[s];a!=c;a=a.nextSibling,++o)this.findAtPoint(t,o),this.addDOM(a,e);this.findAtPoint(t,o)}findPlace(t,e,i){let s,o;for(let a=this.open,c=0;a>=0;a--){let u=this.nodes[a],h=u.findWrapping(t);if(h&&(!s||s.length>h.length+c)&&(s=h,o=u,!h.length))break;if(u.solid){if(i)break;c+=2}}if(!s)return null;this.sync(o);for(let a=0;a<s.length;a++)e=this.enterInner(s[a],null,e,!1);return e}insertNode(t,e,i){if(t.isInline&&this.needsBlock&&!this.top.type){let o=this.textblockFromContext();o&&(e=this.enterInner(o,null,e))}let s=this.findPlace(t,e,i);if(s){this.closeExtra();let o=this.top;o.match&&(o.match=o.match.matchType(t.type));let a=pt.none;for(let c of s.concat(t.marks))(o.type?o.type.allowsMarkType(c.type):bc(c.type,t.type))&&(a=c.addToSet(a));return o.content.push(t.mark(a)),!0}return!1}enter(t,e,i,s){let o=this.findPlace(t.create(e),i,!1);return o&&(o=this.enterInner(t,e,i,!0,s)),o}enterInner(t,e,i,s=!1,o){this.closeExtra();let a=this.top;a.match=a.match&&a.match.matchType(t);let c=_c(t,o,a.options);a.options&Ri&&a.content.length==0&&(c|=Ri);let u=pt.none;return i=i.filter(h=>(a.type?a.type.allowsMarkType(h.type):bc(h.type,t))?(u=h.addToSet(u),!1):!0),this.nodes.push(new Mr(t,e,u,s,null,c)),this.open++,i}closeExtra(t=!1){let e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(t){for(let e=this.open;e>=0;e--){if(this.nodes[e]==t)return this.open=e,!0;this.localPreserveWS&&(this.nodes[e].options|=Zi)}return!1}get currentPos(){this.closeExtra();let t=0;for(let e=this.open;e>=0;e--){let i=this.nodes[e].content;for(let s=i.length-1;s>=0;s--)t+=i[s].nodeSize;e&&t++}return t}findAtPoint(t,e){if(this.find)for(let i=0;i<this.find.length;i++)this.find[i].node==t&&this.find[i].offset==e&&(this.find[i].pos=this.currentPos)}findInside(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].pos==null&&t.nodeType==1&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)}findAround(t,e,i){if(t!=e&&this.find)for(let s=0;s<this.find.length;s++)this.find[s].pos==null&&t.nodeType==1&&t.contains(this.find[s].node)&&e.compareDocumentPosition(this.find[s].node)&(i?2:4)&&(this.find[s].pos=this.currentPos)}findInText(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))}matchesContext(t){if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);let e=t.split("/"),i=this.options.context,s=!this.isOpen&&(!i||i.parent.type==this.nodes[0].type),o=-(i?i.depth+1:0)+(s?0:1),a=(c,u)=>{for(;c>=0;c--){let h=e[c];if(h==""){if(c==e.length-1||c==0)continue;for(;u>=o;u--)if(a(c-1,u))return!0;return!1}else{let f=u>0||u==0&&s?this.nodes[u].type:i&&u>=o?i.node(u-o).type:null;if(!f||f.name!=h&&!f.isInGroup(h))return!1;u--}}return!0};return a(e.length-1,this.open)}textblockFromContext(){let t=this.options.context;if(t)for(let e=t.depth;e>=0;e--){let i=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(i&&i.isTextblock&&i.defaultAttrs)return i}for(let e in this.parser.schema.nodes){let i=this.parser.schema.nodes[e];if(i.isTextblock&&i.defaultAttrs)return i}}}function pg(n){for(let t=n.firstChild,e=null;t;t=t.nextSibling){let i=t.nodeType==1?t.nodeName.toLowerCase():null;i&&ud.hasOwnProperty(i)&&e?(e.appendChild(t),t=e):i=="li"?e=t:i&&(e=null)}}function mg(n,t){return(n.matches||n.msMatchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector).call(n,t)}function vc(n){let t={};for(let e in n)t[e]=n[e];return t}function bc(n,t){let e=t.schema.nodes;for(let i in e){let s=e[i];if(!s.allowsMarkType(n))continue;let o=[],a=c=>{o.push(c);for(let u=0;u<c.edgeCount;u++){let{type:h,next:f}=c.edge(u);if(h==t||o.indexOf(f)<0&&a(f))return!0}};if(a(s.contentMatch))return!0}}class $n{constructor(t,e){this.nodes=t,this.marks=e}serializeFragment(t,e={},i){i||(i=fo(e).createDocumentFragment());let s=i,o=[];return t.forEach(a=>{if(o.length||a.marks.length){let c=0,u=0;for(;c<o.length&&u<a.marks.length;){let h=a.marks[u];if(!this.marks[h.type.name]){u++;continue}if(!h.eq(o[c][0])||h.type.spec.spanning===!1)break;c++,u++}for(;c<o.length;)s=o.pop()[1];for(;u<a.marks.length;){let h=a.marks[u++],f=this.serializeMark(h,a.isInline,e);f&&(o.push([h,s]),s.appendChild(f.dom),s=f.contentDOM||f.dom)}}s.appendChild(this.serializeNodeInner(a,e))}),i}serializeNodeInner(t,e){let{dom:i,contentDOM:s}=Nr(fo(e),this.nodes[t.type.name](t),null,t.attrs);if(s){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(t.content,e,s)}return i}serializeNode(t,e={}){let i=this.serializeNodeInner(t,e);for(let s=t.marks.length-1;s>=0;s--){let o=this.serializeMark(t.marks[s],t.isInline,e);o&&((o.contentDOM||o.dom).appendChild(i),i=o.dom)}return i}serializeMark(t,e,i={}){let s=this.marks[t.type.name];return s&&Nr(fo(i),s(t,e),null,t.attrs)}static renderSpec(t,e,i=null,s){return Nr(t,e,i,s)}static fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new $n(this.nodesFromSchema(t),this.marksFromSchema(t)))}static nodesFromSchema(t){let e=xc(t.nodes);return e.text||(e.text=i=>i.text),e}static marksFromSchema(t){return xc(t.marks)}}function xc(n){let t={};for(let e in n){let i=n[e].spec.toDOM;i&&(t[e]=i)}return t}function fo(n){return n.document||window.document}const wc=new WeakMap;function gg(n){let t=wc.get(n);return t===void 0&&wc.set(n,t=_g(n)),t}function _g(n){let t=null;function e(i){if(i&&typeof i=="object")if(Array.isArray(i))if(typeof i[0]=="string")t||(t=[]),t.push(i);else for(let s=0;s<i.length;s++)e(i[s]);else for(let s in i)e(i[s])}return e(n),t}function Nr(n,t,e,i){if(typeof t=="string")return{dom:n.createTextNode(t)};if(t.nodeType!=null)return{dom:t};if(t.dom&&t.dom.nodeType!=null)return t;let s=t[0],o;if(typeof s!="string")throw new RangeError("Invalid array passed to renderSpec");if(i&&(o=gg(i))&&o.indexOf(t)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let a=s.indexOf(" ");a>0&&(e=s.slice(0,a),s=s.slice(a+1));let c,u=e?n.createElementNS(e,s):n.createElement(s),h=t[1],f=1;if(h&&typeof h=="object"&&h.nodeType==null&&!Array.isArray(h)){f=2;for(let m in h)if(h[m]!=null){let _=m.indexOf(" ");_>0?u.setAttributeNS(m.slice(0,_),m.slice(_+1),h[m]):m=="style"&&u.style?u.style.cssText=h[m]:u.setAttribute(m,h[m])}}for(let m=f;m<t.length;m++){let _=t[m];if(_===0){if(m<t.length-1||m>f)throw new RangeError("Content hole must be the only child of its parent node");return{dom:u,contentDOM:u}}else{let{dom:y,contentDOM:v}=Nr(n,_,e,i);if(u.appendChild(y),v){if(c)throw new RangeError("Multiple content holes");c=v}}}return{dom:u,contentDOM:c}}const dd=65535,hd=Math.pow(2,16);function yg(n,t){return n+t*hd}function kc(n){return n&dd}function vg(n){return(n-(n&dd))/hd}const fd=1,pd=2,Dr=4,md=8;class Ro{constructor(t,e,i){this.pos=t,this.delInfo=e,this.recover=i}get deleted(){return(this.delInfo&md)>0}get deletedBefore(){return(this.delInfo&(fd|Dr))>0}get deletedAfter(){return(this.delInfo&(pd|Dr))>0}get deletedAcross(){return(this.delInfo&Dr)>0}}class de{constructor(t,e=!1){if(this.ranges=t,this.inverted=e,!t.length&&de.empty)return de.empty}recover(t){let e=0,i=kc(t);if(!this.inverted)for(let s=0;s<i;s++)e+=this.ranges[s*3+2]-this.ranges[s*3+1];return this.ranges[i*3]+e+vg(t)}mapResult(t,e=1){return this._map(t,e,!1)}map(t,e=1){return this._map(t,e,!0)}_map(t,e,i){let s=0,o=this.inverted?2:1,a=this.inverted?1:2;for(let c=0;c<this.ranges.length;c+=3){let u=this.ranges[c]-(this.inverted?s:0);if(u>t)break;let h=this.ranges[c+o],f=this.ranges[c+a],m=u+h;if(t<=m){let _=h?t==u?-1:t==m?1:e:e,y=u+s+(_<0?0:f);if(i)return y;let v=t==(e<0?u:m)?null:yg(c/3,t-u),x=t==u?pd:t==m?fd:Dr;return(e<0?t!=u:t!=m)&&(x|=md),new Ro(y,x,v)}s+=f-h}return i?t+s:new Ro(t+s,0,null)}touches(t,e){let i=0,s=kc(e),o=this.inverted?2:1,a=this.inverted?1:2;for(let c=0;c<this.ranges.length;c+=3){let u=this.ranges[c]-(this.inverted?i:0);if(u>t)break;let h=this.ranges[c+o],f=u+h;if(t<=f&&c==s*3)return!0;i+=this.ranges[c+a]-h}return!1}forEach(t){let e=this.inverted?2:1,i=this.inverted?1:2;for(let s=0,o=0;s<this.ranges.length;s+=3){let a=this.ranges[s],c=a-(this.inverted?o:0),u=a+(this.inverted?0:o),h=this.ranges[s+e],f=this.ranges[s+i];t(c,c+h,u,u+f),o+=f-h}}invert(){return new de(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return t==0?de.empty:new de(t<0?[0,-t,0]:[0,0,t])}}de.empty=new de([]);class Hi{constructor(t,e,i=0,s=t?t.length:0){this.mirror=e,this.from=i,this.to=s,this._maps=t||[],this.ownData=!(t||e)}get maps(){return this._maps}slice(t=0,e=this.maps.length){return new Hi(this._maps,this.mirror,t,e)}appendMap(t,e){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(t),e!=null&&this.setMirror(this._maps.length-1,e)}appendMapping(t){for(let e=0,i=this._maps.length;e<t._maps.length;e++){let s=t.getMirror(e);this.appendMap(t._maps[e],s!=null&&s<e?i+s:void 0)}}getMirror(t){if(this.mirror){for(let e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]}}setMirror(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)}appendMappingInverted(t){for(let e=t.maps.length-1,i=this._maps.length+t._maps.length;e>=0;e--){let s=t.getMirror(e);this.appendMap(t._maps[e].invert(),s!=null&&s>e?i-s-1:void 0)}}invert(){let t=new Hi;return t.appendMappingInverted(this),t}map(t,e=1){if(this.mirror)return this._map(t,e,!0);for(let i=this.from;i<this.to;i++)t=this._maps[i].map(t,e);return t}mapResult(t,e=1){return this._map(t,e,!1)}_map(t,e,i){let s=0;for(let o=this.from;o<this.to;o++){let a=this._maps[o],c=a.mapResult(t,e);if(c.recover!=null){let u=this.getMirror(o);if(u!=null&&u>o&&u<this.to){o=u,t=this._maps[u].recover(c.recover);continue}}s|=c.delInfo,t=c.pos}return i?t:new Ro(t,s,null)}}const po=Object.create(null);class Gt{getMap(){return de.empty}merge(t){return null}static fromJSON(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");let i=po[e.stepType];if(!i)throw new RangeError(`No step type ${e.stepType} defined`);return i.fromJSON(t,e)}static jsonID(t,e){if(t in po)throw new RangeError("Duplicate use of step JSON ID "+t);return po[t]=e,e.prototype.jsonID=t,e}}class Lt{constructor(t,e){this.doc=t,this.failed=e}static ok(t){return new Lt(t,null)}static fail(t){return new Lt(null,t)}static fromReplace(t,e,i,s){try{return Lt.ok(t.replace(e,i,s))}catch(o){if(o instanceof Zr)return Lt.fail(o.message);throw o}}}function ga(n,t,e){let i=[];for(let s=0;s<n.childCount;s++){let o=n.child(s);o.content.size&&(o=o.copy(ga(o.content,t,o))),o.isInline&&(o=t(o,e,s)),i.push(o)}return A.fromArray(i)}class tn extends Gt{constructor(t,e,i){super(),this.from=t,this.to=e,this.mark=i}apply(t){let e=t.slice(this.from,this.to),i=t.resolve(this.from),s=i.node(i.sharedDepth(this.to)),o=new B(ga(e.content,(a,c)=>!a.isAtom||!c.type.allowsMarkType(this.mark.type)?a:a.mark(this.mark.addToSet(a.marks)),s),e.openStart,e.openEnd);return Lt.fromReplace(t,this.from,this.to,o)}invert(){return new Me(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),i=t.mapResult(this.to,-1);return e.deleted&&i.deleted||e.pos>=i.pos?null:new tn(e.pos,i.pos,this.mark)}merge(t){return t instanceof tn&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new tn(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new tn(e.from,e.to,t.markFromJSON(e.mark))}}Gt.jsonID("addMark",tn);class Me extends Gt{constructor(t,e,i){super(),this.from=t,this.to=e,this.mark=i}apply(t){let e=t.slice(this.from,this.to),i=new B(ga(e.content,s=>s.mark(this.mark.removeFromSet(s.marks)),t),e.openStart,e.openEnd);return Lt.fromReplace(t,this.from,this.to,i)}invert(){return new tn(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),i=t.mapResult(this.to,-1);return e.deleted&&i.deleted||e.pos>=i.pos?null:new Me(e.pos,i.pos,this.mark)}merge(t){return t instanceof Me&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new Me(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Me(e.from,e.to,t.markFromJSON(e.mark))}}Gt.jsonID("removeMark",Me);class en extends Gt{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return Lt.fail("No node at mark step's position");let i=e.type.create(e.attrs,null,this.mark.addToSet(e.marks));return Lt.fromReplace(t,this.pos,this.pos+1,new B(A.from(i),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);if(e){let i=this.mark.addToSet(e.marks);if(i.length==e.marks.length){for(let s=0;s<e.marks.length;s++)if(!e.marks[s].isInSet(i))return new en(this.pos,e.marks[s]);return new en(this.pos,this.mark)}}return new An(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new en(e.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new en(e.pos,t.markFromJSON(e.mark))}}Gt.jsonID("addNodeMark",en);class An extends Gt{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return Lt.fail("No node at mark step's position");let i=e.type.create(e.attrs,null,this.mark.removeFromSet(e.marks));return Lt.fromReplace(t,this.pos,this.pos+1,new B(A.from(i),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);return!e||!this.mark.isInSet(e.marks)?this:new en(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new An(e.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new An(e.pos,t.markFromJSON(e.mark))}}Gt.jsonID("removeNodeMark",An);class Nt extends Gt{constructor(t,e,i,s=!1){super(),this.from=t,this.to=e,this.slice=i,this.structure=s}apply(t){return this.structure&&Bo(t,this.from,this.to)?Lt.fail("Structure replace would overwrite content"):Lt.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new de([this.from,this.to-this.from,this.slice.size])}invert(t){return new Nt(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let e=t.mapResult(this.from,1),i=t.mapResult(this.to,-1);return e.deletedAcross&&i.deletedAcross?null:new Nt(e.pos,Math.max(e.pos,i.pos),this.slice,this.structure)}merge(t){if(!(t instanceof Nt)||t.structure||this.structure)return null;if(this.from+this.slice.size==t.from&&!this.slice.openEnd&&!t.slice.openStart){let e=this.slice.size+t.slice.size==0?B.empty:new B(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new Nt(this.from,this.to+(t.to-t.from),e,this.structure)}else if(t.to==this.from&&!this.slice.openStart&&!t.slice.openEnd){let e=this.slice.size+t.slice.size==0?B.empty:new B(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new Nt(t.from,this.to,e,this.structure)}else return null}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new Nt(e.from,e.to,B.fromJSON(t,e.slice),!!e.structure)}}Gt.jsonID("replace",Nt);class Dt extends Gt{constructor(t,e,i,s,o,a,c=!1){super(),this.from=t,this.to=e,this.gapFrom=i,this.gapTo=s,this.slice=o,this.insert=a,this.structure=c}apply(t){if(this.structure&&(Bo(t,this.from,this.gapFrom)||Bo(t,this.gapTo,this.to)))return Lt.fail("Structure gap-replace would overwrite content");let e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return Lt.fail("Gap is not a flat range");let i=this.slice.insertAt(this.insert,e.content);return i?Lt.fromReplace(t,this.from,this.to,i):Lt.fail("Content does not fit in gap")}getMap(){return new de([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let e=this.gapTo-this.gapFrom;return new Dt(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let e=t.mapResult(this.from,1),i=t.mapResult(this.to,-1),s=this.from==this.gapFrom?e.pos:t.map(this.gapFrom,-1),o=this.to==this.gapTo?i.pos:t.map(this.gapTo,1);return e.deletedAcross&&i.deletedAcross||s<e.pos||o>i.pos?null:new Dt(e.pos,i.pos,s,o,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number"||typeof e.gapFrom!="number"||typeof e.gapTo!="number"||typeof e.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Dt(e.from,e.to,e.gapFrom,e.gapTo,B.fromJSON(t,e.slice),e.insert,!!e.structure)}}Gt.jsonID("replaceAround",Dt);function Bo(n,t,e){let i=n.resolve(t),s=e-t,o=i.depth;for(;s>0&&o>0&&i.indexAfter(o)==i.node(o).childCount;)o--,s--;if(s>0){let a=i.node(o).maybeChild(i.indexAfter(o));for(;s>0;){if(!a||a.isLeaf)return!0;a=a.firstChild,s--}}return!1}function bg(n,t,e,i){let s=[],o=[],a,c;n.doc.nodesBetween(t,e,(u,h,f)=>{if(!u.isInline)return;let m=u.marks;if(!i.isInSet(m)&&f.type.allowsMarkType(i.type)){let _=Math.max(h,t),y=Math.min(h+u.nodeSize,e),v=i.addToSet(m);for(let x=0;x<m.length;x++)m[x].isInSet(v)||(a&&a.to==_&&a.mark.eq(m[x])?a.to=y:s.push(a=new Me(_,y,m[x])));c&&c.to==_?c.to=y:o.push(c=new tn(_,y,i))}}),s.forEach(u=>n.step(u)),o.forEach(u=>n.step(u))}function xg(n,t,e,i){let s=[],o=0;n.doc.nodesBetween(t,e,(a,c)=>{if(!a.isInline)return;o++;let u=null;if(i instanceof ps){let h=a.marks,f;for(;f=i.isInSet(h);)(u||(u=[])).push(f),h=f.removeFromSet(h)}else i?i.isInSet(a.marks)&&(u=[i]):u=a.marks;if(u&&u.length){let h=Math.min(c+a.nodeSize,e);for(let f=0;f<u.length;f++){let m=u[f],_;for(let y=0;y<s.length;y++){let v=s[y];v.step==o-1&&m.eq(s[y].style)&&(_=v)}_?(_.to=h,_.step=o):s.push({style:m,from:Math.max(c,t),to:h,step:o})}}}),s.forEach(a=>n.step(new Me(a.from,a.to,a.style)))}function _a(n,t,e,i=e.contentMatch,s=!0){let o=n.doc.nodeAt(t),a=[],c=t+1;for(let u=0;u<o.childCount;u++){let h=o.child(u),f=c+h.nodeSize,m=i.matchType(h.type);if(!m)a.push(new Nt(c,f,B.empty));else{i=m;for(let _=0;_<h.marks.length;_++)e.allowsMarkType(h.marks[_].type)||n.step(new Me(c,f,h.marks[_]));if(s&&h.isText&&e.whitespace!="pre"){let _,y=/\r?\n|\r/g,v;for(;_=y.exec(h.text);)v||(v=new B(A.from(e.schema.text(" ",e.allowedMarks(h.marks))),0,0)),a.push(new Nt(c+_.index,c+_.index+_[0].length,v))}}c=f}if(!i.validEnd){let u=i.fillBefore(A.empty,!0);n.replace(c,c,new B(u,0,0))}for(let u=a.length-1;u>=0;u--)n.step(a[u])}function wg(n,t,e){return(t==0||n.canReplace(t,n.childCount))&&(e==n.childCount||n.canReplace(0,e))}function Fn(n){let e=n.parent.content.cutByIndex(n.startIndex,n.endIndex);for(let i=n.depth;;--i){let s=n.$from.node(i),o=n.$from.index(i),a=n.$to.indexAfter(i);if(i<n.depth&&s.canReplace(o,a,e))return i;if(i==0||s.type.spec.isolating||!wg(s,o,a))break}return null}function kg(n,t,e){let{$from:i,$to:s,depth:o}=t,a=i.before(o+1),c=s.after(o+1),u=a,h=c,f=A.empty,m=0;for(let v=o,x=!1;v>e;v--)x||i.index(v)>0?(x=!0,f=A.from(i.node(v).copy(f)),m++):u--;let _=A.empty,y=0;for(let v=o,x=!1;v>e;v--)x||s.after(v+1)<s.end(v)?(x=!0,_=A.from(s.node(v).copy(_)),y++):h++;n.step(new Dt(u,h,a,c,new B(f.append(_),m,y),f.size-m,!0))}function ya(n,t,e=null,i=n){let s=Sg(n,t),o=s&&Mg(i,t);return o?s.map(Sc).concat({type:t,attrs:e}).concat(o.map(Sc)):null}function Sc(n){return{type:n,attrs:null}}function Sg(n,t){let{parent:e,startIndex:i,endIndex:s}=n,o=e.contentMatchAt(i).findWrapping(t);if(!o)return null;let a=o.length?o[0]:t;return e.canReplaceWith(i,s,a)?o:null}function Mg(n,t){let{parent:e,startIndex:i,endIndex:s}=n,o=e.child(i),a=t.contentMatch.findWrapping(o.type);if(!a)return null;let u=(a.length?a[a.length-1]:t).contentMatch;for(let h=i;u&&h<s;h++)u=u.matchType(e.child(h).type);return!u||!u.validEnd?null:a}function Cg(n,t,e){let i=A.empty;for(let a=e.length-1;a>=0;a--){if(i.size){let c=e[a].type.contentMatch.matchFragment(i);if(!c||!c.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}i=A.from(e[a].type.create(e[a].attrs,i))}let s=t.start,o=t.end;n.step(new Dt(s,o,s,o,new B(i,0,0),e.length,!0))}function Tg(n,t,e,i,s){if(!i.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let o=n.steps.length;n.doc.nodesBetween(t,e,(a,c)=>{let u=typeof s=="function"?s(a):s;if(a.isTextblock&&!a.hasMarkup(i,u)&&Pg(n.doc,n.mapping.slice(o).map(c),i)){let h=null;if(i.schema.linebreakReplacement){let y=i.whitespace=="pre",v=!!i.contentMatch.matchType(i.schema.linebreakReplacement);y&&!v?h=!1:!y&&v&&(h=!0)}h===!1&&_d(n,a,c,o),_a(n,n.mapping.slice(o).map(c,1),i,void 0,h===null);let f=n.mapping.slice(o),m=f.map(c,1),_=f.map(c+a.nodeSize,1);return n.step(new Dt(m,_,m+1,_-1,new B(A.from(i.create(u,null,a.marks)),0,0),1,!0)),h===!0&&gd(n,a,c,o),!1}})}function gd(n,t,e,i){t.forEach((s,o)=>{if(s.isText){let a,c=/\r?\n|\r/g;for(;a=c.exec(s.text);){let u=n.mapping.slice(i).map(e+1+o+a.index);n.replaceWith(u,u+1,t.type.schema.linebreakReplacement.create())}}})}function _d(n,t,e,i){t.forEach((s,o)=>{if(s.type==s.type.schema.linebreakReplacement){let a=n.mapping.slice(i).map(e+1+o);n.replaceWith(a,a+1,t.type.schema.text(`
`))}})}function Pg(n,t,e){let i=n.resolve(t),s=i.index();return i.parent.canReplaceWith(s,s+1,e)}function Eg(n,t,e,i,s){let o=n.doc.nodeAt(t);if(!o)throw new RangeError("No node at given position");e||(e=o.type);let a=e.create(i,null,s||o.marks);if(o.isLeaf)return n.replaceWith(t,t+o.nodeSize,a);if(!e.validContent(o.content))throw new RangeError("Invalid content for node type "+e.name);n.step(new Dt(t,t+o.nodeSize,t+1,t+o.nodeSize-1,new B(A.from(a),0,0),1,!0))}function fe(n,t,e=1,i){let s=n.resolve(t),o=s.depth-e,a=i&&i[i.length-1]||s.parent;if(o<0||s.parent.type.spec.isolating||!s.parent.canReplace(s.index(),s.parent.childCount)||!a.type.validContent(s.parent.content.cutByIndex(s.index(),s.parent.childCount)))return!1;for(let h=s.depth-1,f=e-2;h>o;h--,f--){let m=s.node(h),_=s.index(h);if(m.type.spec.isolating)return!1;let y=m.content.cutByIndex(_,m.childCount),v=i&&i[f+1];v&&(y=y.replaceChild(0,v.type.create(v.attrs)));let x=i&&i[f]||m;if(!m.canReplace(_+1,m.childCount)||!x.type.validContent(y))return!1}let c=s.indexAfter(o),u=i&&i[0];return s.node(o).canReplaceWith(c,c,u?u.type:s.node(o+1).type)}function Og(n,t,e=1,i){let s=n.doc.resolve(t),o=A.empty,a=A.empty;for(let c=s.depth,u=s.depth-e,h=e-1;c>u;c--,h--){o=A.from(s.node(c).copy(o));let f=i&&i[h];a=A.from(f?f.type.create(f.attrs,a):s.node(c).copy(a))}n.step(new Nt(t,t,new B(o.append(a),e,e),!0))}function ze(n,t){let e=n.resolve(t),i=e.index();return yd(e.nodeBefore,e.nodeAfter)&&e.parent.canReplace(i,i+1)}function Lg(n,t){t.content.size||n.type.compatibleContent(t.type);let e=n.contentMatchAt(n.childCount),{linebreakReplacement:i}=n.type.schema;for(let s=0;s<t.childCount;s++){let o=t.child(s),a=o.type==i?n.type.schema.nodes.text:o.type;if(e=e.matchType(a),!e||!n.type.allowsMarks(o.marks))return!1}return e.validEnd}function yd(n,t){return!!(n&&t&&!n.isLeaf&&Lg(n,t))}function pi(n,t,e=-1){let i=n.resolve(t);for(let s=i.depth;;s--){let o,a,c=i.index(s);if(s==i.depth?(o=i.nodeBefore,a=i.nodeAfter):e>0?(o=i.node(s+1),c++,a=i.node(s).maybeChild(c)):(o=i.node(s).maybeChild(c-1),a=i.node(s+1)),o&&!o.isTextblock&&yd(o,a)&&i.node(s).canReplace(c,c+1))return t;if(s==0)break;t=e<0?i.before(s):i.after(s)}}function Ag(n,t,e){let i=null,{linebreakReplacement:s}=n.doc.type.schema,o=n.doc.resolve(t-e),a=o.node().type;if(s&&a.inlineContent){let f=a.whitespace=="pre",m=!!a.contentMatch.matchType(s);f&&!m?i=!1:!f&&m&&(i=!0)}let c=n.steps.length;if(i===!1){let f=n.doc.resolve(t+e);_d(n,f.node(),f.before(),c)}a.inlineContent&&_a(n,t+e-1,a,o.node().contentMatchAt(o.index()),i==null);let u=n.mapping.slice(c),h=u.map(t-e);if(n.step(new Nt(h,u.map(t+e,-1),B.empty,!0)),i===!0){let f=n.doc.resolve(h);gd(n,f.node(),f.before(),n.steps.length)}return n}function Ig(n,t,e){let i=n.resolve(t);if(i.parent.canReplaceWith(i.index(),i.index(),e))return t;if(i.parentOffset==0)for(let s=i.depth-1;s>=0;s--){let o=i.index(s);if(i.node(s).canReplaceWith(o,o,e))return i.before(s+1);if(o>0)return null}if(i.parentOffset==i.parent.content.size)for(let s=i.depth-1;s>=0;s--){let o=i.indexAfter(s);if(i.node(s).canReplaceWith(o,o,e))return i.after(s+1);if(o<i.node(s).childCount)return null}return null}function vd(n,t,e){let i=n.resolve(t);if(!e.content.size)return t;let s=e.content;for(let o=0;o<e.openStart;o++)s=s.firstChild.content;for(let o=1;o<=(e.openStart==0&&e.size?2:1);o++)for(let a=i.depth;a>=0;a--){let c=a==i.depth?0:i.pos<=(i.start(a+1)+i.end(a+1))/2?-1:1,u=i.index(a)+(c>0?1:0),h=i.node(a),f=!1;if(o==1)f=h.canReplace(u,u,s);else{let m=h.contentMatchAt(u).findWrapping(s.firstChild.type);f=m&&h.canReplaceWith(u,u,m[0])}if(f)return c==0?i.pos:c<0?i.before(a+1):i.after(a+1)}return null}function ms(n,t,e=t,i=B.empty){if(t==e&&!i.size)return null;let s=n.resolve(t),o=n.resolve(e);return bd(s,o,i)?new Nt(t,e,i):new Ng(s,o,i).fit()}function bd(n,t,e){return!e.openStart&&!e.openEnd&&n.start()==t.start()&&n.parent.canReplace(n.index(),t.index(),e.content)}class Ng{constructor(t,e,i){this.$from=t,this.$to=e,this.unplaced=i,this.frontier=[],this.placed=A.empty;for(let s=0;s<=t.depth;s++){let o=t.node(s);this.frontier.push({type:o.type,match:o.contentMatchAt(t.indexAfter(s))})}for(let s=t.depth;s>0;s--)this.placed=A.from(t.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let h=this.findFittable();h?this.placeNodes(h):this.openMore()||this.dropNode()}let t=this.mustMoveInline(),e=this.placed.size-this.depth-this.$from.depth,i=this.$from,s=this.close(t<0?this.$to:i.doc.resolve(t));if(!s)return null;let o=this.placed,a=i.depth,c=s.depth;for(;a&&c&&o.childCount==1;)o=o.firstChild.content,a--,c--;let u=new B(o,a,c);return t>-1?new Dt(i.pos,t,this.$to.pos,this.$to.end(),u,e):u.size||i.pos!=this.$to.pos?new Nt(i.pos,s.pos,u):null}findFittable(){let t=this.unplaced.openStart;for(let e=this.unplaced.content,i=0,s=this.unplaced.openEnd;i<t;i++){let o=e.firstChild;if(e.childCount>1&&(s=0),o.type.spec.isolating&&s<=i){t=i;break}e=o.content}for(let e=1;e<=2;e++)for(let i=e==1?t:this.unplaced.openStart;i>=0;i--){let s,o=null;i?(o=mo(this.unplaced.content,i-1).firstChild,s=o.content):s=this.unplaced.content;let a=s.firstChild;for(let c=this.depth;c>=0;c--){let{type:u,match:h}=this.frontier[c],f,m=null;if(e==1&&(a?h.matchType(a.type)||(m=h.fillBefore(A.from(a),!1)):o&&u.compatibleContent(o.type)))return{sliceDepth:i,frontierDepth:c,parent:o,inject:m};if(e==2&&a&&(f=h.findWrapping(a.type)))return{sliceDepth:i,frontierDepth:c,parent:o,wrap:f};if(o&&h.matchType(o.type))break}}}openMore(){let{content:t,openStart:e,openEnd:i}=this.unplaced,s=mo(t,e);return!s.childCount||s.firstChild.isLeaf?!1:(this.unplaced=new B(t,e+1,Math.max(i,s.size+e>=t.size-i?e+1:0)),!0)}dropNode(){let{content:t,openStart:e,openEnd:i}=this.unplaced,s=mo(t,e);if(s.childCount<=1&&e>0){let o=t.size-e<=e+s.size;this.unplaced=new B(Ai(t,e-1,1),e-1,o?e-1:i)}else this.unplaced=new B(Ai(t,e,1),e,i)}placeNodes({sliceDepth:t,frontierDepth:e,parent:i,inject:s,wrap:o}){for(;this.depth>e;)this.closeFrontierNode();if(o)for(let x=0;x<o.length;x++)this.openFrontierNode(o[x]);let a=this.unplaced,c=i?i.content:a.content,u=a.openStart-t,h=0,f=[],{match:m,type:_}=this.frontier[e];if(s){for(let x=0;x<s.childCount;x++)f.push(s.child(x));m=m.matchFragment(s)}let y=c.size+t-(a.content.size-a.openEnd);for(;h<c.childCount;){let x=c.child(h),k=m.matchType(x.type);if(!k)break;h++,(h>1||u==0||x.content.size)&&(m=k,f.push(xd(x.mark(_.allowedMarks(x.marks)),h==1?u:0,h==c.childCount?y:-1)))}let v=h==c.childCount;v||(y=-1),this.placed=Ii(this.placed,e,A.from(f)),this.frontier[e].match=m,v&&y<0&&i&&i.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let x=0,k=c;x<y;x++){let C=k.lastChild;this.frontier.push({type:C.type,match:C.contentMatchAt(C.childCount)}),k=C.content}this.unplaced=v?t==0?B.empty:new B(Ai(a.content,t-1,1),t-1,y<0?a.openEnd:t-1):new B(Ai(a.content,t,h),a.openStart,a.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let t=this.frontier[this.depth],e;if(!t.type.isTextblock||!go(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;let{depth:i}=this.$to,s=this.$to.after(i);for(;i>1&&s==this.$to.end(--i);)++s;return s}findCloseLevel(t){t:for(let e=Math.min(this.depth,t.depth);e>=0;e--){let{match:i,type:s}=this.frontier[e],o=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),a=go(t,e,s,i,o);if(a){for(let c=e-1;c>=0;c--){let{match:u,type:h}=this.frontier[c],f=go(t,c,h,u,!0);if(!f||f.childCount)continue t}return{depth:e,fit:a,move:o?t.doc.resolve(t.after(e+1)):t}}}}close(t){let e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=Ii(this.placed,e.depth,e.fit)),t=e.move;for(let i=e.depth+1;i<=t.depth;i++){let s=t.node(i),o=s.type.contentMatch.fillBefore(s.content,!0,t.index(i));this.openFrontierNode(s.type,s.attrs,o)}return t}openFrontierNode(t,e=null,i){let s=this.frontier[this.depth];s.match=s.match.matchType(t),this.placed=Ii(this.placed,this.depth,A.from(t.create(e,i))),this.frontier.push({type:t,match:t.contentMatch})}closeFrontierNode(){let e=this.frontier.pop().match.fillBefore(A.empty,!0);e.childCount&&(this.placed=Ii(this.placed,this.frontier.length,e))}}function Ai(n,t,e){return t==0?n.cutByIndex(e,n.childCount):n.replaceChild(0,n.firstChild.copy(Ai(n.firstChild.content,t-1,e)))}function Ii(n,t,e){return t==0?n.append(e):n.replaceChild(n.childCount-1,n.lastChild.copy(Ii(n.lastChild.content,t-1,e)))}function mo(n,t){for(let e=0;e<t;e++)n=n.firstChild.content;return n}function xd(n,t,e){if(t<=0)return n;let i=n.content;return t>1&&(i=i.replaceChild(0,xd(i.firstChild,t-1,i.childCount==1?e-1:0))),t>0&&(i=n.type.contentMatch.fillBefore(i).append(i),e<=0&&(i=i.append(n.type.contentMatch.matchFragment(i).fillBefore(A.empty,!0)))),n.copy(i)}function go(n,t,e,i,s){let o=n.node(t),a=s?n.indexAfter(t):n.index(t);if(a==o.childCount&&!e.compatibleContent(o.type))return null;let c=i.fillBefore(o.content,!0,a);return c&&!Dg(e,o.content,a)?c:null}function Dg(n,t,e){for(let i=e;i<t.childCount;i++)if(!n.allowsMarks(t.child(i).marks))return!0;return!1}function zg(n){return n.spec.defining||n.spec.definingForContent}function Rg(n,t,e,i){if(!i.size)return n.deleteRange(t,e);let s=n.doc.resolve(t),o=n.doc.resolve(e);if(bd(s,o,i))return n.step(new Nt(t,e,i));let a=kd(s,n.doc.resolve(e));a[a.length-1]==0&&a.pop();let c=-(s.depth+1);a.unshift(c);for(let _=s.depth,y=s.pos-1;_>0;_--,y--){let v=s.node(_).type.spec;if(v.defining||v.definingAsContext||v.isolating)break;a.indexOf(_)>-1?c=_:s.before(_)==y&&a.splice(1,0,-_)}let u=a.indexOf(c),h=[],f=i.openStart;for(let _=i.content,y=0;;y++){let v=_.firstChild;if(h.push(v),y==i.openStart)break;_=v.content}for(let _=f-1;_>=0;_--){let y=h[_],v=zg(y.type);if(v&&!y.sameMarkup(s.node(Math.abs(c)-1)))f=_;else if(v||!y.type.isTextblock)break}for(let _=i.openStart;_>=0;_--){let y=(_+f+1)%(i.openStart+1),v=h[y];if(v)for(let x=0;x<a.length;x++){let k=a[(x+u)%a.length],C=!0;k<0&&(C=!1,k=-k);let O=s.node(k-1),N=s.index(k-1);if(O.canReplaceWith(N,N,v.type,v.marks))return n.replace(s.before(k),C?o.after(k):e,new B(wd(i.content,0,i.openStart,y),y,i.openEnd))}}let m=n.steps.length;for(let _=a.length-1;_>=0&&(n.replace(t,e,i),!(n.steps.length>m));_--){let y=a[_];y<0||(t=s.before(y),e=o.after(y))}}function wd(n,t,e,i,s){if(t<e){let o=n.firstChild;n=n.replaceChild(0,o.copy(wd(o.content,t+1,e,i,o)))}if(t>i){let o=s.contentMatchAt(0),a=o.fillBefore(n).append(n);n=a.append(o.matchFragment(a).fillBefore(A.empty,!0))}return n}function Bg(n,t,e,i){if(!i.isInline&&t==e&&n.doc.resolve(t).parent.content.size){let s=Ig(n.doc,t,i.type);s!=null&&(t=e=s)}n.replaceRange(t,e,new B(A.from(i),0,0))}function $g(n,t,e){let i=n.doc.resolve(t),s=n.doc.resolve(e),o=kd(i,s);for(let a=0;a<o.length;a++){let c=o[a],u=a==o.length-1;if(u&&c==0||i.node(c).type.contentMatch.validEnd)return n.delete(i.start(c),s.end(c));if(c>0&&(u||i.node(c-1).canReplace(i.index(c-1),s.indexAfter(c-1))))return n.delete(i.before(c),s.after(c))}for(let a=1;a<=i.depth&&a<=s.depth;a++)if(t-i.start(a)==i.depth-a&&e>i.end(a)&&s.end(a)-e!=s.depth-a&&i.start(a-1)==s.start(a-1)&&i.node(a-1).canReplace(i.index(a-1),s.index(a-1)))return n.delete(i.before(a),e);n.delete(t,e)}function kd(n,t){let e=[],i=Math.min(n.depth,t.depth);for(let s=i;s>=0;s--){let o=n.start(s);if(o<n.pos-(n.depth-s)||t.end(s)>t.pos+(t.depth-s)||n.node(s).type.spec.isolating||t.node(s).type.spec.isolating)break;(o==t.start(s)||s==n.depth&&s==t.depth&&n.parent.inlineContent&&t.parent.inlineContent&&s&&t.start(s-1)==o-1)&&e.push(s)}return e}class ii extends Gt{constructor(t,e,i){super(),this.pos=t,this.attr=e,this.value=i}apply(t){let e=t.nodeAt(this.pos);if(!e)return Lt.fail("No node at attribute step's position");let i=Object.create(null);for(let o in e.attrs)i[o]=e.attrs[o];i[this.attr]=this.value;let s=e.type.create(i,null,e.marks);return Lt.fromReplace(t,this.pos,this.pos+1,new B(A.from(s),0,e.isLeaf?0:1))}getMap(){return de.empty}invert(t){return new ii(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new ii(e.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,e){if(typeof e.pos!="number"||typeof e.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new ii(e.pos,e.attr,e.value)}}Gt.jsonID("attr",ii);class Wi extends Gt{constructor(t,e){super(),this.attr=t,this.value=e}apply(t){let e=Object.create(null);for(let s in t.attrs)e[s]=t.attrs[s];e[this.attr]=this.value;let i=t.type.create(e,t.content,t.marks);return Lt.ok(i)}getMap(){return de.empty}invert(t){return new Wi(this.attr,t.attrs[this.attr])}map(t){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(t,e){if(typeof e.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Wi(e.attr,e.value)}}Gt.jsonID("docAttr",Wi);let si=class extends Error{};si=function n(t){let e=Error.call(this,t);return e.__proto__=n.prototype,e};si.prototype=Object.create(Error.prototype);si.prototype.constructor=si;si.prototype.name="TransformError";class Sd{constructor(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new Hi}get before(){return this.docs.length?this.docs[0]:this.doc}step(t){let e=this.maybeStep(t);if(e.failed)throw new si(e.failed);return this}maybeStep(t){let e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e}get docChanged(){return this.steps.length>0}addStep(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e}replace(t,e=t,i=B.empty){let s=ms(this.doc,t,e,i);return s&&this.step(s),this}replaceWith(t,e,i){return this.replace(t,e,new B(A.from(i),0,0))}delete(t,e){return this.replace(t,e,B.empty)}insert(t,e){return this.replaceWith(t,t,e)}replaceRange(t,e,i){return Rg(this,t,e,i),this}replaceRangeWith(t,e,i){return Bg(this,t,e,i),this}deleteRange(t,e){return $g(this,t,e),this}lift(t,e){return kg(this,t,e),this}join(t,e=1){return Ag(this,t,e),this}wrap(t,e){return Cg(this,t,e),this}setBlockType(t,e=t,i,s=null){return Tg(this,t,e,i,s),this}setNodeMarkup(t,e,i=null,s){return Eg(this,t,e,i,s),this}setNodeAttribute(t,e,i){return this.step(new ii(t,e,i)),this}setDocAttribute(t,e){return this.step(new Wi(t,e)),this}addNodeMark(t,e){return this.step(new en(t,e)),this}removeNodeMark(t,e){let i=this.doc.nodeAt(t);if(!i)throw new RangeError("No node at position "+t);if(e instanceof pt)e.isInSet(i.marks)&&this.step(new An(t,e));else{let s=i.marks,o,a=[];for(;o=e.isInSet(s);)a.push(new An(t,o)),s=o.removeFromSet(s);for(let c=a.length-1;c>=0;c--)this.step(a[c])}return this}split(t,e=1,i){return Og(this,t,e,i),this}addMark(t,e,i){return bg(this,t,e,i),this}removeMark(t,e,i){return xg(this,t,e,i),this}clearIncompatible(t,e,i){return _a(this,t,e,i),this}}const _o=Object.create(null);class Q{constructor(t,e,i){this.$anchor=t,this.$head=e,this.ranges=i||[new Fg(t.min(e),t.max(e))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let t=this.ranges;for(let e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(t,e=B.empty){let i=e.content.lastChild,s=null;for(let c=0;c<e.openEnd;c++)s=i,i=i.lastChild;let o=t.steps.length,a=this.ranges;for(let c=0;c<a.length;c++){let{$from:u,$to:h}=a[c],f=t.mapping.slice(o);t.replaceRange(f.map(u.pos),f.map(h.pos),c?B.empty:e),c==0&&Tc(t,o,(i?i.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(t,e){let i=t.steps.length,s=this.ranges;for(let o=0;o<s.length;o++){let{$from:a,$to:c}=s[o],u=t.mapping.slice(i),h=u.map(a.pos),f=u.map(c.pos);o?t.deleteRange(h,f):(t.replaceRangeWith(h,f,e),Tc(t,i,e.isInline?-1:1))}}static findFrom(t,e,i=!1){let s=t.parent.inlineContent?new U(t):Xn(t.node(0),t.parent,t.pos,t.index(),e,i);if(s)return s;for(let o=t.depth-1;o>=0;o--){let a=e<0?Xn(t.node(0),t.node(o),t.before(o+1),t.index(o),e,i):Xn(t.node(0),t.node(o),t.after(o+1),t.index(o)+1,e,i);if(a)return a}return null}static near(t,e=1){return this.findFrom(t,e)||this.findFrom(t,-e)||new oe(t.node(0))}static atStart(t){return Xn(t,t,0,0,1)||new oe(t)}static atEnd(t){return Xn(t,t,t.content.size,t.childCount,-1)||new oe(t)}static fromJSON(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");let i=_o[e.type];if(!i)throw new RangeError(`No selection type ${e.type} defined`);return i.fromJSON(t,e)}static jsonID(t,e){if(t in _o)throw new RangeError("Duplicate use of selection JSON ID "+t);return _o[t]=e,e.prototype.jsonID=t,e}getBookmark(){return U.between(this.$anchor,this.$head).getBookmark()}}Q.prototype.visible=!0;class Fg{constructor(t,e){this.$from=t,this.$to=e}}let Mc=!1;function Cc(n){!Mc&&!n.parent.inlineContent&&(Mc=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+n.parent.type.name+")"))}class U extends Q{constructor(t,e=t){Cc(t),Cc(e),super(t,e)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(t,e){let i=t.resolve(e.map(this.head));if(!i.parent.inlineContent)return Q.near(i);let s=t.resolve(e.map(this.anchor));return new U(s.parent.inlineContent?s:i,i)}replace(t,e=B.empty){if(super.replace(t,e),e==B.empty){let i=this.$from.marksAcross(this.$to);i&&t.ensureMarks(i)}}eq(t){return t instanceof U&&t.anchor==this.anchor&&t.head==this.head}getBookmark(){return new gs(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(t,e){if(typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new U(t.resolve(e.anchor),t.resolve(e.head))}static create(t,e,i=e){let s=t.resolve(e);return new this(s,i==e?s:t.resolve(i))}static between(t,e,i){let s=t.pos-e.pos;if((!i||s)&&(i=s>=0?1:-1),!e.parent.inlineContent){let o=Q.findFrom(e,i,!0)||Q.findFrom(e,-i,!0);if(o)e=o.$head;else return Q.near(e,i)}return t.parent.inlineContent||(s==0?t=e:(t=(Q.findFrom(t,-i,!0)||Q.findFrom(t,i,!0)).$anchor,t.pos<e.pos!=s<0&&(t=e))),new U(t,e)}}Q.jsonID("text",U);class gs{constructor(t,e){this.anchor=t,this.head=e}map(t){return new gs(t.map(this.anchor),t.map(this.head))}resolve(t){return U.between(t.resolve(this.anchor),t.resolve(this.head))}}class j extends Q{constructor(t){let e=t.nodeAfter,i=t.node(0).resolve(t.pos+e.nodeSize);super(t,i),this.node=e}map(t,e){let{deleted:i,pos:s}=e.mapResult(this.anchor),o=t.resolve(s);return i?Q.near(o):new j(o)}content(){return new B(A.from(this.node),0,0)}eq(t){return t instanceof j&&t.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new va(this.anchor)}static fromJSON(t,e){if(typeof e.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new j(t.resolve(e.anchor))}static create(t,e){return new j(t.resolve(e))}static isSelectable(t){return!t.isText&&t.type.spec.selectable!==!1}}j.prototype.visible=!1;Q.jsonID("node",j);class va{constructor(t){this.anchor=t}map(t){let{deleted:e,pos:i}=t.mapResult(this.anchor);return e?new gs(i,i):new va(i)}resolve(t){let e=t.resolve(this.anchor),i=e.nodeAfter;return i&&j.isSelectable(i)?new j(e):Q.near(e)}}class oe extends Q{constructor(t){super(t.resolve(0),t.resolve(t.content.size))}replace(t,e=B.empty){if(e==B.empty){t.delete(0,t.doc.content.size);let i=Q.atStart(t.doc);i.eq(t.selection)||t.setSelection(i)}else super.replace(t,e)}toJSON(){return{type:"all"}}static fromJSON(t){return new oe(t)}map(t){return new oe(t)}eq(t){return t instanceof oe}getBookmark(){return Vg}}Q.jsonID("all",oe);const Vg={map(){return this},resolve(n){return new oe(n)}};function Xn(n,t,e,i,s,o=!1){if(t.inlineContent)return U.create(n,e);for(let a=i-(s>0?0:1);s>0?a<t.childCount:a>=0;a+=s){let c=t.child(a);if(c.isAtom){if(!o&&j.isSelectable(c))return j.create(n,e-(s<0?c.nodeSize:0))}else{let u=Xn(n,c,e+s,s<0?c.childCount:0,s,o);if(u)return u}e+=c.nodeSize*s}return null}function Tc(n,t,e){let i=n.steps.length-1;if(i<t)return;let s=n.steps[i];if(!(s instanceof Nt||s instanceof Dt))return;let o=n.mapping.maps[i],a;o.forEach((c,u,h,f)=>{a==null&&(a=f)}),n.setSelection(Q.near(n.doc.resolve(a),e))}const Pc=1,Cr=2,Ec=4;class Zg extends Sd{constructor(t){super(t.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=t.selection,this.storedMarks=t.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=(this.updated|Pc)&~Cr,this.storedMarks=null,this}get selectionSet(){return(this.updated&Pc)>0}setStoredMarks(t){return this.storedMarks=t,this.updated|=Cr,this}ensureMarks(t){return pt.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this}addStoredMark(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Cr)>0}addStep(t,e){super.addStep(t,e),this.updated=this.updated&~Cr,this.storedMarks=null}setTime(t){return this.time=t,this}replaceSelection(t){return this.selection.replace(this,t),this}replaceSelectionWith(t,e=!0){let i=this.selection;return e&&(t=t.mark(this.storedMarks||(i.empty?i.$from.marks():i.$from.marksAcross(i.$to)||pt.none))),i.replaceWith(this,t),this}deleteSelection(){return this.selection.replace(this),this}insertText(t,e,i){let s=this.doc.type.schema;if(e==null)return t?this.replaceSelectionWith(s.text(t),!0):this.deleteSelection();{if(i==null&&(i=e),i=i??e,!t)return this.deleteRange(e,i);let o=this.storedMarks;if(!o){let a=this.doc.resolve(e);o=i==e?a.marks():a.marksAcross(this.doc.resolve(i))}return this.replaceRangeWith(e,i,s.text(t,o)),this.selection.empty||this.setSelection(Q.near(this.selection.$to)),this}}setMeta(t,e){return this.meta[typeof t=="string"?t:t.key]=e,this}getMeta(t){return this.meta[typeof t=="string"?t:t.key]}get isGeneric(){for(let t in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=Ec,this}get scrolledIntoView(){return(this.updated&Ec)>0}}function Oc(n,t){return!t||!n?n:n.bind(t)}class Ni{constructor(t,e,i){this.name=t,this.init=Oc(e.init,i),this.apply=Oc(e.apply,i)}}const Hg=[new Ni("doc",{init(n){return n.doc||n.schema.topNodeType.createAndFill()},apply(n){return n.doc}}),new Ni("selection",{init(n,t){return n.selection||Q.atStart(t.doc)},apply(n){return n.selection}}),new Ni("storedMarks",{init(n){return n.storedMarks||null},apply(n,t,e,i){return i.selection.$cursor?n.storedMarks:null}}),new Ni("scrollToSelection",{init(){return 0},apply(n,t){return n.scrolledIntoView?t+1:t}})];class yo{constructor(t,e){this.schema=t,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=Hg.slice(),e&&e.forEach(i=>{if(this.pluginsByKey[i.key])throw new RangeError("Adding different instances of a keyed plugin ("+i.key+")");this.plugins.push(i),this.pluginsByKey[i.key]=i,i.spec.state&&this.fields.push(new Ni(i.key,i.spec.state,i))})}}class ti{constructor(t){this.config=t}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(t){return this.applyTransaction(t).state}filterTransaction(t,e=-1){for(let i=0;i<this.config.plugins.length;i++)if(i!=e){let s=this.config.plugins[i];if(s.spec.filterTransaction&&!s.spec.filterTransaction.call(s,t,this))return!1}return!0}applyTransaction(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};let e=[t],i=this.applyInner(t),s=null;for(;;){let o=!1;for(let a=0;a<this.config.plugins.length;a++){let c=this.config.plugins[a];if(c.spec.appendTransaction){let u=s?s[a].n:0,h=s?s[a].state:this,f=u<e.length&&c.spec.appendTransaction.call(c,u?e.slice(u):e,h,i);if(f&&i.filterTransaction(f,a)){if(f.setMeta("appendedTransaction",t),!s){s=[];for(let m=0;m<this.config.plugins.length;m++)s.push(m<a?{state:i,n:e.length}:{state:this,n:0})}e.push(f),i=i.applyInner(f),o=!0}s&&(s[a]={state:i,n:e.length})}}if(!o)return{state:i,transactions:e}}}applyInner(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let e=new ti(this.config),i=this.config.fields;for(let s=0;s<i.length;s++){let o=i[s];e[o.name]=o.apply(t,this[o.name],this,e)}return e}get tr(){return new Zg(this)}static create(t){let e=new yo(t.doc?t.doc.type.schema:t.schema,t.plugins),i=new ti(e);for(let s=0;s<e.fields.length;s++)i[e.fields[s].name]=e.fields[s].init(t,i);return i}reconfigure(t){let e=new yo(this.schema,t.plugins),i=e.fields,s=new ti(e);for(let o=0;o<i.length;o++){let a=i[o].name;s[a]=this.hasOwnProperty(a)?this[a]:i[o].init(t,s)}return s}toJSON(t){let e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(e.storedMarks=this.storedMarks.map(i=>i.toJSON())),t&&typeof t=="object")for(let i in t){if(i=="doc"||i=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let s=t[i],o=s.spec.state;o&&o.toJSON&&(e[i]=o.toJSON.call(s,this[s.key]))}return e}static fromJSON(t,e,i){if(!e)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");let s=new yo(t.schema,t.plugins),o=new ti(s);return s.fields.forEach(a=>{if(a.name=="doc")o.doc=ve.fromJSON(t.schema,e.doc);else if(a.name=="selection")o.selection=Q.fromJSON(o.doc,e.selection);else if(a.name=="storedMarks")e.storedMarks&&(o.storedMarks=e.storedMarks.map(t.schema.markFromJSON));else{if(i)for(let c in i){let u=i[c],h=u.spec.state;if(u.key==a.name&&h&&h.fromJSON&&Object.prototype.hasOwnProperty.call(e,c)){o[a.name]=h.fromJSON.call(u,t,e[c],o);return}}o[a.name]=a.init(t,o)}}),o}}function Md(n,t,e){for(let i in n){let s=n[i];s instanceof Function?s=s.bind(t):i=="handleDOMEvents"&&(s=Md(s,t,{})),e[i]=s}return e}class yt{constructor(t){this.spec=t,this.props={},t.props&&Md(t.props,this,this.props),this.key=t.key?t.key.key:Cd("plugin")}getState(t){return t[this.key]}}const vo=Object.create(null);function Cd(n){return n in vo?n+"$"+ ++vo[n]:(vo[n]=0,n+"$")}class Ct{constructor(t="key"){this.key=Cd(t)}get(t){return t.config.pluginsByKey[this.key]}getState(t){return t[this.key]}}const jt=function(n){for(var t=0;;t++)if(n=n.previousSibling,!n)return t},oi=function(n){let t=n.assignedSlot||n.parentNode;return t&&t.nodeType==11?t.host:t};let $o=null;const He=function(n,t,e){let i=$o||($o=document.createRange());return i.setEnd(n,e??n.nodeValue.length),i.setStart(n,t||0),i},Wg=function(){$o=null},In=function(n,t,e,i){return e&&(Lc(n,t,e,i,-1)||Lc(n,t,e,i,1))},jg=/^(img|br|input|textarea|hr)$/i;function Lc(n,t,e,i,s){for(var o;;){if(n==e&&t==i)return!0;if(t==(s<0?0:ye(n))){let a=n.parentNode;if(!a||a.nodeType!=1||tr(n)||jg.test(n.nodeName)||n.contentEditable=="false")return!1;t=jt(n)+(s<0?0:1),n=a}else if(n.nodeType==1){let a=n.childNodes[t+(s<0?-1:0)];if(a.nodeType==1&&a.contentEditable=="false")if(!((o=a.pmViewDesc)===null||o===void 0)&&o.ignoreForSelection)t+=s;else return!1;else n=a,t=s<0?ye(n):0}else return!1}}function ye(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function qg(n,t){for(;;){if(n.nodeType==3&&t)return n;if(n.nodeType==1&&t>0){if(n.contentEditable=="false")return null;n=n.childNodes[t-1],t=ye(n)}else if(n.parentNode&&!tr(n))t=jt(n),n=n.parentNode;else return null}}function Ug(n,t){for(;;){if(n.nodeType==3&&t<n.nodeValue.length)return n;if(n.nodeType==1&&t<n.childNodes.length){if(n.contentEditable=="false")return null;n=n.childNodes[t],t=0}else if(n.parentNode&&!tr(n))t=jt(n)+1,n=n.parentNode;else return null}}function Kg(n,t,e){for(let i=t==0,s=t==ye(n);i||s;){if(n==e)return!0;let o=jt(n);if(n=n.parentNode,!n)return!1;i=i&&o==0,s=s&&o==ye(n)}}function tr(n){let t;for(let e=n;e&&!(t=e.pmViewDesc);e=e.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==n||t.contentDOM==n)}const _s=function(n){return n.focusNode&&In(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)};function vn(n,t){let e=document.createEvent("Event");return e.initEvent("keydown",!0,!0),e.keyCode=n,e.key=e.code=t,e}function Jg(n){let t=n.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}function Gg(n,t,e){if(n.caretPositionFromPoint)try{let i=n.caretPositionFromPoint(t,e);if(i)return{node:i.offsetNode,offset:Math.min(ye(i.offsetNode),i.offset)}}catch{}if(n.caretRangeFromPoint){let i=n.caretRangeFromPoint(t,e);if(i)return{node:i.startContainer,offset:Math.min(ye(i.startContainer),i.startOffset)}}}const Ne=typeof navigator<"u"?navigator:null,Ac=typeof document<"u"?document:null,un=Ne&&Ne.userAgent||"",Fo=/Edge\/(\d+)/.exec(un),Td=/MSIE \d/.exec(un),Vo=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(un),ae=!!(Td||Vo||Fo),rn=Td?document.documentMode:Vo?+Vo[1]:Fo?+Fo[1]:0,Te=!ae&&/gecko\/(\d+)/i.test(un);Te&&+(/Firefox\/(\d+)/.exec(un)||[0,0])[1];const Zo=!ae&&/Chrome\/(\d+)/.exec(un),Jt=!!Zo,Pd=Zo?+Zo[1]:0,te=!ae&&!!Ne&&/Apple Computer/.test(Ne.vendor),ai=te&&(/Mobile\/\w+/.test(un)||!!Ne&&Ne.maxTouchPoints>2),_e=ai||(Ne?/Mac/.test(Ne.platform):!1),Yg=Ne?/Win/.test(Ne.platform):!1,We=/Android \d/.test(un),er=!!Ac&&"webkitFontSmoothing"in Ac.documentElement.style,Xg=er?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function Qg(n){let t=n.defaultView&&n.defaultView.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:n.documentElement.clientWidth,top:0,bottom:n.documentElement.clientHeight}}function Ze(n,t){return typeof n=="number"?n:n[t]}function t_(n){let t=n.getBoundingClientRect(),e=t.width/n.offsetWidth||1,i=t.height/n.offsetHeight||1;return{left:t.left,right:t.left+n.clientWidth*e,top:t.top,bottom:t.top+n.clientHeight*i}}function Ic(n,t,e){let i=n.someProp("scrollThreshold")||0,s=n.someProp("scrollMargin")||5,o=n.dom.ownerDocument;for(let a=e||n.dom;a;){if(a.nodeType!=1){a=oi(a);continue}let c=a,u=c==o.body,h=u?Qg(o):t_(c),f=0,m=0;if(t.top<h.top+Ze(i,"top")?m=-(h.top-t.top+Ze(s,"top")):t.bottom>h.bottom-Ze(i,"bottom")&&(m=t.bottom-t.top>h.bottom-h.top?t.top+Ze(s,"top")-h.top:t.bottom-h.bottom+Ze(s,"bottom")),t.left<h.left+Ze(i,"left")?f=-(h.left-t.left+Ze(s,"left")):t.right>h.right-Ze(i,"right")&&(f=t.right-h.right+Ze(s,"right")),f||m)if(u)o.defaultView.scrollBy(f,m);else{let y=c.scrollLeft,v=c.scrollTop;m&&(c.scrollTop+=m),f&&(c.scrollLeft+=f);let x=c.scrollLeft-y,k=c.scrollTop-v;t={left:t.left-x,top:t.top-k,right:t.right-x,bottom:t.bottom-k}}let _=u?"fixed":getComputedStyle(a).position;if(/^(fixed|sticky)$/.test(_))break;a=_=="absolute"?a.offsetParent:oi(a)}}function e_(n){let t=n.dom.getBoundingClientRect(),e=Math.max(0,t.top),i,s;for(let o=(t.left+t.right)/2,a=e+1;a<Math.min(innerHeight,t.bottom);a+=5){let c=n.root.elementFromPoint(o,a);if(!c||c==n.dom||!n.dom.contains(c))continue;let u=c.getBoundingClientRect();if(u.top>=e-20){i=c,s=u.top;break}}return{refDOM:i,refTop:s,stack:Ed(n.dom)}}function Ed(n){let t=[],e=n.ownerDocument;for(let i=n;i&&(t.push({dom:i,top:i.scrollTop,left:i.scrollLeft}),n!=e);i=oi(i));return t}function n_({refDOM:n,refTop:t,stack:e}){let i=n?n.getBoundingClientRect().top:0;Od(e,i==0?0:i-t)}function Od(n,t){for(let e=0;e<n.length;e++){let{dom:i,top:s,left:o}=n[e];i.scrollTop!=s+t&&(i.scrollTop=s+t),i.scrollLeft!=o&&(i.scrollLeft=o)}}let Gn=null;function i_(n){if(n.setActive)return n.setActive();if(Gn)return n.focus(Gn);let t=Ed(n);n.focus(Gn==null?{get preventScroll(){return Gn={preventScroll:!0},!0}}:void 0),Gn||(Gn=!1,Od(t,0))}function Ld(n,t){let e,i=2e8,s,o=0,a=t.top,c=t.top,u,h;for(let f=n.firstChild,m=0;f;f=f.nextSibling,m++){let _;if(f.nodeType==1)_=f.getClientRects();else if(f.nodeType==3)_=He(f).getClientRects();else continue;for(let y=0;y<_.length;y++){let v=_[y];if(v.top<=a&&v.bottom>=c){a=Math.max(v.bottom,a),c=Math.min(v.top,c);let x=v.left>t.left?v.left-t.left:v.right<t.left?t.left-v.right:0;if(x<i){e=f,i=x,s=x&&e.nodeType==3?{left:v.right<t.left?v.right:v.left,top:t.top}:t,f.nodeType==1&&x&&(o=m+(t.left>=(v.left+v.right)/2?1:0));continue}}else v.top>t.top&&!u&&v.left<=t.left&&v.right>=t.left&&(u=f,h={left:Math.max(v.left,Math.min(v.right,t.left)),top:v.top});!e&&(t.left>=v.right&&t.top>=v.top||t.left>=v.left&&t.top>=v.bottom)&&(o=m+1)}}return!e&&u&&(e=u,s=h,i=0),e&&e.nodeType==3?r_(e,s):!e||i&&e.nodeType==1?{node:n,offset:o}:Ld(e,s)}function r_(n,t){let e=n.nodeValue.length,i=document.createRange();for(let s=0;s<e;s++){i.setEnd(n,s+1),i.setStart(n,s);let o=Ge(i,1);if(o.top!=o.bottom&&ba(t,o))return{node:n,offset:s+(t.left>=(o.left+o.right)/2?1:0)}}return{node:n,offset:0}}function ba(n,t){return n.left>=t.left-1&&n.left<=t.right+1&&n.top>=t.top-1&&n.top<=t.bottom+1}function s_(n,t){let e=n.parentNode;return e&&/^li$/i.test(e.nodeName)&&t.left<n.getBoundingClientRect().left?e:n}function o_(n,t,e){let{node:i,offset:s}=Ld(t,e),o=-1;if(i.nodeType==1&&!i.firstChild){let a=i.getBoundingClientRect();o=a.left!=a.right&&e.left>(a.left+a.right)/2?1:-1}return n.docView.posFromDOM(i,s,o)}function a_(n,t,e,i){let s=-1;for(let o=t,a=!1;o!=n.dom;){let c=n.docView.nearestDesc(o,!0),u;if(!c)return null;if(c.dom.nodeType==1&&(c.node.isBlock&&c.parent||!c.contentDOM)&&((u=c.dom.getBoundingClientRect()).width||u.height)&&(c.node.isBlock&&c.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(c.dom.nodeName)&&(!a&&u.left>i.left||u.top>i.top?s=c.posBefore:(!a&&u.right<i.left||u.bottom<i.top)&&(s=c.posAfter),a=!0),!c.contentDOM&&s<0&&!c.node.isText))return(c.node.isBlock?i.top<(u.top+u.bottom)/2:i.left<(u.left+u.right)/2)?c.posBefore:c.posAfter;o=c.dom.parentNode}return s>-1?s:n.docView.posFromDOM(t,e,-1)}function Ad(n,t,e){let i=n.childNodes.length;if(i&&e.top<e.bottom)for(let s=Math.max(0,Math.min(i-1,Math.floor(i*(t.top-e.top)/(e.bottom-e.top))-2)),o=s;;){let a=n.childNodes[o];if(a.nodeType==1){let c=a.getClientRects();for(let u=0;u<c.length;u++){let h=c[u];if(ba(t,h))return Ad(a,t,h)}}if((o=(o+1)%i)==s)break}return n}function l_(n,t){let e=n.dom.ownerDocument,i,s=0,o=Gg(e,t.left,t.top);o&&({node:i,offset:s}=o);let a=(n.root.elementFromPoint?n.root:e).elementFromPoint(t.left,t.top),c;if(!a||!n.dom.contains(a.nodeType!=1?a.parentNode:a)){let h=n.dom.getBoundingClientRect();if(!ba(t,h)||(a=Ad(n.dom,t,h),!a))return null}if(te)for(let h=a;i&&h;h=oi(h))h.draggable&&(i=void 0);if(a=s_(a,t),i){if(Te&&i.nodeType==1&&(s=Math.min(s,i.childNodes.length),s<i.childNodes.length)){let f=i.childNodes[s],m;f.nodeName=="IMG"&&(m=f.getBoundingClientRect()).right<=t.left&&m.bottom>t.top&&s++}let h;er&&s&&i.nodeType==1&&(h=i.childNodes[s-1]).nodeType==1&&h.contentEditable=="false"&&h.getBoundingClientRect().top>=t.top&&s--,i==n.dom&&s==i.childNodes.length-1&&i.lastChild.nodeType==1&&t.top>i.lastChild.getBoundingClientRect().bottom?c=n.state.doc.content.size:(s==0||i.nodeType!=1||i.childNodes[s-1].nodeName!="BR")&&(c=a_(n,i,s,t))}c==null&&(c=o_(n,a,t));let u=n.docView.nearestDesc(a,!0);return{pos:c,inside:u?u.posAtStart-u.border:-1}}function Nc(n){return n.top<n.bottom||n.left<n.right}function Ge(n,t){let e=n.getClientRects();if(e.length){let i=e[t<0?0:e.length-1];if(Nc(i))return i}return Array.prototype.find.call(e,Nc)||n.getBoundingClientRect()}const c_=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function Id(n,t,e){let{node:i,offset:s,atom:o}=n.docView.domFromPos(t,e<0?-1:1),a=er||Te;if(i.nodeType==3)if(a&&(c_.test(i.nodeValue)||(e<0?!s:s==i.nodeValue.length))){let u=Ge(He(i,s,s),e);if(Te&&s&&/\s/.test(i.nodeValue[s-1])&&s<i.nodeValue.length){let h=Ge(He(i,s-1,s-1),-1);if(h.top==u.top){let f=Ge(He(i,s,s+1),-1);if(f.top!=u.top)return Li(f,f.left<h.left)}}return u}else{let u=s,h=s,f=e<0?1:-1;return e<0&&!s?(h++,f=-1):e>=0&&s==i.nodeValue.length?(u--,f=1):e<0?u--:h++,Li(Ge(He(i,u,h),f),f<0)}if(!n.state.doc.resolve(t-(o||0)).parent.inlineContent){if(o==null&&s&&(e<0||s==ye(i))){let u=i.childNodes[s-1];if(u.nodeType==1)return bo(u.getBoundingClientRect(),!1)}if(o==null&&s<ye(i)){let u=i.childNodes[s];if(u.nodeType==1)return bo(u.getBoundingClientRect(),!0)}return bo(i.getBoundingClientRect(),e>=0)}if(o==null&&s&&(e<0||s==ye(i))){let u=i.childNodes[s-1],h=u.nodeType==3?He(u,ye(u)-(a?0:1)):u.nodeType==1&&(u.nodeName!="BR"||!u.nextSibling)?u:null;if(h)return Li(Ge(h,1),!1)}if(o==null&&s<ye(i)){let u=i.childNodes[s];for(;u.pmViewDesc&&u.pmViewDesc.ignoreForCoords;)u=u.nextSibling;let h=u?u.nodeType==3?He(u,0,a?0:1):u.nodeType==1?u:null:null;if(h)return Li(Ge(h,-1),!0)}return Li(Ge(i.nodeType==3?He(i):i,-e),e>=0)}function Li(n,t){if(n.width==0)return n;let e=t?n.left:n.right;return{top:n.top,bottom:n.bottom,left:e,right:e}}function bo(n,t){if(n.height==0)return n;let e=t?n.top:n.bottom;return{top:e,bottom:e,left:n.left,right:n.right}}function Nd(n,t,e){let i=n.state,s=n.root.activeElement;i!=t&&n.updateState(t),s!=n.dom&&n.focus();try{return e()}finally{i!=t&&n.updateState(i),s!=n.dom&&s&&s.focus()}}function u_(n,t,e){let i=t.selection,s=e=="up"?i.$from:i.$to;return Nd(n,t,()=>{let{node:o}=n.docView.domFromPos(s.pos,e=="up"?-1:1);for(;;){let c=n.docView.nearestDesc(o,!0);if(!c)break;if(c.node.isBlock){o=c.contentDOM||c.dom;break}o=c.dom.parentNode}let a=Id(n,s.pos,1);for(let c=o.firstChild;c;c=c.nextSibling){let u;if(c.nodeType==1)u=c.getClientRects();else if(c.nodeType==3)u=He(c,0,c.nodeValue.length).getClientRects();else continue;for(let h=0;h<u.length;h++){let f=u[h];if(f.bottom>f.top+1&&(e=="up"?a.top-f.top>(f.bottom-a.top)*2:f.bottom-a.bottom>(a.bottom-f.top)*2))return!1}}return!0})}const d_=/[\u0590-\u08ac]/;function h_(n,t,e){let{$head:i}=t.selection;if(!i.parent.isTextblock)return!1;let s=i.parentOffset,o=!s,a=s==i.parent.content.size,c=n.domSelection();return c?!d_.test(i.parent.textContent)||!c.modify?e=="left"||e=="backward"?o:a:Nd(n,t,()=>{let{focusNode:u,focusOffset:h,anchorNode:f,anchorOffset:m}=n.domSelectionRange(),_=c.caretBidiLevel;c.modify("move",e,"character");let y=i.depth?n.docView.domAfterPos(i.before()):n.dom,{focusNode:v,focusOffset:x}=n.domSelectionRange(),k=v&&!y.contains(v.nodeType==1?v:v.parentNode)||u==v&&h==x;try{c.collapse(f,m),u&&(u!=f||h!=m)&&c.extend&&c.extend(u,h)}catch{}return _!=null&&(c.caretBidiLevel=_),k}):i.pos==i.start()||i.pos==i.end()}let Dc=null,zc=null,Rc=!1;function f_(n,t,e){return Dc==t&&zc==e?Rc:(Dc=t,zc=e,Rc=e=="up"||e=="down"?u_(n,t,e):h_(n,t,e))}const be=0,Bc=1,xn=2,De=3;class nr{constructor(t,e,i,s){this.parent=t,this.children=e,this.dom=i,this.contentDOM=s,this.dirty=be,i.pmViewDesc=this}matchesWidget(t){return!1}matchesMark(t){return!1}matchesNode(t,e,i){return!1}matchesHack(t){return!1}parseRule(){return null}stopEvent(t){return!1}get size(){let t=0;for(let e=0;e<this.children.length;e++)t+=this.children[e].size;return t}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let t=0;t<this.children.length;t++)this.children[t].destroy()}posBeforeChild(t){for(let e=0,i=this.posAtStart;;e++){let s=this.children[e];if(s==t)return i;i+=s.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(t,e,i){if(this.contentDOM&&this.contentDOM.contains(t.nodeType==1?t:t.parentNode))if(i<0){let o,a;if(t==this.contentDOM)o=t.childNodes[e-1];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;o=t.previousSibling}for(;o&&!((a=o.pmViewDesc)&&a.parent==this);)o=o.previousSibling;return o?this.posBeforeChild(a)+a.size:this.posAtStart}else{let o,a;if(t==this.contentDOM)o=t.childNodes[e];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;o=t.nextSibling}for(;o&&!((a=o.pmViewDesc)&&a.parent==this);)o=o.nextSibling;return o?this.posBeforeChild(a):this.posAtEnd}let s;if(t==this.dom&&this.contentDOM)s=e>jt(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))s=t.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(e==0)for(let o=t;;o=o.parentNode){if(o==this.dom){s=!1;break}if(o.previousSibling)break}if(s==null&&e==t.childNodes.length)for(let o=t;;o=o.parentNode){if(o==this.dom){s=!0;break}if(o.nextSibling)break}}return s??i>0?this.posAtEnd:this.posAtStart}nearestDesc(t,e=!1){for(let i=!0,s=t;s;s=s.parentNode){let o=this.getDesc(s),a;if(o&&(!e||o.node))if(i&&(a=o.nodeDOM)&&!(a.nodeType==1?a.contains(t.nodeType==1?t:t.parentNode):a==t))i=!1;else return o}}getDesc(t){let e=t.pmViewDesc;for(let i=e;i;i=i.parent)if(i==this)return e}posFromDOM(t,e,i){for(let s=t;s;s=s.parentNode){let o=this.getDesc(s);if(o)return o.localPosFromDOM(t,e,i)}return-1}descAt(t){for(let e=0,i=0;e<this.children.length;e++){let s=this.children[e],o=i+s.size;if(i==t&&o!=i){for(;!s.border&&s.children.length;)for(let a=0;a<s.children.length;a++){let c=s.children[a];if(c.size){s=c;break}}return s}if(t<o)return s.descAt(t-i-s.border);i=o}}domFromPos(t,e){if(!this.contentDOM)return{node:this.dom,offset:0,atom:t+1};let i=0,s=0;for(let o=0;i<this.children.length;i++){let a=this.children[i],c=o+a.size;if(c>t||a instanceof zd){s=t-o;break}o=c}if(s)return this.children[i].domFromPos(s-this.children[i].border,e);for(let o;i&&!(o=this.children[i-1]).size&&o instanceof Dd&&o.side>=0;i--);if(e<=0){let o,a=!0;for(;o=i?this.children[i-1]:null,!(!o||o.dom.parentNode==this.contentDOM);i--,a=!1);return o&&e&&a&&!o.border&&!o.domAtom?o.domFromPos(o.size,e):{node:this.contentDOM,offset:o?jt(o.dom)+1:0}}else{let o,a=!0;for(;o=i<this.children.length?this.children[i]:null,!(!o||o.dom.parentNode==this.contentDOM);i++,a=!1);return o&&a&&!o.border&&!o.domAtom?o.domFromPos(0,e):{node:this.contentDOM,offset:o?jt(o.dom):this.contentDOM.childNodes.length}}}parseRange(t,e,i=0){if(this.children.length==0)return{node:this.contentDOM,from:t,to:e,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let s=-1,o=-1;for(let a=i,c=0;;c++){let u=this.children[c],h=a+u.size;if(s==-1&&t<=h){let f=a+u.border;if(t>=f&&e<=h-u.border&&u.node&&u.contentDOM&&this.contentDOM.contains(u.contentDOM))return u.parseRange(t,e,f);t=a;for(let m=c;m>0;m--){let _=this.children[m-1];if(_.size&&_.dom.parentNode==this.contentDOM&&!_.emptyChildAt(1)){s=jt(_.dom)+1;break}t-=_.size}s==-1&&(s=0)}if(s>-1&&(h>e||c==this.children.length-1)){e=h;for(let f=c+1;f<this.children.length;f++){let m=this.children[f];if(m.size&&m.dom.parentNode==this.contentDOM&&!m.emptyChildAt(-1)){o=jt(m.dom);break}e+=m.size}o==-1&&(o=this.contentDOM.childNodes.length);break}a=h}return{node:this.contentDOM,from:t,to:e,fromOffset:s,toOffset:o}}emptyChildAt(t){if(this.border||!this.contentDOM||!this.children.length)return!1;let e=this.children[t<0?0:this.children.length-1];return e.size==0||e.emptyChildAt(t)}domAfterPos(t){let{node:e,offset:i}=this.domFromPos(t,0);if(e.nodeType!=1||i==e.childNodes.length)throw new RangeError("No node after pos "+t);return e.childNodes[i]}setSelection(t,e,i,s=!1){let o=Math.min(t,e),a=Math.max(t,e);for(let y=0,v=0;y<this.children.length;y++){let x=this.children[y],k=v+x.size;if(o>v&&a<k)return x.setSelection(t-v-x.border,e-v-x.border,i,s);v=k}let c=this.domFromPos(t,t?-1:1),u=e==t?c:this.domFromPos(e,e?-1:1),h=i.root.getSelection(),f=i.domSelectionRange(),m=!1;if((Te||te)&&t==e){let{node:y,offset:v}=c;if(y.nodeType==3){if(m=!!(v&&y.nodeValue[v-1]==`
`),m&&v==y.nodeValue.length)for(let x=y,k;x;x=x.parentNode){if(k=x.nextSibling){k.nodeName=="BR"&&(c=u={node:k.parentNode,offset:jt(k)+1});break}let C=x.pmViewDesc;if(C&&C.node&&C.node.isBlock)break}}else{let x=y.childNodes[v-1];m=x&&(x.nodeName=="BR"||x.contentEditable=="false")}}if(Te&&f.focusNode&&f.focusNode!=u.node&&f.focusNode.nodeType==1){let y=f.focusNode.childNodes[f.focusOffset];y&&y.contentEditable=="false"&&(s=!0)}if(!(s||m&&te)&&In(c.node,c.offset,f.anchorNode,f.anchorOffset)&&In(u.node,u.offset,f.focusNode,f.focusOffset))return;let _=!1;if((h.extend||t==e)&&!m){h.collapse(c.node,c.offset);try{t!=e&&h.extend(u.node,u.offset),_=!0}catch{}}if(!_){if(t>e){let v=c;c=u,u=v}let y=document.createRange();y.setEnd(u.node,u.offset),y.setStart(c.node,c.offset),h.removeAllRanges(),h.addRange(y)}}ignoreMutation(t){return!this.contentDOM&&t.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(t,e){for(let i=0,s=0;s<this.children.length;s++){let o=this.children[s],a=i+o.size;if(i==a?t<=a&&e>=i:t<a&&e>i){let c=i+o.border,u=a-o.border;if(t>=c&&e<=u){this.dirty=t==i||e==a?xn:Bc,t==c&&e==u&&(o.contentLost||o.dom.parentNode!=this.contentDOM)?o.dirty=De:o.markDirty(t-c,e-c);return}else o.dirty=o.dom==o.contentDOM&&o.dom.parentNode==this.contentDOM&&!o.children.length?xn:De}i=a}this.dirty=xn}markParentsDirty(){let t=1;for(let e=this.parent;e;e=e.parent,t++){let i=t==1?xn:Bc;e.dirty<i&&(e.dirty=i)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(t){return!1}}class Dd extends nr{constructor(t,e,i,s){let o,a=e.type.toDOM;if(typeof a=="function"&&(a=a(i,()=>{if(!o)return s;if(o.parent)return o.parent.posBeforeChild(o)})),!e.type.spec.raw){if(a.nodeType!=1){let c=document.createElement("span");c.appendChild(a),a=c}a.contentEditable="false",a.classList.add("ProseMirror-widget")}super(t,[],a,null),this.widget=e,this.widget=e,o=this}matchesWidget(t){return this.dirty==be&&t.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(t){let e=this.widget.spec.stopEvent;return e?e(t):!1}ignoreMutation(t){return t.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class p_ extends nr{constructor(t,e,i,s){super(t,[],e,null),this.textDOM=i,this.text=s}get size(){return this.text.length}localPosFromDOM(t,e){return t!=this.textDOM?this.posAtStart+(e?this.size:0):this.posAtStart+e}domFromPos(t){return{node:this.textDOM,offset:t}}ignoreMutation(t){return t.type==="characterData"&&t.target.nodeValue==t.oldValue}}class Nn extends nr{constructor(t,e,i,s,o){super(t,[],i,s),this.mark=e,this.spec=o}static create(t,e,i,s){let o=s.nodeViews[e.type.name],a=o&&o(e,s,i);return(!a||!a.dom)&&(a=$n.renderSpec(document,e.type.spec.toDOM(e,i),null,e.attrs)),new Nn(t,e,a.dom,a.contentDOM||a.dom,a)}parseRule(){return this.dirty&De||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(t){return this.dirty!=De&&this.mark.eq(t)}markDirty(t,e){if(super.markDirty(t,e),this.dirty!=be){let i=this.parent;for(;!i.node;)i=i.parent;i.dirty<this.dirty&&(i.dirty=this.dirty),this.dirty=be}}slice(t,e,i){let s=Nn.create(this.parent,this.mark,!0,i),o=this.children,a=this.size;e<a&&(o=Wo(o,e,a,i)),t>0&&(o=Wo(o,0,t,i));for(let c=0;c<o.length;c++)o[c].parent=s;return s.children=o,s}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class sn extends nr{constructor(t,e,i,s,o,a,c,u,h){super(t,[],o,a),this.node=e,this.outerDeco=i,this.innerDeco=s,this.nodeDOM=c}static create(t,e,i,s,o,a){let c=o.nodeViews[e.type.name],u,h=c&&c(e,o,()=>{if(!u)return a;if(u.parent)return u.parent.posBeforeChild(u)},i,s),f=h&&h.dom,m=h&&h.contentDOM;if(e.isText){if(!f)f=document.createTextNode(e.text);else if(f.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else f||({dom:f,contentDOM:m}=$n.renderSpec(document,e.type.spec.toDOM(e),null,e.attrs));!m&&!e.isText&&f.nodeName!="BR"&&(f.hasAttribute("contenteditable")||(f.contentEditable="false"),e.type.spec.draggable&&(f.draggable=!0));let _=f;return f=$d(f,i,e),h?u=new m_(t,e,i,s,f,m||null,_,h,o,a+1):e.isText?new ys(t,e,i,s,f,_,o):new sn(t,e,i,s,f,m||null,_,o,a+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let t={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(t.preserveWhitespace="full"),!this.contentDOM)t.getContent=()=>this.node.content;else if(!this.contentLost)t.contentElement=this.contentDOM;else{for(let e=this.children.length-1;e>=0;e--){let i=this.children[e];if(this.dom.contains(i.dom.parentNode)){t.contentElement=i.dom.parentNode;break}}t.contentElement||(t.getContent=()=>A.empty)}return t}matchesNode(t,e,i){return this.dirty==be&&t.eq(this.node)&&qr(e,this.outerDeco)&&i.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(t,e){let i=this.node.inlineContent,s=e,o=t.composing?this.localCompositionInfo(t,e):null,a=o&&o.pos>-1?o:null,c=o&&o.pos<0,u=new __(this,a&&a.node,t);b_(this.node,this.innerDeco,(h,f,m)=>{h.spec.marks?u.syncToMarks(h.spec.marks,i,t):h.type.side>=0&&!m&&u.syncToMarks(f==this.node.childCount?pt.none:this.node.child(f).marks,i,t),u.placeWidget(h,t,s)},(h,f,m,_)=>{u.syncToMarks(h.marks,i,t);let y;u.findNodeMatch(h,f,m,_)||c&&t.state.selection.from>s&&t.state.selection.to<s+h.nodeSize&&(y=u.findIndexWithChild(o.node))>-1&&u.updateNodeAt(h,f,m,y,t)||u.updateNextNode(h,f,m,t,_,s)||u.addNode(h,f,m,t,s),s+=h.nodeSize}),u.syncToMarks([],i,t),this.node.isTextblock&&u.addTextblockHacks(),u.destroyRest(),(u.changed||this.dirty==xn)&&(a&&this.protectLocalComposition(t,a),Rd(this.contentDOM,this.children,t),ai&&x_(this.dom))}localCompositionInfo(t,e){let{from:i,to:s}=t.state.selection;if(!(t.state.selection instanceof U)||i<e||s>e+this.node.content.size)return null;let o=t.input.compositionNode;if(!o||!this.dom.contains(o.parentNode))return null;if(this.node.inlineContent){let a=o.nodeValue,c=w_(this.node.content,a,i-e,s-e);return c<0?null:{node:o,pos:c,text:a}}else return{node:o,pos:-1,text:""}}protectLocalComposition(t,{node:e,pos:i,text:s}){if(this.getDesc(e))return;let o=e;for(;o.parentNode!=this.contentDOM;o=o.parentNode){for(;o.previousSibling;)o.parentNode.removeChild(o.previousSibling);for(;o.nextSibling;)o.parentNode.removeChild(o.nextSibling);o.pmViewDesc&&(o.pmViewDesc=void 0)}let a=new p_(this,o,e,s);t.input.compositionNodes.push(a),this.children=Wo(this.children,i,i+s.length,t,a)}update(t,e,i,s){return this.dirty==De||!t.sameMarkup(this.node)?!1:(this.updateInner(t,e,i,s),!0)}updateInner(t,e,i,s){this.updateOuterDeco(e),this.node=t,this.innerDeco=i,this.contentDOM&&this.updateChildren(s,this.posAtStart),this.dirty=be}updateOuterDeco(t){if(qr(t,this.outerDeco))return;let e=this.nodeDOM.nodeType!=1,i=this.dom;this.dom=Bd(this.dom,this.nodeDOM,Ho(this.outerDeco,this.node,e),Ho(t,this.node,e)),this.dom!=i&&(i.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=t}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function $c(n,t,e,i,s){$d(i,t,n);let o=new sn(void 0,n,t,e,i,i,i,s,0);return o.contentDOM&&o.updateChildren(s,0),o}class ys extends sn{constructor(t,e,i,s,o,a,c){super(t,e,i,s,o,null,a,c,0)}parseRule(){let t=this.nodeDOM.parentNode;for(;t&&t!=this.dom&&!t.pmIsDeco;)t=t.parentNode;return{skip:t||!0}}update(t,e,i,s){return this.dirty==De||this.dirty!=be&&!this.inParent()||!t.sameMarkup(this.node)?!1:(this.updateOuterDeco(e),(this.dirty!=be||t.text!=this.node.text)&&t.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=t.text,s.trackWrites==this.nodeDOM&&(s.trackWrites=null)),this.node=t,this.dirty=be,!0)}inParent(){let t=this.parent.contentDOM;for(let e=this.nodeDOM;e;e=e.parentNode)if(e==t)return!0;return!1}domFromPos(t){return{node:this.nodeDOM,offset:t}}localPosFromDOM(t,e,i){return t==this.nodeDOM?this.posAtStart+Math.min(e,this.node.text.length):super.localPosFromDOM(t,e,i)}ignoreMutation(t){return t.type!="characterData"&&t.type!="selection"}slice(t,e,i){let s=this.node.cut(t,e),o=document.createTextNode(s.text);return new ys(this.parent,s,this.outerDeco,this.innerDeco,o,o,i)}markDirty(t,e){super.markDirty(t,e),this.dom!=this.nodeDOM&&(t==0||e==this.nodeDOM.nodeValue.length)&&(this.dirty=De)}get domAtom(){return!1}isText(t){return this.node.text==t}}class zd extends nr{parseRule(){return{ignore:!0}}matchesHack(t){return this.dirty==be&&this.dom.nodeName==t}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class m_ extends sn{constructor(t,e,i,s,o,a,c,u,h,f){super(t,e,i,s,o,a,c,h,f),this.spec=u}update(t,e,i,s){if(this.dirty==De)return!1;if(this.spec.update&&(this.node.type==t.type||this.spec.multiType)){let o=this.spec.update(t,e,i);return o&&this.updateInner(t,e,i,s),o}else return!this.contentDOM&&!t.isLeaf?!1:super.update(t,e,i,s)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(t,e,i,s){this.spec.setSelection?this.spec.setSelection(t,e,i.root):super.setSelection(t,e,i,s)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(t){return this.spec.stopEvent?this.spec.stopEvent(t):!1}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}}function Rd(n,t,e){let i=n.firstChild,s=!1;for(let o=0;o<t.length;o++){let a=t[o],c=a.dom;if(c.parentNode==n){for(;c!=i;)i=Fc(i),s=!0;i=i.nextSibling}else s=!0,n.insertBefore(c,i);if(a instanceof Nn){let u=i?i.previousSibling:n.lastChild;Rd(a.contentDOM,a.children,e),i=u?u.nextSibling:n.firstChild}}for(;i;)i=Fc(i),s=!0;s&&e.trackWrites==n&&(e.trackWrites=null)}const Bi=function(n){n&&(this.nodeName=n)};Bi.prototype=Object.create(null);const wn=[new Bi];function Ho(n,t,e){if(n.length==0)return wn;let i=e?wn[0]:new Bi,s=[i];for(let o=0;o<n.length;o++){let a=n[o].type.attrs;if(a){a.nodeName&&s.push(i=new Bi(a.nodeName));for(let c in a){let u=a[c];u!=null&&(e&&s.length==1&&s.push(i=new Bi(t.isInline?"span":"div")),c=="class"?i.class=(i.class?i.class+" ":"")+u:c=="style"?i.style=(i.style?i.style+";":"")+u:c!="nodeName"&&(i[c]=u))}}}return s}function Bd(n,t,e,i){if(e==wn&&i==wn)return t;let s=t;for(let o=0;o<i.length;o++){let a=i[o],c=e[o];if(o){let u;c&&c.nodeName==a.nodeName&&s!=n&&(u=s.parentNode)&&u.nodeName.toLowerCase()==a.nodeName||(u=document.createElement(a.nodeName),u.pmIsDeco=!0,u.appendChild(s),c=wn[0]),s=u}g_(s,c||wn[0],a)}return s}function g_(n,t,e){for(let i in t)i!="class"&&i!="style"&&i!="nodeName"&&!(i in e)&&n.removeAttribute(i);for(let i in e)i!="class"&&i!="style"&&i!="nodeName"&&e[i]!=t[i]&&n.setAttribute(i,e[i]);if(t.class!=e.class){let i=t.class?t.class.split(" ").filter(Boolean):[],s=e.class?e.class.split(" ").filter(Boolean):[];for(let o=0;o<i.length;o++)s.indexOf(i[o])==-1&&n.classList.remove(i[o]);for(let o=0;o<s.length;o++)i.indexOf(s[o])==-1&&n.classList.add(s[o]);n.classList.length==0&&n.removeAttribute("class")}if(t.style!=e.style){if(t.style){let i=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,s;for(;s=i.exec(t.style);)n.style.removeProperty(s[1])}e.style&&(n.style.cssText+=e.style)}}function $d(n,t,e){return Bd(n,n,wn,Ho(t,e,n.nodeType!=1))}function qr(n,t){if(n.length!=t.length)return!1;for(let e=0;e<n.length;e++)if(!n[e].type.eq(t[e].type))return!1;return!0}function Fc(n){let t=n.nextSibling;return n.parentNode.removeChild(n),t}class __{constructor(t,e,i){this.lock=e,this.view=i,this.index=0,this.stack=[],this.changed=!1,this.top=t,this.preMatch=y_(t.node.content,t)}destroyBetween(t,e){if(t!=e){for(let i=t;i<e;i++)this.top.children[i].destroy();this.top.children.splice(t,e-t),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(t,e,i){let s=0,o=this.stack.length>>1,a=Math.min(o,t.length);for(;s<a&&(s==o-1?this.top:this.stack[s+1<<1]).matchesMark(t[s])&&t[s].type.spec.spanning!==!1;)s++;for(;s<o;)this.destroyRest(),this.top.dirty=be,this.index=this.stack.pop(),this.top=this.stack.pop(),o--;for(;o<t.length;){this.stack.push(this.top,this.index+1);let c=-1;for(let u=this.index;u<Math.min(this.index+3,this.top.children.length);u++){let h=this.top.children[u];if(h.matchesMark(t[o])&&!this.isLocked(h.dom)){c=u;break}}if(c>-1)c>this.index&&(this.changed=!0,this.destroyBetween(this.index,c)),this.top=this.top.children[this.index];else{let u=Nn.create(this.top,t[o],e,i);this.top.children.splice(this.index,0,u),this.top=u,this.changed=!0}this.index=0,o++}}findNodeMatch(t,e,i,s){let o=-1,a;if(s>=this.preMatch.index&&(a=this.preMatch.matches[s-this.preMatch.index]).parent==this.top&&a.matchesNode(t,e,i))o=this.top.children.indexOf(a,this.index);else for(let c=this.index,u=Math.min(this.top.children.length,c+5);c<u;c++){let h=this.top.children[c];if(h.matchesNode(t,e,i)&&!this.preMatch.matched.has(h)){o=c;break}}return o<0?!1:(this.destroyBetween(this.index,o),this.index++,!0)}updateNodeAt(t,e,i,s,o){let a=this.top.children[s];return a.dirty==De&&a.dom==a.contentDOM&&(a.dirty=xn),a.update(t,e,i,o)?(this.destroyBetween(this.index,s),this.index++,!0):!1}findIndexWithChild(t){for(;;){let e=t.parentNode;if(!e)return-1;if(e==this.top.contentDOM){let i=t.pmViewDesc;if(i){for(let s=this.index;s<this.top.children.length;s++)if(this.top.children[s]==i)return s}return-1}t=e}}updateNextNode(t,e,i,s,o,a){for(let c=this.index;c<this.top.children.length;c++){let u=this.top.children[c];if(u instanceof sn){let h=this.preMatch.matched.get(u);if(h!=null&&h!=o)return!1;let f=u.dom,m,_=this.isLocked(f)&&!(t.isText&&u.node&&u.node.isText&&u.nodeDOM.nodeValue==t.text&&u.dirty!=De&&qr(e,u.outerDeco));if(!_&&u.update(t,e,i,s))return this.destroyBetween(this.index,c),u.dom!=f&&(this.changed=!0),this.index++,!0;if(!_&&(m=this.recreateWrapper(u,t,e,i,s,a)))return this.destroyBetween(this.index,c),this.top.children[this.index]=m,m.contentDOM&&(m.dirty=xn,m.updateChildren(s,a+1),m.dirty=be),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(t,e,i,s,o,a){if(t.dirty||e.isAtom||!t.children.length||!t.node.content.eq(e.content)||!qr(i,t.outerDeco)||!s.eq(t.innerDeco))return null;let c=sn.create(this.top,e,i,s,o,a);if(c.contentDOM){c.children=t.children,t.children=[];for(let u of c.children)u.parent=c}return t.destroy(),c}addNode(t,e,i,s,o){let a=sn.create(this.top,t,e,i,s,o);a.contentDOM&&a.updateChildren(s,o+1),this.top.children.splice(this.index++,0,a),this.changed=!0}placeWidget(t,e,i){let s=this.index<this.top.children.length?this.top.children[this.index]:null;if(s&&s.matchesWidget(t)&&(t==s.widget||!s.widget.type.toDOM.parentNode))this.index++;else{let o=new Dd(this.top,t,e,i);this.top.children.splice(this.index++,0,o),this.changed=!0}}addTextblockHacks(){let t=this.top.children[this.index-1],e=this.top;for(;t instanceof Nn;)e=t,t=e.children[e.children.length-1];(!t||!(t instanceof ys)||/\n$/.test(t.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(t.node.text))&&((te||Jt)&&t&&t.dom.contentEditable=="false"&&this.addHackNode("IMG",e),this.addHackNode("BR",this.top))}addHackNode(t,e){if(e==this.top&&this.index<e.children.length&&e.children[this.index].matchesHack(t))this.index++;else{let i=document.createElement(t);t=="IMG"&&(i.className="ProseMirror-separator",i.alt=""),t=="BR"&&(i.className="ProseMirror-trailingBreak");let s=new zd(this.top,[],i,null);e!=this.top?e.children.push(s):e.children.splice(this.index++,0,s),this.changed=!0}}isLocked(t){return this.lock&&(t==this.lock||t.nodeType==1&&t.contains(this.lock.parentNode))}}function y_(n,t){let e=t,i=e.children.length,s=n.childCount,o=new Map,a=[];t:for(;s>0;){let c;for(;;)if(i){let h=e.children[i-1];if(h instanceof Nn)e=h,i=h.children.length;else{c=h,i--;break}}else{if(e==t)break t;i=e.parent.children.indexOf(e),e=e.parent}let u=c.node;if(u){if(u!=n.child(s-1))break;--s,o.set(c,s),a.push(c)}}return{index:s,matched:o,matches:a.reverse()}}function v_(n,t){return n.type.side-t.type.side}function b_(n,t,e,i){let s=t.locals(n),o=0;if(s.length==0){for(let h=0;h<n.childCount;h++){let f=n.child(h);i(f,s,t.forChild(o,f),h),o+=f.nodeSize}return}let a=0,c=[],u=null;for(let h=0;;){let f,m;for(;a<s.length&&s[a].to==o;){let k=s[a++];k.widget&&(f?(m||(m=[f])).push(k):f=k)}if(f)if(m){m.sort(v_);for(let k=0;k<m.length;k++)e(m[k],h,!!u)}else e(f,h,!!u);let _,y;if(u)y=-1,_=u,u=null;else if(h<n.childCount)y=h,_=n.child(h++);else break;for(let k=0;k<c.length;k++)c[k].to<=o&&c.splice(k--,1);for(;a<s.length&&s[a].from<=o&&s[a].to>o;)c.push(s[a++]);let v=o+_.nodeSize;if(_.isText){let k=v;a<s.length&&s[a].from<k&&(k=s[a].from);for(let C=0;C<c.length;C++)c[C].to<k&&(k=c[C].to);k<v&&(u=_.cut(k-o),_=_.cut(0,k-o),v=k,y=-1)}else for(;a<s.length&&s[a].to<v;)a++;let x=_.isInline&&!_.isLeaf?c.filter(k=>!k.inline):c.slice();i(_,x,t.forChild(o,_),y),o=v}}function x_(n){if(n.nodeName=="UL"||n.nodeName=="OL"){let t=n.style.cssText;n.style.cssText=t+"; list-style: square !important",window.getComputedStyle(n).listStyle,n.style.cssText=t}}function w_(n,t,e,i){for(let s=0,o=0;s<n.childCount&&o<=i;){let a=n.child(s++),c=o;if(o+=a.nodeSize,!a.isText)continue;let u=a.text;for(;s<n.childCount;){let h=n.child(s++);if(o+=h.nodeSize,!h.isText)break;u+=h.text}if(o>=e){if(o>=i&&u.slice(i-t.length-c,i-c)==t)return i-t.length;let h=c<i?u.lastIndexOf(t,i-c-1):-1;if(h>=0&&h+t.length+c>=e)return c+h;if(e==i&&u.length>=i+t.length-c&&u.slice(i-c,i-c+t.length)==t)return i}}return-1}function Wo(n,t,e,i,s){let o=[];for(let a=0,c=0;a<n.length;a++){let u=n[a],h=c,f=c+=u.size;h>=e||f<=t?o.push(u):(h<t&&o.push(u.slice(0,t-h,i)),s&&(o.push(s),s=void 0),f>e&&o.push(u.slice(e-h,u.size,i)))}return o}function xa(n,t=null){let e=n.domSelectionRange(),i=n.state.doc;if(!e.focusNode)return null;let s=n.docView.nearestDesc(e.focusNode),o=s&&s.size==0,a=n.docView.posFromDOM(e.focusNode,e.focusOffset,1);if(a<0)return null;let c=i.resolve(a),u,h;if(_s(e)){for(u=a;s&&!s.node;)s=s.parent;let m=s.node;if(s&&m.isAtom&&j.isSelectable(m)&&s.parent&&!(m.isInline&&Kg(e.focusNode,e.focusOffset,s.dom))){let _=s.posBefore;h=new j(a==_?c:i.resolve(_))}}else{if(e instanceof n.dom.ownerDocument.defaultView.Selection&&e.rangeCount>1){let m=a,_=a;for(let y=0;y<e.rangeCount;y++){let v=e.getRangeAt(y);m=Math.min(m,n.docView.posFromDOM(v.startContainer,v.startOffset,1)),_=Math.max(_,n.docView.posFromDOM(v.endContainer,v.endOffset,-1))}if(m<0)return null;[u,a]=_==n.state.selection.anchor?[_,m]:[m,_],c=i.resolve(a)}else u=n.docView.posFromDOM(e.anchorNode,e.anchorOffset,1);if(u<0)return null}let f=i.resolve(u);if(!h){let m=t=="pointer"||n.state.selection.head<c.pos&&!o?1:-1;h=wa(n,f,c,m)}return h}function Fd(n){return n.editable?n.hasFocus():Zd(n)&&document.activeElement&&document.activeElement.contains(n.dom)}function je(n,t=!1){let e=n.state.selection;if(Vd(n,e),!!Fd(n)){if(!t&&n.input.mouseDown&&n.input.mouseDown.allowDefault&&Jt){let i=n.domSelectionRange(),s=n.domObserver.currentSelection;if(i.anchorNode&&s.anchorNode&&In(i.anchorNode,i.anchorOffset,s.anchorNode,s.anchorOffset)){n.input.mouseDown.delayedSelectionSync=!0,n.domObserver.setCurSelection();return}}if(n.domObserver.disconnectSelection(),n.cursorWrapper)S_(n);else{let{anchor:i,head:s}=e,o,a;Vc&&!(e instanceof U)&&(e.$from.parent.inlineContent||(o=Zc(n,e.from)),!e.empty&&!e.$from.parent.inlineContent&&(a=Zc(n,e.to))),n.docView.setSelection(i,s,n,t),Vc&&(o&&Hc(o),a&&Hc(a)),e.visible?n.dom.classList.remove("ProseMirror-hideselection"):(n.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&k_(n))}n.domObserver.setCurSelection(),n.domObserver.connectSelection()}}const Vc=te||Jt&&Pd<63;function Zc(n,t){let{node:e,offset:i}=n.docView.domFromPos(t,0),s=i<e.childNodes.length?e.childNodes[i]:null,o=i?e.childNodes[i-1]:null;if(te&&s&&s.contentEditable=="false")return xo(s);if((!s||s.contentEditable=="false")&&(!o||o.contentEditable=="false")){if(s)return xo(s);if(o)return xo(o)}}function xo(n){return n.contentEditable="true",te&&n.draggable&&(n.draggable=!1,n.wasDraggable=!0),n}function Hc(n){n.contentEditable="false",n.wasDraggable&&(n.draggable=!0,n.wasDraggable=null)}function k_(n){let t=n.dom.ownerDocument;t.removeEventListener("selectionchange",n.input.hideSelectionGuard);let e=n.domSelectionRange(),i=e.anchorNode,s=e.anchorOffset;t.addEventListener("selectionchange",n.input.hideSelectionGuard=()=>{(e.anchorNode!=i||e.anchorOffset!=s)&&(t.removeEventListener("selectionchange",n.input.hideSelectionGuard),setTimeout(()=>{(!Fd(n)||n.state.selection.visible)&&n.dom.classList.remove("ProseMirror-hideselection")},20))})}function S_(n){let t=n.domSelection(),e=document.createRange();if(!t)return;let i=n.cursorWrapper.dom,s=i.nodeName=="IMG";s?e.setStart(i.parentNode,jt(i)+1):e.setStart(i,0),e.collapse(!0),t.removeAllRanges(),t.addRange(e),!s&&!n.state.selection.visible&&ae&&rn<=11&&(i.disabled=!0,i.disabled=!1)}function Vd(n,t){if(t instanceof j){let e=n.docView.descAt(t.from);e!=n.lastSelectedViewDesc&&(Wc(n),e&&e.selectNode(),n.lastSelectedViewDesc=e)}else Wc(n)}function Wc(n){n.lastSelectedViewDesc&&(n.lastSelectedViewDesc.parent&&n.lastSelectedViewDesc.deselectNode(),n.lastSelectedViewDesc=void 0)}function wa(n,t,e,i){return n.someProp("createSelectionBetween",s=>s(n,t,e))||U.between(t,e,i)}function jc(n){return n.editable&&!n.hasFocus()?!1:Zd(n)}function Zd(n){let t=n.domSelectionRange();if(!t.anchorNode)return!1;try{return n.dom.contains(t.anchorNode.nodeType==3?t.anchorNode.parentNode:t.anchorNode)&&(n.editable||n.dom.contains(t.focusNode.nodeType==3?t.focusNode.parentNode:t.focusNode))}catch{return!1}}function M_(n){let t=n.docView.domFromPos(n.state.selection.anchor,0),e=n.domSelectionRange();return In(t.node,t.offset,e.anchorNode,e.anchorOffset)}function jo(n,t){let{$anchor:e,$head:i}=n.selection,s=t>0?e.max(i):e.min(i),o=s.parent.inlineContent?s.depth?n.doc.resolve(t>0?s.after():s.before()):null:s;return o&&Q.findFrom(o,t)}function Ye(n,t){return n.dispatch(n.state.tr.setSelection(t).scrollIntoView()),!0}function qc(n,t,e){let i=n.state.selection;if(i instanceof U)if(e.indexOf("s")>-1){let{$head:s}=i,o=s.textOffset?null:t<0?s.nodeBefore:s.nodeAfter;if(!o||o.isText||!o.isLeaf)return!1;let a=n.state.doc.resolve(s.pos+o.nodeSize*(t<0?-1:1));return Ye(n,new U(i.$anchor,a))}else if(i.empty){if(n.endOfTextblock(t>0?"forward":"backward")){let s=jo(n.state,t);return s&&s instanceof j?Ye(n,s):!1}else if(!(_e&&e.indexOf("m")>-1)){let s=i.$head,o=s.textOffset?null:t<0?s.nodeBefore:s.nodeAfter,a;if(!o||o.isText)return!1;let c=t<0?s.pos-o.nodeSize:s.pos;return o.isAtom||(a=n.docView.descAt(c))&&!a.contentDOM?j.isSelectable(o)?Ye(n,new j(t<0?n.state.doc.resolve(s.pos-o.nodeSize):s)):er?Ye(n,new U(n.state.doc.resolve(t<0?c:c+o.nodeSize))):!1:!1}}else return!1;else{if(i instanceof j&&i.node.isInline)return Ye(n,new U(t>0?i.$to:i.$from));{let s=jo(n.state,t);return s?Ye(n,s):!1}}}function Ur(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function $i(n,t){let e=n.pmViewDesc;return e&&e.size==0&&(t<0||n.nextSibling||n.nodeName!="BR")}function Yn(n,t){return t<0?C_(n):T_(n)}function C_(n){let t=n.domSelectionRange(),e=t.focusNode,i=t.focusOffset;if(!e)return;let s,o,a=!1;for(Te&&e.nodeType==1&&i<Ur(e)&&$i(e.childNodes[i],-1)&&(a=!0);;)if(i>0){if(e.nodeType!=1)break;{let c=e.childNodes[i-1];if($i(c,-1))s=e,o=--i;else if(c.nodeType==3)e=c,i=e.nodeValue.length;else break}}else{if(Hd(e))break;{let c=e.previousSibling;for(;c&&$i(c,-1);)s=e.parentNode,o=jt(c),c=c.previousSibling;if(c)e=c,i=Ur(e);else{if(e=e.parentNode,e==n.dom)break;i=0}}}a?qo(n,e,i):s&&qo(n,s,o)}function T_(n){let t=n.domSelectionRange(),e=t.focusNode,i=t.focusOffset;if(!e)return;let s=Ur(e),o,a;for(;;)if(i<s){if(e.nodeType!=1)break;let c=e.childNodes[i];if($i(c,1))o=e,a=++i;else break}else{if(Hd(e))break;{let c=e.nextSibling;for(;c&&$i(c,1);)o=c.parentNode,a=jt(c)+1,c=c.nextSibling;if(c)e=c,i=0,s=Ur(e);else{if(e=e.parentNode,e==n.dom)break;i=s=0}}}o&&qo(n,o,a)}function Hd(n){let t=n.pmViewDesc;return t&&t.node&&t.node.isBlock}function P_(n,t){for(;n&&t==n.childNodes.length&&!tr(n);)t=jt(n)+1,n=n.parentNode;for(;n&&t<n.childNodes.length;){let e=n.childNodes[t];if(e.nodeType==3)return e;if(e.nodeType==1&&e.contentEditable=="false")break;n=e,t=0}}function E_(n,t){for(;n&&!t&&!tr(n);)t=jt(n),n=n.parentNode;for(;n&&t;){let e=n.childNodes[t-1];if(e.nodeType==3)return e;if(e.nodeType==1&&e.contentEditable=="false")break;n=e,t=n.childNodes.length}}function qo(n,t,e){if(t.nodeType!=3){let o,a;(a=P_(t,e))?(t=a,e=0):(o=E_(t,e))&&(t=o,e=o.nodeValue.length)}let i=n.domSelection();if(!i)return;if(_s(i)){let o=document.createRange();o.setEnd(t,e),o.setStart(t,e),i.removeAllRanges(),i.addRange(o)}else i.extend&&i.extend(t,e);n.domObserver.setCurSelection();let{state:s}=n;setTimeout(()=>{n.state==s&&je(n)},50)}function Uc(n,t){let e=n.state.doc.resolve(t);if(!(Jt||Yg)&&e.parent.inlineContent){let s=n.coordsAtPos(t);if(t>e.start()){let o=n.coordsAtPos(t-1),a=(o.top+o.bottom)/2;if(a>s.top&&a<s.bottom&&Math.abs(o.left-s.left)>1)return o.left<s.left?"ltr":"rtl"}if(t<e.end()){let o=n.coordsAtPos(t+1),a=(o.top+o.bottom)/2;if(a>s.top&&a<s.bottom&&Math.abs(o.left-s.left)>1)return o.left>s.left?"ltr":"rtl"}}return getComputedStyle(n.dom).direction=="rtl"?"rtl":"ltr"}function Kc(n,t,e){let i=n.state.selection;if(i instanceof U&&!i.empty||e.indexOf("s")>-1||_e&&e.indexOf("m")>-1)return!1;let{$from:s,$to:o}=i;if(!s.parent.inlineContent||n.endOfTextblock(t<0?"up":"down")){let a=jo(n.state,t);if(a&&a instanceof j)return Ye(n,a)}if(!s.parent.inlineContent){let a=t<0?s:o,c=i instanceof oe?Q.near(a,t):Q.findFrom(a,t);return c?Ye(n,c):!1}return!1}function Jc(n,t){if(!(n.state.selection instanceof U))return!0;let{$head:e,$anchor:i,empty:s}=n.state.selection;if(!e.sameParent(i))return!0;if(!s)return!1;if(n.endOfTextblock(t>0?"forward":"backward"))return!0;let o=!e.textOffset&&(t<0?e.nodeBefore:e.nodeAfter);if(o&&!o.isText){let a=n.state.tr;return t<0?a.delete(e.pos-o.nodeSize,e.pos):a.delete(e.pos,e.pos+o.nodeSize),n.dispatch(a),!0}return!1}function Gc(n,t,e){n.domObserver.stop(),t.contentEditable=e,n.domObserver.start()}function O_(n){if(!te||n.state.selection.$head.parentOffset>0)return!1;let{focusNode:t,focusOffset:e}=n.domSelectionRange();if(t&&t.nodeType==1&&e==0&&t.firstChild&&t.firstChild.contentEditable=="false"){let i=t.firstChild;Gc(n,i,"true"),setTimeout(()=>Gc(n,i,"false"),20)}return!1}function L_(n){let t="";return n.ctrlKey&&(t+="c"),n.metaKey&&(t+="m"),n.altKey&&(t+="a"),n.shiftKey&&(t+="s"),t}function A_(n,t){let e=t.keyCode,i=L_(t);if(e==8||_e&&e==72&&i=="c")return Jc(n,-1)||Yn(n,-1);if(e==46&&!t.shiftKey||_e&&e==68&&i=="c")return Jc(n,1)||Yn(n,1);if(e==13||e==27)return!0;if(e==37||_e&&e==66&&i=="c"){let s=e==37?Uc(n,n.state.selection.from)=="ltr"?-1:1:-1;return qc(n,s,i)||Yn(n,s)}else if(e==39||_e&&e==70&&i=="c"){let s=e==39?Uc(n,n.state.selection.from)=="ltr"?1:-1:1;return qc(n,s,i)||Yn(n,s)}else{if(e==38||_e&&e==80&&i=="c")return Kc(n,-1,i)||Yn(n,-1);if(e==40||_e&&e==78&&i=="c")return O_(n)||Kc(n,1,i)||Yn(n,1);if(i==(_e?"m":"c")&&(e==66||e==73||e==89||e==90))return!0}return!1}function ka(n,t){n.someProp("transformCopied",y=>{t=y(t,n)});let e=[],{content:i,openStart:s,openEnd:o}=t;for(;s>1&&o>1&&i.childCount==1&&i.firstChild.childCount==1;){s--,o--;let y=i.firstChild;e.push(y.type.name,y.attrs!=y.type.defaultAttrs?y.attrs:null),i=y.content}let a=n.someProp("clipboardSerializer")||$n.fromSchema(n.state.schema),c=Jd(),u=c.createElement("div");u.appendChild(a.serializeFragment(i,{document:c}));let h=u.firstChild,f,m=0;for(;h&&h.nodeType==1&&(f=Kd[h.nodeName.toLowerCase()]);){for(let y=f.length-1;y>=0;y--){let v=c.createElement(f[y]);for(;u.firstChild;)v.appendChild(u.firstChild);u.appendChild(v),m++}h=u.firstChild}h&&h.nodeType==1&&h.setAttribute("data-pm-slice",`${s} ${o}${m?` -${m}`:""} ${JSON.stringify(e)}`);let _=n.someProp("clipboardTextSerializer",y=>y(t,n))||t.content.textBetween(0,t.content.size,`

`);return{dom:u,text:_,slice:t}}function Wd(n,t,e,i,s){let o=s.parent.type.spec.code,a,c;if(!e&&!t)return null;let u=t&&(i||o||!e);if(u){if(n.someProp("transformPastedText",_=>{t=_(t,o||i,n)}),o)return t?new B(A.from(n.state.schema.text(t.replace(/\r\n?/g,`
`))),0,0):B.empty;let m=n.someProp("clipboardTextParser",_=>_(t,s,i,n));if(m)c=m;else{let _=s.marks(),{schema:y}=n.state,v=$n.fromSchema(y);a=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach(x=>{let k=a.appendChild(document.createElement("p"));x&&k.appendChild(v.serializeNode(y.text(x,_)))})}}else n.someProp("transformPastedHTML",m=>{e=m(e,n)}),a=z_(e),er&&R_(a);let h=a&&a.querySelector("[data-pm-slice]"),f=h&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(h.getAttribute("data-pm-slice")||"");if(f&&f[3])for(let m=+f[3];m>0;m--){let _=a.firstChild;for(;_&&_.nodeType!=1;)_=_.nextSibling;if(!_)break;a=_}if(c||(c=(n.someProp("clipboardParser")||n.someProp("domParser")||Ce.fromSchema(n.state.schema)).parseSlice(a,{preserveWhitespace:!!(u||f),context:s,ruleFromNode(_){return _.nodeName=="BR"&&!_.nextSibling&&_.parentNode&&!I_.test(_.parentNode.nodeName)?{ignore:!0}:null}})),f)c=B_(Yc(c,+f[1],+f[2]),f[4]);else if(c=B.maxOpen(N_(c.content,s),!0),c.openStart||c.openEnd){let m=0,_=0;for(let y=c.content.firstChild;m<c.openStart&&!y.type.spec.isolating;m++,y=y.firstChild);for(let y=c.content.lastChild;_<c.openEnd&&!y.type.spec.isolating;_++,y=y.lastChild);c=Yc(c,m,_)}return n.someProp("transformPasted",m=>{c=m(c,n)}),c}const I_=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function N_(n,t){if(n.childCount<2)return n;for(let e=t.depth;e>=0;e--){let s=t.node(e).contentMatchAt(t.index(e)),o,a=[];if(n.forEach(c=>{if(!a)return;let u=s.findWrapping(c.type),h;if(!u)return a=null;if(h=a.length&&o.length&&qd(u,o,c,a[a.length-1],0))a[a.length-1]=h;else{a.length&&(a[a.length-1]=Ud(a[a.length-1],o.length));let f=jd(c,u);a.push(f),s=s.matchType(f.type),o=u}}),a)return A.from(a)}return n}function jd(n,t,e=0){for(let i=t.length-1;i>=e;i--)n=t[i].create(null,A.from(n));return n}function qd(n,t,e,i,s){if(s<n.length&&s<t.length&&n[s]==t[s]){let o=qd(n,t,e,i.lastChild,s+1);if(o)return i.copy(i.content.replaceChild(i.childCount-1,o));if(i.contentMatchAt(i.childCount).matchType(s==n.length-1?e.type:n[s+1]))return i.copy(i.content.append(A.from(jd(e,n,s+1))))}}function Ud(n,t){if(t==0)return n;let e=n.content.replaceChild(n.childCount-1,Ud(n.lastChild,t-1)),i=n.contentMatchAt(n.childCount).fillBefore(A.empty,!0);return n.copy(e.append(i))}function Uo(n,t,e,i,s,o){let a=t<0?n.firstChild:n.lastChild,c=a.content;return n.childCount>1&&(o=0),s<i-1&&(c=Uo(c,t,e,i,s+1,o)),s>=e&&(c=t<0?a.contentMatchAt(0).fillBefore(c,o<=s).append(c):c.append(a.contentMatchAt(a.childCount).fillBefore(A.empty,!0))),n.replaceChild(t<0?0:n.childCount-1,a.copy(c))}function Yc(n,t,e){return t<n.openStart&&(n=new B(Uo(n.content,-1,t,n.openStart,0,n.openEnd),t,n.openEnd)),e<n.openEnd&&(n=new B(Uo(n.content,1,e,n.openEnd,0,0),n.openStart,e)),n}const Kd={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Xc=null;function Jd(){return Xc||(Xc=document.implementation.createHTMLDocument("title"))}let wo=null;function D_(n){let t=window.trustedTypes;return t?(wo||(wo=t.defaultPolicy||t.createPolicy("ProseMirrorClipboard",{createHTML:e=>e})),wo.createHTML(n)):n}function z_(n){let t=/^(\s*<meta [^>]*>)*/.exec(n);t&&(n=n.slice(t[0].length));let e=Jd().createElement("div"),i=/<([a-z][^>\s]+)/i.exec(n),s;if((s=i&&Kd[i[1].toLowerCase()])&&(n=s.map(o=>"<"+o+">").join("")+n+s.map(o=>"</"+o+">").reverse().join("")),e.innerHTML=D_(n),s)for(let o=0;o<s.length;o++)e=e.querySelector(s[o])||e;return e}function R_(n){let t=n.querySelectorAll(Jt?"span:not([class]):not([style])":"span.Apple-converted-space");for(let e=0;e<t.length;e++){let i=t[e];i.childNodes.length==1&&i.textContent==""&&i.parentNode&&i.parentNode.replaceChild(n.ownerDocument.createTextNode(" "),i)}}function B_(n,t){if(!n.size)return n;let e=n.content.firstChild.type.schema,i;try{i=JSON.parse(t)}catch{return n}let{content:s,openStart:o,openEnd:a}=n;for(let c=i.length-2;c>=0;c-=2){let u=e.nodes[i[c]];if(!u||u.hasRequiredAttrs())break;s=A.from(u.create(i[c+1],s)),o++,a++}return new B(s,o,a)}const ee={},ne={},$_={touchstart:!0,touchmove:!0};class F_{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function V_(n){for(let t in ee){let e=ee[t];n.dom.addEventListener(t,n.input.eventHandlers[t]=i=>{H_(n,i)&&!Sa(n,i)&&(n.editable||!(i.type in ne))&&e(n,i)},$_[t]?{passive:!0}:void 0)}te&&n.dom.addEventListener("input",()=>null),Ko(n)}function nn(n,t){n.input.lastSelectionOrigin=t,n.input.lastSelectionTime=Date.now()}function Z_(n){n.domObserver.stop();for(let t in n.input.eventHandlers)n.dom.removeEventListener(t,n.input.eventHandlers[t]);clearTimeout(n.input.composingTimeout),clearTimeout(n.input.lastIOSEnterFallbackTimeout)}function Ko(n){n.someProp("handleDOMEvents",t=>{for(let e in t)n.input.eventHandlers[e]||n.dom.addEventListener(e,n.input.eventHandlers[e]=i=>Sa(n,i))})}function Sa(n,t){return n.someProp("handleDOMEvents",e=>{let i=e[t.type];return i?i(n,t)||t.defaultPrevented:!1})}function H_(n,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let e=t.target;e!=n.dom;e=e.parentNode)if(!e||e.nodeType==11||e.pmViewDesc&&e.pmViewDesc.stopEvent(t))return!1;return!0}function W_(n,t){!Sa(n,t)&&ee[t.type]&&(n.editable||!(t.type in ne))&&ee[t.type](n,t)}ne.keydown=(n,t)=>{let e=t;if(n.input.shiftKey=e.keyCode==16||e.shiftKey,!Yd(n,e)&&(n.input.lastKeyCode=e.keyCode,n.input.lastKeyCodeTime=Date.now(),!(We&&Jt&&e.keyCode==13)))if(e.keyCode!=229&&n.domObserver.forceFlush(),ai&&e.keyCode==13&&!e.ctrlKey&&!e.altKey&&!e.metaKey){let i=Date.now();n.input.lastIOSEnter=i,n.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{n.input.lastIOSEnter==i&&(n.someProp("handleKeyDown",s=>s(n,vn(13,"Enter"))),n.input.lastIOSEnter=0)},200)}else n.someProp("handleKeyDown",i=>i(n,e))||A_(n,e)?e.preventDefault():nn(n,"key")};ne.keyup=(n,t)=>{t.keyCode==16&&(n.input.shiftKey=!1)};ne.keypress=(n,t)=>{let e=t;if(Yd(n,e)||!e.charCode||e.ctrlKey&&!e.altKey||_e&&e.metaKey)return;if(n.someProp("handleKeyPress",s=>s(n,e))){e.preventDefault();return}let i=n.state.selection;if(!(i instanceof U)||!i.$from.sameParent(i.$to)){let s=String.fromCharCode(e.charCode),o=()=>n.state.tr.insertText(s).scrollIntoView();!/[\r\n]/.test(s)&&!n.someProp("handleTextInput",a=>a(n,i.$from.pos,i.$to.pos,s,o))&&n.dispatch(o()),e.preventDefault()}};function vs(n){return{left:n.clientX,top:n.clientY}}function j_(n,t){let e=t.x-n.clientX,i=t.y-n.clientY;return e*e+i*i<100}function Ma(n,t,e,i,s){if(i==-1)return!1;let o=n.state.doc.resolve(i);for(let a=o.depth+1;a>0;a--)if(n.someProp(t,c=>a>o.depth?c(n,e,o.nodeAfter,o.before(a),s,!0):c(n,e,o.node(a),o.before(a),s,!1)))return!0;return!1}function ri(n,t,e){if(n.focused||n.focus(),n.state.selection.eq(t))return;let i=n.state.tr.setSelection(t);i.setMeta("pointer",!0),n.dispatch(i)}function q_(n,t){if(t==-1)return!1;let e=n.state.doc.resolve(t),i=e.nodeAfter;return i&&i.isAtom&&j.isSelectable(i)?(ri(n,new j(e)),!0):!1}function U_(n,t){if(t==-1)return!1;let e=n.state.selection,i,s;e instanceof j&&(i=e.node);let o=n.state.doc.resolve(t);for(let a=o.depth+1;a>0;a--){let c=a>o.depth?o.nodeAfter:o.node(a);if(j.isSelectable(c)){i&&e.$from.depth>0&&a>=e.$from.depth&&o.before(e.$from.depth+1)==e.$from.pos?s=o.before(e.$from.depth):s=o.before(a);break}}return s!=null?(ri(n,j.create(n.state.doc,s)),!0):!1}function K_(n,t,e,i,s){return Ma(n,"handleClickOn",t,e,i)||n.someProp("handleClick",o=>o(n,t,i))||(s?U_(n,e):q_(n,e))}function J_(n,t,e,i){return Ma(n,"handleDoubleClickOn",t,e,i)||n.someProp("handleDoubleClick",s=>s(n,t,i))}function G_(n,t,e,i){return Ma(n,"handleTripleClickOn",t,e,i)||n.someProp("handleTripleClick",s=>s(n,t,i))||Y_(n,e,i)}function Y_(n,t,e){if(e.button!=0)return!1;let i=n.state.doc;if(t==-1)return i.inlineContent?(ri(n,U.create(i,0,i.content.size)),!0):!1;let s=i.resolve(t);for(let o=s.depth+1;o>0;o--){let a=o>s.depth?s.nodeAfter:s.node(o),c=s.before(o);if(a.inlineContent)ri(n,U.create(i,c+1,c+1+a.content.size));else if(j.isSelectable(a))ri(n,j.create(i,c));else continue;return!0}}function Ca(n){return Kr(n)}const Gd=_e?"metaKey":"ctrlKey";ee.mousedown=(n,t)=>{let e=t;n.input.shiftKey=e.shiftKey;let i=Ca(n),s=Date.now(),o="singleClick";s-n.input.lastClick.time<500&&j_(e,n.input.lastClick)&&!e[Gd]&&n.input.lastClick.button==e.button&&(n.input.lastClick.type=="singleClick"?o="doubleClick":n.input.lastClick.type=="doubleClick"&&(o="tripleClick")),n.input.lastClick={time:s,x:e.clientX,y:e.clientY,type:o,button:e.button};let a=n.posAtCoords(vs(e));a&&(o=="singleClick"?(n.input.mouseDown&&n.input.mouseDown.done(),n.input.mouseDown=new X_(n,a,e,!!i)):(o=="doubleClick"?J_:G_)(n,a.pos,a.inside,e)?e.preventDefault():nn(n,"pointer"))};class X_{constructor(t,e,i,s){this.view=t,this.pos=e,this.event=i,this.flushed=s,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=t.state.doc,this.selectNode=!!i[Gd],this.allowDefault=i.shiftKey;let o,a;if(e.inside>-1)o=t.state.doc.nodeAt(e.inside),a=e.inside;else{let f=t.state.doc.resolve(e.pos);o=f.parent,a=f.depth?f.before():0}const c=s?null:i.target,u=c?t.docView.nearestDesc(c,!0):null;this.target=u&&u.dom.nodeType==1?u.dom:null;let{selection:h}=t.state;(i.button==0&&o.type.spec.draggable&&o.type.spec.selectable!==!1||h instanceof j&&h.from<=a&&h.to>a)&&(this.mightDrag={node:o,pos:a,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Te&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),nn(t,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>je(this.view)),this.view.input.mouseDown=null}up(t){if(this.done(),!this.view.dom.contains(t.target))return;let e=this.pos;this.view.state.doc!=this.startDoc&&(e=this.view.posAtCoords(vs(t))),this.updateAllowDefault(t),this.allowDefault||!e?nn(this.view,"pointer"):K_(this.view,e.pos,e.inside,t,this.selectNode)?t.preventDefault():t.button==0&&(this.flushed||te&&this.mightDrag&&!this.mightDrag.node.isAtom||Jt&&!this.view.state.selection.visible&&Math.min(Math.abs(e.pos-this.view.state.selection.from),Math.abs(e.pos-this.view.state.selection.to))<=2)?(ri(this.view,Q.near(this.view.state.doc.resolve(e.pos))),t.preventDefault()):nn(this.view,"pointer")}move(t){this.updateAllowDefault(t),nn(this.view,"pointer"),t.buttons==0&&this.done()}updateAllowDefault(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0)}}ee.touchstart=n=>{n.input.lastTouch=Date.now(),Ca(n),nn(n,"pointer")};ee.touchmove=n=>{n.input.lastTouch=Date.now(),nn(n,"pointer")};ee.contextmenu=n=>Ca(n);function Yd(n,t){return n.composing?!0:te&&Math.abs(t.timeStamp-n.input.compositionEndedAt)<500?(n.input.compositionEndedAt=-2e8,!0):!1}const Q_=We?5e3:-1;ne.compositionstart=ne.compositionupdate=n=>{if(!n.composing){n.domObserver.flush();let{state:t}=n,e=t.selection.$to;if(t.selection instanceof U&&(t.storedMarks||!e.textOffset&&e.parentOffset&&e.nodeBefore.marks.some(i=>i.type.spec.inclusive===!1)))n.markCursor=n.state.storedMarks||e.marks(),Kr(n,!0),n.markCursor=null;else if(Kr(n,!t.selection.empty),Te&&t.selection.empty&&e.parentOffset&&!e.textOffset&&e.nodeBefore.marks.length){let i=n.domSelectionRange();for(let s=i.focusNode,o=i.focusOffset;s&&s.nodeType==1&&o!=0;){let a=o<0?s.lastChild:s.childNodes[o-1];if(!a)break;if(a.nodeType==3){let c=n.domSelection();c&&c.collapse(a,a.nodeValue.length);break}else s=a,o=-1}}n.input.composing=!0}Xd(n,Q_)};ne.compositionend=(n,t)=>{n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=t.timeStamp,n.input.compositionPendingChanges=n.domObserver.pendingRecords().length?n.input.compositionID:0,n.input.compositionNode=null,n.input.compositionPendingChanges&&Promise.resolve().then(()=>n.domObserver.flush()),n.input.compositionID++,Xd(n,20))};function Xd(n,t){clearTimeout(n.input.composingTimeout),t>-1&&(n.input.composingTimeout=setTimeout(()=>Kr(n),t))}function Qd(n){for(n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=ey());n.input.compositionNodes.length>0;)n.input.compositionNodes.pop().markParentsDirty()}function ty(n){let t=n.domSelectionRange();if(!t.focusNode)return null;let e=qg(t.focusNode,t.focusOffset),i=Ug(t.focusNode,t.focusOffset);if(e&&i&&e!=i){let s=i.pmViewDesc,o=n.domObserver.lastChangedTextNode;if(e==o||i==o)return o;if(!s||!s.isText(i.nodeValue))return i;if(n.input.compositionNode==i){let a=e.pmViewDesc;if(!(!a||!a.isText(e.nodeValue)))return i}}return e||i}function ey(){let n=document.createEvent("Event");return n.initEvent("event",!0,!0),n.timeStamp}function Kr(n,t=!1){if(!(We&&n.domObserver.flushingSoon>=0)){if(n.domObserver.forceFlush(),Qd(n),t||n.docView&&n.docView.dirty){let e=xa(n),i=n.state.selection;return e&&!e.eq(i)?n.dispatch(n.state.tr.setSelection(e)):(n.markCursor||t)&&!i.$from.node(i.$from.sharedDepth(i.to)).inlineContent?n.dispatch(n.state.tr.deleteSelection()):n.updateState(n.state),!0}return!1}}function ny(n,t){if(!n.dom.parentNode)return;let e=n.dom.parentNode.appendChild(document.createElement("div"));e.appendChild(t),e.style.cssText="position: fixed; left: -10000px; top: 10px";let i=getSelection(),s=document.createRange();s.selectNodeContents(t),n.dom.blur(),i.removeAllRanges(),i.addRange(s),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e),n.focus()},50)}const ji=ae&&rn<15||ai&&Xg<604;ee.copy=ne.cut=(n,t)=>{let e=t,i=n.state.selection,s=e.type=="cut";if(i.empty)return;let o=ji?null:e.clipboardData,a=i.content(),{dom:c,text:u}=ka(n,a);o?(e.preventDefault(),o.clearData(),o.setData("text/html",c.innerHTML),o.setData("text/plain",u)):ny(n,c),s&&n.dispatch(n.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function iy(n){return n.openStart==0&&n.openEnd==0&&n.content.childCount==1?n.content.firstChild:null}function ry(n,t){if(!n.dom.parentNode)return;let e=n.input.shiftKey||n.state.selection.$from.parent.type.spec.code,i=n.dom.parentNode.appendChild(document.createElement(e?"textarea":"div"));e||(i.contentEditable="true"),i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus();let s=n.input.shiftKey&&n.input.lastKeyCode!=45;setTimeout(()=>{n.focus(),i.parentNode&&i.parentNode.removeChild(i),e?qi(n,i.value,null,s,t):qi(n,i.textContent,i.innerHTML,s,t)},50)}function qi(n,t,e,i,s){let o=Wd(n,t,e,i,n.state.selection.$from);if(n.someProp("handlePaste",u=>u(n,s,o||B.empty)))return!0;if(!o)return!1;let a=iy(o),c=a?n.state.tr.replaceSelectionWith(a,i):n.state.tr.replaceSelection(o);return n.dispatch(c.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function th(n){let t=n.getData("text/plain")||n.getData("Text");if(t)return t;let e=n.getData("text/uri-list");return e?e.replace(/\r?\n/g," "):""}ne.paste=(n,t)=>{let e=t;if(n.composing&&!We)return;let i=ji?null:e.clipboardData,s=n.input.shiftKey&&n.input.lastKeyCode!=45;i&&qi(n,th(i),i.getData("text/html"),s,e)?e.preventDefault():ry(n,e)};class eh{constructor(t,e,i){this.slice=t,this.move=e,this.node=i}}const sy=_e?"altKey":"ctrlKey";function nh(n,t){let e=n.someProp("dragCopies",i=>!i(t));return e??!t[sy]}ee.dragstart=(n,t)=>{let e=t,i=n.input.mouseDown;if(i&&i.done(),!e.dataTransfer)return;let s=n.state.selection,o=s.empty?null:n.posAtCoords(vs(e)),a;if(!(o&&o.pos>=s.from&&o.pos<=(s instanceof j?s.to-1:s.to))){if(i&&i.mightDrag)a=j.create(n.state.doc,i.mightDrag.pos);else if(e.target&&e.target.nodeType==1){let m=n.docView.nearestDesc(e.target,!0);m&&m.node.type.spec.draggable&&m!=n.docView&&(a=j.create(n.state.doc,m.posBefore))}}let c=(a||n.state.selection).content(),{dom:u,text:h,slice:f}=ka(n,c);(!e.dataTransfer.files.length||!Jt||Pd>120)&&e.dataTransfer.clearData(),e.dataTransfer.setData(ji?"Text":"text/html",u.innerHTML),e.dataTransfer.effectAllowed="copyMove",ji||e.dataTransfer.setData("text/plain",h),n.dragging=new eh(f,nh(n,e),a)};ee.dragend=n=>{let t=n.dragging;window.setTimeout(()=>{n.dragging==t&&(n.dragging=null)},50)};ne.dragover=ne.dragenter=(n,t)=>t.preventDefault();ne.drop=(n,t)=>{let e=t,i=n.dragging;if(n.dragging=null,!e.dataTransfer)return;let s=n.posAtCoords(vs(e));if(!s)return;let o=n.state.doc.resolve(s.pos),a=i&&i.slice;a?n.someProp("transformPasted",v=>{a=v(a,n)}):a=Wd(n,th(e.dataTransfer),ji?null:e.dataTransfer.getData("text/html"),!1,o);let c=!!(i&&nh(n,e));if(n.someProp("handleDrop",v=>v(n,e,a||B.empty,c))){e.preventDefault();return}if(!a)return;e.preventDefault();let u=a?vd(n.state.doc,o.pos,a):o.pos;u==null&&(u=o.pos);let h=n.state.tr;if(c){let{node:v}=i;v?v.replace(h):h.deleteSelection()}let f=h.mapping.map(u),m=a.openStart==0&&a.openEnd==0&&a.content.childCount==1,_=h.doc;if(m?h.replaceRangeWith(f,f,a.content.firstChild):h.replaceRange(f,f,a),h.doc.eq(_))return;let y=h.doc.resolve(f);if(m&&j.isSelectable(a.content.firstChild)&&y.nodeAfter&&y.nodeAfter.sameMarkup(a.content.firstChild))h.setSelection(new j(y));else{let v=h.mapping.map(u);h.mapping.maps[h.mapping.maps.length-1].forEach((x,k,C,O)=>v=O),h.setSelection(wa(n,y,h.doc.resolve(v)))}n.focus(),n.dispatch(h.setMeta("uiEvent","drop"))};ee.focus=n=>{n.input.lastFocus=Date.now(),n.focused||(n.domObserver.stop(),n.dom.classList.add("ProseMirror-focused"),n.domObserver.start(),n.focused=!0,setTimeout(()=>{n.docView&&n.hasFocus()&&!n.domObserver.currentSelection.eq(n.domSelectionRange())&&je(n)},20))};ee.blur=(n,t)=>{let e=t;n.focused&&(n.domObserver.stop(),n.dom.classList.remove("ProseMirror-focused"),n.domObserver.start(),e.relatedTarget&&n.dom.contains(e.relatedTarget)&&n.domObserver.currentSelection.clear(),n.focused=!1)};ee.beforeinput=(n,t)=>{if(Jt&&We&&t.inputType=="deleteContentBackward"){n.domObserver.flushSoon();let{domChangeCount:i}=n.input;setTimeout(()=>{if(n.input.domChangeCount!=i||(n.dom.blur(),n.focus(),n.someProp("handleKeyDown",o=>o(n,vn(8,"Backspace")))))return;let{$cursor:s}=n.state.selection;s&&s.pos>0&&n.dispatch(n.state.tr.delete(s.pos-1,s.pos).scrollIntoView())},50)}};for(let n in ne)ee[n]=ne[n];function Ui(n,t){if(n==t)return!0;for(let e in n)if(n[e]!==t[e])return!1;for(let e in t)if(!(e in n))return!1;return!0}class Jr{constructor(t,e){this.toDOM=t,this.spec=e||Pn,this.side=this.spec.side||0}map(t,e,i,s){let{pos:o,deleted:a}=t.mapResult(e.from+s,this.side<0?-1:1);return a?null:new Qt(o-i,o-i,this)}valid(){return!0}eq(t){return this==t||t instanceof Jr&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&Ui(this.spec,t.spec))}destroy(t){this.spec.destroy&&this.spec.destroy(t)}}class on{constructor(t,e){this.attrs=t,this.spec=e||Pn}map(t,e,i,s){let o=t.map(e.from+s,this.spec.inclusiveStart?-1:1)-i,a=t.map(e.to+s,this.spec.inclusiveEnd?1:-1)-i;return o>=a?null:new Qt(o,a,this)}valid(t,e){return e.from<e.to}eq(t){return this==t||t instanceof on&&Ui(this.attrs,t.attrs)&&Ui(this.spec,t.spec)}static is(t){return t.type instanceof on}destroy(){}}class Ta{constructor(t,e){this.attrs=t,this.spec=e||Pn}map(t,e,i,s){let o=t.mapResult(e.from+s,1);if(o.deleted)return null;let a=t.mapResult(e.to+s,-1);return a.deleted||a.pos<=o.pos?null:new Qt(o.pos-i,a.pos-i,this)}valid(t,e){let{index:i,offset:s}=t.content.findIndex(e.from),o;return s==e.from&&!(o=t.child(i)).isText&&s+o.nodeSize==e.to}eq(t){return this==t||t instanceof Ta&&Ui(this.attrs,t.attrs)&&Ui(this.spec,t.spec)}destroy(){}}class Qt{constructor(t,e,i){this.from=t,this.to=e,this.type=i}copy(t,e){return new Qt(t,e,this.type)}eq(t,e=0){return this.type.eq(t.type)&&this.from+e==t.from&&this.to+e==t.to}map(t,e,i){return this.type.map(t,this,e,i)}static widget(t,e,i){return new Qt(t,t,new Jr(e,i))}static inline(t,e,i,s){return new Qt(t,e,new on(i,s))}static node(t,e,i,s){return new Qt(t,e,new Ta(i,s))}get spec(){return this.type.spec}get inline(){return this.type instanceof on}get widget(){return this.type instanceof Jr}}const Qn=[],Pn={};class kt{constructor(t,e){this.local=t.length?t:Qn,this.children=e.length?e:Qn}static create(t,e){return e.length?Gr(e,t,0,Pn):Kt}find(t,e,i){let s=[];return this.findInner(t??0,e??1e9,s,0,i),s}findInner(t,e,i,s,o){for(let a=0;a<this.local.length;a++){let c=this.local[a];c.from<=e&&c.to>=t&&(!o||o(c.spec))&&i.push(c.copy(c.from+s,c.to+s))}for(let a=0;a<this.children.length;a+=3)if(this.children[a]<e&&this.children[a+1]>t){let c=this.children[a]+1;this.children[a+2].findInner(t-c,e-c,i,s+c,o)}}map(t,e,i){return this==Kt||t.maps.length==0?this:this.mapInner(t,e,0,0,i||Pn)}mapInner(t,e,i,s,o){let a;for(let c=0;c<this.local.length;c++){let u=this.local[c].map(t,i,s);u&&u.type.valid(e,u)?(a||(a=[])).push(u):o.onRemove&&o.onRemove(this.local[c].spec)}return this.children.length?oy(this.children,a||[],t,e,i,s,o):a?new kt(a.sort(En),Qn):Kt}add(t,e){return e.length?this==Kt?kt.create(t,e):this.addInner(t,e,0):this}addInner(t,e,i){let s,o=0;t.forEach((c,u)=>{let h=u+i,f;if(f=rh(e,c,h)){for(s||(s=this.children.slice());o<s.length&&s[o]<u;)o+=3;s[o]==u?s[o+2]=s[o+2].addInner(c,f,h+1):s.splice(o,0,u,u+c.nodeSize,Gr(f,c,h+1,Pn)),o+=3}});let a=ih(o?sh(e):e,-i);for(let c=0;c<a.length;c++)a[c].type.valid(t,a[c])||a.splice(c--,1);return new kt(a.length?this.local.concat(a).sort(En):this.local,s||this.children)}remove(t){return t.length==0||this==Kt?this:this.removeInner(t,0)}removeInner(t,e){let i=this.children,s=this.local;for(let o=0;o<i.length;o+=3){let a,c=i[o]+e,u=i[o+1]+e;for(let f=0,m;f<t.length;f++)(m=t[f])&&m.from>c&&m.to<u&&(t[f]=null,(a||(a=[])).push(m));if(!a)continue;i==this.children&&(i=this.children.slice());let h=i[o+2].removeInner(a,c+1);h!=Kt?i[o+2]=h:(i.splice(o,3),o-=3)}if(s.length){for(let o=0,a;o<t.length;o++)if(a=t[o])for(let c=0;c<s.length;c++)s[c].eq(a,e)&&(s==this.local&&(s=this.local.slice()),s.splice(c--,1))}return i==this.children&&s==this.local?this:s.length||i.length?new kt(s,i):Kt}forChild(t,e){if(this==Kt)return this;if(e.isLeaf)return kt.empty;let i,s;for(let c=0;c<this.children.length;c+=3)if(this.children[c]>=t){this.children[c]==t&&(i=this.children[c+2]);break}let o=t+1,a=o+e.content.size;for(let c=0;c<this.local.length;c++){let u=this.local[c];if(u.from<a&&u.to>o&&u.type instanceof on){let h=Math.max(o,u.from)-o,f=Math.min(a,u.to)-o;h<f&&(s||(s=[])).push(u.copy(h,f))}}if(s){let c=new kt(s.sort(En),Qn);return i?new Qe([c,i]):c}return i||Kt}eq(t){if(this==t)return!0;if(!(t instanceof kt)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(let e=0;e<this.local.length;e++)if(!this.local[e].eq(t.local[e]))return!1;for(let e=0;e<this.children.length;e+=3)if(this.children[e]!=t.children[e]||this.children[e+1]!=t.children[e+1]||!this.children[e+2].eq(t.children[e+2]))return!1;return!0}locals(t){return Pa(this.localsInner(t))}localsInner(t){if(this==Kt)return Qn;if(t.inlineContent||!this.local.some(on.is))return this.local;let e=[];for(let i=0;i<this.local.length;i++)this.local[i].type instanceof on||e.push(this.local[i]);return e}forEachSet(t){t(this)}}kt.empty=new kt([],[]);kt.removeOverlap=Pa;const Kt=kt.empty;class Qe{constructor(t){this.members=t}map(t,e){const i=this.members.map(s=>s.map(t,e,Pn));return Qe.from(i)}forChild(t,e){if(e.isLeaf)return kt.empty;let i=[];for(let s=0;s<this.members.length;s++){let o=this.members[s].forChild(t,e);o!=Kt&&(o instanceof Qe?i=i.concat(o.members):i.push(o))}return Qe.from(i)}eq(t){if(!(t instanceof Qe)||t.members.length!=this.members.length)return!1;for(let e=0;e<this.members.length;e++)if(!this.members[e].eq(t.members[e]))return!1;return!0}locals(t){let e,i=!0;for(let s=0;s<this.members.length;s++){let o=this.members[s].localsInner(t);if(o.length)if(!e)e=o;else{i&&(e=e.slice(),i=!1);for(let a=0;a<o.length;a++)e.push(o[a])}}return e?Pa(i?e:e.sort(En)):Qn}static from(t){switch(t.length){case 0:return Kt;case 1:return t[0];default:return new Qe(t.every(e=>e instanceof kt)?t:t.reduce((e,i)=>e.concat(i instanceof kt?i:i.members),[]))}}forEachSet(t){for(let e=0;e<this.members.length;e++)this.members[e].forEachSet(t)}}function oy(n,t,e,i,s,o,a){let c=n.slice();for(let h=0,f=o;h<e.maps.length;h++){let m=0;e.maps[h].forEach((_,y,v,x)=>{let k=x-v-(y-_);for(let C=0;C<c.length;C+=3){let O=c[C+1];if(O<0||_>O+f-m)continue;let N=c[C]+f-m;y>=N?c[C+1]=_<=N?-2:-1:_>=f&&k&&(c[C]+=k,c[C+1]+=k)}m+=k}),f=e.maps[h].map(f,-1)}let u=!1;for(let h=0;h<c.length;h+=3)if(c[h+1]<0){if(c[h+1]==-2){u=!0,c[h+1]=-1;continue}let f=e.map(n[h]+o),m=f-s;if(m<0||m>=i.content.size){u=!0;continue}let _=e.map(n[h+1]+o,-1),y=_-s,{index:v,offset:x}=i.content.findIndex(m),k=i.maybeChild(v);if(k&&x==m&&x+k.nodeSize==y){let C=c[h+2].mapInner(e,k,f+1,n[h]+o+1,a);C!=Kt?(c[h]=m,c[h+1]=y,c[h+2]=C):(c[h+1]=-2,u=!0)}else u=!0}if(u){let h=ay(c,n,t,e,s,o,a),f=Gr(h,i,0,a);t=f.local;for(let m=0;m<c.length;m+=3)c[m+1]<0&&(c.splice(m,3),m-=3);for(let m=0,_=0;m<f.children.length;m+=3){let y=f.children[m];for(;_<c.length&&c[_]<y;)_+=3;c.splice(_,0,f.children[m],f.children[m+1],f.children[m+2])}}return new kt(t.sort(En),c)}function ih(n,t){if(!t||!n.length)return n;let e=[];for(let i=0;i<n.length;i++){let s=n[i];e.push(new Qt(s.from+t,s.to+t,s.type))}return e}function ay(n,t,e,i,s,o,a){function c(u,h){for(let f=0;f<u.local.length;f++){let m=u.local[f].map(i,s,h);m?e.push(m):a.onRemove&&a.onRemove(u.local[f].spec)}for(let f=0;f<u.children.length;f+=3)c(u.children[f+2],u.children[f]+h+1)}for(let u=0;u<n.length;u+=3)n[u+1]==-1&&c(n[u+2],t[u]+o+1);return e}function rh(n,t,e){if(t.isLeaf)return null;let i=e+t.nodeSize,s=null;for(let o=0,a;o<n.length;o++)(a=n[o])&&a.from>e&&a.to<i&&((s||(s=[])).push(a),n[o]=null);return s}function sh(n){let t=[];for(let e=0;e<n.length;e++)n[e]!=null&&t.push(n[e]);return t}function Gr(n,t,e,i){let s=[],o=!1;t.forEach((c,u)=>{let h=rh(n,c,u+e);if(h){o=!0;let f=Gr(h,c,e+u+1,i);f!=Kt&&s.push(u,u+c.nodeSize,f)}});let a=ih(o?sh(n):n,-e).sort(En);for(let c=0;c<a.length;c++)a[c].type.valid(t,a[c])||(i.onRemove&&i.onRemove(a[c].spec),a.splice(c--,1));return a.length||s.length?new kt(a,s):Kt}function En(n,t){return n.from-t.from||n.to-t.to}function Pa(n){let t=n;for(let e=0;e<t.length-1;e++){let i=t[e];if(i.from!=i.to)for(let s=e+1;s<t.length;s++){let o=t[s];if(o.from==i.from){o.to!=i.to&&(t==n&&(t=n.slice()),t[s]=o.copy(o.from,i.to),Qc(t,s+1,o.copy(i.to,o.to)));continue}else{o.from<i.to&&(t==n&&(t=n.slice()),t[e]=i.copy(i.from,o.from),Qc(t,s,i.copy(o.from,i.to)));break}}}return t}function Qc(n,t,e){for(;t<n.length&&En(e,n[t])>0;)t++;n.splice(t,0,e)}function ko(n){let t=[];return n.someProp("decorations",e=>{let i=e(n.state);i&&i!=Kt&&t.push(i)}),n.cursorWrapper&&t.push(kt.create(n.state.doc,[n.cursorWrapper.deco])),Qe.from(t)}const ly={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},cy=ae&&rn<=11;class uy{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset}}class dy{constructor(t,e){this.view=t,this.handleDOMChange=e,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new uy,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(i=>{for(let s=0;s<i.length;s++)this.queue.push(i[s]);ae&&rn<=11&&i.some(s=>s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length)?this.flushSoon():this.flush()}),cy&&(this.onCharData=i=>{this.queue.push({target:i.target,type:"characterData",oldValue:i.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,ly)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let t=this.observer.takeRecords();if(t.length){for(let e=0;e<t.length;e++)this.queue.push(t[e]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(jc(this.view)){if(this.suppressingSelectionUpdates)return je(this.view);if(ae&&rn<=11&&!this.view.state.selection.empty){let t=this.view.domSelectionRange();if(t.focusNode&&In(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(t){if(!t.focusNode)return!0;let e=new Set,i;for(let o=t.focusNode;o;o=oi(o))e.add(o);for(let o=t.anchorNode;o;o=oi(o))if(e.has(o)){i=o;break}let s=i&&this.view.docView.nearestDesc(i);if(s&&s.ignoreMutation({type:"selection",target:i.nodeType==3?i.parentNode:i}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let t of this.observer.takeRecords())this.queue.push(t);return this.queue}flush(){let{view:t}=this;if(!t.docView||this.flushingSoon>-1)return;let e=this.pendingRecords();e.length&&(this.queue=[]);let i=t.domSelectionRange(),s=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(i)&&jc(t)&&!this.ignoreSelectionChange(i),o=-1,a=-1,c=!1,u=[];if(t.editable)for(let f=0;f<e.length;f++){let m=this.registerMutation(e[f],u);m&&(o=o<0?m.from:Math.min(m.from,o),a=a<0?m.to:Math.max(m.to,a),m.typeOver&&(c=!0))}if(Te&&u.length){let f=u.filter(m=>m.nodeName=="BR");if(f.length==2){let[m,_]=f;m.parentNode&&m.parentNode.parentNode==_.parentNode?_.remove():m.remove()}else{let{focusNode:m}=this.currentSelection;for(let _ of f){let y=_.parentNode;y&&y.nodeName=="LI"&&(!m||py(t,m)!=y)&&_.remove()}}}let h=null;o<0&&s&&t.input.lastFocus>Date.now()-200&&Math.max(t.input.lastTouch,t.input.lastClick.time)<Date.now()-300&&_s(i)&&(h=xa(t))&&h.eq(Q.near(t.state.doc.resolve(0),1))?(t.input.lastFocus=0,je(t),this.currentSelection.set(i),t.scrollToSelection()):(o>-1||s)&&(o>-1&&(t.docView.markDirty(o,a),hy(t)),this.handleDOMChange(o,a,c,u),t.docView&&t.docView.dirty?t.updateState(t.state):this.currentSelection.eq(i)||je(t),this.currentSelection.set(i))}registerMutation(t,e){if(e.indexOf(t.target)>-1)return null;let i=this.view.docView.nearestDesc(t.target);if(t.type=="attributes"&&(i==this.view.docView||t.attributeName=="contenteditable"||t.attributeName=="style"&&!t.oldValue&&!t.target.getAttribute("style"))||!i||i.ignoreMutation(t))return null;if(t.type=="childList"){for(let f=0;f<t.addedNodes.length;f++){let m=t.addedNodes[f];e.push(m),m.nodeType==3&&(this.lastChangedTextNode=m)}if(i.contentDOM&&i.contentDOM!=i.dom&&!i.contentDOM.contains(t.target))return{from:i.posBefore,to:i.posAfter};let s=t.previousSibling,o=t.nextSibling;if(ae&&rn<=11&&t.addedNodes.length)for(let f=0;f<t.addedNodes.length;f++){let{previousSibling:m,nextSibling:_}=t.addedNodes[f];(!m||Array.prototype.indexOf.call(t.addedNodes,m)<0)&&(s=m),(!_||Array.prototype.indexOf.call(t.addedNodes,_)<0)&&(o=_)}let a=s&&s.parentNode==t.target?jt(s)+1:0,c=i.localPosFromDOM(t.target,a,-1),u=o&&o.parentNode==t.target?jt(o):t.target.childNodes.length,h=i.localPosFromDOM(t.target,u,1);return{from:c,to:h}}else return t.type=="attributes"?{from:i.posAtStart-i.border,to:i.posAtEnd+i.border}:(this.lastChangedTextNode=t.target,{from:i.posAtStart,to:i.posAtEnd,typeOver:t.target.nodeValue==t.oldValue})}}let tu=new WeakMap,eu=!1;function hy(n){if(!tu.has(n)&&(tu.set(n,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(n.dom).whiteSpace)!==-1)){if(n.requiresGeckoHackNode=Te,eu)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),eu=!0}}function nu(n,t){let e=t.startContainer,i=t.startOffset,s=t.endContainer,o=t.endOffset,a=n.domAtPos(n.state.selection.anchor);return In(a.node,a.offset,s,o)&&([e,i,s,o]=[s,o,e,i]),{anchorNode:e,anchorOffset:i,focusNode:s,focusOffset:o}}function fy(n,t){if(t.getComposedRanges){let s=t.getComposedRanges(n.root)[0];if(s)return nu(n,s)}let e;function i(s){s.preventDefault(),s.stopImmediatePropagation(),e=s.getTargetRanges()[0]}return n.dom.addEventListener("beforeinput",i,!0),document.execCommand("indent"),n.dom.removeEventListener("beforeinput",i,!0),e?nu(n,e):null}function py(n,t){for(let e=t.parentNode;e&&e!=n.dom;e=e.parentNode){let i=n.docView.nearestDesc(e,!0);if(i&&i.node.isBlock)return e}return null}function my(n,t,e){let{node:i,fromOffset:s,toOffset:o,from:a,to:c}=n.docView.parseRange(t,e),u=n.domSelectionRange(),h,f=u.anchorNode;if(f&&n.dom.contains(f.nodeType==1?f:f.parentNode)&&(h=[{node:f,offset:u.anchorOffset}],_s(u)||h.push({node:u.focusNode,offset:u.focusOffset})),Jt&&n.input.lastKeyCode===8)for(let k=o;k>s;k--){let C=i.childNodes[k-1],O=C.pmViewDesc;if(C.nodeName=="BR"&&!O){o=k;break}if(!O||O.size)break}let m=n.state.doc,_=n.someProp("domParser")||Ce.fromSchema(n.state.schema),y=m.resolve(a),v=null,x=_.parse(i,{topNode:y.parent,topMatch:y.parent.contentMatchAt(y.index()),topOpen:!0,from:s,to:o,preserveWhitespace:y.parent.type.whitespace=="pre"?"full":!0,findPositions:h,ruleFromNode:gy,context:y});if(h&&h[0].pos!=null){let k=h[0].pos,C=h[1]&&h[1].pos;C==null&&(C=k),v={anchor:k+a,head:C+a}}return{doc:x,sel:v,from:a,to:c}}function gy(n){let t=n.pmViewDesc;if(t)return t.parseRule();if(n.nodeName=="BR"&&n.parentNode){if(te&&/^(ul|ol)$/i.test(n.parentNode.nodeName)){let e=document.createElement("div");return e.appendChild(document.createElement("li")),{skip:e}}else if(n.parentNode.lastChild==n||te&&/^(tr|table)$/i.test(n.parentNode.nodeName))return{ignore:!0}}else if(n.nodeName=="IMG"&&n.getAttribute("mark-placeholder"))return{ignore:!0};return null}const _y=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function yy(n,t,e,i,s){let o=n.input.compositionPendingChanges||(n.composing?n.input.compositionID:0);if(n.input.compositionPendingChanges=0,t<0){let R=n.input.lastSelectionTime>Date.now()-50?n.input.lastSelectionOrigin:null,ut=xa(n,R);if(ut&&!n.state.selection.eq(ut)){if(Jt&&We&&n.input.lastKeyCode===13&&Date.now()-100<n.input.lastKeyCodeTime&&n.someProp("handleKeyDown",Tt=>Tt(n,vn(13,"Enter"))))return;let xt=n.state.tr.setSelection(ut);R=="pointer"?xt.setMeta("pointer",!0):R=="key"&&xt.scrollIntoView(),o&&xt.setMeta("composition",o),n.dispatch(xt)}return}let a=n.state.doc.resolve(t),c=a.sharedDepth(e);t=a.before(c+1),e=n.state.doc.resolve(e).after(c+1);let u=n.state.selection,h=my(n,t,e),f=n.state.doc,m=f.slice(h.from,h.to),_,y;n.input.lastKeyCode===8&&Date.now()-100<n.input.lastKeyCodeTime?(_=n.state.selection.to,y="end"):(_=n.state.selection.from,y="start"),n.input.lastKeyCode=null;let v=xy(m.content,h.doc.content,h.from,_,y);if(v&&n.input.domChangeCount++,(ai&&n.input.lastIOSEnter>Date.now()-225||We)&&s.some(R=>R.nodeType==1&&!_y.test(R.nodeName))&&(!v||v.endA>=v.endB)&&n.someProp("handleKeyDown",R=>R(n,vn(13,"Enter")))){n.input.lastIOSEnter=0;return}if(!v)if(i&&u instanceof U&&!u.empty&&u.$head.sameParent(u.$anchor)&&!n.composing&&!(h.sel&&h.sel.anchor!=h.sel.head))v={start:u.from,endA:u.to,endB:u.to};else{if(h.sel){let R=iu(n,n.state.doc,h.sel);if(R&&!R.eq(n.state.selection)){let ut=n.state.tr.setSelection(R);o&&ut.setMeta("composition",o),n.dispatch(ut)}}return}n.state.selection.from<n.state.selection.to&&v.start==v.endB&&n.state.selection instanceof U&&(v.start>n.state.selection.from&&v.start<=n.state.selection.from+2&&n.state.selection.from>=h.from?v.start=n.state.selection.from:v.endA<n.state.selection.to&&v.endA>=n.state.selection.to-2&&n.state.selection.to<=h.to&&(v.endB+=n.state.selection.to-v.endA,v.endA=n.state.selection.to)),ae&&rn<=11&&v.endB==v.start+1&&v.endA==v.start&&v.start>h.from&&h.doc.textBetween(v.start-h.from-1,v.start-h.from+1)==" "&&(v.start--,v.endA--,v.endB--);let x=h.doc.resolveNoCache(v.start-h.from),k=h.doc.resolveNoCache(v.endB-h.from),C=f.resolve(v.start),O=x.sameParent(k)&&x.parent.inlineContent&&C.end()>=v.endA,N;if((ai&&n.input.lastIOSEnter>Date.now()-225&&(!O||s.some(R=>R.nodeName=="DIV"||R.nodeName=="P"))||!O&&x.pos<h.doc.content.size&&(!x.sameParent(k)||!x.parent.inlineContent)&&!/\S/.test(h.doc.textBetween(x.pos,k.pos,"",""))&&(N=Q.findFrom(h.doc.resolve(x.pos+1),1,!0))&&N.head>x.pos)&&n.someProp("handleKeyDown",R=>R(n,vn(13,"Enter")))){n.input.lastIOSEnter=0;return}if(n.state.selection.anchor>v.start&&by(f,v.start,v.endA,x,k)&&n.someProp("handleKeyDown",R=>R(n,vn(8,"Backspace")))){We&&Jt&&n.domObserver.suppressSelectionUpdates();return}Jt&&v.endB==v.start&&(n.input.lastChromeDelete=Date.now()),We&&!O&&x.start()!=k.start()&&k.parentOffset==0&&x.depth==k.depth&&h.sel&&h.sel.anchor==h.sel.head&&h.sel.head==v.endA&&(v.endB-=2,k=h.doc.resolveNoCache(v.endB-h.from),setTimeout(()=>{n.someProp("handleKeyDown",function(R){return R(n,vn(13,"Enter"))})},20));let V=v.start,F=v.endA,et=R=>{let ut=R||n.state.tr.replace(V,F,h.doc.slice(v.start-h.from,v.endB-h.from));if(h.sel){let xt=iu(n,ut.doc,h.sel);xt&&!(Jt&&n.composing&&xt.empty&&(v.start!=v.endB||n.input.lastChromeDelete<Date.now()-100)&&(xt.head==V||xt.head==ut.mapping.map(F)-1)||ae&&xt.empty&&xt.head==V)&&ut.setSelection(xt)}return o&&ut.setMeta("composition",o),ut.scrollIntoView()},ot;if(O){if(x.pos==k.pos){ae&&rn<=11&&x.parentOffset==0&&(n.domObserver.suppressSelectionUpdates(),setTimeout(()=>je(n),20));let R=et(n.state.tr.delete(V,F)),ut=f.resolve(v.start).marksAcross(f.resolve(v.endA));ut&&R.ensureMarks(ut),n.dispatch(R)}else if(v.endA==v.endB&&(ot=vy(x.parent.content.cut(x.parentOffset,k.parentOffset),C.parent.content.cut(C.parentOffset,v.endA-C.start())))){let R=et(n.state.tr);ot.type=="add"?R.addMark(V,F,ot.mark):R.removeMark(V,F,ot.mark),n.dispatch(R)}else if(x.parent.child(x.index()).isText&&x.index()==k.index()-(k.textOffset?0:1)){let R=x.parent.textBetween(x.parentOffset,k.parentOffset),ut=()=>et(n.state.tr.insertText(R,V,F));n.someProp("handleTextInput",xt=>xt(n,V,F,R,ut))||n.dispatch(ut())}}else n.dispatch(et())}function iu(n,t,e){return Math.max(e.anchor,e.head)>t.content.size?null:wa(n,t.resolve(e.anchor),t.resolve(e.head))}function vy(n,t){let e=n.firstChild.marks,i=t.firstChild.marks,s=e,o=i,a,c,u;for(let f=0;f<i.length;f++)s=i[f].removeFromSet(s);for(let f=0;f<e.length;f++)o=e[f].removeFromSet(o);if(s.length==1&&o.length==0)c=s[0],a="add",u=f=>f.mark(c.addToSet(f.marks));else if(s.length==0&&o.length==1)c=o[0],a="remove",u=f=>f.mark(c.removeFromSet(f.marks));else return null;let h=[];for(let f=0;f<t.childCount;f++)h.push(u(t.child(f)));if(A.from(h).eq(n))return{mark:c,type:a}}function by(n,t,e,i,s){if(e-t<=s.pos-i.pos||So(i,!0,!1)<s.pos)return!1;let o=n.resolve(t);if(!i.parent.isTextblock){let c=o.nodeAfter;return c!=null&&e==t+c.nodeSize}if(o.parentOffset<o.parent.content.size||!o.parent.isTextblock)return!1;let a=n.resolve(So(o,!0,!0));return!a.parent.isTextblock||a.pos>e||So(a,!0,!1)<e?!1:i.parent.content.cut(i.parentOffset).eq(a.parent.content)}function So(n,t,e){let i=n.depth,s=t?n.end():n.pos;for(;i>0&&(t||n.indexAfter(i)==n.node(i).childCount);)i--,s++,t=!1;if(e){let o=n.node(i).maybeChild(n.indexAfter(i));for(;o&&!o.isLeaf;)o=o.firstChild,s++}return s}function xy(n,t,e,i,s){let o=n.findDiffStart(t,e);if(o==null)return null;let{a,b:c}=n.findDiffEnd(t,e+n.size,e+t.size);if(s=="end"){let u=Math.max(0,o-Math.min(a,c));i-=a+u-o}if(a<o&&n.size<t.size){let u=i<=o&&i>=a?o-i:0;o-=u,o&&o<t.size&&ru(t.textBetween(o-1,o+1))&&(o+=u?1:-1),c=o+(c-a),a=o}else if(c<o){let u=i<=o&&i>=c?o-i:0;o-=u,o&&o<n.size&&ru(n.textBetween(o-1,o+1))&&(o+=u?1:-1),a=o+(a-c),c=o}return{start:o,endA:a,endB:c}}function ru(n){if(n.length!=2)return!1;let t=n.charCodeAt(0),e=n.charCodeAt(1);return t>=56320&&t<=57343&&e>=55296&&e<=56319}class oh{constructor(t,e){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new F_,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=e,this.state=e.state,this.directPlugins=e.plugins||[],this.directPlugins.forEach(cu),this.dispatch=this.dispatch.bind(this),this.dom=t&&t.mount||document.createElement("div"),t&&(t.appendChild?t.appendChild(this.dom):typeof t=="function"?t(this.dom):t.mount&&(this.mounted=!0)),this.editable=au(this),ou(this),this.nodeViews=lu(this),this.docView=$c(this.state.doc,su(this),ko(this),this.dom,this),this.domObserver=new dy(this,(i,s,o,a)=>yy(this,i,s,o,a)),this.domObserver.start(),V_(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let t=this._props;this._props={};for(let e in t)this._props[e]=t[e];this._props.state=this.state}return this._props}update(t){t.handleDOMEvents!=this._props.handleDOMEvents&&Ko(this);let e=this._props;this._props=t,t.plugins&&(t.plugins.forEach(cu),this.directPlugins=t.plugins),this.updateStateInner(t.state,e)}setProps(t){let e={};for(let i in this._props)e[i]=this._props[i];e.state=this.state;for(let i in t)e[i]=t[i];this.update(e)}updateState(t){this.updateStateInner(t,this._props)}updateStateInner(t,e){var i;let s=this.state,o=!1,a=!1;t.storedMarks&&this.composing&&(Qd(this),a=!0),this.state=t;let c=s.plugins!=t.plugins||this._props.plugins!=e.plugins;if(c||this._props.plugins!=e.plugins||this._props.nodeViews!=e.nodeViews){let y=lu(this);ky(y,this.nodeViews)&&(this.nodeViews=y,o=!0)}(c||e.handleDOMEvents!=this._props.handleDOMEvents)&&Ko(this),this.editable=au(this),ou(this);let u=ko(this),h=su(this),f=s.plugins!=t.plugins&&!s.doc.eq(t.doc)?"reset":t.scrollToSelection>s.scrollToSelection?"to selection":"preserve",m=o||!this.docView.matchesNode(t.doc,h,u);(m||!t.selection.eq(s.selection))&&(a=!0);let _=f=="preserve"&&a&&this.dom.style.overflowAnchor==null&&e_(this);if(a){this.domObserver.stop();let y=m&&(ae||Jt)&&!this.composing&&!s.selection.empty&&!t.selection.empty&&wy(s.selection,t.selection);if(m){let v=Jt?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=ty(this)),(o||!this.docView.update(t.doc,h,u,this))&&(this.docView.updateOuterDeco(h),this.docView.destroy(),this.docView=$c(t.doc,h,u,this.dom,this)),v&&!this.trackWrites&&(y=!0)}y||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&M_(this))?je(this,y):(Vd(this,t.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(s),!((i=this.dragging)===null||i===void 0)&&i.node&&!s.doc.eq(t.doc)&&this.updateDraggedNode(this.dragging,s),f=="reset"?this.dom.scrollTop=0:f=="to selection"?this.scrollToSelection():_&&n_(_)}scrollToSelection(){let t=this.domSelectionRange().focusNode;if(!(!t||!this.dom.contains(t.nodeType==1?t:t.parentNode))){if(!this.someProp("handleScrollToSelection",e=>e(this)))if(this.state.selection instanceof j){let e=this.docView.domAfterPos(this.state.selection.from);e.nodeType==1&&Ic(this,e.getBoundingClientRect(),t)}else Ic(this,this.coordsAtPos(this.state.selection.head,1),t)}}destroyPluginViews(){let t;for(;t=this.pluginViews.pop();)t.destroy&&t.destroy()}updatePluginViews(t){if(!t||t.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let e=0;e<this.directPlugins.length;e++){let i=this.directPlugins[e];i.spec.view&&this.pluginViews.push(i.spec.view(this))}for(let e=0;e<this.state.plugins.length;e++){let i=this.state.plugins[e];i.spec.view&&this.pluginViews.push(i.spec.view(this))}}else for(let e=0;e<this.pluginViews.length;e++){let i=this.pluginViews[e];i.update&&i.update(this,t)}}updateDraggedNode(t,e){let i=t.node,s=-1;if(this.state.doc.nodeAt(i.from)==i.node)s=i.from;else{let o=i.from+(this.state.doc.content.size-e.doc.content.size);(o>0&&this.state.doc.nodeAt(o))==i.node&&(s=o)}this.dragging=new eh(t.slice,t.move,s<0?void 0:j.create(this.state.doc,s))}someProp(t,e){let i=this._props&&this._props[t],s;if(i!=null&&(s=e?e(i):i))return s;for(let a=0;a<this.directPlugins.length;a++){let c=this.directPlugins[a].props[t];if(c!=null&&(s=e?e(c):c))return s}let o=this.state.plugins;if(o)for(let a=0;a<o.length;a++){let c=o[a].props[t];if(c!=null&&(s=e?e(c):c))return s}}hasFocus(){if(ae){let t=this.root.activeElement;if(t==this.dom)return!0;if(!t||!this.dom.contains(t))return!1;for(;t&&this.dom!=t&&this.dom.contains(t);){if(t.contentEditable=="false")return!1;t=t.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&i_(this.dom),je(this),this.domObserver.start()}get root(){let t=this._root;if(t==null){for(let e=this.dom.parentNode;e;e=e.parentNode)if(e.nodeType==9||e.nodeType==11&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=()=>e.ownerDocument.getSelection()),this._root=e}return t||document}updateRoot(){this._root=null}posAtCoords(t){return l_(this,t)}coordsAtPos(t,e=1){return Id(this,t,e)}domAtPos(t,e=0){return this.docView.domFromPos(t,e)}nodeDOM(t){let e=this.docView.descAt(t);return e?e.nodeDOM:null}posAtDOM(t,e,i=-1){let s=this.docView.posFromDOM(t,e,i);if(s==null)throw new RangeError("DOM position not inside the editor");return s}endOfTextblock(t,e){return f_(this,e||this.state,t)}pasteHTML(t,e){return qi(this,"",t,!1,e||new ClipboardEvent("paste"))}pasteText(t,e){return qi(this,t,null,!0,e||new ClipboardEvent("paste"))}serializeForClipboard(t){return ka(this,t)}destroy(){this.docView&&(Z_(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],ko(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,Wg())}get isDestroyed(){return this.docView==null}dispatchEvent(t){return W_(this,t)}domSelectionRange(){let t=this.domSelection();return t?te&&this.root.nodeType===11&&Jg(this.dom.ownerDocument)==this.dom&&fy(this,t)||t:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}oh.prototype.dispatch=function(n){let t=this._props.dispatchTransaction;t?t.call(this,n):this.updateState(this.state.apply(n))};function su(n){let t=Object.create(null);return t.class="ProseMirror",t.contenteditable=String(n.editable),n.someProp("attributes",e=>{if(typeof e=="function"&&(e=e(n.state)),e)for(let i in e)i=="class"?t.class+=" "+e[i]:i=="style"?t.style=(t.style?t.style+";":"")+e[i]:!t[i]&&i!="contenteditable"&&i!="nodeName"&&(t[i]=String(e[i]))}),t.translate||(t.translate="no"),[Qt.node(0,n.state.doc.content.size,t)]}function ou(n){if(n.markCursor){let t=document.createElement("img");t.className="ProseMirror-separator",t.setAttribute("mark-placeholder","true"),t.setAttribute("alt",""),n.cursorWrapper={dom:t,deco:Qt.widget(n.state.selection.from,t,{raw:!0,marks:n.markCursor})}}else n.cursorWrapper=null}function au(n){return!n.someProp("editable",t=>t(n.state)===!1)}function wy(n,t){let e=Math.min(n.$anchor.sharedDepth(n.head),t.$anchor.sharedDepth(t.head));return n.$anchor.start(e)!=t.$anchor.start(e)}function lu(n){let t=Object.create(null);function e(i){for(let s in i)Object.prototype.hasOwnProperty.call(t,s)||(t[s]=i[s])}return n.someProp("nodeViews",e),n.someProp("markViews",e),t}function ky(n,t){let e=0,i=0;for(let s in n){if(n[s]!=t[s])return!0;e++}for(let s in t)i++;return e!=i}function cu(n){if(n.spec.state||n.spec.filterTransaction||n.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var an={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Yr={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},Sy=typeof navigator<"u"&&/Mac/.test(navigator.platform),My=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var qt=0;qt<10;qt++)an[48+qt]=an[96+qt]=String(qt);for(var qt=1;qt<=24;qt++)an[qt+111]="F"+qt;for(var qt=65;qt<=90;qt++)an[qt]=String.fromCharCode(qt+32),Yr[qt]=String.fromCharCode(qt);for(var Mo in an)Yr.hasOwnProperty(Mo)||(Yr[Mo]=an[Mo]);function Cy(n){var t=Sy&&n.metaKey&&n.shiftKey&&!n.ctrlKey&&!n.altKey||My&&n.shiftKey&&n.key&&n.key.length==1||n.key=="Unidentified",e=!t&&n.key||(n.shiftKey?Yr:an)[n.keyCode]||n.key||"Unidentified";return e=="Esc"&&(e="Escape"),e=="Del"&&(e="Delete"),e=="Left"&&(e="ArrowLeft"),e=="Up"&&(e="ArrowUp"),e=="Right"&&(e="ArrowRight"),e=="Down"&&(e="ArrowDown"),e}const Ty=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),Py=typeof navigator<"u"&&/Win/.test(navigator.platform);function Ey(n){let t=n.split(/-(?!$)/),e=t[t.length-1];e=="Space"&&(e=" ");let i,s,o,a;for(let c=0;c<t.length-1;c++){let u=t[c];if(/^(cmd|meta|m)$/i.test(u))a=!0;else if(/^a(lt)?$/i.test(u))i=!0;else if(/^(c|ctrl|control)$/i.test(u))s=!0;else if(/^s(hift)?$/i.test(u))o=!0;else if(/^mod$/i.test(u))Ty?a=!0:s=!0;else throw new Error("Unrecognized modifier name: "+u)}return i&&(e="Alt-"+e),s&&(e="Ctrl-"+e),a&&(e="Meta-"+e),o&&(e="Shift-"+e),e}function Oy(n){let t=Object.create(null);for(let e in n)t[Ey(e)]=n[e];return t}function Co(n,t,e=!0){return t.altKey&&(n="Alt-"+n),t.ctrlKey&&(n="Ctrl-"+n),t.metaKey&&(n="Meta-"+n),e&&t.shiftKey&&(n="Shift-"+n),n}function Ly(n){return new yt({props:{handleKeyDown:ah(n)}})}function ah(n){let t=Oy(n);return function(e,i){let s=Cy(i),o,a=t[Co(s,i)];if(a&&a(e.state,e.dispatch,e))return!0;if(s.length==1&&s!=" "){if(i.shiftKey){let c=t[Co(s,i,!1)];if(c&&c(e.state,e.dispatch,e))return!0}if((i.altKey||i.metaKey||i.ctrlKey)&&!(Py&&i.ctrlKey&&i.altKey)&&(o=an[i.keyCode])&&o!=s){let c=t[Co(o,i)];if(c&&c(e.state,e.dispatch,e))return!0}}return!1}}const bs=(n,t)=>n.selection.empty?!1:(t&&t(n.tr.deleteSelection().scrollIntoView()),!0);function lh(n,t){let{$cursor:e}=n.selection;return!e||(t?!t.endOfTextblock("backward",n):e.parentOffset>0)?null:e}const Ea=(n,t,e)=>{let i=lh(n,e);if(!i)return!1;let s=La(i);if(!s){let a=i.blockRange(),c=a&&Fn(a);return c==null?!1:(t&&t(n.tr.lift(a,c).scrollIntoView()),!0)}let o=s.nodeBefore;if(yh(n,s,t,-1))return!0;if(i.parent.content.size==0&&(li(o,"end")||j.isSelectable(o)))for(let a=i.depth;;a--){let c=ms(n.doc,i.before(a),i.after(a),B.empty);if(c&&c.slice.size<c.to-c.from){if(t){let u=n.tr.step(c);u.setSelection(li(o,"end")?Q.findFrom(u.doc.resolve(u.mapping.map(s.pos,-1)),-1):j.create(u.doc,s.pos-o.nodeSize)),t(u.scrollIntoView())}return!0}if(a==1||i.node(a-1).childCount>1)break}return o.isAtom&&s.depth==i.depth-1?(t&&t(n.tr.delete(s.pos-o.nodeSize,s.pos).scrollIntoView()),!0):!1},ch=(n,t,e)=>{let i=lh(n,e);if(!i)return!1;let s=La(i);return s?dh(n,s,t):!1},uh=(n,t,e)=>{let i=hh(n,e);if(!i)return!1;let s=Na(i);return s?dh(n,s,t):!1};function dh(n,t,e){let i=t.nodeBefore,s=i,o=t.pos-1;for(;!s.isTextblock;o--){if(s.type.spec.isolating)return!1;let f=s.lastChild;if(!f)return!1;s=f}let a=t.nodeAfter,c=a,u=t.pos+1;for(;!c.isTextblock;u++){if(c.type.spec.isolating)return!1;let f=c.firstChild;if(!f)return!1;c=f}let h=ms(n.doc,o,u,B.empty);if(!h||h.from!=o||h instanceof Nt&&h.slice.size>=u-o)return!1;if(e){let f=n.tr.step(h);f.setSelection(U.create(f.doc,o)),e(f.scrollIntoView())}return!0}function li(n,t,e=!1){for(let i=n;i;i=t=="start"?i.firstChild:i.lastChild){if(i.isTextblock)return!0;if(e&&i.childCount!=1)return!1}return!1}const Oa=(n,t,e)=>{let{$head:i,empty:s}=n.selection,o=i;if(!s)return!1;if(i.parent.isTextblock){if(e?!e.endOfTextblock("backward",n):i.parentOffset>0)return!1;o=La(i)}let a=o&&o.nodeBefore;return!a||!j.isSelectable(a)?!1:(t&&t(n.tr.setSelection(j.create(n.doc,o.pos-a.nodeSize)).scrollIntoView()),!0)};function La(n){if(!n.parent.type.spec.isolating)for(let t=n.depth-1;t>=0;t--){if(n.index(t)>0)return n.doc.resolve(n.before(t+1));if(n.node(t).type.spec.isolating)break}return null}function hh(n,t){let{$cursor:e}=n.selection;return!e||(t?!t.endOfTextblock("forward",n):e.parentOffset<e.parent.content.size)?null:e}const Aa=(n,t,e)=>{let i=hh(n,e);if(!i)return!1;let s=Na(i);if(!s)return!1;let o=s.nodeAfter;if(yh(n,s,t,1))return!0;if(i.parent.content.size==0&&(li(o,"start")||j.isSelectable(o))){let a=ms(n.doc,i.before(),i.after(),B.empty);if(a&&a.slice.size<a.to-a.from){if(t){let c=n.tr.step(a);c.setSelection(li(o,"start")?Q.findFrom(c.doc.resolve(c.mapping.map(s.pos)),1):j.create(c.doc,c.mapping.map(s.pos))),t(c.scrollIntoView())}return!0}}return o.isAtom&&s.depth==i.depth-1?(t&&t(n.tr.delete(s.pos,s.pos+o.nodeSize).scrollIntoView()),!0):!1},Ia=(n,t,e)=>{let{$head:i,empty:s}=n.selection,o=i;if(!s)return!1;if(i.parent.isTextblock){if(e?!e.endOfTextblock("forward",n):i.parentOffset<i.parent.content.size)return!1;o=Na(i)}let a=o&&o.nodeAfter;return!a||!j.isSelectable(a)?!1:(t&&t(n.tr.setSelection(j.create(n.doc,o.pos)).scrollIntoView()),!0)};function Na(n){if(!n.parent.type.spec.isolating)for(let t=n.depth-1;t>=0;t--){let e=n.node(t);if(n.index(t)+1<e.childCount)return n.doc.resolve(n.after(t+1));if(e.type.spec.isolating)break}return null}const fh=(n,t)=>{let e=n.selection,i=e instanceof j,s;if(i){if(e.node.isTextblock||!ze(n.doc,e.from))return!1;s=e.from}else if(s=pi(n.doc,e.from,-1),s==null)return!1;if(t){let o=n.tr.join(s);i&&o.setSelection(j.create(o.doc,s-n.doc.resolve(s).nodeBefore.nodeSize)),t(o.scrollIntoView())}return!0},ph=(n,t)=>{let e=n.selection,i;if(e instanceof j){if(e.node.isTextblock||!ze(n.doc,e.to))return!1;i=e.to}else if(i=pi(n.doc,e.to,1),i==null)return!1;return t&&t(n.tr.join(i).scrollIntoView()),!0},mh=(n,t)=>{let{$from:e,$to:i}=n.selection,s=e.blockRange(i),o=s&&Fn(s);return o==null?!1:(t&&t(n.tr.lift(s,o).scrollIntoView()),!0)},Da=(n,t)=>{let{$head:e,$anchor:i}=n.selection;return!e.parent.type.spec.code||!e.sameParent(i)?!1:(t&&t(n.tr.insertText(`
`).scrollIntoView()),!0)};function za(n){for(let t=0;t<n.edgeCount;t++){let{type:e}=n.edge(t);if(e.isTextblock&&!e.hasRequiredAttrs())return e}return null}const gh=(n,t)=>{let{$head:e,$anchor:i}=n.selection;if(!e.parent.type.spec.code||!e.sameParent(i))return!1;let s=e.node(-1),o=e.indexAfter(-1),a=za(s.contentMatchAt(o));if(!a||!s.canReplaceWith(o,o,a))return!1;if(t){let c=e.after(),u=n.tr.replaceWith(c,c,a.createAndFill());u.setSelection(Q.near(u.doc.resolve(c),1)),t(u.scrollIntoView())}return!0},Ra=(n,t)=>{let e=n.selection,{$from:i,$to:s}=e;if(e instanceof oe||i.parent.inlineContent||s.parent.inlineContent)return!1;let o=za(s.parent.contentMatchAt(s.indexAfter()));if(!o||!o.isTextblock)return!1;if(t){let a=(!i.parentOffset&&s.index()<s.parent.childCount?i:s).pos,c=n.tr.insert(a,o.createAndFill());c.setSelection(U.create(c.doc,a+1)),t(c.scrollIntoView())}return!0},Ba=(n,t)=>{let{$cursor:e}=n.selection;if(!e||e.parent.content.size)return!1;if(e.depth>1&&e.after()!=e.end(-1)){let o=e.before();if(fe(n.doc,o))return t&&t(n.tr.split(o).scrollIntoView()),!0}let i=e.blockRange(),s=i&&Fn(i);return s==null?!1:(t&&t(n.tr.lift(i,s).scrollIntoView()),!0)};function Ay(n){return(t,e)=>{let{$from:i,$to:s}=t.selection;if(t.selection instanceof j&&t.selection.node.isBlock)return!i.parentOffset||!fe(t.doc,i.pos)?!1:(e&&e(t.tr.split(i.pos).scrollIntoView()),!0);if(!i.depth)return!1;let o=[],a,c,u=!1,h=!1;for(let y=i.depth;;y--)if(i.node(y).isBlock){u=i.end(y)==i.pos+(i.depth-y),h=i.start(y)==i.pos-(i.depth-y),c=za(i.node(y-1).contentMatchAt(i.indexAfter(y-1))),o.unshift(u&&c?{type:c}:null),a=y;break}else{if(y==1)return!1;o.unshift(null)}let f=t.tr;(t.selection instanceof U||t.selection instanceof oe)&&f.deleteSelection();let m=f.mapping.map(i.pos),_=fe(f.doc,m,o.length,o);if(_||(o[0]=c?{type:c}:null,_=fe(f.doc,m,o.length,o)),!_)return!1;if(f.split(m,o.length,o),!u&&h&&i.node(a).type!=c){let y=f.mapping.map(i.before(a)),v=f.doc.resolve(y);c&&i.node(a-1).canReplaceWith(v.index(),v.index()+1,c)&&f.setNodeMarkup(f.mapping.map(i.before(a)),c)}return e&&e(f.scrollIntoView()),!0}}const Iy=Ay(),_h=(n,t)=>{let{$from:e,to:i}=n.selection,s,o=e.sharedDepth(i);return o==0?!1:(s=e.before(o),t&&t(n.tr.setSelection(j.create(n.doc,s))),!0)};function Ny(n,t,e){let i=t.nodeBefore,s=t.nodeAfter,o=t.index();return!i||!s||!i.type.compatibleContent(s.type)?!1:!i.content.size&&t.parent.canReplace(o-1,o)?(e&&e(n.tr.delete(t.pos-i.nodeSize,t.pos).scrollIntoView()),!0):!t.parent.canReplace(o,o+1)||!(s.isTextblock||ze(n.doc,t.pos))?!1:(e&&e(n.tr.join(t.pos).scrollIntoView()),!0)}function yh(n,t,e,i){let s=t.nodeBefore,o=t.nodeAfter,a,c,u=s.type.spec.isolating||o.type.spec.isolating;if(!u&&Ny(n,t,e))return!0;let h=!u&&t.parent.canReplace(t.index(),t.index()+1);if(h&&(a=(c=s.contentMatchAt(s.childCount)).findWrapping(o.type))&&c.matchType(a[0]||o.type).validEnd){if(e){let y=t.pos+o.nodeSize,v=A.empty;for(let C=a.length-1;C>=0;C--)v=A.from(a[C].create(null,v));v=A.from(s.copy(v));let x=n.tr.step(new Dt(t.pos-1,y,t.pos,y,new B(v,1,0),a.length,!0)),k=x.doc.resolve(y+2*a.length);k.nodeAfter&&k.nodeAfter.type==s.type&&ze(x.doc,k.pos)&&x.join(k.pos),e(x.scrollIntoView())}return!0}let f=o.type.spec.isolating||i>0&&u?null:Q.findFrom(t,1),m=f&&f.$from.blockRange(f.$to),_=m&&Fn(m);if(_!=null&&_>=t.depth)return e&&e(n.tr.lift(m,_).scrollIntoView()),!0;if(h&&li(o,"start",!0)&&li(s,"end")){let y=s,v=[];for(;v.push(y),!y.isTextblock;)y=y.lastChild;let x=o,k=1;for(;!x.isTextblock;x=x.firstChild)k++;if(y.canReplace(y.childCount,y.childCount,x.content)){if(e){let C=A.empty;for(let N=v.length-1;N>=0;N--)C=A.from(v[N].copy(C));let O=n.tr.step(new Dt(t.pos-v.length,t.pos+o.nodeSize,t.pos+k,t.pos+o.nodeSize-k,new B(C,v.length,0),0,!0));e(O.scrollIntoView())}return!0}}return!1}function vh(n){return function(t,e){let i=t.selection,s=n<0?i.$from:i.$to,o=s.depth;for(;s.node(o).isInline;){if(!o)return!1;o--}return s.node(o).isTextblock?(e&&e(t.tr.setSelection(U.create(t.doc,n<0?s.start(o):s.end(o)))),!0):!1}}const bh=vh(-1),xh=vh(1);function wh(n,t=null){return function(e,i){let{$from:s,$to:o}=e.selection,a=s.blockRange(o),c=a&&ya(a,n,t);return c?(i&&i(e.tr.wrap(a,c).scrollIntoView()),!0):!1}}function Xr(n,t=null){return function(e,i){let s=!1;for(let o=0;o<e.selection.ranges.length&&!s;o++){let{$from:{pos:a},$to:{pos:c}}=e.selection.ranges[o];e.doc.nodesBetween(a,c,(u,h)=>{if(s)return!1;if(!(!u.isTextblock||u.hasMarkup(n,t)))if(u.type==n)s=!0;else{let f=e.doc.resolve(h),m=f.index();s=f.parent.canReplaceWith(m,m+1,n)}})}if(!s)return!1;if(i){let o=e.tr;for(let a=0;a<e.selection.ranges.length;a++){let{$from:{pos:c},$to:{pos:u}}=e.selection.ranges[a];o.setBlockType(c,u,n,t)}i(o.scrollIntoView())}return!0}}function $a(...n){return function(t,e,i){for(let s=0;s<n.length;s++)if(n[s](t,e,i))return!0;return!1}}$a(bs,Ea,Oa);$a(bs,Aa,Ia);$a(Da,Ra,Ba,Iy);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function kh(n,t=null){return function(e,i){let{$from:s,$to:o}=e.selection,a=s.blockRange(o);if(!a)return!1;let c=i?e.tr:null;return Dy(c,a,n,t)?(i&&i(c.scrollIntoView()),!0):!1}}function Dy(n,t,e,i=null){let s=!1,o=t,a=t.$from.doc;if(t.depth>=2&&t.$from.node(t.depth-1).type.compatibleContent(e)&&t.startIndex==0){if(t.$from.index(t.depth-1)==0)return!1;let u=a.resolve(t.start-2);o=new Wr(u,u,t.depth),t.endIndex<t.parent.childCount&&(t=new Wr(t.$from,a.resolve(t.$to.end(t.depth)),t.depth)),s=!0}let c=ya(o,e,i,t);return c?(n&&zy(n,t,c,s,e),!0):!1}function zy(n,t,e,i,s){let o=A.empty;for(let f=e.length-1;f>=0;f--)o=A.from(e[f].type.create(e[f].attrs,o));n.step(new Dt(t.start-(i?2:0),t.end,t.start,t.end,new B(o,0,0),e.length,!0));let a=0;for(let f=0;f<e.length;f++)e[f].type==s&&(a=f+1);let c=e.length-a,u=t.start+e.length-(i?2:0),h=t.parent;for(let f=t.startIndex,m=t.endIndex,_=!0;f<m;f++,_=!1)!_&&fe(n.doc,u,c)&&(n.split(u,c),u+=2*c),u+=h.child(f).nodeSize;return n}function Sh(n){return function(t,e){let{$from:i,$to:s}=t.selection,o=i.blockRange(s,a=>a.childCount>0&&a.firstChild.type==n);return o?e?i.node(o.depth-1).type==n?Ry(t,e,n,o):By(t,e,o):!0:!1}}function Ry(n,t,e,i){let s=n.tr,o=i.end,a=i.$to.end(i.depth);o<a&&(s.step(new Dt(o-1,a,o,a,new B(A.from(e.create(null,i.parent.copy())),1,0),1,!0)),i=new Wr(s.doc.resolve(i.$from.pos),s.doc.resolve(a),i.depth));const c=Fn(i);if(c==null)return!1;s.lift(i,c);let u=s.doc.resolve(s.mapping.map(o,-1)-1);return ze(s.doc,u.pos)&&u.nodeBefore.type==u.nodeAfter.type&&s.join(u.pos),t(s.scrollIntoView()),!0}function By(n,t,e){let i=n.tr,s=e.parent;for(let y=e.end,v=e.endIndex-1,x=e.startIndex;v>x;v--)y-=s.child(v).nodeSize,i.delete(y-1,y+1);let o=i.doc.resolve(e.start),a=o.nodeAfter;if(i.mapping.map(e.end)!=e.start+o.nodeAfter.nodeSize)return!1;let c=e.startIndex==0,u=e.endIndex==s.childCount,h=o.node(-1),f=o.index(-1);if(!h.canReplace(f+(c?0:1),f+1,a.content.append(u?A.empty:A.from(s))))return!1;let m=o.pos,_=m+a.nodeSize;return i.step(new Dt(m-(c?1:0),_+(u?1:0),m+1,_-1,new B((c?A.empty:A.from(s.copy(A.empty))).append(u?A.empty:A.from(s.copy(A.empty))),c?0:1,u?0:1),c?0:1)),t(i.scrollIntoView()),!0}function Mh(n){return function(t,e){let{$from:i,$to:s}=t.selection,o=i.blockRange(s,h=>h.childCount>0&&h.firstChild.type==n);if(!o)return!1;let a=o.startIndex;if(a==0)return!1;let c=o.parent,u=c.child(a-1);if(u.type!=n)return!1;if(e){let h=u.lastChild&&u.lastChild.type==c.type,f=A.from(h?n.create():null),m=new B(A.from(n.create(null,A.from(c.type.create(null,f)))),h?3:1,0),_=o.start,y=o.end;e(t.tr.step(new Dt(_-(h?3:1),y,_,y,m,1,!0)).scrollIntoView())}return!0}}function xs(n){const{state:t,transaction:e}=n;let{selection:i}=e,{doc:s}=e,{storedMarks:o}=e;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return o},get selection(){return i},get doc(){return s},get tr(){return i=e.selection,s=e.doc,o=e.storedMarks,e}}}let ws=class{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:e,state:i}=this,{view:s}=e,{tr:o}=i,a=this.buildProps(o);return Object.fromEntries(Object.entries(t).map(([c,u])=>[c,(...f)=>{const m=u(...f)(a);return!o.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(o),m}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){const{rawCommands:i,editor:s,state:o}=this,{view:a}=s,c=[],u=!!t,h=t||o.tr,f=()=>(!u&&e&&!h.getMeta("preventDispatch")&&!this.hasCustomState&&a.dispatch(h),c.every(_=>_===!0)),m={...Object.fromEntries(Object.entries(i).map(([_,y])=>[_,(...x)=>{const k=this.buildProps(h,e),C=y(...x)(k);return c.push(C),m}])),run:f};return m}createCan(t){const{rawCommands:e,state:i}=this,s=!1,o=t||i.tr,a=this.buildProps(o,s);return{...Object.fromEntries(Object.entries(e).map(([u,h])=>[u,(...f)=>h(...f)({...a,dispatch:void 0})])),chain:()=>this.createChain(o,s)}}buildProps(t,e=!0){const{rawCommands:i,editor:s,state:o}=this,{view:a}=s,c={tr:t,editor:s,view:a,state:xs({state:o,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t,e),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(i).map(([u,h])=>[u,(...f)=>h(...f)(c)]))}};return c}};class $y{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const i=this.callbacks[t];return i&&i.forEach(s=>s.apply(this,e)),this}off(t,e){const i=this.callbacks[t];return i&&(e?this.callbacks[t]=i.filter(s=>s!==e):delete this.callbacks[t]),this}once(t,e){const i=(...s)=>{this.off(t,i),e.apply(this,s)};return this.on(t,i)}removeAllListeners(){this.callbacks={}}}function H(n,t,e){return n.config[t]===void 0&&n.parent?H(n.parent,t,e):typeof n.config[t]=="function"?n.config[t].bind({...e,parent:n.parent?H(n.parent,t,e):null}):n.config[t]}function ks(n){const t=n.filter(s=>s.type==="extension"),e=n.filter(s=>s.type==="node"),i=n.filter(s=>s.type==="mark");return{baseExtensions:t,nodeExtensions:e,markExtensions:i}}function Ch(n){const t=[],{nodeExtensions:e,markExtensions:i}=ks(n),s=[...e,...i],o={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return n.forEach(a=>{const c={name:a.name,options:a.options,storage:a.storage,extensions:s},u=H(a,"addGlobalAttributes",c);if(!u)return;u().forEach(f=>{f.types.forEach(m=>{Object.entries(f.attributes).forEach(([_,y])=>{t.push({type:m,name:_,attribute:{...o,...y}})})})})}),s.forEach(a=>{const c={name:a.name,options:a.options,storage:a.storage},u=H(a,"addAttributes",c);if(!u)return;const h=u();Object.entries(h).forEach(([f,m])=>{const _={...o,...m};typeof _?.default=="function"&&(_.default=_.default()),_?.isRequired&&_?.default===void 0&&delete _.default,t.push({type:a.name,name:f,attribute:_})})}),t}function Ft(n,t){if(typeof n=="string"){if(!t.nodes[n])throw Error(`There is no node type named '${n}'. Maybe you forgot to add the extension?`);return t.nodes[n]}return n}function Fy(...n){return n.filter(t=>!!t).reduce((t,e)=>{const i={...t};return Object.entries(e).forEach(([s,o])=>{if(!i[s]){i[s]=o;return}if(s==="class"){const c=o?String(o).split(" "):[],u=i[s]?i[s].split(" "):[],h=c.filter(f=>!u.includes(f));i[s]=[...u,...h].join(" ")}else if(s==="style"){const c=o?o.split(";").map(f=>f.trim()).filter(Boolean):[],u=i[s]?i[s].split(";").map(f=>f.trim()).filter(Boolean):[],h=new Map;u.forEach(f=>{const[m,_]=f.split(":").map(y=>y.trim());h.set(m,_)}),c.forEach(f=>{const[m,_]=f.split(":").map(y=>y.trim());h.set(m,_)}),i[s]=Array.from(h.entries()).map(([f,m])=>`${f}: ${m}`).join("; ")}else i[s]=o}),i},{})}function Jo(n,t){return t.filter(e=>e.type===n.type.name).filter(e=>e.attribute.rendered).map(e=>e.attribute.renderHTML?e.attribute.renderHTML(n.attrs)||{}:{[e.name]:n.attrs[e.name]}).reduce((e,i)=>Fy(e,i),{})}function Th(n){return typeof n=="function"}function ht(n,t=void 0,...e){return Th(n)?t?n.bind(t)(...e):n(...e):n}function Vy(n={}){return Object.keys(n).length===0&&n.constructor===Object}function Zy(n){return typeof n!="string"?n:n.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(n):n==="true"?!0:n==="false"?!1:n}function uu(n,t){return"style"in n?n:{...n,getAttrs:e=>{const i=n.getAttrs?n.getAttrs(e):n.attrs;if(i===!1)return!1;const s=t.reduce((o,a)=>{const c=a.attribute.parseHTML?a.attribute.parseHTML(e):Zy(e.getAttribute(a.name));return c==null?o:{...o,[a.name]:c}},{});return{...i,...s}}}}function du(n){return Object.fromEntries(Object.entries(n).filter(([t,e])=>t==="attrs"&&Vy(e)?!1:e!=null))}function Hy(n,t){var e;const i=Ch(n),{nodeExtensions:s,markExtensions:o}=ks(n),a=(e=s.find(h=>H(h,"topNode")))===null||e===void 0?void 0:e.name,c=Object.fromEntries(s.map(h=>{const f=i.filter(C=>C.type===h.name),m={name:h.name,options:h.options,storage:h.storage,editor:t},_=n.reduce((C,O)=>{const N=H(O,"extendNodeSchema",m);return{...C,...N?N(h):{}}},{}),y=du({..._,content:ht(H(h,"content",m)),marks:ht(H(h,"marks",m)),group:ht(H(h,"group",m)),inline:ht(H(h,"inline",m)),atom:ht(H(h,"atom",m)),selectable:ht(H(h,"selectable",m)),draggable:ht(H(h,"draggable",m)),code:ht(H(h,"code",m)),whitespace:ht(H(h,"whitespace",m)),linebreakReplacement:ht(H(h,"linebreakReplacement",m)),defining:ht(H(h,"defining",m)),isolating:ht(H(h,"isolating",m)),attrs:Object.fromEntries(f.map(C=>{var O;return[C.name,{default:(O=C?.attribute)===null||O===void 0?void 0:O.default}]}))}),v=ht(H(h,"parseHTML",m));v&&(y.parseDOM=v.map(C=>uu(C,f)));const x=H(h,"renderHTML",m);x&&(y.toDOM=C=>x({node:C,HTMLAttributes:Jo(C,f)}));const k=H(h,"renderText",m);return k&&(y.toText=k),[h.name,y]})),u=Object.fromEntries(o.map(h=>{const f=i.filter(k=>k.type===h.name),m={name:h.name,options:h.options,storage:h.storage,editor:t},_=n.reduce((k,C)=>{const O=H(C,"extendMarkSchema",m);return{...k,...O?O(h):{}}},{}),y=du({..._,inclusive:ht(H(h,"inclusive",m)),excludes:ht(H(h,"excludes",m)),group:ht(H(h,"group",m)),spanning:ht(H(h,"spanning",m)),code:ht(H(h,"code",m)),attrs:Object.fromEntries(f.map(k=>{var C;return[k.name,{default:(C=k?.attribute)===null||C===void 0?void 0:C.default}]}))}),v=ht(H(h,"parseHTML",m));v&&(y.parseDOM=v.map(k=>uu(k,f)));const x=H(h,"renderHTML",m);return x&&(y.toDOM=k=>x({mark:k,HTMLAttributes:Jo(k,f)})),[h.name,y]}));return new ma({topNode:a,nodes:c,marks:u})}function To(n,t){return t.nodes[n]||t.marks[n]||null}function hu(n,t){return Array.isArray(t)?t.some(e=>(typeof e=="string"?e:e.name)===n.name):t}function Fa(n,t){const e=$n.fromSchema(t).serializeFragment(n),s=document.implementation.createHTMLDocument().createElement("div");return s.appendChild(e),s.innerHTML}const Wy=(n,t=500)=>{let e="";const i=n.parentOffset;return n.parent.nodesBetween(Math.max(0,i-t),i,(s,o,a,c)=>{var u,h;const f=((h=(u=s.type.spec).toText)===null||h===void 0?void 0:h.call(u,{node:s,pos:o,parent:a,index:c}))||s.textContent||"%leaf%";e+=s.isAtom&&!s.isText?f:f.slice(0,Math.max(0,i-o))}),e};function Va(n){return Object.prototype.toString.call(n)==="[object RegExp]"}const jy=(n,t)=>{if(Va(t))return t.exec(n);const e=t(n);if(!e)return null;const i=[e.text];return i.index=e.index,i.input=n,i.data=e.data,e.replaceWith&&(e.text.includes(e.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),i.push(e.replaceWith)),i};function Tr(n){var t;const{editor:e,from:i,to:s,text:o,rules:a,plugin:c}=n,{view:u}=e;if(u.composing)return!1;const h=u.state.doc.resolve(i);if(h.parent.type.spec.code||!((t=h.nodeBefore||h.nodeAfter)===null||t===void 0)&&t.marks.find(_=>_.type.spec.code))return!1;let f=!1;const m=Wy(h)+o;return a.forEach(_=>{if(f)return;const y=jy(m,_.find);if(!y)return;const v=u.state.tr,x=xs({state:u.state,transaction:v}),k={from:i-(y[0].length-o.length),to:s},{commands:C,chain:O,can:N}=new ws({editor:e,state:x});_.handler({state:x,range:k,match:y,commands:C,chain:O,can:N})===null||!v.steps.length||(v.setMeta(c,{transform:v,from:i,to:s,text:o}),u.dispatch(v),f=!0)}),f}function qy(n){const{editor:t,rules:e}=n,i=new yt({state:{init(){return null},apply(s,o,a){const c=s.getMeta(i);if(c)return c;const u=s.getMeta("applyInputRules");return!!u&&setTimeout(()=>{let{text:f}=u;typeof f=="string"?f=f:f=Fa(A.from(f),a.schema);const{from:m}=u,_=m+f.length;Tr({editor:t,from:m,to:_,text:f,rules:e,plugin:i})}),s.selectionSet||s.docChanged?null:o}},props:{handleTextInput(s,o,a,c){return Tr({editor:t,from:o,to:a,text:c,rules:e,plugin:i})},handleDOMEvents:{compositionend:s=>(setTimeout(()=>{const{$cursor:o}=s.state.selection;o&&Tr({editor:t,from:o.pos,to:o.pos,text:"",rules:e,plugin:i})}),!1)},handleKeyDown(s,o){if(o.key!=="Enter")return!1;const{$cursor:a}=s.state.selection;return a?Tr({editor:t,from:a.pos,to:a.pos,text:`
`,rules:e,plugin:i}):!1}},isInputRules:!0});return i}function Uy(n){return Object.prototype.toString.call(n).slice(8,-1)}function Pr(n){return Uy(n)!=="Object"?!1:n.constructor===Object&&Object.getPrototypeOf(n)===Object.prototype}function Za(n,t){const e={...n};return Pr(n)&&Pr(t)&&Object.keys(t).forEach(i=>{Pr(t[i])&&Pr(n[i])?e[i]=Za(n[i],t[i]):e[i]=t[i]}),e}let Ky=class Go{constructor(t={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=ht(H(this,"addOptions",{name:this.name}))),this.storage=ht(H(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new Go(t)}configure(t={}){const e=this.extend({...this.config,addOptions:()=>Za(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){const e=new Go(t);return e.parent=this,this.child=e,e.name=t.name?t.name:e.parent.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${e.name}".`),e.options=ht(H(e,"addOptions",{name:e.name})),e.storage=ht(H(e,"addStorage",{name:e.name,options:e.options})),e}static handleExit({editor:t,mark:e}){const{tr:i}=t.state,s=t.state.selection.$from;if(s.pos===s.end()){const a=s.marks();if(!!!a.find(h=>h?.type.name===e.name))return!1;const u=a.find(h=>h?.type.name===e.name);return u&&i.removeStoredMark(u),i.insertText(" ",s.pos),t.view.dispatch(i),!0}return!1}};function Jy(n){return typeof n=="number"}const Gy=(n,t,e)=>{if(Va(t))return[...n.matchAll(t)];const i=t(n,e);return i?i.map(s=>{const o=[s.text];return o.index=s.index,o.input=n,o.data=s.data,s.replaceWith&&(s.text.includes(s.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),o.push(s.replaceWith)),o}):[]};function Yy(n){const{editor:t,state:e,from:i,to:s,rule:o,pasteEvent:a,dropEvent:c}=n,{commands:u,chain:h,can:f}=new ws({editor:t,state:e}),m=[];return e.doc.nodesBetween(i,s,(y,v)=>{if(!y.isTextblock||y.type.spec.code)return;const x=Math.max(i,v),k=Math.min(s,v+y.content.size),C=y.textBetween(x-v,k-v,void 0,"");Gy(C,o.find,a).forEach(N=>{if(N.index===void 0)return;const V=x+N.index+1,F=V+N[0].length,et={from:e.tr.mapping.map(V),to:e.tr.mapping.map(F)},ot=o.handler({state:e,range:et,match:N,commands:u,chain:h,can:f,pasteEvent:a,dropEvent:c});m.push(ot)})}),m.every(y=>y!==null)}let Er=null;const Xy=n=>{var t;const e=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(t=e.clipboardData)===null||t===void 0||t.setData("text/html",n),e};function Qy(n){const{editor:t,rules:e}=n;let i=null,s=!1,o=!1,a=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,c;try{c=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{c=null}const u=({state:f,from:m,to:_,rule:y,pasteEvt:v})=>{const x=f.tr,k=xs({state:f,transaction:x});if(!(!Yy({editor:t,state:k,from:Math.max(m-1,0),to:_.b-1,rule:y,pasteEvent:v,dropEvent:c})||!x.steps.length)){try{c=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{c=null}return a=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,x}};return e.map(f=>new yt({view(m){const _=v=>{var x;i=!((x=m.dom.parentElement)===null||x===void 0)&&x.contains(v.target)?m.dom.parentElement:null,i&&(Er=t)},y=()=>{Er&&(Er=null)};return window.addEventListener("dragstart",_),window.addEventListener("dragend",y),{destroy(){window.removeEventListener("dragstart",_),window.removeEventListener("dragend",y)}}},props:{handleDOMEvents:{drop:(m,_)=>{if(o=i===m.dom.parentElement,c=_,!o){const y=Er;y?.isEditable&&setTimeout(()=>{const v=y.state.selection;v&&y.commands.deleteRange({from:v.from,to:v.to})},10)}return!1},paste:(m,_)=>{var y;const v=(y=_.clipboardData)===null||y===void 0?void 0:y.getData("text/html");return a=_,s=!!v?.includes("data-pm-slice"),!1}}},appendTransaction:(m,_,y)=>{const v=m[0],x=v.getMeta("uiEvent")==="paste"&&!s,k=v.getMeta("uiEvent")==="drop"&&!o,C=v.getMeta("applyPasteRules"),O=!!C;if(!x&&!k&&!O)return;if(O){let{text:F}=C;typeof F=="string"?F=F:F=Fa(A.from(F),y.schema);const{from:et}=C,ot=et+F.length,R=Xy(F);return u({rule:f,state:y,from:et,to:{b:ot},pasteEvt:R})}const N=_.doc.content.findDiffStart(y.doc.content),V=_.doc.content.findDiffEnd(y.doc.content);if(!(!Jy(N)||!V||N===V.b))return u({rule:f,state:y,from:N,to:V,pasteEvt:a})}}))}function tv(n){const t=n.filter((e,i)=>n.indexOf(e)!==i);return Array.from(new Set(t))}class ei{constructor(t,e){this.splittableMarks=[],this.editor=e,this.extensions=ei.resolve(t),this.schema=Hy(this.extensions,e),this.setupExtensions()}static resolve(t){const e=ei.sort(ei.flatten(t)),i=tv(e.map(s=>s.name));return i.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${i.map(s=>`'${s}'`).join(", ")}]. This can lead to issues.`),e}static flatten(t){return t.map(e=>{const i={name:e.name,options:e.options,storage:e.storage},s=H(e,"addExtensions",i);return s?[e,...this.flatten(s())]:e}).flat(10)}static sort(t){return t.sort((i,s)=>{const o=H(i,"priority")||100,a=H(s,"priority")||100;return o>a?-1:o<a?1:0})}get commands(){return this.extensions.reduce((t,e)=>{const i={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:To(e.name,this.schema)},s=H(e,"addCommands",i);return s?{...t,...s()}:t},{})}get plugins(){const{editor:t}=this,e=ei.sort([...this.extensions].reverse()),i=[],s=[],o=e.map(a=>{const c={name:a.name,options:a.options,storage:a.storage,editor:t,type:To(a.name,this.schema)},u=[],h=H(a,"addKeyboardShortcuts",c);let f={};if(a.type==="mark"&&H(a,"exitable",c)&&(f.ArrowRight=()=>Ky.handleExit({editor:t,mark:a})),h){const x=Object.fromEntries(Object.entries(h()).map(([k,C])=>[k,()=>C({editor:t})]));f={...f,...x}}const m=Ly(f);u.push(m);const _=H(a,"addInputRules",c);hu(a,t.options.enableInputRules)&&_&&i.push(..._());const y=H(a,"addPasteRules",c);hu(a,t.options.enablePasteRules)&&y&&s.push(...y());const v=H(a,"addProseMirrorPlugins",c);if(v){const x=v();u.push(...x)}return u}).flat();return[qy({editor:t,rules:i}),...Qy({editor:t,rules:s}),...o]}get attributes(){return Ch(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:e}=ks(this.extensions);return Object.fromEntries(e.filter(i=>!!H(i,"addNodeView")).map(i=>{const s=this.attributes.filter(u=>u.type===i.name),o={name:i.name,options:i.options,storage:i.storage,editor:t,type:Ft(i.name,this.schema)},a=H(i,"addNodeView",o);if(!a)return[];const c=(u,h,f,m,_)=>{const y=Jo(u,s);return a()({node:u,view:h,getPos:f,decorations:m,innerDecorations:_,editor:t,extension:i,HTMLAttributes:y})};return[i.name,c]}))}setupExtensions(){this.extensions.forEach(t=>{var e;this.editor.extensionStorage[t.name]=t.storage;const i={name:t.name,options:t.options,storage:t.storage,editor:this.editor,type:To(t.name,this.schema)};t.type==="mark"&&(!((e=ht(H(t,"keepOnSplit",i)))!==null&&e!==void 0)||e)&&this.splittableMarks.push(t.name);const s=H(t,"onBeforeCreate",i),o=H(t,"onCreate",i),a=H(t,"onUpdate",i),c=H(t,"onSelectionUpdate",i),u=H(t,"onTransaction",i),h=H(t,"onFocus",i),f=H(t,"onBlur",i),m=H(t,"onDestroy",i);s&&this.editor.on("beforeCreate",s),o&&this.editor.on("create",o),a&&this.editor.on("update",a),c&&this.editor.on("selectionUpdate",c),u&&this.editor.on("transaction",u),h&&this.editor.on("focus",h),f&&this.editor.on("blur",f),m&&this.editor.on("destroy",m)})}}let dn=class Yo{constructor(t={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=ht(H(this,"addOptions",{name:this.name}))),this.storage=ht(H(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new Yo(t)}configure(t={}){const e=this.extend({...this.config,addOptions:()=>Za(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){const e=new Yo({...this.config,...t});return e.parent=this,this.child=e,e.name=t.name?t.name:e.parent.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${e.name}".`),e.options=ht(H(e,"addOptions",{name:e.name})),e.storage=ht(H(e,"addStorage",{name:e.name,options:e.options})),e}};function Ph(n,t,e){const{from:i,to:s}=t,{blockSeparator:o=`

`,textSerializers:a={}}=e||{};let c="";return n.nodesBetween(i,s,(u,h,f,m)=>{var _;u.isBlock&&h>i&&(c+=o);const y=a?.[u.type.name];if(y)return f&&(c+=y({node:u,pos:h,parent:f,index:m,range:t})),!1;u.isText&&(c+=(_=u?.text)===null||_===void 0?void 0:_.slice(Math.max(i,h)-h,s-h))}),c}function Eh(n){return Object.fromEntries(Object.entries(n.nodes).filter(([,t])=>t.spec.toText).map(([t,e])=>[t,e.spec.toText]))}const ev=dn.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new yt({key:new Ct("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:n}=this,{state:t,schema:e}=n,{doc:i,selection:s}=t,{ranges:o}=s,a=Math.min(...o.map(f=>f.$from.pos)),c=Math.max(...o.map(f=>f.$to.pos)),u=Eh(e);return Ph(i,{from:a,to:c},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:u})}}})]}}),nv=()=>({editor:n,view:t})=>(requestAnimationFrame(()=>{var e;n.isDestroyed||(t.dom.blur(),(e=window?.getSelection())===null||e===void 0||e.removeAllRanges())}),!0),iv=(n=!1)=>({commands:t})=>t.setContent("",n),rv=()=>({state:n,tr:t,dispatch:e})=>{const{selection:i}=t,{ranges:s}=i;return e&&s.forEach(({$from:o,$to:a})=>{n.doc.nodesBetween(o.pos,a.pos,(c,u)=>{if(c.type.isText)return;const{doc:h,mapping:f}=t,m=h.resolve(f.map(u)),_=h.resolve(f.map(u+c.nodeSize)),y=m.blockRange(_);if(!y)return;const v=Fn(y);if(c.type.isTextblock){const{defaultType:x}=m.parent.contentMatchAt(m.index());t.setNodeMarkup(y.start,x)}(v||v===0)&&t.lift(y,v)})}),!0},sv=n=>t=>n(t),ov=()=>({state:n,dispatch:t})=>Ra(n,t),av=(n,t)=>({editor:e,tr:i})=>{const{state:s}=e,o=s.doc.slice(n.from,n.to);i.deleteRange(n.from,n.to);const a=i.mapping.map(t);return i.insert(a,o.content),i.setSelection(new U(i.doc.resolve(Math.max(a-1,0)))),!0},lv=()=>({tr:n,dispatch:t})=>{const{selection:e}=n,i=e.$anchor.node();if(i.content.size>0)return!1;const s=n.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i.type){if(t){const c=s.before(o),u=s.after(o);n.delete(c,u).scrollIntoView()}return!0}return!1},cv=n=>({tr:t,state:e,dispatch:i})=>{const s=Ft(n,e.schema),o=t.selection.$anchor;for(let a=o.depth;a>0;a-=1)if(o.node(a).type===s){if(i){const u=o.before(a),h=o.after(a);t.delete(u,h).scrollIntoView()}return!0}return!1},uv=n=>({tr:t,dispatch:e})=>{const{from:i,to:s}=n;return e&&t.delete(i,s),!0},dv=()=>({state:n,dispatch:t})=>bs(n,t),hv=()=>({commands:n})=>n.keyboardShortcut("Enter"),fv=()=>({state:n,dispatch:t})=>gh(n,t);function Qr(n,t,e={strict:!0}){const i=Object.keys(t);return i.length?i.every(s=>e.strict?t[s]===n[s]:Va(t[s])?t[s].test(n[s]):t[s]===n[s]):!0}function Oh(n,t,e={}){return n.find(i=>i.type===t&&Qr(Object.fromEntries(Object.keys(e).map(s=>[s,i.attrs[s]])),e))}function fu(n,t,e={}){return!!Oh(n,t,e)}function Lh(n,t,e){var i;if(!n||!t)return;let s=n.parent.childAfter(n.parentOffset);if((!s.node||!s.node.marks.some(f=>f.type===t))&&(s=n.parent.childBefore(n.parentOffset)),!s.node||!s.node.marks.some(f=>f.type===t)||(e=e||((i=s.node.marks[0])===null||i===void 0?void 0:i.attrs),!Oh([...s.node.marks],t,e)))return;let a=s.index,c=n.start()+s.offset,u=a+1,h=c+s.node.nodeSize;for(;a>0&&fu([...n.parent.child(a-1).marks],t,e);)a-=1,c-=n.parent.child(a).nodeSize;for(;u<n.parent.childCount&&fu([...n.parent.child(u).marks],t,e);)h+=n.parent.child(u).nodeSize,u+=1;return{from:c,to:h}}function hn(n,t){if(typeof n=="string"){if(!t.marks[n])throw Error(`There is no mark type named '${n}'. Maybe you forgot to add the extension?`);return t.marks[n]}return n}const pv=(n,t={})=>({tr:e,state:i,dispatch:s})=>{const o=hn(n,i.schema),{doc:a,selection:c}=e,{$from:u,from:h,to:f}=c;if(s){const m=Lh(u,o,t);if(m&&m.from<=h&&m.to>=f){const _=U.create(a,m.from,m.to);e.setSelection(_)}}return!0},mv=n=>t=>{const e=typeof n=="function"?n(t):n;for(let i=0;i<e.length;i+=1)if(e[i](t))return!0;return!1};function Ah(n){return n instanceof U}function kn(n=0,t=0,e=0){return Math.min(Math.max(n,t),e)}function Ih(n,t=null){if(!t)return null;const e=Q.atStart(n),i=Q.atEnd(n);if(t==="start"||t===!0)return e;if(t==="end")return i;const s=e.from,o=i.to;return t==="all"?U.create(n,kn(0,s,o),kn(n.content.size,s,o)):U.create(n,kn(t,s,o),kn(t,s,o))}function gv(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function Ha(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const _v=(n=null,t={})=>({editor:e,view:i,tr:s,dispatch:o})=>{t={scrollIntoView:!0,...t};const a=()=>{(Ha()||gv())&&i.dom.focus(),requestAnimationFrame(()=>{e.isDestroyed||(i.focus(),t?.scrollIntoView&&e.commands.scrollIntoView())})};if(i.hasFocus()&&n===null||n===!1)return!0;if(o&&n===null&&!Ah(e.state.selection))return a(),!0;const c=Ih(s.doc,n)||e.state.selection,u=e.state.selection.eq(c);return o&&(u||s.setSelection(c),u&&s.storedMarks&&s.setStoredMarks(s.storedMarks),a()),!0},yv=(n,t)=>e=>n.every((i,s)=>t(i,{...e,index:s})),vv=(n,t)=>({tr:e,commands:i})=>i.insertContentAt({from:e.selection.from,to:e.selection.to},n,t),Nh=n=>{const t=n.childNodes;for(let e=t.length-1;e>=0;e-=1){const i=t[e];i.nodeType===3&&i.nodeValue&&/^(\n\s\s|\n)$/.test(i.nodeValue)?n.removeChild(i):i.nodeType===1&&Nh(i)}return n};function Or(n){const t=`<body>${n}</body>`,e=new window.DOMParser().parseFromString(t,"text/html").body;return Nh(e)}function Ki(n,t,e){if(n instanceof ve||n instanceof A)return n;e={slice:!0,parseOptions:{},...e};const i=typeof n=="object"&&n!==null,s=typeof n=="string";if(i)try{if(Array.isArray(n)&&n.length>0)return A.fromArray(n.map(c=>t.nodeFromJSON(c)));const a=t.nodeFromJSON(n);return e.errorOnInvalidContent&&a.check(),a}catch(o){if(e.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:o});return console.warn("[tiptap warn]: Invalid content.","Passed value:",n,"Error:",o),Ki("",t,e)}if(s){if(e.errorOnInvalidContent){let a=!1,c="";const u=new ma({topNode:t.spec.topNode,marks:t.spec.marks,nodes:t.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:h=>(a=!0,c=typeof h=="string"?h:h.outerHTML,null)}]}})});if(e.slice?Ce.fromSchema(u).parseSlice(Or(n),e.parseOptions):Ce.fromSchema(u).parse(Or(n),e.parseOptions),e.errorOnInvalidContent&&a)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${c}`)})}const o=Ce.fromSchema(t);return e.slice?o.parseSlice(Or(n),e.parseOptions).content:o.parse(Or(n),e.parseOptions)}return Ki("",t,e)}function bv(n,t,e){const i=n.steps.length-1;if(i<t)return;const s=n.steps[i];if(!(s instanceof Nt||s instanceof Dt))return;const o=n.mapping.maps[i];let a=0;o.forEach((c,u,h,f)=>{a===0&&(a=f)}),n.setSelection(Q.near(n.doc.resolve(a),e))}const xv=n=>!("type"in n),wv=(n,t,e)=>({tr:i,dispatch:s,editor:o})=>{var a;if(s){e={parseOptions:o.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...e};let c;const u=k=>{o.emit("contentError",{editor:o,error:k,disableCollaboration:()=>{o.storage.collaboration&&(o.storage.collaboration.isDisabled=!0)}})},h={preserveWhitespace:"full",...e.parseOptions};if(!e.errorOnInvalidContent&&!o.options.enableContentCheck&&o.options.emitContentError)try{Ki(t,o.schema,{parseOptions:h,errorOnInvalidContent:!0})}catch(k){u(k)}try{c=Ki(t,o.schema,{parseOptions:h,errorOnInvalidContent:(a=e.errorOnInvalidContent)!==null&&a!==void 0?a:o.options.enableContentCheck})}catch(k){return u(k),!1}let{from:f,to:m}=typeof n=="number"?{from:n,to:n}:{from:n.from,to:n.to},_=!0,y=!0;if((xv(c)?c:[c]).forEach(k=>{k.check(),_=_?k.isText&&k.marks.length===0:!1,y=y?k.isBlock:!1}),f===m&&y){const{parent:k}=i.doc.resolve(f);k.isTextblock&&!k.type.spec.code&&!k.childCount&&(f-=1,m+=1)}let x;if(_){if(Array.isArray(t))x=t.map(k=>k.text||"").join("");else if(t instanceof A){let k="";t.forEach(C=>{C.text&&(k+=C.text)}),x=k}else typeof t=="object"&&t&&t.text?x=t.text:x=t;i.insertText(x,f,m)}else x=c,i.replaceWith(f,m,x);e.updateSelection&&bv(i,i.steps.length-1,-1),e.applyInputRules&&i.setMeta("applyInputRules",{from:f,text:x}),e.applyPasteRules&&i.setMeta("applyPasteRules",{from:f,text:x})}return!0},kv=()=>({state:n,dispatch:t})=>fh(n,t),Sv=()=>({state:n,dispatch:t})=>ph(n,t),Mv=()=>({state:n,dispatch:t})=>Ea(n,t),Cv=()=>({state:n,dispatch:t})=>Aa(n,t),Tv=()=>({state:n,dispatch:t,tr:e})=>{try{const i=pi(n.doc,n.selection.$from.pos,-1);return i==null?!1:(e.join(i,2),t&&t(e),!0)}catch{return!1}},Pv=()=>({state:n,dispatch:t,tr:e})=>{try{const i=pi(n.doc,n.selection.$from.pos,1);return i==null?!1:(e.join(i,2),t&&t(e),!0)}catch{return!1}},Ev=()=>({state:n,dispatch:t})=>ch(n,t),Ov=()=>({state:n,dispatch:t})=>uh(n,t);function Dh(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function Lv(n){const t=n.split(/-(?!$)/);let e=t[t.length-1];e==="Space"&&(e=" ");let i,s,o,a;for(let c=0;c<t.length-1;c+=1){const u=t[c];if(/^(cmd|meta|m)$/i.test(u))a=!0;else if(/^a(lt)?$/i.test(u))i=!0;else if(/^(c|ctrl|control)$/i.test(u))s=!0;else if(/^s(hift)?$/i.test(u))o=!0;else if(/^mod$/i.test(u))Ha()||Dh()?a=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${u}`)}return i&&(e=`Alt-${e}`),s&&(e=`Ctrl-${e}`),a&&(e=`Meta-${e}`),o&&(e=`Shift-${e}`),e}const Av=n=>({editor:t,view:e,tr:i,dispatch:s})=>{const o=Lv(n).split(/-(?!$)/),a=o.find(h=>!["Alt","Ctrl","Meta","Shift"].includes(h)),c=new KeyboardEvent("keydown",{key:a==="Space"?" ":a,altKey:o.includes("Alt"),ctrlKey:o.includes("Ctrl"),metaKey:o.includes("Meta"),shiftKey:o.includes("Shift"),bubbles:!0,cancelable:!0}),u=t.captureTransaction(()=>{e.someProp("handleKeyDown",h=>h(e,c))});return u?.steps.forEach(h=>{const f=h.map(i.mapping);f&&s&&i.maybeStep(f)}),!0};function Ji(n,t,e={}){const{from:i,to:s,empty:o}=n.selection,a=t?Ft(t,n.schema):null,c=[];n.doc.nodesBetween(i,s,(m,_)=>{if(m.isText)return;const y=Math.max(i,_),v=Math.min(s,_+m.nodeSize);c.push({node:m,from:y,to:v})});const u=s-i,h=c.filter(m=>a?a.name===m.node.type.name:!0).filter(m=>Qr(m.node.attrs,e,{strict:!1}));return o?!!h.length:h.reduce((m,_)=>m+_.to-_.from,0)>=u}const Iv=(n,t={})=>({state:e,dispatch:i})=>{const s=Ft(n,e.schema);return Ji(e,s,t)?mh(e,i):!1},Nv=()=>({state:n,dispatch:t})=>Ba(n,t),Dv=n=>({state:t,dispatch:e})=>{const i=Ft(n,t.schema);return Sh(i)(t,e)},zv=()=>({state:n,dispatch:t})=>Da(n,t);function Ss(n,t){return t.nodes[n]?"node":t.marks[n]?"mark":null}function pu(n,t){const e=typeof t=="string"?[t]:t;return Object.keys(n).reduce((i,s)=>(e.includes(s)||(i[s]=n[s]),i),{})}const Rv=(n,t)=>({tr:e,state:i,dispatch:s})=>{let o=null,a=null;const c=Ss(typeof n=="string"?n:n.name,i.schema);return c?(c==="node"&&(o=Ft(n,i.schema)),c==="mark"&&(a=hn(n,i.schema)),s&&e.selection.ranges.forEach(u=>{i.doc.nodesBetween(u.$from.pos,u.$to.pos,(h,f)=>{o&&o===h.type&&e.setNodeMarkup(f,void 0,pu(h.attrs,t)),a&&h.marks.length&&h.marks.forEach(m=>{a===m.type&&e.addMark(f,f+h.nodeSize,a.create(pu(m.attrs,t)))})})}),!0):!1},Bv=()=>({tr:n,dispatch:t})=>(t&&n.scrollIntoView(),!0),$v=()=>({tr:n,dispatch:t})=>{if(t){const e=new oe(n.doc);n.setSelection(e)}return!0},Fv=()=>({state:n,dispatch:t})=>Oa(n,t),Vv=()=>({state:n,dispatch:t})=>Ia(n,t),Zv=()=>({state:n,dispatch:t})=>_h(n,t),Hv=()=>({state:n,dispatch:t})=>xh(n,t),Wv=()=>({state:n,dispatch:t})=>bh(n,t);function Xo(n,t,e={},i={}){return Ki(n,t,{slice:!1,parseOptions:e,errorOnInvalidContent:i.errorOnInvalidContent})}const jv=(n,t=!1,e={},i={})=>({editor:s,tr:o,dispatch:a,commands:c})=>{var u,h;const{doc:f}=o;if(e.preserveWhitespace!=="full"){const m=Xo(n,s.schema,e,{errorOnInvalidContent:(u=i.errorOnInvalidContent)!==null&&u!==void 0?u:s.options.enableContentCheck});return a&&o.replaceWith(0,f.content.size,m).setMeta("preventUpdate",!t),!0}return a&&o.setMeta("preventUpdate",!t),c.insertContentAt({from:0,to:f.content.size},n,{parseOptions:e,errorOnInvalidContent:(h=i.errorOnInvalidContent)!==null&&h!==void 0?h:s.options.enableContentCheck})};function zh(n,t){const e=hn(t,n.schema),{from:i,to:s,empty:o}=n.selection,a=[];o?(n.storedMarks&&a.push(...n.storedMarks),a.push(...n.selection.$head.marks())):n.doc.nodesBetween(i,s,u=>{a.push(...u.marks)});const c=a.find(u=>u.type.name===e.name);return c?{...c.attrs}:{}}function qv(n){for(let t=0;t<n.edgeCount;t+=1){const{type:e}=n.edge(t);if(e.isTextblock&&!e.hasRequiredAttrs())return e}return null}function Uv(n,t){for(let e=n.depth;e>0;e-=1){const i=n.node(e);if(t(i))return{pos:e>0?n.before(e):0,start:n.start(e),depth:e,node:i}}}function Wa(n){return t=>Uv(t.$from,n)}function Kv(n,t){const e={from:0,to:n.content.size};return Ph(n,e,t)}function Jv(n,t){const e=Ft(t,n.schema),{from:i,to:s}=n.selection,o=[];n.doc.nodesBetween(i,s,c=>{o.push(c)});const a=o.reverse().find(c=>c.type.name===e.name);return a?{...a.attrs}:{}}function Gv(n,t){const e=Ss(typeof t=="string"?t:t.name,n.schema);return e==="node"?Jv(n,t):e==="mark"?zh(n,t):{}}function zr(n,t,e){return Object.fromEntries(Object.entries(e).filter(([i])=>{const s=n.find(o=>o.type===t&&o.name===i);return s?s.attribute.keepOnSplit:!1}))}function Qo(n,t,e={}){const{empty:i,ranges:s}=n.selection,o=t?hn(t,n.schema):null;if(i)return!!(n.storedMarks||n.selection.$from.marks()).filter(m=>o?o.name===m.type.name:!0).find(m=>Qr(m.attrs,e,{strict:!1}));let a=0;const c=[];if(s.forEach(({$from:m,$to:_})=>{const y=m.pos,v=_.pos;n.doc.nodesBetween(y,v,(x,k)=>{if(!x.isText&&!x.marks.length)return;const C=Math.max(y,k),O=Math.min(v,k+x.nodeSize),N=O-C;a+=N,c.push(...x.marks.map(V=>({mark:V,from:C,to:O})))})}),a===0)return!1;const u=c.filter(m=>o?o.name===m.mark.type.name:!0).filter(m=>Qr(m.mark.attrs,e,{strict:!1})).reduce((m,_)=>m+_.to-_.from,0),h=c.filter(m=>o?m.mark.type!==o&&m.mark.type.excludes(o):!0).reduce((m,_)=>m+_.to-_.from,0);return(u>0?u+h:u)>=a}function Yv(n,t,e={}){if(!t)return Ji(n,null,e)||Qo(n,null,e);const i=Ss(t,n.schema);return i==="node"?Ji(n,t,e):i==="mark"?Qo(n,t,e):!1}function mu(n,t){const{nodeExtensions:e}=ks(t),i=e.find(a=>a.name===n);if(!i)return!1;const s={name:i.name,options:i.options,storage:i.storage},o=ht(H(i,"group",s));return typeof o!="string"?!1:o.split(" ").includes("list")}function ja(n,{checkChildren:t=!0,ignoreWhitespace:e=!1}={}){var i;if(e){if(n.type.name==="hardBreak")return!0;if(n.isText)return/^\s*$/m.test((i=n.text)!==null&&i!==void 0?i:"")}if(n.isText)return!n.text;if(n.isAtom||n.isLeaf)return!1;if(n.content.childCount===0)return!0;if(t){let s=!0;return n.content.forEach(o=>{s!==!1&&(ja(o,{ignoreWhitespace:e,checkChildren:t})||(s=!1))}),s}return!1}function Xv(n,t,e){var i;const{selection:s}=t;let o=null;if(Ah(s)&&(o=s.$cursor),o){const c=(i=n.storedMarks)!==null&&i!==void 0?i:o.marks();return!!e.isInSet(c)||!c.some(u=>u.type.excludes(e))}const{ranges:a}=s;return a.some(({$from:c,$to:u})=>{let h=c.depth===0?n.doc.inlineContent&&n.doc.type.allowsMarkType(e):!1;return n.doc.nodesBetween(c.pos,u.pos,(f,m,_)=>{if(h)return!1;if(f.isInline){const y=!_||_.type.allowsMarkType(e),v=!!e.isInSet(f.marks)||!f.marks.some(x=>x.type.excludes(e));h=y&&v}return!h}),h})}const Qv=(n,t={})=>({tr:e,state:i,dispatch:s})=>{const{selection:o}=e,{empty:a,ranges:c}=o,u=hn(n,i.schema);if(s)if(a){const h=zh(i,u);e.addStoredMark(u.create({...h,...t}))}else c.forEach(h=>{const f=h.$from.pos,m=h.$to.pos;i.doc.nodesBetween(f,m,(_,y)=>{const v=Math.max(y,f),x=Math.min(y+_.nodeSize,m);_.marks.find(C=>C.type===u)?_.marks.forEach(C=>{u===C.type&&e.addMark(v,x,u.create({...C.attrs,...t}))}):e.addMark(v,x,u.create(t))})});return Xv(i,e,u)},tb=(n,t)=>({tr:e})=>(e.setMeta(n,t),!0),eb=(n,t={})=>({state:e,dispatch:i,chain:s})=>{const o=Ft(n,e.schema);let a;return e.selection.$anchor.sameParent(e.selection.$head)&&(a=e.selection.$anchor.parent.attrs),o.isTextblock?s().command(({commands:c})=>Xr(o,{...a,...t})(e)?!0:c.clearNodes()).command(({state:c})=>Xr(o,{...a,...t})(c,i)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},nb=n=>({tr:t,dispatch:e})=>{if(e){const{doc:i}=t,s=kn(n,0,i.content.size),o=j.create(i,s);t.setSelection(o)}return!0},ib=n=>({tr:t,dispatch:e})=>{if(e){const{doc:i}=t,{from:s,to:o}=typeof n=="number"?{from:n,to:n}:n,a=U.atStart(i).from,c=U.atEnd(i).to,u=kn(s,a,c),h=kn(o,a,c),f=U.create(i,u,h);t.setSelection(f)}return!0},rb=n=>({state:t,dispatch:e})=>{const i=Ft(n,t.schema);return Mh(i)(t,e)};function gu(n,t){const e=n.storedMarks||n.selection.$to.parentOffset&&n.selection.$from.marks();if(e){const i=e.filter(s=>t?.includes(s.type.name));n.tr.ensureMarks(i)}}const sb=({keepMarks:n=!0}={})=>({tr:t,state:e,dispatch:i,editor:s})=>{const{selection:o,doc:a}=t,{$from:c,$to:u}=o,h=s.extensionManager.attributes,f=zr(h,c.node().type.name,c.node().attrs);if(o instanceof j&&o.node.isBlock)return!c.parentOffset||!fe(a,c.pos)?!1:(i&&(n&&gu(e,s.extensionManager.splittableMarks),t.split(c.pos).scrollIntoView()),!0);if(!c.parent.isBlock)return!1;const m=u.parentOffset===u.parent.content.size,_=c.depth===0?void 0:qv(c.node(-1).contentMatchAt(c.indexAfter(-1)));let y=m&&_?[{type:_,attrs:f}]:void 0,v=fe(t.doc,t.mapping.map(c.pos),1,y);if(!y&&!v&&fe(t.doc,t.mapping.map(c.pos),1,_?[{type:_}]:void 0)&&(v=!0,y=_?[{type:_,attrs:f}]:void 0),i){if(v&&(o instanceof U&&t.deleteSelection(),t.split(t.mapping.map(c.pos),1,y),_&&!m&&!c.parentOffset&&c.parent.type!==_)){const x=t.mapping.map(c.before()),k=t.doc.resolve(x);c.node(-1).canReplaceWith(k.index(),k.index()+1,_)&&t.setNodeMarkup(t.mapping.map(c.before()),_)}n&&gu(e,s.extensionManager.splittableMarks),t.scrollIntoView()}return v},ob=(n,t={})=>({tr:e,state:i,dispatch:s,editor:o})=>{var a;const c=Ft(n,i.schema),{$from:u,$to:h}=i.selection,f=i.selection.node;if(f&&f.isBlock||u.depth<2||!u.sameParent(h))return!1;const m=u.node(-1);if(m.type!==c)return!1;const _=o.extensionManager.attributes;if(u.parent.content.size===0&&u.node(-1).childCount===u.indexAfter(-1)){if(u.depth===2||u.node(-3).type!==c||u.index(-2)!==u.node(-2).childCount-1)return!1;if(s){let C=A.empty;const O=u.index(-1)?1:u.index(-2)?2:3;for(let R=u.depth-O;R>=u.depth-3;R-=1)C=A.from(u.node(R).copy(C));const N=u.indexAfter(-1)<u.node(-2).childCount?1:u.indexAfter(-2)<u.node(-3).childCount?2:3,V={...zr(_,u.node().type.name,u.node().attrs),...t},F=((a=c.contentMatch.defaultType)===null||a===void 0?void 0:a.createAndFill(V))||void 0;C=C.append(A.from(c.createAndFill(null,F)||void 0));const et=u.before(u.depth-(O-1));e.replace(et,u.after(-N),new B(C,4-O,0));let ot=-1;e.doc.nodesBetween(et,e.doc.content.size,(R,ut)=>{if(ot>-1)return!1;R.isTextblock&&R.content.size===0&&(ot=ut+1)}),ot>-1&&e.setSelection(U.near(e.doc.resolve(ot))),e.scrollIntoView()}return!0}const y=h.pos===u.end()?m.contentMatchAt(0).defaultType:null,v={...zr(_,m.type.name,m.attrs),...t},x={...zr(_,u.node().type.name,u.node().attrs),...t};e.delete(u.pos,h.pos);const k=y?[{type:c,attrs:v},{type:y,attrs:x}]:[{type:c,attrs:v}];if(!fe(e.doc,u.pos,2))return!1;if(s){const{selection:C,storedMarks:O}=i,{splittableMarks:N}=o.extensionManager,V=O||C.$to.parentOffset&&C.$from.marks();if(e.split(u.pos,2,k).scrollIntoView(),!V||!s)return!0;const F=V.filter(et=>N.includes(et.type.name));e.ensureMarks(F)}return!0},Po=(n,t)=>{const e=Wa(a=>a.type===t)(n.selection);if(!e)return!0;const i=n.doc.resolve(Math.max(0,e.pos-1)).before(e.depth);if(i===void 0)return!0;const s=n.doc.nodeAt(i);return e.node.type===s?.type&&ze(n.doc,e.pos)&&n.join(e.pos),!0},Eo=(n,t)=>{const e=Wa(a=>a.type===t)(n.selection);if(!e)return!0;const i=n.doc.resolve(e.start).after(e.depth);if(i===void 0)return!0;const s=n.doc.nodeAt(i);return e.node.type===s?.type&&ze(n.doc,i)&&n.join(i),!0},ab=(n,t,e,i={})=>({editor:s,tr:o,state:a,dispatch:c,chain:u,commands:h,can:f})=>{const{extensions:m,splittableMarks:_}=s.extensionManager,y=Ft(n,a.schema),v=Ft(t,a.schema),{selection:x,storedMarks:k}=a,{$from:C,$to:O}=x,N=C.blockRange(O),V=k||x.$to.parentOffset&&x.$from.marks();if(!N)return!1;const F=Wa(et=>mu(et.type.name,m))(x);if(N.depth>=1&&F&&N.depth-F.depth<=1){if(F.node.type===y)return h.liftListItem(v);if(mu(F.node.type.name,m)&&y.validContent(F.node.content)&&c)return u().command(()=>(o.setNodeMarkup(F.pos,y),!0)).command(()=>Po(o,y)).command(()=>Eo(o,y)).run()}return!e||!V||!c?u().command(()=>f().wrapInList(y,i)?!0:h.clearNodes()).wrapInList(y,i).command(()=>Po(o,y)).command(()=>Eo(o,y)).run():u().command(()=>{const et=f().wrapInList(y,i),ot=V.filter(R=>_.includes(R.type.name));return o.ensureMarks(ot),et?!0:h.clearNodes()}).wrapInList(y,i).command(()=>Po(o,y)).command(()=>Eo(o,y)).run()},lb=(n,t={},e={})=>({state:i,commands:s})=>{const{extendEmptyMarkRange:o=!1}=e,a=hn(n,i.schema);return Qo(i,a,t)?s.unsetMark(a,{extendEmptyMarkRange:o}):s.setMark(a,t)},cb=(n,t,e={})=>({state:i,commands:s})=>{const o=Ft(n,i.schema),a=Ft(t,i.schema),c=Ji(i,o,e);let u;return i.selection.$anchor.sameParent(i.selection.$head)&&(u=i.selection.$anchor.parent.attrs),c?s.setNode(a,u):s.setNode(o,{...u,...e})},ub=(n,t={})=>({state:e,commands:i})=>{const s=Ft(n,e.schema);return Ji(e,s,t)?i.lift(s):i.wrapIn(s,t)},db=()=>({state:n,dispatch:t})=>{const e=n.plugins;for(let i=0;i<e.length;i+=1){const s=e[i];let o;if(s.spec.isInputRules&&(o=s.getState(n))){if(t){const a=n.tr,c=o.transform;for(let u=c.steps.length-1;u>=0;u-=1)a.step(c.steps[u].invert(c.docs[u]));if(o.text){const u=a.doc.resolve(o.from).marks();a.replaceWith(o.from,o.to,n.schema.text(o.text,u))}else a.delete(o.from,o.to)}return!0}}return!1},hb=()=>({tr:n,dispatch:t})=>{const{selection:e}=n,{empty:i,ranges:s}=e;return i||t&&s.forEach(o=>{n.removeMark(o.$from.pos,o.$to.pos)}),!0},fb=(n,t={})=>({tr:e,state:i,dispatch:s})=>{var o;const{extendEmptyMarkRange:a=!1}=t,{selection:c}=e,u=hn(n,i.schema),{$from:h,empty:f,ranges:m}=c;if(!s)return!0;if(f&&a){let{from:_,to:y}=c;const v=(o=h.marks().find(k=>k.type===u))===null||o===void 0?void 0:o.attrs,x=Lh(h,u,v);x&&(_=x.from,y=x.to),e.removeMark(_,y,u)}else m.forEach(_=>{e.removeMark(_.$from.pos,_.$to.pos,u)});return e.removeStoredMark(u),!0},pb=(n,t={})=>({tr:e,state:i,dispatch:s})=>{let o=null,a=null;const c=Ss(typeof n=="string"?n:n.name,i.schema);return c?(c==="node"&&(o=Ft(n,i.schema)),c==="mark"&&(a=hn(n,i.schema)),s&&e.selection.ranges.forEach(u=>{const h=u.$from.pos,f=u.$to.pos;let m,_,y,v;e.selection.empty?i.doc.nodesBetween(h,f,(x,k)=>{o&&o===x.type&&(y=Math.max(k,h),v=Math.min(k+x.nodeSize,f),m=k,_=x)}):i.doc.nodesBetween(h,f,(x,k)=>{k<h&&o&&o===x.type&&(y=Math.max(k,h),v=Math.min(k+x.nodeSize,f),m=k,_=x),k>=h&&k<=f&&(o&&o===x.type&&e.setNodeMarkup(k,void 0,{...x.attrs,...t}),a&&x.marks.length&&x.marks.forEach(C=>{if(a===C.type){const O=Math.max(k,h),N=Math.min(k+x.nodeSize,f);e.addMark(O,N,a.create({...C.attrs,...t}))}}))}),_&&(m!==void 0&&e.setNodeMarkup(m,void 0,{..._.attrs,...t}),a&&_.marks.length&&_.marks.forEach(x=>{a===x.type&&e.addMark(y,v,a.create({...x.attrs,...t}))}))}),!0):!1},mb=(n,t={})=>({state:e,dispatch:i})=>{const s=Ft(n,e.schema);return wh(s,t)(e,i)},gb=(n,t={})=>({state:e,dispatch:i})=>{const s=Ft(n,e.schema);return kh(s,t)(e,i)};var _b=Object.freeze({__proto__:null,blur:nv,clearContent:iv,clearNodes:rv,command:sv,createParagraphNear:ov,cut:av,deleteCurrentNode:lv,deleteNode:cv,deleteRange:uv,deleteSelection:dv,enter:hv,exitCode:fv,extendMarkRange:pv,first:mv,focus:_v,forEach:yv,insertContent:vv,insertContentAt:wv,joinBackward:Mv,joinDown:Sv,joinForward:Cv,joinItemBackward:Tv,joinItemForward:Pv,joinTextblockBackward:Ev,joinTextblockForward:Ov,joinUp:kv,keyboardShortcut:Av,lift:Iv,liftEmptyBlock:Nv,liftListItem:Dv,newlineInCode:zv,resetAttributes:Rv,scrollIntoView:Bv,selectAll:$v,selectNodeBackward:Fv,selectNodeForward:Vv,selectParentNode:Zv,selectTextblockEnd:Hv,selectTextblockStart:Wv,setContent:jv,setMark:Qv,setMeta:tb,setNode:eb,setNodeSelection:nb,setTextSelection:ib,sinkListItem:rb,splitBlock:sb,splitListItem:ob,toggleList:ab,toggleMark:lb,toggleNode:cb,toggleWrap:ub,undoInputRule:db,unsetAllMarks:hb,unsetMark:fb,updateAttributes:pb,wrapIn:mb,wrapInList:gb});const yb=dn.create({name:"commands",addCommands(){return{..._b}}}),vb=dn.create({name:"drop",addProseMirrorPlugins(){return[new yt({key:new Ct("tiptapDrop"),props:{handleDrop:(n,t,e,i)=>{this.editor.emit("drop",{editor:this.editor,event:t,slice:e,moved:i})}}})]}}),bb=dn.create({name:"editable",addProseMirrorPlugins(){return[new yt({key:new Ct("editable"),props:{editable:()=>this.editor.options.editable}})]}}),xb=new Ct("focusEvents"),wb=dn.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:n}=this;return[new yt({key:xb,props:{handleDOMEvents:{focus:(t,e)=>{n.isFocused=!0;const i=n.state.tr.setMeta("focus",{event:e}).setMeta("addToHistory",!1);return t.dispatch(i),!1},blur:(t,e)=>{n.isFocused=!1;const i=n.state.tr.setMeta("blur",{event:e}).setMeta("addToHistory",!1);return t.dispatch(i),!1}}}})]}}),kb=dn.create({name:"keymap",addKeyboardShortcuts(){const n=()=>this.editor.commands.first(({commands:a})=>[()=>a.undoInputRule(),()=>a.command(({tr:c})=>{const{selection:u,doc:h}=c,{empty:f,$anchor:m}=u,{pos:_,parent:y}=m,v=m.parent.isTextblock&&_>0?c.doc.resolve(_-1):m,x=v.parent.type.spec.isolating,k=m.pos-m.parentOffset,C=x&&v.parent.childCount===1?k===m.pos:Q.atStart(h).from===_;return!f||!y.type.isTextblock||y.textContent.length||!C||C&&m.parent.type.name==="paragraph"?!1:a.clearNodes()}),()=>a.deleteSelection(),()=>a.joinBackward(),()=>a.selectNodeBackward()]),t=()=>this.editor.commands.first(({commands:a})=>[()=>a.deleteSelection(),()=>a.deleteCurrentNode(),()=>a.joinForward(),()=>a.selectNodeForward()]),i={Enter:()=>this.editor.commands.first(({commands:a})=>[()=>a.newlineInCode(),()=>a.createParagraphNear(),()=>a.liftEmptyBlock(),()=>a.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:n,"Mod-Backspace":n,"Shift-Backspace":n,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},s={...i},o={...i,"Ctrl-h":n,"Alt-Backspace":n,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Ha()||Dh()?o:s},addProseMirrorPlugins(){return[new yt({key:new Ct("clearDocument"),appendTransaction:(n,t,e)=>{if(n.some(x=>x.getMeta("composition")))return;const i=n.some(x=>x.docChanged)&&!t.doc.eq(e.doc),s=n.some(x=>x.getMeta("preventClearDocument"));if(!i||s)return;const{empty:o,from:a,to:c}=t.selection,u=Q.atStart(t.doc).from,h=Q.atEnd(t.doc).to;if(o||!(a===u&&c===h)||!ja(e.doc))return;const _=e.tr,y=xs({state:e,transaction:_}),{commands:v}=new ws({editor:this.editor,state:y});if(v.clearNodes(),!!_.steps.length)return _}})]}}),Sb=dn.create({name:"paste",addProseMirrorPlugins(){return[new yt({key:new Ct("tiptapPaste"),props:{handlePaste:(n,t,e)=>{this.editor.emit("paste",{editor:this.editor,event:t,slice:e})}}})]}}),Mb=dn.create({name:"tabindex",addProseMirrorPlugins(){return[new yt({key:new Ct("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class bn{get name(){return this.node.type.name}constructor(t,e,i=!1,s=null){this.currentNode=null,this.actualDepth=null,this.isBlock=i,this.resolvedPos=t,this.editor=e,this.currentNode=s}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var t;return(t=this.actualDepth)!==null&&t!==void 0?t:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(t){let e=this.from,i=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}e=this.from+1,i=this.to-1}this.editor.commands.insertContentAt({from:e,to:i},t)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const t=this.resolvedPos.start(this.resolvedPos.depth-1),e=this.resolvedPos.doc.resolve(t);return new bn(e,this.editor)}get before(){let t=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return t.depth!==this.depth&&(t=this.resolvedPos.doc.resolve(this.from-3)),new bn(t,this.editor)}get after(){let t=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return t.depth!==this.depth&&(t=this.resolvedPos.doc.resolve(this.to+3)),new bn(t,this.editor)}get children(){const t=[];return this.node.content.forEach((e,i)=>{const s=e.isBlock&&!e.isTextblock,o=e.isAtom&&!e.isText,a=this.pos+i+(o?0:1);if(a<0||a>this.resolvedPos.doc.nodeSize-2)return;const c=this.resolvedPos.doc.resolve(a);if(!s&&c.depth<=this.depth)return;const u=new bn(c,this.editor,s,s?e:null);s&&(u.actualDepth=this.depth+1),t.push(new bn(c,this.editor,s,s?e:null))}),t}get firstChild(){return this.children[0]||null}get lastChild(){const t=this.children;return t[t.length-1]||null}closest(t,e={}){let i=null,s=this.parent;for(;s&&!i;){if(s.node.type.name===t)if(Object.keys(e).length>0){const o=s.node.attrs,a=Object.keys(e);for(let c=0;c<a.length;c+=1){const u=a[c];if(o[u]!==e[u])break}}else i=s;s=s.parent}return i}querySelector(t,e={}){return this.querySelectorAll(t,e,!0)[0]||null}querySelectorAll(t,e={},i=!1){let s=[];if(!this.children||this.children.length===0)return s;const o=Object.keys(e);return this.children.forEach(a=>{i&&s.length>0||(a.node.type.name===t&&o.every(u=>e[u]===a.node.attrs[u])&&s.push(a),!(i&&s.length>0)&&(s=s.concat(a.querySelectorAll(t,e,i))))}),s}setAttribute(t){const{tr:e}=this.editor.state;e.setNodeMarkup(this.from,void 0,{...this.node.attrs,...t}),this.editor.view.dispatch(e)}}const Cb=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function Tb(n,t,e){const i=document.querySelector("style[data-tiptap-style]");if(i!==null)return i;const s=document.createElement("style");return t&&s.setAttribute("nonce",t),s.setAttribute("data-tiptap-style",""),s.innerHTML=n,document.getElementsByTagName("head")[0].appendChild(s),s}let Pb=class extends $y{constructor(t={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:e})=>{throw e},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(t),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:e,slice:i,moved:s})=>this.options.onDrop(e,i,s)),this.on("paste",({event:e,slice:i})=>this.options.onPaste(e,i)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=Tb(Cb,this.options.injectNonce))}setOptions(t={}){this.options={...this.options,...t},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(t,e=!0){this.setOptions({editable:t}),e&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(t,e){const i=Th(e)?e(t,[...this.state.plugins]):[...this.state.plugins,t],s=this.state.reconfigure({plugins:i});return this.view.updateState(s),s}unregisterPlugin(t){if(this.isDestroyed)return;const e=this.state.plugins;let i=e;if([].concat(t).forEach(o=>{const a=typeof o=="string"?`${o}$`:o.key;i=i.filter(c=>!c.key.startsWith(a))}),e.length===i.length)return;const s=this.state.reconfigure({plugins:i});return this.view.updateState(s),s}createExtensionManager(){var t,e;const s=[...this.options.enableCoreExtensions?[bb,ev.configure({blockSeparator:(e=(t=this.options.coreExtensionOptions)===null||t===void 0?void 0:t.clipboardTextSerializer)===null||e===void 0?void 0:e.blockSeparator}),yb,wb,kb,Mb,vb,Sb].filter(o=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[o.name]!==!1:!0):[],...this.options.extensions].filter(o=>["extension","node","mark"].includes(o?.type));this.extensionManager=new ei(s,this)}createCommandManager(){this.commandManager=new ws({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var t;let e;try{e=Xo(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(a){if(!(a instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(a.message))throw a;this.emit("contentError",{editor:this,error:a,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(c=>c.name!=="collaboration"),this.createExtensionManager()}}),e=Xo(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const i=Ih(e,this.options.autofocus);this.view=new oh(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(t=this.options.editorProps)===null||t===void 0?void 0:t.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:ti.create({doc:e,selection:i||void 0})});const s=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(s),this.createNodeViews(),this.prependClass();const o=this.view.dom;o.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;const e=this.capturedTransaction;return this.capturedTransaction=null,e}dispatchTransaction(t){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=t;return}t.steps.forEach(a=>{var c;return(c=this.capturedTransaction)===null||c===void 0?void 0:c.step(a)});return}const e=this.state.apply(t),i=!this.state.selection.eq(e.selection);this.emit("beforeTransaction",{editor:this,transaction:t,nextState:e}),this.view.updateState(e),this.emit("transaction",{editor:this,transaction:t}),i&&this.emit("selectionUpdate",{editor:this,transaction:t});const s=t.getMeta("focus"),o=t.getMeta("blur");s&&this.emit("focus",{editor:this,event:s.event,transaction:t}),o&&this.emit("blur",{editor:this,event:o.event,transaction:t}),!(!t.docChanged||t.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:t})}getAttributes(t){return Gv(this.state,t)}isActive(t,e){const i=typeof t=="string"?t:null,s=typeof t=="string"?e:t;return Yv(this.state,i,s)}getJSON(){return this.state.doc.toJSON()}getHTML(){return Fa(this.state.doc.content,this.schema)}getText(t){const{blockSeparator:e=`

`,textSerializers:i={}}=t||{};return Kv(this.state.doc,{blockSeparator:e,textSerializers:{...Eh(this.schema),...i}})}get isEmpty(){return ja(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const t=this.view.dom;t&&t.editor&&delete t.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var t;return!(!((t=this.view)===null||t===void 0)&&t.docView)}$node(t,e){var i;return((i=this.$doc)===null||i===void 0?void 0:i.querySelector(t,e))||null}$nodes(t,e){var i;return((i=this.$doc)===null||i===void 0?void 0:i.querySelectorAll(t,e))||null}$pos(t){const e=this.state.doc.resolve(t);return new bn(e,this)}get $doc(){return this.$pos(0)}};function _u(n){return Yp((t,e)=>({get(){return t(),n},set(i){n=i,requestAnimationFrame(()=>{requestAnimationFrame(()=>{e()})})}}))}class Eb extends Pb{constructor(t={}){return super(t),this.contentComponent=null,this.appContext=null,this.reactiveState=_u(this.view.state),this.reactiveExtensionStorage=_u(this.extensionStorage),this.on("beforeTransaction",({nextState:e})=>{this.reactiveState.value=e,this.reactiveExtensionStorage.value=this.extensionStorage}),Gp(this)}get state(){return this.reactiveState?this.reactiveState.value:this.view.state}get storage(){return this.reactiveExtensionStorage?this.reactiveExtensionStorage.value:super.storage}registerPlugin(t,e){const i=super.registerPlugin(t,e);return this.reactiveState&&(this.reactiveState.value=i),i}unregisterPlugin(t){const e=super.unregisterPlugin(t);return this.reactiveState&&e&&(this.reactiveState.value=e),e}}const Ob=_t({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(n){const t=q(),e=Qp();return Jp(()=>{const i=n.editor;i&&i.options.element&&t.value&&Xp(()=>{if(!t.value||!i.options.element.firstChild)return;const s=w(t.value);t.value.append(...i.options.element.childNodes),i.contentComponent=e.ctx._,e&&(i.appContext={...e.appContext,provides:e.provides}),i.setOptions({element:s}),i.createNodeViews()})}),ra(()=>{const i=n.editor;i&&(i.contentComponent=null,i.appContext=null)}),{rootEl:t}},render(){return Kp("div",{ref:n=>{this.rootEl=n}})}}),Lb=(n={})=>{const t=Up();return xe(()=>{t.value=new Eb(n)}),ra(()=>{var e,i,s;const o=(e=t.value)===null||e===void 0?void 0:e.options.element,a=o?.cloneNode(!0);(i=o?.parentNode)===null||i===void 0||i.replaceChild(a,o),(s=t.value)===null||s===void 0||s.destroy()}),t};var Ab=Object.defineProperty,Rh=(n,t)=>{for(var e in t)Ab(n,e,{get:t[e],enumerable:!0})};function Bh(n){const{state:t,transaction:e}=n;let{selection:i}=e,{doc:s}=e,{storedMarks:o}=e;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return o},get selection(){return i},get doc(){return s},get tr(){return i=e.selection,s=e.doc,o=e.storedMarks,e}}}var Ib=class{constructor(n){this.editor=n.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=n.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:n,editor:t,state:e}=this,{view:i}=t,{tr:s}=e,o=this.buildProps(s);return Object.fromEntries(Object.entries(n).map(([a,c])=>[a,(...h)=>{const f=c(...h)(o);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(s),f}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(n,t=!0){const{rawCommands:e,editor:i,state:s}=this,{view:o}=i,a=[],c=!!n,u=n||s.tr,h=()=>(!c&&t&&!u.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(u),a.every(m=>m===!0)),f={...Object.fromEntries(Object.entries(e).map(([m,_])=>[m,(...v)=>{const x=this.buildProps(u,t),k=_(...v)(x);return a.push(k),f}])),run:h};return f}createCan(n){const{rawCommands:t,state:e}=this,i=!1,s=n||e.tr,o=this.buildProps(s,i);return{...Object.fromEntries(Object.entries(t).map(([c,u])=>[c,(...h)=>u(...h)({...o,dispatch:void 0})])),chain:()=>this.createChain(s,i)}}buildProps(n,t=!0){const{rawCommands:e,editor:i,state:s}=this,{view:o}=i,a={tr:n,editor:i,view:o,state:Bh({state:s,transaction:n}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(n,t),can:()=>this.createCan(n),get commands(){return Object.fromEntries(Object.entries(e).map(([c,u])=>[c,(...h)=>u(...h)(a)]))}};return a}};function Nb(n,t){const e=new Sd(n);return t.forEach(i=>{i.steps.forEach(s=>{e.step(s)})}),e}var $h=n=>{const t=n.childNodes;for(let e=t.length-1;e>=0;e-=1){const i=t[e];i.nodeType===3&&i.nodeValue&&/^(\n\s\s|\n)$/.test(i.nodeValue)?n.removeChild(i):i.nodeType===1&&$h(i)}return n};function Lr(n){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const t=`<body>${n}</body>`,e=new window.DOMParser().parseFromString(t,"text/html").body;return $h(e)}function Gi(n,t,e){if(n instanceof ve||n instanceof A)return n;e={slice:!0,parseOptions:{},...e};const i=typeof n=="object"&&n!==null,s=typeof n=="string";if(i)try{if(Array.isArray(n)&&n.length>0)return A.fromArray(n.map(c=>t.nodeFromJSON(c)));const a=t.nodeFromJSON(n);return e.errorOnInvalidContent&&a.check(),a}catch(o){if(e.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:o});return console.warn("[tiptap warn]: Invalid content.","Passed value:",n,"Error:",o),Gi("",t,e)}if(s){if(e.errorOnInvalidContent){let a=!1,c="";const u=new ma({topNode:t.spec.topNode,marks:t.spec.marks,nodes:t.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:h=>(a=!0,c=typeof h=="string"?h:h.outerHTML,null)}]}})});if(e.slice?Ce.fromSchema(u).parseSlice(Lr(n),e.parseOptions):Ce.fromSchema(u).parse(Lr(n),e.parseOptions),e.errorOnInvalidContent&&a)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${c}`)})}const o=Ce.fromSchema(t);return e.slice?o.parseSlice(Lr(n),e.parseOptions).content:o.parse(Lr(n),e.parseOptions)}return Gi("",t,e)}function Db(n,t,e={},i={}){return Gi(n,t,{slice:!1,parseOptions:e,errorOnInvalidContent:i.errorOnInvalidContent})}function zb(n){for(let t=0;t<n.edgeCount;t+=1){const{type:e}=n.edge(t);if(e.isTextblock&&!e.hasRequiredAttrs())return e}return null}function Rb(n,t){for(let e=n.depth;e>0;e-=1){const i=n.node(e);if(t(i))return{pos:e>0?n.before(e):0,start:n.start(e),depth:e,node:i}}}function Ms(n){return t=>Rb(t.$from,n)}function ci(n,t,e){return n.config[t]===void 0&&n.parent?ci(n.parent,t,e):typeof n.config[t]=="function"?n.config[t].bind({...e,parent:n.parent?ci(n.parent,t,e):null}):n.config[t]}function Bb(n){return typeof n=="function"}function qe(n,t=void 0,...e){return Bb(n)?t?n.bind(t)(...e):n(...e):n}function $b(n){const t=n.filter(s=>s.type==="extension"),e=n.filter(s=>s.type==="node"),i=n.filter(s=>s.type==="mark");return{baseExtensions:t,nodeExtensions:e,markExtensions:i}}function le(...n){return n.filter(t=>!!t).reduce((t,e)=>{const i={...t};return Object.entries(e).forEach(([s,o])=>{if(!i[s]){i[s]=o;return}if(s==="class"){const c=o?String(o).split(" "):[],u=i[s]?i[s].split(" "):[],h=c.filter(f=>!u.includes(f));i[s]=[...u,...h].join(" ")}else if(s==="style"){const c=o?o.split(";").map(f=>f.trim()).filter(Boolean):[],u=i[s]?i[s].split(";").map(f=>f.trim()).filter(Boolean):[],h=new Map;u.forEach(f=>{const[m,_]=f.split(":").map(y=>y.trim());h.set(m,_)}),c.forEach(f=>{const[m,_]=f.split(":").map(y=>y.trim());h.set(m,_)}),i[s]=Array.from(h.entries()).map(([f,m])=>`${f}: ${m}`).join("; ")}else i[s]=o}),i},{})}function Fb(n,t,e){const{from:i,to:s}=t,{blockSeparator:o=`

`,textSerializers:a={}}=e||{};let c="";return n.nodesBetween(i,s,(u,h,f,m)=>{var _;u.isBlock&&h>i&&(c+=o);const y=a?.[u.type.name];if(y)return f&&(c+=y({node:u,pos:h,parent:f,index:m,range:t})),!1;u.isText&&(c+=(_=u?.text)==null?void 0:_.slice(Math.max(i,h)-h,s-h))}),c}function Vb(n){return Object.fromEntries(Object.entries(n.nodes).filter(([,t])=>t.spec.toText).map(([t,e])=>[t,e.spec.toText]))}function fn(n,t){if(typeof n=="string"){if(!t.marks[n])throw Error(`There is no mark type named '${n}'. Maybe you forgot to add the extension?`);return t.marks[n]}return n}function Zb(n,t){const e=fn(t,n.schema),{from:i,to:s,empty:o}=n.selection,a=[];o?(n.storedMarks&&a.push(...n.storedMarks),a.push(...n.selection.$head.marks())):n.doc.nodesBetween(i,s,u=>{a.push(...u.marks)});const c=a.find(u=>u.type.name===e.name);return c?{...c.attrs}:{}}function Vt(n,t){if(typeof n=="string"){if(!t.nodes[n])throw Error(`There is no node type named '${n}'. Maybe you forgot to add the extension?`);return t.nodes[n]}return n}function Fh(n,t){return t.nodes[n]?"node":t.marks[n]?"mark":null}function Hb(n,t=JSON.stringify){const e={};return n.filter(i=>{const s=t(i);return Object.prototype.hasOwnProperty.call(e,s)?!1:e[s]=!0})}function Wb(n){const t=Hb(n);return t.length===1?t:t.filter((e,i)=>!t.filter((o,a)=>a!==i).some(o=>e.oldRange.from>=o.oldRange.from&&e.oldRange.to<=o.oldRange.to&&e.newRange.from>=o.newRange.from&&e.newRange.to<=o.newRange.to))}function jb(n){const{mapping:t,steps:e}=n,i=[];return t.maps.forEach((s,o)=>{const a=[];if(s.ranges.length)s.forEach((c,u)=>{a.push({from:c,to:u})});else{const{from:c,to:u}=e[o];if(c===void 0||u===void 0)return;a.push({from:c,to:u})}a.forEach(({from:c,to:u})=>{const h=t.slice(o).map(c,-1),f=t.slice(o).map(u),m=t.invert().map(h,-1),_=t.invert().map(f);i.push({oldRange:{from:m,to:_},newRange:{from:h,to:f}})})}),Wb(i)}function qb(n){return Object.prototype.toString.call(n)==="[object RegExp]"}function ts(n,t,e={strict:!0}){const i=Object.keys(t);return i.length?i.every(s=>e.strict?t[s]===n[s]:qb(t[s])?t[s].test(n[s]):t[s]===n[s]):!0}function Vh(n,t,e={}){return n.find(i=>i.type===t&&ts(Object.fromEntries(Object.keys(e).map(s=>[s,i.attrs[s]])),e))}function yu(n,t,e={}){return!!Vh(n,t,e)}function qa(n,t,e){var i;if(!n||!t)return;let s=n.parent.childAfter(n.parentOffset);if((!s.node||!s.node.marks.some(f=>f.type===t))&&(s=n.parent.childBefore(n.parentOffset)),!s.node||!s.node.marks.some(f=>f.type===t)||(e=e||((i=s.node.marks[0])==null?void 0:i.attrs),!Vh([...s.node.marks],t,e)))return;let a=s.index,c=n.start()+s.offset,u=a+1,h=c+s.node.nodeSize;for(;a>0&&yu([...n.parent.child(a-1).marks],t,e);)a-=1,c-=n.parent.child(a).nodeSize;for(;u<n.parent.childCount&&yu([...n.parent.child(u).marks],t,e);)h+=n.parent.child(u).nodeSize,u+=1;return{from:c,to:h}}function Zh(n,t,e){const i=[];return n===t?e.resolve(n).marks().forEach(s=>{const o=e.resolve(n),a=qa(o,s.type);a&&i.push({mark:s,...a})}):e.nodesBetween(n,t,(s,o)=>{!s||s?.nodeSize===void 0||i.push(...s.marks.map(a=>({from:o,to:o+s.nodeSize,mark:a})))}),i}var Ub=(n,t,e,i=20)=>{const s=n.doc.resolve(e);let o=i,a=null;for(;o>0&&a===null;){const c=s.node(o);c?.type.name===t?a=c:o-=1}return[a,o]};function Rr(n,t,e){return Object.fromEntries(Object.entries(e).filter(([i])=>{const s=n.find(o=>o.type===t&&o.name===i);return s?s.attribute.keepOnSplit:!1}))}function Kb(n,t,e={}){const{empty:i,ranges:s}=n.selection,o=t?fn(t,n.schema):null;if(i)return!!(n.storedMarks||n.selection.$from.marks()).filter(m=>o?o.name===m.type.name:!0).find(m=>ts(m.attrs,e,{strict:!1}));let a=0;const c=[];if(s.forEach(({$from:m,$to:_})=>{const y=m.pos,v=_.pos;n.doc.nodesBetween(y,v,(x,k)=>{if(!x.isText&&!x.marks.length)return;const C=Math.max(y,k),O=Math.min(v,k+x.nodeSize),N=O-C;a+=N,c.push(...x.marks.map(V=>({mark:V,from:C,to:O})))})}),a===0)return!1;const u=c.filter(m=>o?o.name===m.mark.type.name:!0).filter(m=>ts(m.mark.attrs,e,{strict:!1})).reduce((m,_)=>m+_.to-_.from,0),h=c.filter(m=>o?m.mark.type!==o&&m.mark.type.excludes(o):!0).reduce((m,_)=>m+_.to-_.from,0);return(u>0?u+h:u)>=a}function ui(n,t,e={}){const{from:i,to:s,empty:o}=n.selection,a=t?Vt(t,n.schema):null,c=[];n.doc.nodesBetween(i,s,(m,_)=>{if(m.isText)return;const y=Math.max(i,_),v=Math.min(s,_+m.nodeSize);c.push({node:m,from:y,to:v})});const u=s-i,h=c.filter(m=>a?a.name===m.node.type.name:!0).filter(m=>ts(m.node.attrs,e,{strict:!1}));return o?!!h.length:h.reduce((m,_)=>m+_.to-_.from,0)>=u}var Jb=(n,t)=>{const{$from:e,$to:i,$anchor:s}=n.selection;if(t){const o=Ms(c=>c.type.name===t)(n.selection);if(!o)return!1;const a=n.doc.resolve(o.pos+1);return s.pos+1===a.end()}return!(i.parentOffset<i.parent.nodeSize-2||e.pos!==i.pos)},Gb=n=>{const{$from:t,$to:e}=n.selection;return!(t.parentOffset>0||t.pos!==e.pos)};function vu(n,t){const{nodeExtensions:e}=$b(t),i=e.find(a=>a.name===n);if(!i)return!1;const s={name:i.name,options:i.options,storage:i.storage},o=qe(ci(i,"group",s));return typeof o!="string"?!1:o.split(" ").includes("list")}function Ua(n,{checkChildren:t=!0,ignoreWhitespace:e=!1}={}){var i;if(e){if(n.type.name==="hardBreak")return!0;if(n.isText)return/^\s*$/m.test((i=n.text)!=null?i:"")}if(n.isText)return!n.text;if(n.isAtom||n.isLeaf)return!1;if(n.content.childCount===0)return!0;if(t){let s=!0;return n.content.forEach(o=>{s!==!1&&(Ua(o,{ignoreWhitespace:e,checkChildren:t})||(s=!1))}),s}return!1}function Hh(n){return n instanceof j}function Wh(n){return n instanceof U}function Sn(n=0,t=0,e=0){return Math.min(Math.max(n,t),e)}function Yb(n,t=null){if(!t)return null;const e=Q.atStart(n),i=Q.atEnd(n);if(t==="start"||t===!0)return e;if(t==="end")return i;const s=e.from,o=i.to;return t==="all"?U.create(n,Sn(0,s,o),Sn(n.content.size,s,o)):U.create(n,Sn(t,s,o),Sn(t,s,o))}function Xb(n,t,e){const i=n.steps.length-1;if(i<t)return;const s=n.steps[i];if(!(s instanceof Nt||s instanceof Dt))return;const o=n.mapping.maps[i];let a=0;o.forEach((c,u,h,f)=>{a===0&&(a=f)}),n.setSelection(Q.near(n.doc.resolve(a),e))}var Cs=class{constructor(n){this.find=n.find,this.handler=n.handler}};function Qb(n){return Object.prototype.toString.call(n).slice(8,-1)}function Ar(n){return Qb(n)!=="Object"?!1:n.constructor===Object&&Object.getPrototypeOf(n)===Object.prototype}function jh(n,t){const e={...n};return Ar(n)&&Ar(t)&&Object.keys(t).forEach(i=>{Ar(t[i])&&Ar(n[i])?e[i]=jh(n[i],t[i]):e[i]=t[i]}),e}var Ka=class{constructor(n={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...n},this.name=this.config.name}get options(){return{...qe(ci(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...qe(ci(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(n={}){const t=this.extend({...this.config,addOptions:()=>jh(this.options,n)});return t.name=this.name,t.parent=this.parent,t}extend(n={}){const t=new this.constructor({...this.config,...n});return t.parent=this,this.child=t,t.name="name"in n?n.name:t.parent.name,t}},Ts=class qh extends Ka{constructor(){super(...arguments),this.type="mark"}static create(t={}){const e=typeof t=="function"?t():t;return new qh(e)}static handleExit({editor:t,mark:e}){const{tr:i}=t.state,s=t.state.selection.$from;if(s.pos===s.end()){const a=s.marks();if(!!!a.find(h=>h?.type.name===e.name))return!1;const u=a.find(h=>h?.type.name===e.name);return u&&i.removeStoredMark(u),i.insertText(" ",s.pos),t.view.dispatch(i),!0}return!1}configure(t){return super.configure(t)}extend(t){const e=typeof t=="function"?t():t;return super.extend(e)}},tx=class{constructor(n){this.find=n.find,this.handler=n.handler}},ex={};Rh(ex,{ClipboardTextSerializer:()=>nx,Commands:()=>d0,Delete:()=>h0,Drop:()=>f0,Editable:()=>p0,FocusEvents:()=>m0,Keymap:()=>g0,Paste:()=>_0,Tabindex:()=>y0,focusEventsPluginKey:()=>Gh});var zt=class Uh extends Ka{constructor(){super(...arguments),this.type="extension"}static create(t={}){const e=typeof t=="function"?t():t;return new Uh(e)}configure(t){return super.configure(t)}extend(t){const e=typeof t=="function"?t():t;return super.extend(e)}},nx=zt.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new yt({key:new Ct("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:n}=this,{state:t,schema:e}=n,{doc:i,selection:s}=t,{ranges:o}=s,a=Math.min(...o.map(f=>f.$from.pos)),c=Math.max(...o.map(f=>f.$to.pos)),u=Vb(e);return Fb(i,{from:a,to:c},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:u})}}})]}}),Kh={};Rh(Kh,{blur:()=>ix,clearContent:()=>rx,clearNodes:()=>sx,command:()=>ox,createParagraphNear:()=>ax,cut:()=>lx,deleteCurrentNode:()=>cx,deleteNode:()=>ux,deleteRange:()=>dx,deleteSelection:()=>hx,enter:()=>fx,exitCode:()=>px,extendMarkRange:()=>mx,first:()=>gx,focus:()=>yx,forEach:()=>vx,insertContent:()=>bx,insertContentAt:()=>wx,joinBackward:()=>Mx,joinDown:()=>Sx,joinForward:()=>Cx,joinItemBackward:()=>Tx,joinItemForward:()=>Px,joinTextblockBackward:()=>Ex,joinTextblockForward:()=>Ox,joinUp:()=>kx,keyboardShortcut:()=>Ax,lift:()=>Ix,liftEmptyBlock:()=>Nx,liftListItem:()=>Dx,newlineInCode:()=>zx,resetAttributes:()=>Rx,scrollIntoView:()=>Bx,selectAll:()=>$x,selectNodeBackward:()=>Fx,selectNodeForward:()=>Vx,selectParentNode:()=>Zx,selectTextblockEnd:()=>Hx,selectTextblockStart:()=>Wx,setContent:()=>jx,setMark:()=>Ux,setMeta:()=>Kx,setNode:()=>Jx,setNodeSelection:()=>Gx,setTextSelection:()=>Yx,sinkListItem:()=>Xx,splitBlock:()=>Qx,splitListItem:()=>t0,toggleList:()=>e0,toggleMark:()=>n0,toggleNode:()=>i0,toggleWrap:()=>r0,undoInputRule:()=>s0,unsetAllMarks:()=>o0,unsetMark:()=>a0,updateAttributes:()=>l0,wrapIn:()=>c0,wrapInList:()=>u0});var ix=()=>({editor:n,view:t})=>(requestAnimationFrame(()=>{var e;n.isDestroyed||(t.dom.blur(),(e=window?.getSelection())==null||e.removeAllRanges())}),!0),rx=(n=!0)=>({commands:t})=>t.setContent("",{emitUpdate:n}),sx=()=>({state:n,tr:t,dispatch:e})=>{const{selection:i}=t,{ranges:s}=i;return e&&s.forEach(({$from:o,$to:a})=>{n.doc.nodesBetween(o.pos,a.pos,(c,u)=>{if(c.type.isText)return;const{doc:h,mapping:f}=t,m=h.resolve(f.map(u)),_=h.resolve(f.map(u+c.nodeSize)),y=m.blockRange(_);if(!y)return;const v=Fn(y);if(c.type.isTextblock){const{defaultType:x}=m.parent.contentMatchAt(m.index());t.setNodeMarkup(y.start,x)}(v||v===0)&&t.lift(y,v)})}),!0},ox=n=>t=>n(t),ax=()=>({state:n,dispatch:t})=>Ra(n,t),lx=(n,t)=>({editor:e,tr:i})=>{const{state:s}=e,o=s.doc.slice(n.from,n.to);i.deleteRange(n.from,n.to);const a=i.mapping.map(t);return i.insert(a,o.content),i.setSelection(new U(i.doc.resolve(Math.max(a-1,0)))),!0},cx=()=>({tr:n,dispatch:t})=>{const{selection:e}=n,i=e.$anchor.node();if(i.content.size>0)return!1;const s=n.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i.type){if(t){const c=s.before(o),u=s.after(o);n.delete(c,u).scrollIntoView()}return!0}return!1},ux=n=>({tr:t,state:e,dispatch:i})=>{const s=Vt(n,e.schema),o=t.selection.$anchor;for(let a=o.depth;a>0;a-=1)if(o.node(a).type===s){if(i){const u=o.before(a),h=o.after(a);t.delete(u,h).scrollIntoView()}return!0}return!1},dx=n=>({tr:t,dispatch:e})=>{const{from:i,to:s}=n;return e&&t.delete(i,s),!0},hx=()=>({state:n,dispatch:t})=>bs(n,t),fx=()=>({commands:n})=>n.keyboardShortcut("Enter"),px=()=>({state:n,dispatch:t})=>gh(n,t),mx=(n,t={})=>({tr:e,state:i,dispatch:s})=>{const o=fn(n,i.schema),{doc:a,selection:c}=e,{$from:u,from:h,to:f}=c;if(s){const m=qa(u,o,t);if(m&&m.from<=h&&m.to>=f){const _=U.create(a,m.from,m.to);e.setSelection(_)}}return!0},gx=n=>t=>{const e=typeof n=="function"?n(t):n;for(let i=0;i<e.length;i+=1)if(e[i](t))return!0;return!1};function _x(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function Ja(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var yx=(n=null,t={})=>({editor:e,view:i,tr:s,dispatch:o})=>{t={scrollIntoView:!0,...t};const a=()=>{(Ja()||_x())&&i.dom.focus(),requestAnimationFrame(()=>{e.isDestroyed||(i.focus(),t?.scrollIntoView&&e.commands.scrollIntoView())})};if(i.hasFocus()&&n===null||n===!1)return!0;if(o&&n===null&&!Wh(e.state.selection))return a(),!0;const c=Yb(s.doc,n)||e.state.selection,u=e.state.selection.eq(c);return o&&(u||s.setSelection(c),u&&s.storedMarks&&s.setStoredMarks(s.storedMarks),a()),!0},vx=(n,t)=>e=>n.every((i,s)=>t(i,{...e,index:s})),bx=(n,t)=>({tr:e,commands:i})=>i.insertContentAt({from:e.selection.from,to:e.selection.to},n,t),xx=n=>!("type"in n),wx=(n,t,e)=>({tr:i,dispatch:s,editor:o})=>{var a;if(s){e={parseOptions:o.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...e};let c;const{selection:u}=o.state,h=C=>{o.emit("contentError",{editor:o,error:C,disableCollaboration:()=>{"collaboration"in o.storage&&typeof o.storage.collaboration=="object"&&o.storage.collaboration&&(o.storage.collaboration.isDisabled=!0)}})},f={preserveWhitespace:"full",...e.parseOptions};if(!e.errorOnInvalidContent&&!o.options.enableContentCheck&&o.options.emitContentError)try{Gi(t,o.schema,{parseOptions:f,errorOnInvalidContent:!0})}catch(C){h(C)}try{c=Gi(t,o.schema,{parseOptions:f,errorOnInvalidContent:(a=e.errorOnInvalidContent)!=null?a:o.options.enableContentCheck})}catch(C){return h(C),!1}let{from:m,to:_}=typeof n=="number"?{from:n,to:n}:{from:n.from,to:n.to},y=!0,v=!0;if((xx(c)?c:[c]).forEach(C=>{C.check(),y=y?C.isText&&C.marks.length===0:!1,v=v?C.isBlock:!1}),m===_&&v){const{parent:C}=i.doc.resolve(m);C.isTextblock&&!C.type.spec.code&&!C.childCount&&(m-=1,_+=1)}let k;if(y){if(Array.isArray(t))k=t.map(C=>C.text||"").join("");else if(t instanceof A){let C="";t.forEach(O=>{O.text&&(C+=O.text)}),k=C}else typeof t=="object"&&t&&t.text?k=t.text:k=t;i.insertText(k,m,_)}else{k=c;const C=u.$from.parentOffset===0,O=u.$from.node().isText||u.$from.node().isTextblock,N=u.$from.node().content.size>0;C&&O&&N&&(m=Math.max(0,m-1)),i.replaceWith(m,_,k)}e.updateSelection&&Xb(i,i.steps.length-1,-1),e.applyInputRules&&i.setMeta("applyInputRules",{from:m,text:k}),e.applyPasteRules&&i.setMeta("applyPasteRules",{from:m,text:k})}return!0},kx=()=>({state:n,dispatch:t})=>fh(n,t),Sx=()=>({state:n,dispatch:t})=>ph(n,t),Mx=()=>({state:n,dispatch:t})=>Ea(n,t),Cx=()=>({state:n,dispatch:t})=>Aa(n,t),Tx=()=>({state:n,dispatch:t,tr:e})=>{try{const i=pi(n.doc,n.selection.$from.pos,-1);return i==null?!1:(e.join(i,2),t&&t(e),!0)}catch{return!1}},Px=()=>({state:n,dispatch:t,tr:e})=>{try{const i=pi(n.doc,n.selection.$from.pos,1);return i==null?!1:(e.join(i,2),t&&t(e),!0)}catch{return!1}},Ex=()=>({state:n,dispatch:t})=>ch(n,t),Ox=()=>({state:n,dispatch:t})=>uh(n,t);function Jh(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function Lx(n){const t=n.split(/-(?!$)/);let e=t[t.length-1];e==="Space"&&(e=" ");let i,s,o,a;for(let c=0;c<t.length-1;c+=1){const u=t[c];if(/^(cmd|meta|m)$/i.test(u))a=!0;else if(/^a(lt)?$/i.test(u))i=!0;else if(/^(c|ctrl|control)$/i.test(u))s=!0;else if(/^s(hift)?$/i.test(u))o=!0;else if(/^mod$/i.test(u))Ja()||Jh()?a=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${u}`)}return i&&(e=`Alt-${e}`),s&&(e=`Ctrl-${e}`),a&&(e=`Meta-${e}`),o&&(e=`Shift-${e}`),e}var Ax=n=>({editor:t,view:e,tr:i,dispatch:s})=>{const o=Lx(n).split(/-(?!$)/),a=o.find(h=>!["Alt","Ctrl","Meta","Shift"].includes(h)),c=new KeyboardEvent("keydown",{key:a==="Space"?" ":a,altKey:o.includes("Alt"),ctrlKey:o.includes("Ctrl"),metaKey:o.includes("Meta"),shiftKey:o.includes("Shift"),bubbles:!0,cancelable:!0}),u=t.captureTransaction(()=>{e.someProp("handleKeyDown",h=>h(e,c))});return u?.steps.forEach(h=>{const f=h.map(i.mapping);f&&s&&i.maybeStep(f)}),!0},Ix=(n,t={})=>({state:e,dispatch:i})=>{const s=Vt(n,e.schema);return ui(e,s,t)?mh(e,i):!1},Nx=()=>({state:n,dispatch:t})=>Ba(n,t),Dx=n=>({state:t,dispatch:e})=>{const i=Vt(n,t.schema);return Sh(i)(t,e)},zx=()=>({state:n,dispatch:t})=>Da(n,t);function bu(n,t){const e=typeof t=="string"?[t]:t;return Object.keys(n).reduce((i,s)=>(e.includes(s)||(i[s]=n[s]),i),{})}var Rx=(n,t)=>({tr:e,state:i,dispatch:s})=>{let o=null,a=null;const c=Fh(typeof n=="string"?n:n.name,i.schema);return c?(c==="node"&&(o=Vt(n,i.schema)),c==="mark"&&(a=fn(n,i.schema)),s&&e.selection.ranges.forEach(u=>{i.doc.nodesBetween(u.$from.pos,u.$to.pos,(h,f)=>{o&&o===h.type&&e.setNodeMarkup(f,void 0,bu(h.attrs,t)),a&&h.marks.length&&h.marks.forEach(m=>{a===m.type&&e.addMark(f,f+h.nodeSize,a.create(bu(m.attrs,t)))})})}),!0):!1},Bx=()=>({tr:n,dispatch:t})=>(t&&n.scrollIntoView(),!0),$x=()=>({tr:n,dispatch:t})=>{if(t){const e=new oe(n.doc);n.setSelection(e)}return!0},Fx=()=>({state:n,dispatch:t})=>Oa(n,t),Vx=()=>({state:n,dispatch:t})=>Ia(n,t),Zx=()=>({state:n,dispatch:t})=>_h(n,t),Hx=()=>({state:n,dispatch:t})=>xh(n,t),Wx=()=>({state:n,dispatch:t})=>bh(n,t),jx=(n,{errorOnInvalidContent:t,emitUpdate:e=!0,parseOptions:i={}}={})=>({editor:s,tr:o,dispatch:a,commands:c})=>{const{doc:u}=o;if(i.preserveWhitespace!=="full"){const h=Db(n,s.schema,i,{errorOnInvalidContent:t??s.options.enableContentCheck});return a&&o.replaceWith(0,u.content.size,h).setMeta("preventUpdate",!e),!0}return a&&o.setMeta("preventUpdate",!e),c.insertContentAt({from:0,to:u.content.size},n,{parseOptions:i,errorOnInvalidContent:t??s.options.enableContentCheck})};function qx(n,t,e){var i;const{selection:s}=t;let o=null;if(Wh(s)&&(o=s.$cursor),o){const c=(i=n.storedMarks)!=null?i:o.marks();return!!e.isInSet(c)||!c.some(u=>u.type.excludes(e))}const{ranges:a}=s;return a.some(({$from:c,$to:u})=>{let h=c.depth===0?n.doc.inlineContent&&n.doc.type.allowsMarkType(e):!1;return n.doc.nodesBetween(c.pos,u.pos,(f,m,_)=>{if(h)return!1;if(f.isInline){const y=!_||_.type.allowsMarkType(e),v=!!e.isInSet(f.marks)||!f.marks.some(x=>x.type.excludes(e));h=y&&v}return!h}),h})}var Ux=(n,t={})=>({tr:e,state:i,dispatch:s})=>{const{selection:o}=e,{empty:a,ranges:c}=o,u=fn(n,i.schema);if(s)if(a){const h=Zb(i,u);e.addStoredMark(u.create({...h,...t}))}else c.forEach(h=>{const f=h.$from.pos,m=h.$to.pos;i.doc.nodesBetween(f,m,(_,y)=>{const v=Math.max(y,f),x=Math.min(y+_.nodeSize,m);_.marks.find(C=>C.type===u)?_.marks.forEach(C=>{u===C.type&&e.addMark(v,x,u.create({...C.attrs,...t}))}):e.addMark(v,x,u.create(t))})});return qx(i,e,u)},Kx=(n,t)=>({tr:e})=>(e.setMeta(n,t),!0),Jx=(n,t={})=>({state:e,dispatch:i,chain:s})=>{const o=Vt(n,e.schema);let a;return e.selection.$anchor.sameParent(e.selection.$head)&&(a=e.selection.$anchor.parent.attrs),o.isTextblock?s().command(({commands:c})=>Xr(o,{...a,...t})(e)?!0:c.clearNodes()).command(({state:c})=>Xr(o,{...a,...t})(c,i)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},Gx=n=>({tr:t,dispatch:e})=>{if(e){const{doc:i}=t,s=Sn(n,0,i.content.size),o=j.create(i,s);t.setSelection(o)}return!0},Yx=n=>({tr:t,dispatch:e})=>{if(e){const{doc:i}=t,{from:s,to:o}=typeof n=="number"?{from:n,to:n}:n,a=U.atStart(i).from,c=U.atEnd(i).to,u=Sn(s,a,c),h=Sn(o,a,c),f=U.create(i,u,h);t.setSelection(f)}return!0},Xx=n=>({state:t,dispatch:e})=>{const i=Vt(n,t.schema);return Mh(i)(t,e)};function xu(n,t){const e=n.storedMarks||n.selection.$to.parentOffset&&n.selection.$from.marks();if(e){const i=e.filter(s=>t?.includes(s.type.name));n.tr.ensureMarks(i)}}var Qx=({keepMarks:n=!0}={})=>({tr:t,state:e,dispatch:i,editor:s})=>{const{selection:o,doc:a}=t,{$from:c,$to:u}=o,h=s.extensionManager.attributes,f=Rr(h,c.node().type.name,c.node().attrs);if(o instanceof j&&o.node.isBlock)return!c.parentOffset||!fe(a,c.pos)?!1:(i&&(n&&xu(e,s.extensionManager.splittableMarks),t.split(c.pos).scrollIntoView()),!0);if(!c.parent.isBlock)return!1;const m=u.parentOffset===u.parent.content.size,_=c.depth===0?void 0:zb(c.node(-1).contentMatchAt(c.indexAfter(-1)));let y=m&&_?[{type:_,attrs:f}]:void 0,v=fe(t.doc,t.mapping.map(c.pos),1,y);if(!y&&!v&&fe(t.doc,t.mapping.map(c.pos),1,_?[{type:_}]:void 0)&&(v=!0,y=_?[{type:_,attrs:f}]:void 0),i){if(v&&(o instanceof U&&t.deleteSelection(),t.split(t.mapping.map(c.pos),1,y),_&&!m&&!c.parentOffset&&c.parent.type!==_)){const x=t.mapping.map(c.before()),k=t.doc.resolve(x);c.node(-1).canReplaceWith(k.index(),k.index()+1,_)&&t.setNodeMarkup(t.mapping.map(c.before()),_)}n&&xu(e,s.extensionManager.splittableMarks),t.scrollIntoView()}return v},t0=(n,t={})=>({tr:e,state:i,dispatch:s,editor:o})=>{var a;const c=Vt(n,i.schema),{$from:u,$to:h}=i.selection,f=i.selection.node;if(f&&f.isBlock||u.depth<2||!u.sameParent(h))return!1;const m=u.node(-1);if(m.type!==c)return!1;const _=o.extensionManager.attributes;if(u.parent.content.size===0&&u.node(-1).childCount===u.indexAfter(-1)){if(u.depth===2||u.node(-3).type!==c||u.index(-2)!==u.node(-2).childCount-1)return!1;if(s){let C=A.empty;const O=u.index(-1)?1:u.index(-2)?2:3;for(let R=u.depth-O;R>=u.depth-3;R-=1)C=A.from(u.node(R).copy(C));const N=u.indexAfter(-1)<u.node(-2).childCount?1:u.indexAfter(-2)<u.node(-3).childCount?2:3,V={...Rr(_,u.node().type.name,u.node().attrs),...t},F=((a=c.contentMatch.defaultType)==null?void 0:a.createAndFill(V))||void 0;C=C.append(A.from(c.createAndFill(null,F)||void 0));const et=u.before(u.depth-(O-1));e.replace(et,u.after(-N),new B(C,4-O,0));let ot=-1;e.doc.nodesBetween(et,e.doc.content.size,(R,ut)=>{if(ot>-1)return!1;R.isTextblock&&R.content.size===0&&(ot=ut+1)}),ot>-1&&e.setSelection(U.near(e.doc.resolve(ot))),e.scrollIntoView()}return!0}const y=h.pos===u.end()?m.contentMatchAt(0).defaultType:null,v={...Rr(_,m.type.name,m.attrs),...t},x={...Rr(_,u.node().type.name,u.node().attrs),...t};e.delete(u.pos,h.pos);const k=y?[{type:c,attrs:v},{type:y,attrs:x}]:[{type:c,attrs:v}];if(!fe(e.doc,u.pos,2))return!1;if(s){const{selection:C,storedMarks:O}=i,{splittableMarks:N}=o.extensionManager,V=O||C.$to.parentOffset&&C.$from.marks();if(e.split(u.pos,2,k).scrollIntoView(),!V||!s)return!0;const F=V.filter(et=>N.includes(et.type.name));e.ensureMarks(F)}return!0},Oo=(n,t)=>{const e=Ms(a=>a.type===t)(n.selection);if(!e)return!0;const i=n.doc.resolve(Math.max(0,e.pos-1)).before(e.depth);if(i===void 0)return!0;const s=n.doc.nodeAt(i);return e.node.type===s?.type&&ze(n.doc,e.pos)&&n.join(e.pos),!0},Lo=(n,t)=>{const e=Ms(a=>a.type===t)(n.selection);if(!e)return!0;const i=n.doc.resolve(e.start).after(e.depth);if(i===void 0)return!0;const s=n.doc.nodeAt(i);return e.node.type===s?.type&&ze(n.doc,i)&&n.join(i),!0},e0=(n,t,e,i={})=>({editor:s,tr:o,state:a,dispatch:c,chain:u,commands:h,can:f})=>{const{extensions:m,splittableMarks:_}=s.extensionManager,y=Vt(n,a.schema),v=Vt(t,a.schema),{selection:x,storedMarks:k}=a,{$from:C,$to:O}=x,N=C.blockRange(O),V=k||x.$to.parentOffset&&x.$from.marks();if(!N)return!1;const F=Ms(et=>vu(et.type.name,m))(x);if(N.depth>=1&&F&&N.depth-F.depth<=1){if(F.node.type===y)return h.liftListItem(v);if(vu(F.node.type.name,m)&&y.validContent(F.node.content)&&c)return u().command(()=>(o.setNodeMarkup(F.pos,y),!0)).command(()=>Oo(o,y)).command(()=>Lo(o,y)).run()}return!e||!V||!c?u().command(()=>f().wrapInList(y,i)?!0:h.clearNodes()).wrapInList(y,i).command(()=>Oo(o,y)).command(()=>Lo(o,y)).run():u().command(()=>{const et=f().wrapInList(y,i),ot=V.filter(R=>_.includes(R.type.name));return o.ensureMarks(ot),et?!0:h.clearNodes()}).wrapInList(y,i).command(()=>Oo(o,y)).command(()=>Lo(o,y)).run()},n0=(n,t={},e={})=>({state:i,commands:s})=>{const{extendEmptyMarkRange:o=!1}=e,a=fn(n,i.schema);return Kb(i,a,t)?s.unsetMark(a,{extendEmptyMarkRange:o}):s.setMark(a,t)},i0=(n,t,e={})=>({state:i,commands:s})=>{const o=Vt(n,i.schema),a=Vt(t,i.schema),c=ui(i,o,e);let u;return i.selection.$anchor.sameParent(i.selection.$head)&&(u=i.selection.$anchor.parent.attrs),c?s.setNode(a,u):s.setNode(o,{...u,...e})},r0=(n,t={})=>({state:e,commands:i})=>{const s=Vt(n,e.schema);return ui(e,s,t)?i.lift(s):i.wrapIn(s,t)},s0=()=>({state:n,dispatch:t})=>{const e=n.plugins;for(let i=0;i<e.length;i+=1){const s=e[i];let o;if(s.spec.isInputRules&&(o=s.getState(n))){if(t){const a=n.tr,c=o.transform;for(let u=c.steps.length-1;u>=0;u-=1)a.step(c.steps[u].invert(c.docs[u]));if(o.text){const u=a.doc.resolve(o.from).marks();a.replaceWith(o.from,o.to,n.schema.text(o.text,u))}else a.delete(o.from,o.to)}return!0}}return!1},o0=()=>({tr:n,dispatch:t})=>{const{selection:e}=n,{empty:i,ranges:s}=e;return i||t&&s.forEach(o=>{n.removeMark(o.$from.pos,o.$to.pos)}),!0},a0=(n,t={})=>({tr:e,state:i,dispatch:s})=>{var o;const{extendEmptyMarkRange:a=!1}=t,{selection:c}=e,u=fn(n,i.schema),{$from:h,empty:f,ranges:m}=c;if(!s)return!0;if(f&&a){let{from:_,to:y}=c;const v=(o=h.marks().find(k=>k.type===u))==null?void 0:o.attrs,x=qa(h,u,v);x&&(_=x.from,y=x.to),e.removeMark(_,y,u)}else m.forEach(_=>{e.removeMark(_.$from.pos,_.$to.pos,u)});return e.removeStoredMark(u),!0},l0=(n,t={})=>({tr:e,state:i,dispatch:s})=>{let o=null,a=null;const c=Fh(typeof n=="string"?n:n.name,i.schema);return c?(c==="node"&&(o=Vt(n,i.schema)),c==="mark"&&(a=fn(n,i.schema)),s&&e.selection.ranges.forEach(u=>{const h=u.$from.pos,f=u.$to.pos;let m,_,y,v;e.selection.empty?i.doc.nodesBetween(h,f,(x,k)=>{o&&o===x.type&&(y=Math.max(k,h),v=Math.min(k+x.nodeSize,f),m=k,_=x)}):i.doc.nodesBetween(h,f,(x,k)=>{k<h&&o&&o===x.type&&(y=Math.max(k,h),v=Math.min(k+x.nodeSize,f),m=k,_=x),k>=h&&k<=f&&(o&&o===x.type&&e.setNodeMarkup(k,void 0,{...x.attrs,...t}),a&&x.marks.length&&x.marks.forEach(C=>{if(a===C.type){const O=Math.max(k,h),N=Math.min(k+x.nodeSize,f);e.addMark(O,N,a.create({...C.attrs,...t}))}}))}),_&&(m!==void 0&&e.setNodeMarkup(m,void 0,{..._.attrs,...t}),a&&_.marks.length&&_.marks.forEach(x=>{a===x.type&&e.addMark(y,v,a.create({...x.attrs,...t}))}))}),!0):!1},c0=(n,t={})=>({state:e,dispatch:i})=>{const s=Vt(n,e.schema);return wh(s,t)(e,i)},u0=(n,t={})=>({state:e,dispatch:i})=>{const s=Vt(n,e.schema);return kh(s,t)(e,i)},d0=zt.create({name:"commands",addCommands(){return{...Kh}}}),h0=zt.create({name:"delete",onUpdate({transaction:n,appendedTransactions:t}){var e,i,s;const o=()=>{var a,c,u,h;if((h=(u=(c=(a=this.editor.options.coreExtensionOptions)==null?void 0:a.delete)==null?void 0:c.filterTransaction)==null?void 0:u.call(c,n))!=null?h:n.getMeta("y-sync$"))return;const f=Nb(n.before,[n,...t]);jb(f).forEach(y=>{f.mapping.mapResult(y.oldRange.from).deletedAfter&&f.mapping.mapResult(y.oldRange.to).deletedBefore&&f.before.nodesBetween(y.oldRange.from,y.oldRange.to,(v,x)=>{const k=x+v.nodeSize-2,C=y.oldRange.from<=x&&k<=y.oldRange.to;this.editor.emit("delete",{type:"node",node:v,from:x,to:k,newFrom:f.mapping.map(x),newTo:f.mapping.map(k),deletedRange:y.oldRange,newRange:y.newRange,partial:!C,editor:this.editor,transaction:n,combinedTransform:f})})});const _=f.mapping;f.steps.forEach((y,v)=>{var x,k;if(y instanceof Me){const C=_.slice(v).map(y.from,-1),O=_.slice(v).map(y.to),N=_.invert().map(C,-1),V=_.invert().map(O),F=(x=f.doc.nodeAt(C-1))==null?void 0:x.marks.some(ot=>ot.eq(y.mark)),et=(k=f.doc.nodeAt(O))==null?void 0:k.marks.some(ot=>ot.eq(y.mark));this.editor.emit("delete",{type:"mark",mark:y.mark,from:y.from,to:y.to,deletedRange:{from:N,to:V},newRange:{from:C,to:O},partial:!!(et||F),editor:this.editor,transaction:n,combinedTransform:f})}})};(s=(i=(e=this.editor.options.coreExtensionOptions)==null?void 0:e.delete)==null?void 0:i.async)==null||s?setTimeout(o,0):o()}}),f0=zt.create({name:"drop",addProseMirrorPlugins(){return[new yt({key:new Ct("tiptapDrop"),props:{handleDrop:(n,t,e,i)=>{this.editor.emit("drop",{editor:this.editor,event:t,slice:e,moved:i})}}})]}}),p0=zt.create({name:"editable",addProseMirrorPlugins(){return[new yt({key:new Ct("editable"),props:{editable:()=>this.editor.options.editable}})]}}),Gh=new Ct("focusEvents"),m0=zt.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:n}=this;return[new yt({key:Gh,props:{handleDOMEvents:{focus:(t,e)=>{n.isFocused=!0;const i=n.state.tr.setMeta("focus",{event:e}).setMeta("addToHistory",!1);return t.dispatch(i),!1},blur:(t,e)=>{n.isFocused=!1;const i=n.state.tr.setMeta("blur",{event:e}).setMeta("addToHistory",!1);return t.dispatch(i),!1}}}})]}}),g0=zt.create({name:"keymap",addKeyboardShortcuts(){const n=()=>this.editor.commands.first(({commands:a})=>[()=>a.undoInputRule(),()=>a.command(({tr:c})=>{const{selection:u,doc:h}=c,{empty:f,$anchor:m}=u,{pos:_,parent:y}=m,v=m.parent.isTextblock&&_>0?c.doc.resolve(_-1):m,x=v.parent.type.spec.isolating,k=m.pos-m.parentOffset,C=x&&v.parent.childCount===1?k===m.pos:Q.atStart(h).from===_;return!f||!y.type.isTextblock||y.textContent.length||!C||C&&m.parent.type.name==="paragraph"?!1:a.clearNodes()}),()=>a.deleteSelection(),()=>a.joinBackward(),()=>a.selectNodeBackward()]),t=()=>this.editor.commands.first(({commands:a})=>[()=>a.deleteSelection(),()=>a.deleteCurrentNode(),()=>a.joinForward(),()=>a.selectNodeForward()]),i={Enter:()=>this.editor.commands.first(({commands:a})=>[()=>a.newlineInCode(),()=>a.createParagraphNear(),()=>a.liftEmptyBlock(),()=>a.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:n,"Mod-Backspace":n,"Shift-Backspace":n,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},s={...i},o={...i,"Ctrl-h":n,"Alt-Backspace":n,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Ja()||Jh()?o:s},addProseMirrorPlugins(){return[new yt({key:new Ct("clearDocument"),appendTransaction:(n,t,e)=>{if(n.some(x=>x.getMeta("composition")))return;const i=n.some(x=>x.docChanged)&&!t.doc.eq(e.doc),s=n.some(x=>x.getMeta("preventClearDocument"));if(!i||s)return;const{empty:o,from:a,to:c}=t.selection,u=Q.atStart(t.doc).from,h=Q.atEnd(t.doc).to;if(o||!(a===u&&c===h)||!Ua(e.doc))return;const _=e.tr,y=Bh({state:e,transaction:_}),{commands:v}=new Ib({editor:this.editor,state:y});if(v.clearNodes(),!!_.steps.length)return _}})]}}),_0=zt.create({name:"paste",addProseMirrorPlugins(){return[new yt({key:new Ct("tiptapPaste"),props:{handlePaste:(n,t,e)=>{this.editor.emit("paste",{editor:this.editor,event:t,slice:e})}}})]}}),y0=zt.create({name:"tabindex",addProseMirrorPlugins(){return[new yt({key:new Ct("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});function Yi(n){return new Cs({find:n.find,handler:({state:t,range:e,match:i})=>{const s=qe(n.getAttributes,void 0,i);if(s===!1||s===null)return null;const{tr:o}=t,a=i[i.length-1],c=i[0];if(a){const u=c.search(/\S/),h=e.from+c.indexOf(a),f=h+a.length;if(Zh(e.from,e.to,t.doc).filter(y=>y.mark.type.excluded.find(x=>x===n.type&&x!==y.mark.type)).filter(y=>y.to>h).length)return null;f<e.to&&o.delete(f,e.to),h>e.from&&o.delete(e.from+u,h);const _=e.from+u+a.length;o.addMark(e.from+u,_,n.type.create(s||{})),o.removeStoredMark(n.type)}}})}function v0(n){return new Cs({find:n.find,handler:({state:t,range:e,match:i})=>{const s=qe(n.getAttributes,void 0,i)||{},{tr:o}=t,a=e.from;let c=e.to;const u=n.type.create(s);if(i[1]){const h=i[0].lastIndexOf(i[1]);let f=a+h;f>c?f=c:c=f+i[1].length;const m=i[0][i[0].length-1];o.insertText(m,a+i[0].length-1),o.replaceWith(f,c,u)}else if(i[0]){const h=n.type.isInline?a:a-1;o.insert(h,n.type.create(s)).delete(o.mapping.map(a),o.mapping.map(c))}o.scrollIntoView()}})}function b0(n){return new Cs({find:n.find,handler:({state:t,range:e,match:i})=>{const s=t.doc.resolve(e.from),o=qe(n.getAttributes,void 0,i)||{};if(!s.node(-1).canReplaceWith(s.index(-1),s.indexAfter(-1),n.type))return null;t.tr.delete(e.from,e.to).setBlockType(e.from,e.from,n.type,o)}})}function di(n){return new Cs({find:n.find,handler:({state:t,range:e,match:i,chain:s})=>{const o=qe(n.getAttributes,void 0,i)||{},a=t.tr.delete(e.from,e.to),u=a.doc.resolve(e.from).blockRange(),h=u&&ya(u,n.type,o);if(!h)return null;if(a.wrap(u,h),n.keepMarks&&n.editor){const{selection:m,storedMarks:_}=t,{splittableMarks:y}=n.editor.extensionManager,v=_||m.$to.parentOffset&&m.$from.marks();if(v){const x=v.filter(k=>y.includes(k.type.name));a.ensureMarks(x)}}if(n.keepAttributes){const m=n.type.name==="bulletList"||n.type.name==="orderedList"?"listItem":"taskList";s().updateAttributes(m,o).run()}const f=a.doc.resolve(e.from-1).nodeBefore;f&&f.type===n.type&&ze(a.doc,e.from-1)&&(!n.joinPredicate||n.joinPredicate(i,f))&&a.join(e.from-1)}})}function x0(n,t){const{selection:e}=n,{$from:i}=e;if(e instanceof j){const o=i.index();return i.parent.canReplaceWith(o,o+1,t)}let s=i.depth;for(;s>=0;){const o=i.index(s);if(i.node(s).contentMatchAt(o).matchType(t))return!0;s-=1}return!1}var Pe=class Yh extends Ka{constructor(){super(...arguments),this.type="node"}static create(t={}){const e=typeof t=="function"?t():t;return new Yh(e)}configure(t){return super.configure(t)}extend(t){const e=typeof t=="function"?t():t;return super.extend(e)}};function Xi(n){return new tx({find:n.find,handler:({state:t,range:e,match:i,pasteEvent:s})=>{const o=qe(n.getAttributes,void 0,i,s);if(o===!1||o===null)return null;const{tr:a}=t,c=i[i.length-1],u=i[0];let h=e.to;if(c){const f=u.search(/\S/),m=e.from+u.indexOf(c),_=m+c.length;if(Zh(e.from,e.to,t.doc).filter(v=>v.mark.type.excluded.find(k=>k===n.type&&k!==v.mark.type)).filter(v=>v.to>m).length)return null;_<e.to&&a.delete(_,e.to),m>e.from&&a.delete(e.from+f,m),h=e.from+f+c.length,a.addMark(e.from+f,h,n.type.create(o||{})),a.removeStoredMark(n.type)}}})}var w0=Ts.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:n=>n.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:n}){return["u",le(this.options.HTMLAttributes,n),0]},addCommands(){return{setUnderline:()=>({commands:n})=>n.setMark(this.name),toggleUnderline:()=>({commands:n})=>n.toggleMark(this.name),unsetUnderline:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),k0=w0,S0=Pe.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:n}){return["hr",le(this.options.HTMLAttributes,n)]},addCommands(){return{setHorizontalRule:()=>({chain:n,state:t})=>{if(!x0(t,t.schema.nodes[this.name]))return!1;const{selection:e}=t,{$to:i}=e,s=n();return Hh(e)?s.insertContentAt(i.pos,{type:this.name}):s.insertContent({type:this.name}),s.command(({tr:o,dispatch:a})=>{var c;if(a){const{$to:u}=o.selection,h=u.end();if(u.nodeAfter)u.nodeAfter.isTextblock?o.setSelection(U.create(o.doc,u.pos+1)):u.nodeAfter.isBlock?o.setSelection(j.create(o.doc,u.pos)):o.setSelection(U.create(o.doc,u.pos));else{const f=(c=u.parent.type.contentMatch.defaultType)==null?void 0:c.create();f&&(o.insert(h,f),o.setSelection(U.create(o.doc,h+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[v0({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),M0=S0,C0=Pe.create({name:"doc",topNode:!0,content:"block+"}),T0=Pe.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:n}){return["p",le(this.options.HTMLAttributes,n),0]},addCommands(){return{setParagraph:()=>({commands:n})=>n.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),P0=Pe.create({name:"text",group:"inline"}),es=(n,t)=>{if(n==="slot")return 0;if(n instanceof Function)return n(t);const{children:e,...i}=t??{};if(n==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[n,i,e]},E0=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,O0=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,L0=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,A0=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,I0=Ts.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:n=>n.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:n=>n.type.name===this.name},{style:"font-weight",getAttrs:n=>/^(bold(er)?|[5-9]\d{2,})$/.test(n)&&null}]},renderHTML({HTMLAttributes:n}){return es("strong",{...le(this.options.HTMLAttributes,n),children:es("slot",{})})},addCommands(){return{setBold:()=>({commands:n})=>n.setMark(this.name),toggleBold:()=>({commands:n})=>n.toggleMark(this.name),unsetBold:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[Yi({find:E0,type:this.type}),Yi({find:L0,type:this.type})]},addPasteRules(){return[Xi({find:O0,type:this.type}),Xi({find:A0,type:this.type})]}}),N0=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,D0=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,z0=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,R0=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,B0=Ts.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:n=>n.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:n=>n.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:n}){return["em",le(this.options.HTMLAttributes,n),0]},addCommands(){return{setItalic:()=>({commands:n})=>n.setMark(this.name),toggleItalic:()=>({commands:n})=>n.toggleMark(this.name),unsetItalic:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[Yi({find:N0,type:this.type}),Yi({find:z0,type:this.type})]},addPasteRules(){return[Xi({find:D0,type:this.type}),Xi({find:R0,type:this.type})]}}),$0=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,F0=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,V0=Ts.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:n=>n.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:n}){return["s",le(this.options.HTMLAttributes,n),0]},addCommands(){return{setStrike:()=>({commands:n})=>n.setMark(this.name),toggleStrike:()=>({commands:n})=>n.toggleMark(this.name),unsetStrike:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[Yi({find:$0,type:this.type})]},addPasteRules(){return[Xi({find:F0,type:this.type})]}}),Z0=/^\s*>\s$/,H0=Pe.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:n}){return es("blockquote",{...le(this.options.HTMLAttributes,n),children:es("slot",{})})},addCommands(){return{setBlockquote:()=>({commands:n})=>n.wrapIn(this.name),toggleBlockquote:()=>({commands:n})=>n.toggleWrap(this.name),unsetBlockquote:()=>({commands:n})=>n.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[di({find:Z0,type:this.type})]}}),W0=Object.defineProperty,j0=(n,t)=>{for(var e in t)W0(n,e,{get:t[e],enumerable:!0})},q0="listItem",wu="textStyle",ku=/^\s*([-+*])\s$/,Xh=Pe.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:n}){return["ul",le(this.options.HTMLAttributes,n),0]},addCommands(){return{toggleBulletList:()=>({commands:n,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(q0,this.editor.getAttributes(wu)).run():n.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let n=di({find:ku,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(n=di({find:ku,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(wu),editor:this.editor})),[n]}}),Qh=Pe.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:n}){return["li",le(this.options.HTMLAttributes,n),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),U0={};j0(U0,{findListItemPos:()=>ir,getNextListDepth:()=>Ga,handleBackspace:()=>ta,handleDelete:()=>ea,hasListBefore:()=>tf,hasListItemAfter:()=>K0,hasListItemBefore:()=>ef,listItemHasSubList:()=>nf,nextListIsDeeper:()=>rf,nextListIsHigher:()=>sf});var ir=(n,t)=>{const{$from:e}=t.selection,i=Vt(n,t.schema);let s=null,o=e.depth,a=e.pos,c=null;for(;o>0&&c===null;)s=e.node(o),s.type===i?c=o:(o-=1,a-=1);return c===null?null:{$pos:t.doc.resolve(a),depth:c}},Ga=(n,t)=>{const e=ir(n,t);if(!e)return!1;const[,i]=Ub(t,n,e.$pos.pos+4);return i},tf=(n,t,e)=>{const{$anchor:i}=n.selection,s=Math.max(0,i.pos-2),o=n.doc.resolve(s).node();return!(!o||!e.includes(o.type.name))},ef=(n,t)=>{var e;const{$anchor:i}=t.selection,s=t.doc.resolve(i.pos-2);return!(s.index()===0||((e=s.nodeBefore)==null?void 0:e.type.name)!==n)},nf=(n,t,e)=>{if(!e)return!1;const i=Vt(n,t.schema);let s=!1;return e.descendants(o=>{o.type===i&&(s=!0)}),s},ta=(n,t,e)=>{if(n.commands.undoInputRule())return!0;if(n.state.selection.from!==n.state.selection.to)return!1;if(!ui(n.state,t)&&tf(n.state,t,e)){const{$anchor:c}=n.state.selection,u=n.state.doc.resolve(c.before()-1),h=[];u.node().descendants((_,y)=>{_.type.name===t&&h.push({node:_,pos:y})});const f=h.at(-1);if(!f)return!1;const m=n.state.doc.resolve(u.start()+f.pos+1);return n.chain().cut({from:c.start()-1,to:c.end()+1},m.end()).joinForward().run()}if(!ui(n.state,t)||!Gb(n.state))return!1;const i=ir(t,n.state);if(!i)return!1;const o=n.state.doc.resolve(i.$pos.pos-2).node(i.depth),a=nf(t,n.state,o);return ef(t,n.state)&&!a?n.commands.joinItemBackward():n.chain().liftListItem(t).run()},rf=(n,t)=>{const e=Ga(n,t),i=ir(n,t);return!i||!e?!1:e>i.depth},sf=(n,t)=>{const e=Ga(n,t),i=ir(n,t);return!i||!e?!1:e<i.depth},ea=(n,t)=>{if(!ui(n.state,t)||!Jb(n.state,t))return!1;const{selection:e}=n.state,{$from:i,$to:s}=e;return!e.empty&&i.sameParent(s)?!1:rf(t,n.state)?n.chain().focus(n.state.selection.from+4).lift(t).joinBackward().run():sf(t,n.state)?n.chain().joinForward().joinBackward().run():n.commands.joinItemForward()},K0=(n,t)=>{var e;const{$anchor:i}=t.selection,s=t.doc.resolve(i.pos-i.parentOffset-2);return!(s.index()===s.parent.childCount-1||((e=s.nodeAfter)==null?void 0:e.type.name)!==n)},J0=zt.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:n})=>{let t=!1;return this.options.listTypes.forEach(({itemName:e})=>{n.state.schema.nodes[e]!==void 0&&ea(n,e)&&(t=!0)}),t},"Mod-Delete":({editor:n})=>{let t=!1;return this.options.listTypes.forEach(({itemName:e})=>{n.state.schema.nodes[e]!==void 0&&ea(n,e)&&(t=!0)}),t},Backspace:({editor:n})=>{let t=!1;return this.options.listTypes.forEach(({itemName:e,wrapperNames:i})=>{n.state.schema.nodes[e]!==void 0&&ta(n,e,i)&&(t=!0)}),t},"Mod-Backspace":({editor:n})=>{let t=!1;return this.options.listTypes.forEach(({itemName:e,wrapperNames:i})=>{n.state.schema.nodes[e]!==void 0&&ta(n,e,i)&&(t=!0)}),t}}}}),G0="listItem",Su="textStyle",Mu=/^(\d+)\.\s$/,of=Pe.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:n=>n.hasAttribute("start")?parseInt(n.getAttribute("start")||"",10):1},type:{default:null,parseHTML:n=>n.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:n}){const{start:t,...e}=n;return t===1?["ol",le(this.options.HTMLAttributes,e),0]:["ol",le(this.options.HTMLAttributes,n),0]},addCommands(){return{toggleOrderedList:()=>({commands:n,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(G0,this.editor.getAttributes(Su)).run():n.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let n=di({find:Mu,type:this.type,getAttributes:t=>({start:+t[1]}),joinPredicate:(t,e)=>e.childCount+e.attrs.start===+t[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(n=di({find:Mu,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:t=>({start:+t[1],...this.editor.getAttributes(Su)}),joinPredicate:(t,e)=>e.childCount+e.attrs.start===+t[1],editor:this.editor})),[n]}}),Y0=/^\s*(\[([( |x])?\])\s$/,X0=Pe.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:n=>{const t=n.getAttribute("data-checked");return t===""||t==="true"},renderHTML:n=>({"data-checked":n.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:n,HTMLAttributes:t}){return["li",le(this.options.HTMLAttributes,t,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:n.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){const n={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...n,Tab:()=>this.editor.commands.sinkListItem(this.name)}:n},addNodeView(){return({node:n,HTMLAttributes:t,getPos:e,editor:i})=>{const s=document.createElement("li"),o=document.createElement("label"),a=document.createElement("span"),c=document.createElement("input"),u=document.createElement("div"),h=f=>{var m,_;c.ariaLabel=((_=(m=this.options.a11y)==null?void 0:m.checkboxLabel)==null?void 0:_.call(m,f,c.checked))||`Task item checkbox for ${f.textContent||"empty task item"}`};return h(n),o.contentEditable="false",c.type="checkbox",c.addEventListener("mousedown",f=>f.preventDefault()),c.addEventListener("change",f=>{if(!i.isEditable&&!this.options.onReadOnlyChecked){c.checked=!c.checked;return}const{checked:m}=f.target;i.isEditable&&typeof e=="function"&&i.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:_})=>{const y=e();if(typeof y!="number")return!1;const v=_.doc.nodeAt(y);return _.setNodeMarkup(y,void 0,{...v?.attrs,checked:m}),!0}).run(),!i.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(n,m)||(c.checked=!c.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([f,m])=>{s.setAttribute(f,m)}),s.dataset.checked=n.attrs.checked,c.checked=n.attrs.checked,o.append(c,a),s.append(o,u),Object.entries(t).forEach(([f,m])=>{s.setAttribute(f,m)}),{dom:s,contentDOM:u,update:f=>f.type!==this.type?!1:(s.dataset.checked=f.attrs.checked,c.checked=f.attrs.checked,h(f),!0)}}},addInputRules(){return[di({find:Y0,type:this.type,getAttributes:n=>({checked:n[n.length-1]==="x"})})]}}),Q0=Pe.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:n}){return["ul",le(this.options.HTMLAttributes,n,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands:n})=>n.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});zt.create({name:"listKit",addExtensions(){const n=[];return this.options.bulletList!==!1&&n.push(Xh.configure(this.options.bulletList)),this.options.listItem!==!1&&n.push(Qh.configure(this.options.listItem)),this.options.listKeymap!==!1&&n.push(J0.configure(this.options.listKeymap)),this.options.orderedList!==!1&&n.push(of.configure(this.options.orderedList)),this.options.taskItem!==!1&&n.push(X0.configure(this.options.taskItem)),this.options.taskList!==!1&&n.push(Q0.configure(this.options.taskList)),n}});var t1=Pe.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(n=>({tag:`h${n}`,attrs:{level:n}}))},renderHTML({node:n,HTMLAttributes:t}){return[`h${this.options.levels.includes(n.attrs.level)?n.attrs.level:this.options.levels[0]}`,le(this.options.HTMLAttributes,t),0]},addCommands(){return{setHeading:n=>({commands:t})=>this.options.levels.includes(n.level)?t.setNode(this.name,n):!1,toggleHeading:n=>({commands:t})=>this.options.levels.includes(n.level)?t.toggleNode(this.name,"paragraph",n):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((n,t)=>({...n,[`Mod-Alt-${t}`]:()=>this.editor.commands.toggleHeading({level:t})}),{})},addInputRules(){return this.options.levels.map(n=>b0({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${n}})\\s$`),type:this.type,getAttributes:{level:n}}))}});function e1(n={}){return new yt({view(t){return new n1(t,n)}})}class n1{constructor(t,e){var i;this.editorView=t,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(i=e.width)!==null&&i!==void 0?i:1,this.color=e.color===!1?void 0:e.color||"black",this.class=e.class,this.handlers=["dragover","dragend","drop","dragleave"].map(s=>{let o=a=>{this[s](a)};return t.dom.addEventListener(s,o),{name:s,handler:o}})}destroy(){this.handlers.forEach(({name:t,handler:e})=>this.editorView.dom.removeEventListener(t,e))}update(t,e){this.cursorPos!=null&&e.doc!=t.state.doc&&(this.cursorPos>t.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(t){t!=this.cursorPos&&(this.cursorPos=t,t==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let t=this.editorView.state.doc.resolve(this.cursorPos),e=!t.parent.inlineContent,i,s=this.editorView.dom,o=s.getBoundingClientRect(),a=o.width/s.offsetWidth,c=o.height/s.offsetHeight;if(e){let m=t.nodeBefore,_=t.nodeAfter;if(m||_){let y=this.editorView.nodeDOM(this.cursorPos-(m?m.nodeSize:0));if(y){let v=y.getBoundingClientRect(),x=m?v.bottom:v.top;m&&_&&(x=(x+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let k=this.width/2*c;i={left:v.left,right:v.right,top:x-k,bottom:x+k}}}}if(!i){let m=this.editorView.coordsAtPos(this.cursorPos),_=this.width/2*a;i={left:m.left-_,right:m.left+_,top:m.top,bottom:m.bottom}}let u=this.editorView.dom.offsetParent;this.element||(this.element=u.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",e),this.element.classList.toggle("prosemirror-dropcursor-inline",!e);let h,f;if(!u||u==document.body&&getComputedStyle(u).position=="static")h=-pageXOffset,f=-pageYOffset;else{let m=u.getBoundingClientRect(),_=m.width/u.offsetWidth,y=m.height/u.offsetHeight;h=m.left-u.scrollLeft*_,f=m.top-u.scrollTop*y}this.element.style.left=(i.left-h)/a+"px",this.element.style.top=(i.top-f)/c+"px",this.element.style.width=(i.right-i.left)/a+"px",this.element.style.height=(i.bottom-i.top)/c+"px"}scheduleRemoval(t){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),t)}dragover(t){if(!this.editorView.editable)return;let e=this.editorView.posAtCoords({left:t.clientX,top:t.clientY}),i=e&&e.inside>=0&&this.editorView.state.doc.nodeAt(e.inside),s=i&&i.type.spec.disableDropCursor,o=typeof s=="function"?s(this.editorView,e,t):s;if(e&&!o){let a=e.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let c=vd(this.editorView.state.doc,a,this.editorView.dragging.slice);c!=null&&(a=c)}this.setCursor(a),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(t){this.editorView.dom.contains(t.relatedTarget)||this.setCursor(null)}}class St extends Q{constructor(t){super(t,t)}map(t,e){let i=t.resolve(e.map(this.head));return St.valid(i)?new St(i):Q.near(i)}content(){return B.empty}eq(t){return t instanceof St&&t.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new St(t.resolve(e.pos))}getBookmark(){return new Ya(this.anchor)}static valid(t){let e=t.parent;if(e.isTextblock||!i1(t)||!r1(t))return!1;let i=e.type.spec.allowGapCursor;if(i!=null)return i;let s=e.contentMatchAt(t.index()).defaultType;return s&&s.isTextblock}static findGapCursorFrom(t,e,i=!1){t:for(;;){if(!i&&St.valid(t))return t;let s=t.pos,o=null;for(let a=t.depth;;a--){let c=t.node(a);if(e>0?t.indexAfter(a)<c.childCount:t.index(a)>0){o=c.child(e>0?t.indexAfter(a):t.index(a)-1);break}else if(a==0)return null;s+=e;let u=t.doc.resolve(s);if(St.valid(u))return u}for(;;){let a=e>0?o.firstChild:o.lastChild;if(!a){if(o.isAtom&&!o.isText&&!j.isSelectable(o)){t=t.doc.resolve(s+o.nodeSize*e),i=!1;continue t}break}o=a,s+=e;let c=t.doc.resolve(s);if(St.valid(c))return c}return null}}}St.prototype.visible=!1;St.findFrom=St.findGapCursorFrom;Q.jsonID("gapcursor",St);class Ya{constructor(t){this.pos=t}map(t){return new Ya(t.map(this.pos))}resolve(t){let e=t.resolve(this.pos);return St.valid(e)?new St(e):Q.near(e)}}function i1(n){for(let t=n.depth;t>=0;t--){let e=n.index(t),i=n.node(t);if(e==0){if(i.type.spec.isolating)return!0;continue}for(let s=i.child(e-1);;s=s.lastChild){if(s.childCount==0&&!s.inlineContent||s.isAtom||s.type.spec.isolating)return!0;if(s.inlineContent)return!1}}return!0}function r1(n){for(let t=n.depth;t>=0;t--){let e=n.indexAfter(t),i=n.node(t);if(e==i.childCount){if(i.type.spec.isolating)return!0;continue}for(let s=i.child(e);;s=s.firstChild){if(s.childCount==0&&!s.inlineContent||s.isAtom||s.type.spec.isolating)return!0;if(s.inlineContent)return!1}}return!0}function s1(){return new yt({props:{decorations:c1,createSelectionBetween(n,t,e){return t.pos==e.pos&&St.valid(e)?new St(e):null},handleClick:a1,handleKeyDown:o1,handleDOMEvents:{beforeinput:l1}}})}const o1=ah({ArrowLeft:Ir("horiz",-1),ArrowRight:Ir("horiz",1),ArrowUp:Ir("vert",-1),ArrowDown:Ir("vert",1)});function Ir(n,t){const e=n=="vert"?t>0?"down":"up":t>0?"right":"left";return function(i,s,o){let a=i.selection,c=t>0?a.$to:a.$from,u=a.empty;if(a instanceof U){if(!o.endOfTextblock(e)||c.depth==0)return!1;u=!1,c=i.doc.resolve(t>0?c.after():c.before())}let h=St.findGapCursorFrom(c,t,u);return h?(s&&s(i.tr.setSelection(new St(h))),!0):!1}}function a1(n,t,e){if(!n||!n.editable)return!1;let i=n.state.doc.resolve(t);if(!St.valid(i))return!1;let s=n.posAtCoords({left:e.clientX,top:e.clientY});return s&&s.inside>-1&&j.isSelectable(n.state.doc.nodeAt(s.inside))?!1:(n.dispatch(n.state.tr.setSelection(new St(i))),!0)}function l1(n,t){if(t.inputType!="insertCompositionText"||!(n.state.selection instanceof St))return!1;let{$from:e}=n.state.selection,i=e.parent.contentMatchAt(e.index()).findWrapping(n.state.schema.nodes.text);if(!i)return!1;let s=A.empty;for(let a=i.length-1;a>=0;a--)s=A.from(i[a].createAndFill(null,s));let o=n.state.tr.replace(e.pos,e.pos,new B(s,0,0));return o.setSelection(U.near(o.doc.resolve(e.pos+1))),n.dispatch(o),!1}function c1(n){if(!(n.selection instanceof St))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",kt.create(n.doc,[Qt.widget(n.selection.head,t,{key:"gapcursor"})])}var ns=200,$t=function(){};$t.prototype.append=function(t){return t.length?(t=$t.from(t),!this.length&&t||t.length<ns&&this.leafAppend(t)||this.length<ns&&t.leafPrepend(this)||this.appendInner(t)):this};$t.prototype.prepend=function(t){return t.length?$t.from(t).append(this):this};$t.prototype.appendInner=function(t){return new u1(this,t)};$t.prototype.slice=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=this.length),t>=e?$t.empty:this.sliceInner(Math.max(0,t),Math.min(this.length,e))};$t.prototype.get=function(t){if(!(t<0||t>=this.length))return this.getInner(t)};$t.prototype.forEach=function(t,e,i){e===void 0&&(e=0),i===void 0&&(i=this.length),e<=i?this.forEachInner(t,e,i,0):this.forEachInvertedInner(t,e,i,0)};$t.prototype.map=function(t,e,i){e===void 0&&(e=0),i===void 0&&(i=this.length);var s=[];return this.forEach(function(o,a){return s.push(t(o,a))},e,i),s};$t.from=function(t){return t instanceof $t?t:t&&t.length?new af(t):$t.empty};var af=(function(n){function t(i){n.call(this),this.values=i}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(s,o){return s==0&&o==this.length?this:new t(this.values.slice(s,o))},t.prototype.getInner=function(s){return this.values[s]},t.prototype.forEachInner=function(s,o,a,c){for(var u=o;u<a;u++)if(s(this.values[u],c+u)===!1)return!1},t.prototype.forEachInvertedInner=function(s,o,a,c){for(var u=o-1;u>=a;u--)if(s(this.values[u],c+u)===!1)return!1},t.prototype.leafAppend=function(s){if(this.length+s.length<=ns)return new t(this.values.concat(s.flatten()))},t.prototype.leafPrepend=function(s){if(this.length+s.length<=ns)return new t(s.flatten().concat(this.values))},e.length.get=function(){return this.values.length},e.depth.get=function(){return 0},Object.defineProperties(t.prototype,e),t})($t);$t.empty=new af([]);var u1=(function(n){function t(e,i){n.call(this),this.left=e,this.right=i,this.length=e.length+i.length,this.depth=Math.max(e.depth,i.depth)+1}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(i){return i<this.left.length?this.left.get(i):this.right.get(i-this.left.length)},t.prototype.forEachInner=function(i,s,o,a){var c=this.left.length;if(s<c&&this.left.forEachInner(i,s,Math.min(o,c),a)===!1||o>c&&this.right.forEachInner(i,Math.max(s-c,0),Math.min(this.length,o)-c,a+c)===!1)return!1},t.prototype.forEachInvertedInner=function(i,s,o,a){var c=this.left.length;if(s>c&&this.right.forEachInvertedInner(i,s-c,Math.max(o,c)-c,a+c)===!1||o<c&&this.left.forEachInvertedInner(i,Math.min(s,c),o,a)===!1)return!1},t.prototype.sliceInner=function(i,s){if(i==0&&s==this.length)return this;var o=this.left.length;return s<=o?this.left.slice(i,s):i>=o?this.right.slice(i-o,s-o):this.left.slice(i,o).append(this.right.slice(0,s-o))},t.prototype.leafAppend=function(i){var s=this.right.leafAppend(i);if(s)return new t(this.left,s)},t.prototype.leafPrepend=function(i){var s=this.left.leafPrepend(i);if(s)return new t(s,this.right)},t.prototype.appendInner=function(i){return this.left.depth>=Math.max(this.right.depth,i.depth)+1?new t(this.left,new t(this.right,i)):new t(this,i)},t})($t);const d1=500;class Se{constructor(t,e){this.items=t,this.eventCount=e}popEvent(t,e){if(this.eventCount==0)return null;let i=this.items.length;for(;;i--)if(this.items.get(i-1).selection){--i;break}let s,o;e&&(s=this.remapping(i,this.items.length),o=s.maps.length);let a=t.tr,c,u,h=[],f=[];return this.items.forEach((m,_)=>{if(!m.step){s||(s=this.remapping(i,_+1),o=s.maps.length),o--,f.push(m);return}if(s){f.push(new Ie(m.map));let y=m.step.map(s.slice(o)),v;y&&a.maybeStep(y).doc&&(v=a.mapping.maps[a.mapping.maps.length-1],h.push(new Ie(v,void 0,void 0,h.length+f.length))),o--,v&&s.appendMap(v,o)}else a.maybeStep(m.step);if(m.selection)return c=s?m.selection.map(s.slice(o)):m.selection,u=new Se(this.items.slice(0,i).append(f.reverse().concat(h)),this.eventCount-1),!1},this.items.length,0),{remaining:u,transform:a,selection:c}}addTransform(t,e,i,s){let o=[],a=this.eventCount,c=this.items,u=!s&&c.length?c.get(c.length-1):null;for(let f=0;f<t.steps.length;f++){let m=t.steps[f].invert(t.docs[f]),_=new Ie(t.mapping.maps[f],m,e),y;(y=u&&u.merge(_))&&(_=y,f?o.pop():c=c.slice(0,c.length-1)),o.push(_),e&&(a++,e=void 0),s||(u=_)}let h=a-i.depth;return h>f1&&(c=h1(c,h),a-=h),new Se(c.append(o),a)}remapping(t,e){let i=new Hi;return this.items.forEach((s,o)=>{let a=s.mirrorOffset!=null&&o-s.mirrorOffset>=t?i.maps.length-s.mirrorOffset:void 0;i.appendMap(s.map,a)},t,e),i}addMaps(t){return this.eventCount==0?this:new Se(this.items.append(t.map(e=>new Ie(e))),this.eventCount)}rebased(t,e){if(!this.eventCount)return this;let i=[],s=Math.max(0,this.items.length-e),o=t.mapping,a=t.steps.length,c=this.eventCount;this.items.forEach(_=>{_.selection&&c--},s);let u=e;this.items.forEach(_=>{let y=o.getMirror(--u);if(y==null)return;a=Math.min(a,y);let v=o.maps[y];if(_.step){let x=t.steps[y].invert(t.docs[y]),k=_.selection&&_.selection.map(o.slice(u+1,y));k&&c++,i.push(new Ie(v,x,k))}else i.push(new Ie(v))},s);let h=[];for(let _=e;_<a;_++)h.push(new Ie(o.maps[_]));let f=this.items.slice(0,s).append(h).append(i),m=new Se(f,c);return m.emptyItemCount()>d1&&(m=m.compress(this.items.length-i.length)),m}emptyItemCount(){let t=0;return this.items.forEach(e=>{e.step||t++}),t}compress(t=this.items.length){let e=this.remapping(0,t),i=e.maps.length,s=[],o=0;return this.items.forEach((a,c)=>{if(c>=t)s.push(a),a.selection&&o++;else if(a.step){let u=a.step.map(e.slice(i)),h=u&&u.getMap();if(i--,h&&e.appendMap(h,i),u){let f=a.selection&&a.selection.map(e.slice(i));f&&o++;let m=new Ie(h.invert(),u,f),_,y=s.length-1;(_=s.length&&s[y].merge(m))?s[y]=_:s.push(m)}}else a.map&&i--},this.items.length,0),new Se($t.from(s.reverse()),o)}}Se.empty=new Se($t.empty,0);function h1(n,t){let e;return n.forEach((i,s)=>{if(i.selection&&t--==0)return e=s,!1}),n.slice(e)}class Ie{constructor(t,e,i,s){this.map=t,this.step=e,this.selection=i,this.mirrorOffset=s}merge(t){if(this.step&&t.step&&!t.selection){let e=t.step.merge(this.step);if(e)return new Ie(e.getMap().invert(),e,this.selection)}}}class Xe{constructor(t,e,i,s,o){this.done=t,this.undone=e,this.prevRanges=i,this.prevTime=s,this.prevComposition=o}}const f1=20;function p1(n,t,e,i){let s=e.getMeta(On),o;if(s)return s.historyState;e.getMeta(_1)&&(n=new Xe(n.done,n.undone,null,0,-1));let a=e.getMeta("appendedTransaction");if(e.steps.length==0)return n;if(a&&a.getMeta(On))return a.getMeta(On).redo?new Xe(n.done.addTransform(e,void 0,i,Br(t)),n.undone,Cu(e.mapping.maps),n.prevTime,n.prevComposition):new Xe(n.done,n.undone.addTransform(e,void 0,i,Br(t)),null,n.prevTime,n.prevComposition);if(e.getMeta("addToHistory")!==!1&&!(a&&a.getMeta("addToHistory")===!1)){let c=e.getMeta("composition"),u=n.prevTime==0||!a&&n.prevComposition!=c&&(n.prevTime<(e.time||0)-i.newGroupDelay||!m1(e,n.prevRanges)),h=a?Ao(n.prevRanges,e.mapping):Cu(e.mapping.maps);return new Xe(n.done.addTransform(e,u?t.selection.getBookmark():void 0,i,Br(t)),Se.empty,h,e.time,c??n.prevComposition)}else return(o=e.getMeta("rebased"))?new Xe(n.done.rebased(e,o),n.undone.rebased(e,o),Ao(n.prevRanges,e.mapping),n.prevTime,n.prevComposition):new Xe(n.done.addMaps(e.mapping.maps),n.undone.addMaps(e.mapping.maps),Ao(n.prevRanges,e.mapping),n.prevTime,n.prevComposition)}function m1(n,t){if(!t)return!1;if(!n.docChanged)return!0;let e=!1;return n.mapping.maps[0].forEach((i,s)=>{for(let o=0;o<t.length;o+=2)i<=t[o+1]&&s>=t[o]&&(e=!0)}),e}function Cu(n){let t=[];for(let e=n.length-1;e>=0&&t.length==0;e--)n[e].forEach((i,s,o,a)=>t.push(o,a));return t}function Ao(n,t){if(!n)return null;let e=[];for(let i=0;i<n.length;i+=2){let s=t.map(n[i],1),o=t.map(n[i+1],-1);s<=o&&e.push(s,o)}return e}function g1(n,t,e){let i=Br(t),s=On.get(t).spec.config,o=(e?n.undone:n.done).popEvent(t,i);if(!o)return null;let a=o.selection.resolve(o.transform.doc),c=(e?n.done:n.undone).addTransform(o.transform,t.selection.getBookmark(),s,i),u=new Xe(e?c:o.remaining,e?o.remaining:c,null,0,-1);return o.transform.setSelection(a).setMeta(On,{redo:e,historyState:u})}let Io=!1,Tu=null;function Br(n){let t=n.plugins;if(Tu!=t){Io=!1,Tu=t;for(let e=0;e<t.length;e++)if(t[e].spec.historyPreserveItems){Io=!0;break}}return Io}const On=new Ct("history"),_1=new Ct("closeHistory");function y1(n={}){return n={depth:n.depth||100,newGroupDelay:n.newGroupDelay||500},new yt({key:On,state:{init(){return new Xe(Se.empty,Se.empty,null,0,-1)},apply(t,e,i){return p1(e,i,t,n)}},config:n,props:{handleDOMEvents:{beforeinput(t,e){let i=e.inputType,s=i=="historyUndo"?cf:i=="historyRedo"?uf:null;return s?(e.preventDefault(),s(t.state,t.dispatch)):!1}}}})}function lf(n,t){return(e,i)=>{let s=On.getState(e);if(!s||(n?s.undone:s.done).eventCount==0)return!1;if(i){let o=g1(s,e,n);o&&i(t?o.scrollIntoView():o)}return!0}}const cf=lf(!1,!0),uf=lf(!0,!0);zt.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:n=>n.length,wordCounter:n=>n.split(" ").filter(t=>t!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=n=>{const t=n?.node||this.editor.state.doc;if((n?.mode||this.options.mode)==="textSize"){const i=t.textBetween(0,t.content.size,void 0," ");return this.options.textCounter(i)}return t.nodeSize},this.storage.words=n=>{const t=n?.node||this.editor.state.doc,e=t.textBetween(0,t.content.size," "," ");return this.options.wordCounter(e)}},addProseMirrorPlugins(){let n=!1;return[new yt({key:new Ct("characterCount"),appendTransaction:(t,e,i)=>{if(n)return;const s=this.options.limit;if(s==null||s===0){n=!0;return}const o=this.storage.characters({node:i.doc});if(o>s){const a=o-s,c=0,u=a;console.warn(`[CharacterCount] Initial content exceeded limit of ${s} characters. Content was automatically trimmed.`);const h=i.tr.deleteRange(c,u);return n=!0,h}n=!0},filterTransaction:(t,e)=>{const i=this.options.limit;if(!t.docChanged||i===0||i===null||i===void 0)return!0;const s=this.storage.characters({node:e.doc}),o=this.storage.characters({node:t.doc});if(o<=i||s>i&&o>i&&o<=s)return!0;if(s>i&&o>i&&o>s||!t.getMeta("paste"))return!1;const c=t.selection.$head.pos,u=o-i,h=c-u,f=c;return t.deleteRange(h,f),!(this.storage.characters({node:t.doc})>i)}})]}});zt.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[e1(this.options)]}});zt.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new yt({key:new Ct("focus"),props:{decorations:({doc:n,selection:t})=>{const{isEditable:e,isFocused:i}=this.editor,{anchor:s}=t,o=[];if(!e||!i)return kt.create(n,[]);let a=0;this.options.mode==="deepest"&&n.descendants((u,h)=>{if(u.isText)return;if(!(s>=h&&s<=h+u.nodeSize-1))return!1;a+=1});let c=0;return n.descendants((u,h)=>{if(u.isText||!(s>=h&&s<=h+u.nodeSize-1))return!1;if(c+=1,this.options.mode==="deepest"&&a-c>0||this.options.mode==="shallowest"&&c>1)return this.options.mode==="deepest";o.push(Qt.node(h,h+u.nodeSize,{class:this.options.className}))}),kt.create(n,o)}}})]}});zt.create({name:"gapCursor",addProseMirrorPlugins(){return[s1()]},extendNodeSchema(n){var t;const e={name:n.name,options:n.options,storage:n.storage};return{allowGapCursor:(t=qe(ci(n,"allowGapCursor",e)))!=null?t:null}}});zt.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new yt({key:new Ct("placeholder"),props:{decorations:({doc:n,selection:t})=>{const e=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:i}=t,s=[];if(!e)return null;const o=this.editor.isEmpty;return n.descendants((a,c)=>{const u=i>=c&&i<=c+a.nodeSize,h=!a.isLeaf&&Ua(a);if((u||!this.options.showOnlyCurrent)&&h){const f=[this.options.emptyNodeClass];o&&f.push(this.options.emptyEditorClass);const m=Qt.node(c,c+a.nodeSize,{class:f.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:a,pos:c,hasAnchor:u}):this.options.placeholder});s.push(m)}return this.options.includeChildren}),kt.create(n,s)}}})]}});zt.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:n,options:t}=this;return[new yt({key:new Ct("selection"),props:{decorations(e){return e.selection.empty||n.isFocused||!n.isEditable||Hh(e.selection)||n.view.dragging?null:kt.create(e.doc,[Qt.inline(e.selection.from,e.selection.to,{class:t.className})])}}})]}});function Pu({types:n,node:t}){return t&&Array.isArray(n)&&n.includes(t.type)||t?.type===n}zt.create({name:"trailingNode",addOptions(){return{node:"paragraph",notAfter:[]}},addProseMirrorPlugins(){const n=new Ct(this.name),t=Object.entries(this.editor.schema.nodes).map(([,e])=>e).filter(e=>(this.options.notAfter||[]).concat(this.options.node).includes(e.name));return[new yt({key:n,appendTransaction:(e,i,s)=>{const{doc:o,tr:a,schema:c}=s,u=n.getState(s),h=o.content.size,f=c.nodes[this.options.node];if(u)return a.insert(h,f.create())},state:{init:(e,i)=>{const s=i.tr.doc.lastChild;return!Pu({node:s,types:t})},apply:(e,i)=>{if(!e.docChanged)return i;const s=e.doc.lastChild;return!Pu({node:s,types:t})}}})]}});var v1=zt.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:n,dispatch:t})=>cf(n,t),redo:()=>({state:n,dispatch:t})=>uf(n,t)}},addProseMirrorPlugins(){return[y1(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}});const b1={key:0,class:"editor"},x1={key:0,class:"flex items-center gap-0.5 rounded-sm mb-2"},w1={class:"bg-gray-300 p-0.5 rounded"},k1={class:"bg-gray-300 p-0.5 rounded"},S1={class:"bg-gray-300 p-0.5 rounded"},M1={class:"bg-gray-300 p-0.5 rounded"},C1={class:"bg-gray-300 p-0.5 rounded"},T1={class:"bg-gray-300 p-0.5 rounded"},Xa=_t({__name:"TiptapEditor",props:{modelValue:{},disabled:{type:Boolean},timer:{default:1e4}},emits:["update:modelValue"],setup(n,{emit:t}){const e=n,i=t,s=q(!1),o=Lb({content:e.modelValue,extensions:[C0,T0,P0,I0,B0,V0,H0,Xh,t1,Qh,v1,of,k0,M0],onUpdate:({editor:a})=>{s.value=!0,Tm(()=>{s.value=!1,i("update:modelValue",a.getHTML())},e.timer)}});return ra(()=>{w(o).destroy()}),he(()=>e.modelValue,()=>{o.value?.commands.setContent(e.modelValue),o.value?.setEditable(!e.disabled)}),he(()=>e.disabled,()=>{o.value?.setEditable(!e.disabled)}),xe(()=>{e.modelValue&&(o.value?.commands.setContent(e.modelValue),o.value?.setEditable(!e.disabled))}),(a,c)=>{const u=ce,h=Ob;return w(o)?(z(),K("div",b1,[a.disabled?bt("",!0):(z(),K("div",x1,[D("div",w1,[S(u,{size:"sm",variant:"ghost",onClick:c[0]||(c[0]=f=>w(o).chain().focus().toggleBold().run()),disabled:!w(o).can().chain().focus().toggleBold().run(),class:Xt({"is-active":w(o).isActive("bold")})},{default:T(()=>[S(w(lm))]),_:1},8,["disabled","class"]),S(u,{size:"sm",variant:"ghost",onClick:c[1]||(c[1]=f=>w(o).chain().focus().toggleItalic().run()),disabled:!w(o).can().chain().focus().toggleItalic().run(),class:Xt({"is-active":w(o).isActive("italic")})},{default:T(()=>[S(w(cm))]),_:1},8,["disabled","class"]),S(u,{size:"sm",variant:"ghost",onClick:c[2]||(c[2]=f=>w(o).chain().focus().toggleUnderline().run()),disabled:!w(o).can().chain().focus().toggleUnderline().run(),class:Xt({"is-active":w(o).isActive("underline")})},{default:T(()=>[S(w(um))]),_:1},8,["disabled","class"]),S(u,{size:"sm",variant:"ghost",onClick:c[3]||(c[3]=f=>w(o).chain().focus().toggleStrike().run()),disabled:!w(o).can().chain().focus().toggleStrike().run(),class:Xt({"is-active":w(o).isActive("strike")})},{default:T(()=>[S(w(dm))]),_:1},8,["disabled","class"])]),D("div",k1,[S(u,{size:"sm",variant:"ghost",onClick:c[4]||(c[4]=f=>w(o).chain().focus().unsetAllMarks().run())},{default:T(()=>[S(w(Fi))]),_:1}),S(u,{size:"sm",variant:"ghost",onClick:c[5]||(c[5]=f=>w(o).chain().focus().clearNodes().run())},{default:T(()=>[S(w(hm))]),_:1}),S(u,{size:"sm",variant:"ghost",onClick:c[6]||(c[6]=f=>w(o).chain().focus().setParagraph().run()),class:Xt({"is-active":w(o).isActive("paragraph")})},{default:T(()=>[S(w(fm))]),_:1},8,["class"])]),D("div",S1,[S(u,{size:"sm",variant:"ghost",onClick:c[7]||(c[7]=f=>w(o).chain().focus().toggleHeading({level:1}).run()),class:Xt({"is-active":w(o).isActive("heading",{level:1})})},{default:T(()=>[S(w(pm))]),_:1},8,["class"]),S(u,{size:"sm",variant:"ghost",onClick:c[8]||(c[8]=f=>w(o).chain().focus().toggleHeading({level:2}).run()),class:Xt({"is-active":w(o).isActive("heading",{level:2})})},{default:T(()=>[S(w(mm))]),_:1},8,["class"]),S(u,{size:"sm",variant:"ghost",onClick:c[9]||(c[9]=f=>w(o).chain().focus().toggleHeading({level:3}).run()),class:Xt({"is-active":w(o).isActive("heading",{level:3})})},{default:T(()=>[S(w(gm))]),_:1},8,["class"]),S(u,{size:"sm",variant:"ghost",onClick:c[10]||(c[10]=f=>w(o).chain().focus().toggleHeading({level:4}).run()),class:Xt({"is-active":w(o).isActive("heading",{level:4})})},{default:T(()=>[S(w(_m))]),_:1},8,["class"]),S(u,{size:"sm",variant:"ghost",onClick:c[11]||(c[11]=f=>w(o).chain().focus().toggleHeading({level:5}).run()),class:Xt({"is-active":w(o).isActive("heading",{level:5})})},{default:T(()=>[S(w(ym))]),_:1},8,["class"]),S(u,{size:"sm",variant:"ghost",onClick:c[12]||(c[12]=f=>w(o).chain().focus().toggleHeading({level:6}).run()),class:Xt({"is-active":w(o).isActive("heading",{level:6})})},{default:T(()=>[S(w(vm))]),_:1},8,["class"])]),D("div",M1,[S(u,{size:"sm",variant:"ghost",onClick:c[13]||(c[13]=f=>w(o).chain().focus().toggleBulletList().run()),class:Xt({"is-active":w(o).isActive("bulletList")})},{default:T(()=>[S(w(bm))]),_:1},8,["class"]),S(u,{size:"sm",variant:"ghost",onClick:c[14]||(c[14]=f=>w(o).chain().focus().toggleOrderedList().run()),class:Xt({"is-active":w(o).isActive("orderedList")})},{default:T(()=>[S(w(xm))]),_:1},8,["class"])]),D("div",C1,[S(u,{size:"sm",variant:"ghost",onClick:c[15]||(c[15]=f=>w(o).chain().focus().toggleBlockquote().run()),class:Xt({"is-active":w(o).isActive("blockquote")})},{default:T(()=>[S(w(wm))]),_:1},8,["class"]),S(u,{size:"sm",variant:"ghost",onClick:c[16]||(c[16]=f=>w(o).chain().focus().setHorizontalRule().run())},{default:T(()=>[S(w(zu))]),_:1})]),D("div",T1,[S(u,{size:"sm",variant:"ghost",onClick:c[17]||(c[17]=f=>w(o).chain().focus().undo().run()),disabled:!w(o).can().chain().focus().undo().run()},{default:T(()=>[S(w(km))]),_:1},8,["disabled"]),S(u,{size:"sm",variant:"ghost",onClick:c[18]||(c[18]=f=>w(o).chain().focus().redo().run()),disabled:!w(o).can().chain().focus().redo().run()},{default:T(()=>[S(w(Sm))]),_:1},8,["disabled"])]),w(s)?(z(),tt(w(Ru),{key:0,class:"text-green-600 animate-spin",size:16})):bt("",!0)])),S(h,{class:"content_editor p-3 bg-gray-100 text-gray-600 rounded-sm focus:outline-0",editor:w(o)},null,8,["editor"])])):bt("",!0)}}}),P1={class:"mb-2"},E1={class:"flex"},O1={class:"flex gap-1 text-sm items-center"},L1={key:1,class:"text-green-700 flex gap-0.5 items-center"},A1=_t({__name:"description",props:{trailRace:{}},emits:["update"],setup(n,{emit:t}){const e=n,i=t,s=Iu(),{saveDescription:o}=Nu(),{can:a}=Lu(),c=q(""),u=q(!1),h=q(!1);return he(c,async f=>{f!==e.trailRace?.description&&(u.value=!0,await o(s.params.id,c.value),i("update"),u.value=!1,h.value=!0)}),he(()=>e.trailRace,()=>{e.trailRace&&(c.value=e.trailRace.description||"")}),he(h,()=>{h.value&&setTimeout(()=>{h.value=!1},2e3)}),xe(()=>{e.trailRace&&(c.value=e.trailRace.description||"")}),(f,m)=>{const _=Xa;return z(),K("div",P1,[D("div",E1,[m[2]||(m[2]=D("h2",{class:"text-xs uppercase grow mb-2"},"Description",-1)),D("div",O1,[w(u)?(z(),tt(w(fi),{key:0,class:"loading",size:16})):bt("",!0),w(h)?(z(),K("span",L1,[S(w(hi),{size:16}),m[1]||(m[1]=Z(" saved ",-1))])):bt("",!0)])]),S(_,{modelValue:w(c),"onUpdate:modelValue":m[0]||(m[0]=y=>tm(c)?c.value=y:null),disabled:w(u)||!w(a)("event_edit")},null,8,["modelValue","disabled"])])}}});var Di={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */var I1=Di.exports,Eu;function N1(){return Eu||(Eu=1,(function(n,t){(function(e,i){i(t)})(I1,(function(e){var i="1.9.4";function s(r){var l,d,p,g;for(d=1,p=arguments.length;d<p;d++){g=arguments[d];for(l in g)r[l]=g[l]}return r}var o=Object.create||(function(){function r(){}return function(l){return r.prototype=l,new r}})();function a(r,l){var d=Array.prototype.slice;if(r.bind)return r.bind.apply(r,d.call(arguments,1));var p=d.call(arguments,2);return function(){return r.apply(l,p.length?p.concat(d.call(arguments)):arguments)}}var c=0;function u(r){return"_leaflet_id"in r||(r._leaflet_id=++c),r._leaflet_id}function h(r,l,d){var p,g,b,M;return M=function(){p=!1,g&&(b.apply(d,g),g=!1)},b=function(){p?g=arguments:(r.apply(d,arguments),setTimeout(M,l),p=!0)},b}function f(r,l,d){var p=l[1],g=l[0],b=p-g;return r===p&&d?r:((r-g)%b+b)%b+g}function m(){return!1}function _(r,l){if(l===!1)return r;var d=Math.pow(10,l===void 0?6:l);return Math.round(r*d)/d}function y(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")}function v(r){return y(r).split(/\s+/)}function x(r,l){Object.prototype.hasOwnProperty.call(r,"options")||(r.options=r.options?o(r.options):{});for(var d in l)r.options[d]=l[d];return r.options}function k(r,l,d){var p=[];for(var g in r)p.push(encodeURIComponent(d?g.toUpperCase():g)+"="+encodeURIComponent(r[g]));return(!l||l.indexOf("?")===-1?"?":"&")+p.join("&")}var C=/\{ *([\w_ -]+) *\}/g;function O(r,l){return r.replace(C,function(d,p){var g=l[p];if(g===void 0)throw new Error("No value provided for variable "+d);return typeof g=="function"&&(g=g(l)),g})}var N=Array.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"};function V(r,l){for(var d=0;d<r.length;d++)if(r[d]===l)return d;return-1}var F="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function et(r){return window["webkit"+r]||window["moz"+r]||window["ms"+r]}var ot=0;function R(r){var l=+new Date,d=Math.max(0,16-(l-ot));return ot=l+d,window.setTimeout(r,d)}var ut=window.requestAnimationFrame||et("RequestAnimationFrame")||R,xt=window.cancelAnimationFrame||et("CancelAnimationFrame")||et("CancelRequestAnimationFrame")||function(r){window.clearTimeout(r)};function Tt(r,l,d){if(d&&ut===R)r.call(l);else return ut.call(window,a(r,l))}function Ut(r){r&&xt.call(window,r)}var mi={__proto__:null,extend:s,create:o,bind:a,get lastId(){return c},stamp:u,throttle:h,wrapNum:f,falseFn:m,formatNum:_,trim:y,splitWords:v,setOptions:x,getParamString:k,template:O,isArray:N,indexOf:V,emptyImageUrl:F,requestFn:ut,cancelFn:xt,requestAnimFrame:Tt,cancelAnimFrame:Ut};function ue(){}ue.extend=function(r){var l=function(){x(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},d=l.__super__=this.prototype,p=o(d);p.constructor=l,l.prototype=p;for(var g in this)Object.prototype.hasOwnProperty.call(this,g)&&g!=="prototype"&&g!=="__super__"&&(l[g]=this[g]);return r.statics&&s(l,r.statics),r.includes&&(gi(r.includes),s.apply(null,[p].concat(r.includes))),s(p,r),delete p.statics,delete p.includes,p.options&&(p.options=d.options?o(d.options):{},s(p.options,r.options)),p._initHooks=[],p.callInitHooks=function(){if(!this._initHooksCalled){d.callInitHooks&&d.callInitHooks.call(this),this._initHooksCalled=!0;for(var b=0,M=p._initHooks.length;b<M;b++)p._initHooks[b].call(this)}},l},ue.include=function(r){var l=this.prototype.options;return s(this.prototype,r),r.options&&(this.prototype.options=l,this.mergeOptions(r.options)),this},ue.mergeOptions=function(r){return s(this.prototype.options,r),this},ue.addInitHook=function(r){var l=Array.prototype.slice.call(arguments,1),d=typeof r=="function"?r:function(){this[r].apply(this,l)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(d),this};function gi(r){if(!(typeof L>"u"||!L||!L.Mixin)){r=N(r)?r:[r];for(var l=0;l<r.length;l++)r[l]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var Zt={on:function(r,l,d){if(typeof r=="object")for(var p in r)this._on(p,r[p],l);else{r=v(r);for(var g=0,b=r.length;g<b;g++)this._on(r[g],l,d)}return this},off:function(r,l,d){if(!arguments.length)delete this._events;else if(typeof r=="object")for(var p in r)this._off(p,r[p],l);else{r=v(r);for(var g=arguments.length===1,b=0,M=r.length;b<M;b++)g?this._off(r[b]):this._off(r[b],l,d)}return this},_on:function(r,l,d,p){if(typeof l!="function"){console.warn("wrong listener type: "+typeof l);return}if(this._listens(r,l,d)===!1){d===this&&(d=void 0);var g={fn:l,ctx:d};p&&(g.once=!0),this._events=this._events||{},this._events[r]=this._events[r]||[],this._events[r].push(g)}},_off:function(r,l,d){var p,g,b;if(this._events&&(p=this._events[r],!!p)){if(arguments.length===1){if(this._firingCount)for(g=0,b=p.length;g<b;g++)p[g].fn=m;delete this._events[r];return}if(typeof l!="function"){console.warn("wrong listener type: "+typeof l);return}var M=this._listens(r,l,d);if(M!==!1){var P=p[M];this._firingCount&&(P.fn=m,this._events[r]=p=p.slice()),p.splice(M,1)}}},fire:function(r,l,d){if(!this.listens(r,d))return this;var p=s({},l,{type:r,target:this,sourceTarget:l&&l.sourceTarget||this});if(this._events){var g=this._events[r];if(g){this._firingCount=this._firingCount+1||1;for(var b=0,M=g.length;b<M;b++){var P=g[b],E=P.fn;P.once&&this.off(r,E,P.ctx),E.call(P.ctx||this,p)}this._firingCount--}}return d&&this._propagateEvent(p),this},listens:function(r,l,d,p){typeof r!="string"&&console.warn('"string" type argument expected');var g=l;typeof l!="function"&&(p=!!l,g=void 0,d=void 0);var b=this._events&&this._events[r];if(b&&b.length&&this._listens(r,g,d)!==!1)return!0;if(p){for(var M in this._eventParents)if(this._eventParents[M].listens(r,l,d,p))return!0}return!1},_listens:function(r,l,d){if(!this._events)return!1;var p=this._events[r]||[];if(!l)return!!p.length;d===this&&(d=void 0);for(var g=0,b=p.length;g<b;g++)if(p[g].fn===l&&p[g].ctx===d)return g;return!1},once:function(r,l,d){if(typeof r=="object")for(var p in r)this._on(p,r[p],l,!0);else{r=v(r);for(var g=0,b=r.length;g<b;g++)this._on(r[g],l,d,!0)}return this},addEventParent:function(r){return this._eventParents=this._eventParents||{},this._eventParents[u(r)]=r,this},removeEventParent:function(r){return this._eventParents&&delete this._eventParents[u(r)],this},_propagateEvent:function(r){for(var l in this._eventParents)this._eventParents[l].fire(r.type,s({layer:r.target,propagatedFrom:r.target},r),!0)}};Zt.addEventListener=Zt.on,Zt.removeEventListener=Zt.clearAllEventListeners=Zt.off,Zt.addOneTimeEventListener=Zt.once,Zt.fireEvent=Zt.fire,Zt.hasEventListeners=Zt.listens;var dt=ue.extend(Zt);function J(r,l,d){this.x=d?Math.round(r):r,this.y=d?Math.round(l):l}var rr=Math.trunc||function(r){return r>0?Math.floor(r):Math.ceil(r)};J.prototype={clone:function(){return new J(this.x,this.y)},add:function(r){return this.clone()._add(X(r))},_add:function(r){return this.x+=r.x,this.y+=r.y,this},subtract:function(r){return this.clone()._subtract(X(r))},_subtract:function(r){return this.x-=r.x,this.y-=r.y,this},divideBy:function(r){return this.clone()._divideBy(r)},_divideBy:function(r){return this.x/=r,this.y/=r,this},multiplyBy:function(r){return this.clone()._multiplyBy(r)},_multiplyBy:function(r){return this.x*=r,this.y*=r,this},scaleBy:function(r){return new J(this.x*r.x,this.y*r.y)},unscaleBy:function(r){return new J(this.x/r.x,this.y/r.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=rr(this.x),this.y=rr(this.y),this},distanceTo:function(r){r=X(r);var l=r.x-this.x,d=r.y-this.y;return Math.sqrt(l*l+d*d)},equals:function(r){return r=X(r),r.x===this.x&&r.y===this.y},contains:function(r){return r=X(r),Math.abs(r.x)<=Math.abs(this.x)&&Math.abs(r.y)<=Math.abs(this.y)},toString:function(){return"Point("+_(this.x)+", "+_(this.y)+")"}};function X(r,l,d){return r instanceof J?r:N(r)?new J(r[0],r[1]):r==null?r:typeof r=="object"&&"x"in r&&"y"in r?new J(r.x,r.y):new J(r,l,d)}function G(r,l){if(r)for(var d=l?[r,l]:r,p=0,g=d.length;p<g;p++)this.extend(d[p])}G.prototype={extend:function(r){var l,d;if(!r)return this;if(r instanceof J||typeof r[0]=="number"||"x"in r)l=d=X(r);else if(r=At(r),l=r.min,d=r.max,!l||!d)return this;return!this.min&&!this.max?(this.min=l.clone(),this.max=d.clone()):(this.min.x=Math.min(l.x,this.min.x),this.max.x=Math.max(d.x,this.max.x),this.min.y=Math.min(l.y,this.min.y),this.max.y=Math.max(d.y,this.max.y)),this},getCenter:function(r){return X((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,r)},getBottomLeft:function(){return X(this.min.x,this.max.y)},getTopRight:function(){return X(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(r){var l,d;return typeof r[0]=="number"||r instanceof J?r=X(r):r=At(r),r instanceof G?(l=r.min,d=r.max):l=d=r,l.x>=this.min.x&&d.x<=this.max.x&&l.y>=this.min.y&&d.y<=this.max.y},intersects:function(r){r=At(r);var l=this.min,d=this.max,p=r.min,g=r.max,b=g.x>=l.x&&p.x<=d.x,M=g.y>=l.y&&p.y<=d.y;return b&&M},overlaps:function(r){r=At(r);var l=this.min,d=this.max,p=r.min,g=r.max,b=g.x>l.x&&p.x<d.x,M=g.y>l.y&&p.y<d.y;return b&&M},isValid:function(){return!!(this.min&&this.max)},pad:function(r){var l=this.min,d=this.max,p=Math.abs(l.x-d.x)*r,g=Math.abs(l.y-d.y)*r;return At(X(l.x-p,l.y-g),X(d.x+p,d.y+g))},equals:function(r){return r?(r=At(r),this.min.equals(r.getTopLeft())&&this.max.equals(r.getBottomRight())):!1}};function At(r,l){return!r||r instanceof G?r:new G(r,l)}function ie(r,l){if(r)for(var d=l?[r,l]:r,p=0,g=d.length;p<g;p++)this.extend(d[p])}ie.prototype={extend:function(r){var l=this._southWest,d=this._northEast,p,g;if(r instanceof ft)p=r,g=r;else if(r instanceof ie){if(p=r._southWest,g=r._northEast,!p||!g)return this}else return r?this.extend(at(r)||Pt(r)):this;return!l&&!d?(this._southWest=new ft(p.lat,p.lng),this._northEast=new ft(g.lat,g.lng)):(l.lat=Math.min(p.lat,l.lat),l.lng=Math.min(p.lng,l.lng),d.lat=Math.max(g.lat,d.lat),d.lng=Math.max(g.lng,d.lng)),this},pad:function(r){var l=this._southWest,d=this._northEast,p=Math.abs(l.lat-d.lat)*r,g=Math.abs(l.lng-d.lng)*r;return new ie(new ft(l.lat-p,l.lng-g),new ft(d.lat+p,d.lng+g))},getCenter:function(){return new ft((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new ft(this.getNorth(),this.getWest())},getSouthEast:function(){return new ft(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(r){typeof r[0]=="number"||r instanceof ft||"lat"in r?r=at(r):r=Pt(r);var l=this._southWest,d=this._northEast,p,g;return r instanceof ie?(p=r.getSouthWest(),g=r.getNorthEast()):p=g=r,p.lat>=l.lat&&g.lat<=d.lat&&p.lng>=l.lng&&g.lng<=d.lng},intersects:function(r){r=Pt(r);var l=this._southWest,d=this._northEast,p=r.getSouthWest(),g=r.getNorthEast(),b=g.lat>=l.lat&&p.lat<=d.lat,M=g.lng>=l.lng&&p.lng<=d.lng;return b&&M},overlaps:function(r){r=Pt(r);var l=this._southWest,d=this._northEast,p=r.getSouthWest(),g=r.getNorthEast(),b=g.lat>l.lat&&p.lat<d.lat,M=g.lng>l.lng&&p.lng<d.lng;return b&&M},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(r,l){return r?(r=Pt(r),this._southWest.equals(r.getSouthWest(),l)&&this._northEast.equals(r.getNorthEast(),l)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function Pt(r,l){return r instanceof ie?r:new ie(r,l)}function ft(r,l,d){if(isNaN(r)||isNaN(l))throw new Error("Invalid LatLng object: ("+r+", "+l+")");this.lat=+r,this.lng=+l,d!==void 0&&(this.alt=+d)}ft.prototype={equals:function(r,l){if(!r)return!1;r=at(r);var d=Math.max(Math.abs(this.lat-r.lat),Math.abs(this.lng-r.lng));return d<=(l===void 0?1e-9:l)},toString:function(r){return"LatLng("+_(this.lat,r)+", "+_(this.lng,r)+")"},distanceTo:function(r){return Ue.distance(this,at(r))},wrap:function(){return Ue.wrapLatLng(this)},toBounds:function(r){var l=180*r/40075017,d=l/Math.cos(Math.PI/180*this.lat);return Pt([this.lat-l,this.lng-d],[this.lat+l,this.lng+d])},clone:function(){return new ft(this.lat,this.lng,this.alt)}};function at(r,l,d){return r instanceof ft?r:N(r)&&typeof r[0]!="object"?r.length===3?new ft(r[0],r[1],r[2]):r.length===2?new ft(r[0],r[1]):null:r==null?r:typeof r=="object"&&"lat"in r?new ft(r.lat,"lng"in r?r.lng:r.lon,r.alt):l===void 0?null:new ft(r,l,d)}var Re={latLngToPoint:function(r,l){var d=this.projection.project(r),p=this.scale(l);return this.transformation._transform(d,p)},pointToLatLng:function(r,l){var d=this.scale(l),p=this.transformation.untransform(r,d);return this.projection.unproject(p)},project:function(r){return this.projection.project(r)},unproject:function(r){return this.projection.unproject(r)},scale:function(r){return 256*Math.pow(2,r)},zoom:function(r){return Math.log(r/256)/Math.LN2},getProjectedBounds:function(r){if(this.infinite)return null;var l=this.projection.bounds,d=this.scale(r),p=this.transformation.transform(l.min,d),g=this.transformation.transform(l.max,d);return new G(p,g)},infinite:!1,wrapLatLng:function(r){var l=this.wrapLng?f(r.lng,this.wrapLng,!0):r.lng,d=this.wrapLat?f(r.lat,this.wrapLat,!0):r.lat,p=r.alt;return new ft(d,l,p)},wrapLatLngBounds:function(r){var l=r.getCenter(),d=this.wrapLatLng(l),p=l.lat-d.lat,g=l.lng-d.lng;if(p===0&&g===0)return r;var b=r.getSouthWest(),M=r.getNorthEast(),P=new ft(b.lat-p,b.lng-g),E=new ft(M.lat-p,M.lng-g);return new ie(P,E)}},Ue=s({},Re,{wrapLng:[-180,180],R:6371e3,distance:function(r,l){var d=Math.PI/180,p=r.lat*d,g=l.lat*d,b=Math.sin((l.lat-r.lat)*d/2),M=Math.sin((l.lng-r.lng)*d/2),P=b*b+Math.cos(p)*Math.cos(g)*M*M,E=2*Math.atan2(Math.sqrt(P),Math.sqrt(1-P));return this.R*E}}),Qa=6378137,Es={R:Qa,MAX_LATITUDE:85.0511287798,project:function(r){var l=Math.PI/180,d=this.MAX_LATITUDE,p=Math.max(Math.min(d,r.lat),-d),g=Math.sin(p*l);return new J(this.R*r.lng*l,this.R*Math.log((1+g)/(1-g))/2)},unproject:function(r){var l=180/Math.PI;return new ft((2*Math.atan(Math.exp(r.y/this.R))-Math.PI/2)*l,r.x*l/this.R)},bounds:(function(){var r=Qa*Math.PI;return new G([-r,-r],[r,r])})()};function Os(r,l,d,p){if(N(r)){this._a=r[0],this._b=r[1],this._c=r[2],this._d=r[3];return}this._a=r,this._b=l,this._c=d,this._d=p}Os.prototype={transform:function(r,l){return this._transform(r.clone(),l)},_transform:function(r,l){return l=l||1,r.x=l*(this._a*r.x+this._b),r.y=l*(this._c*r.y+this._d),r},untransform:function(r,l){return l=l||1,new J((r.x/l-this._b)/this._a,(r.y/l-this._d)/this._c)}};function _i(r,l,d,p){return new Os(r,l,d,p)}var Ls=s({},Ue,{code:"EPSG:3857",projection:Es,transformation:(function(){var r=.5/(Math.PI*Es.R);return _i(r,.5,-r,.5)})()}),ff=s({},Ls,{code:"EPSG:900913"});function tl(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function el(r,l){var d="",p,g,b,M,P,E;for(p=0,b=r.length;p<b;p++){for(P=r[p],g=0,M=P.length;g<M;g++)E=P[g],d+=(g?"L":"M")+E.x+" "+E.y;d+=l?W.svg?"z":"x":""}return d||"M0 0"}var As=document.documentElement.style,sr="ActiveXObject"in window,pf=sr&&!document.addEventListener,nl="msLaunchUri"in navigator&&!("documentMode"in document),Is=Ee("webkit"),il=Ee("android"),rl=Ee("android 2")||Ee("android 3"),mf=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),gf=il&&Ee("Google")&&mf<537&&!("AudioNode"in window),Ns=!!window.opera,sl=!nl&&Ee("chrome"),ol=Ee("gecko")&&!Is&&!Ns&&!sr,_f=!sl&&Ee("safari"),al=Ee("phantom"),ll="OTransition"in As,yf=navigator.platform.indexOf("Win")===0,cl=sr&&"transition"in As,Ds="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!rl,ul="MozPerspective"in As,vf=!window.L_DISABLE_3D&&(cl||Ds||ul)&&!ll&&!al,yi=typeof orientation<"u"||Ee("mobile"),bf=yi&&Is,xf=yi&&Ds,dl=!window.PointerEvent&&window.MSPointerEvent,hl=!!(window.PointerEvent||dl),fl="ontouchstart"in window||!!window.TouchEvent,wf=!window.L_NO_TOUCH&&(fl||hl),kf=yi&&Ns,Sf=yi&&ol,Mf=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Cf=(function(){var r=!1;try{var l=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("testPassiveEventSupport",m,l),window.removeEventListener("testPassiveEventSupport",m,l)}catch{}return r})(),Tf=(function(){return!!document.createElement("canvas").getContext})(),zs=!!(document.createElementNS&&tl("svg").createSVGRect),Pf=!!zs&&(function(){var r=document.createElement("div");return r.innerHTML="<svg/>",(r.firstChild&&r.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),Ef=!zs&&(function(){try{var r=document.createElement("div");r.innerHTML='<v:shape adj="1"/>';var l=r.firstChild;return l.style.behavior="url(#default#VML)",l&&typeof l.adj=="object"}catch{return!1}})(),Of=navigator.platform.indexOf("Mac")===0,Lf=navigator.platform.indexOf("Linux")===0;function Ee(r){return navigator.userAgent.toLowerCase().indexOf(r)>=0}var W={ie:sr,ielt9:pf,edge:nl,webkit:Is,android:il,android23:rl,androidStock:gf,opera:Ns,chrome:sl,gecko:ol,safari:_f,phantom:al,opera12:ll,win:yf,ie3d:cl,webkit3d:Ds,gecko3d:ul,any3d:vf,mobile:yi,mobileWebkit:bf,mobileWebkit3d:xf,msPointer:dl,pointer:hl,touch:wf,touchNative:fl,mobileOpera:kf,mobileGecko:Sf,retina:Mf,passiveEvents:Cf,canvas:Tf,svg:zs,vml:Ef,inlineSvg:Pf,mac:Of,linux:Lf},pl=W.msPointer?"MSPointerDown":"pointerdown",ml=W.msPointer?"MSPointerMove":"pointermove",gl=W.msPointer?"MSPointerUp":"pointerup",_l=W.msPointer?"MSPointerCancel":"pointercancel",Rs={touchstart:pl,touchmove:ml,touchend:gl,touchcancel:_l},yl={touchstart:Rf,touchmove:or,touchend:or,touchcancel:or},Vn={},vl=!1;function Af(r,l,d){return l==="touchstart"&&zf(),yl[l]?(d=yl[l].bind(this,d),r.addEventListener(Rs[l],d,!1),d):(console.warn("wrong event specified:",l),m)}function If(r,l,d){if(!Rs[l]){console.warn("wrong event specified:",l);return}r.removeEventListener(Rs[l],d,!1)}function Nf(r){Vn[r.pointerId]=r}function Df(r){Vn[r.pointerId]&&(Vn[r.pointerId]=r)}function bl(r){delete Vn[r.pointerId]}function zf(){vl||(document.addEventListener(pl,Nf,!0),document.addEventListener(ml,Df,!0),document.addEventListener(gl,bl,!0),document.addEventListener(_l,bl,!0),vl=!0)}function or(r,l){if(l.pointerType!==(l.MSPOINTER_TYPE_MOUSE||"mouse")){l.touches=[];for(var d in Vn)l.touches.push(Vn[d]);l.changedTouches=[l],r(l)}}function Rf(r,l){l.MSPOINTER_TYPE_TOUCH&&l.pointerType===l.MSPOINTER_TYPE_TOUCH&&Ht(l),or(r,l)}function Bf(r){var l={},d,p;for(p in r)d=r[p],l[p]=d&&d.bind?d.bind(r):d;return r=l,l.type="dblclick",l.detail=2,l.isTrusted=!1,l._simulated=!0,l}var $f=200;function Ff(r,l){r.addEventListener("dblclick",l);var d=0,p;function g(b){if(b.detail!==1){p=b.detail;return}if(!(b.pointerType==="mouse"||b.sourceCapabilities&&!b.sourceCapabilities.firesTouchEvents)){var M=Ml(b);if(!(M.some(function(E){return E instanceof HTMLLabelElement&&E.attributes.for})&&!M.some(function(E){return E instanceof HTMLInputElement||E instanceof HTMLSelectElement}))){var P=Date.now();P-d<=$f?(p++,p===2&&l(Bf(b))):p=1,d=P}}}return r.addEventListener("click",g),{dblclick:l,simDblclick:g}}function Vf(r,l){r.removeEventListener("dblclick",l.dblclick),r.removeEventListener("click",l.simDblclick)}var Bs=cr(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),vi=cr(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),xl=vi==="webkitTransition"||vi==="OTransition"?vi+"End":"transitionend";function wl(r){return typeof r=="string"?document.getElementById(r):r}function bi(r,l){var d=r.style[l]||r.currentStyle&&r.currentStyle[l];if((!d||d==="auto")&&document.defaultView){var p=document.defaultView.getComputedStyle(r,null);d=p?p[l]:null}return d==="auto"?null:d}function ct(r,l,d){var p=document.createElement(r);return p.className=l||"",d&&d.appendChild(p),p}function wt(r){var l=r.parentNode;l&&l.removeChild(r)}function ar(r){for(;r.firstChild;)r.removeChild(r.firstChild)}function Zn(r){var l=r.parentNode;l&&l.lastChild!==r&&l.appendChild(r)}function Hn(r){var l=r.parentNode;l&&l.firstChild!==r&&l.insertBefore(r,l.firstChild)}function $s(r,l){if(r.classList!==void 0)return r.classList.contains(l);var d=lr(r);return d.length>0&&new RegExp("(^|\\s)"+l+"(\\s|$)").test(d)}function it(r,l){if(r.classList!==void 0)for(var d=v(l),p=0,g=d.length;p<g;p++)r.classList.add(d[p]);else if(!$s(r,l)){var b=lr(r);Fs(r,(b?b+" ":"")+l)}}function Mt(r,l){r.classList!==void 0?r.classList.remove(l):Fs(r,y((" "+lr(r)+" ").replace(" "+l+" "," ")))}function Fs(r,l){r.className.baseVal===void 0?r.className=l:r.className.baseVal=l}function lr(r){return r.correspondingElement&&(r=r.correspondingElement),r.className.baseVal===void 0?r.className:r.className.baseVal}function pe(r,l){"opacity"in r.style?r.style.opacity=l:"filter"in r.style&&Zf(r,l)}function Zf(r,l){var d=!1,p="DXImageTransform.Microsoft.Alpha";try{d=r.filters.item(p)}catch{if(l===1)return}l=Math.round(l*100),d?(d.Enabled=l!==100,d.Opacity=l):r.style.filter+=" progid:"+p+"(opacity="+l+")"}function cr(r){for(var l=document.documentElement.style,d=0;d<r.length;d++)if(r[d]in l)return r[d];return!1}function pn(r,l,d){var p=l||new J(0,0);r.style[Bs]=(W.ie3d?"translate("+p.x+"px,"+p.y+"px)":"translate3d("+p.x+"px,"+p.y+"px,0)")+(d?" scale("+d+")":"")}function Et(r,l){r._leaflet_pos=l,W.any3d?pn(r,l):(r.style.left=l.x+"px",r.style.top=l.y+"px")}function mn(r){return r._leaflet_pos||new J(0,0)}var xi,wi,Vs;if("onselectstart"in document)xi=function(){nt(window,"selectstart",Ht)},wi=function(){mt(window,"selectstart",Ht)};else{var ki=cr(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);xi=function(){if(ki){var r=document.documentElement.style;Vs=r[ki],r[ki]="none"}},wi=function(){ki&&(document.documentElement.style[ki]=Vs,Vs=void 0)}}function Zs(){nt(window,"dragstart",Ht)}function Hs(){mt(window,"dragstart",Ht)}var ur,Ws;function js(r){for(;r.tabIndex===-1;)r=r.parentNode;r.style&&(dr(),ur=r,Ws=r.style.outlineStyle,r.style.outlineStyle="none",nt(window,"keydown",dr))}function dr(){ur&&(ur.style.outlineStyle=Ws,ur=void 0,Ws=void 0,mt(window,"keydown",dr))}function kl(r){do r=r.parentNode;while((!r.offsetWidth||!r.offsetHeight)&&r!==document.body);return r}function qs(r){var l=r.getBoundingClientRect();return{x:l.width/r.offsetWidth||1,y:l.height/r.offsetHeight||1,boundingClientRect:l}}var Hf={__proto__:null,TRANSFORM:Bs,TRANSITION:vi,TRANSITION_END:xl,get:wl,getStyle:bi,create:ct,remove:wt,empty:ar,toFront:Zn,toBack:Hn,hasClass:$s,addClass:it,removeClass:Mt,setClass:Fs,getClass:lr,setOpacity:pe,testProp:cr,setTransform:pn,setPosition:Et,getPosition:mn,get disableTextSelection(){return xi},get enableTextSelection(){return wi},disableImageDrag:Zs,enableImageDrag:Hs,preventOutline:js,restoreOutline:dr,getSizedParentNode:kl,getScale:qs};function nt(r,l,d,p){if(l&&typeof l=="object")for(var g in l)Ks(r,g,l[g],d);else{l=v(l);for(var b=0,M=l.length;b<M;b++)Ks(r,l[b],d,p)}return this}var Oe="_leaflet_events";function mt(r,l,d,p){if(arguments.length===1)Sl(r),delete r[Oe];else if(l&&typeof l=="object")for(var g in l)Js(r,g,l[g],d);else if(l=v(l),arguments.length===2)Sl(r,function(P){return V(l,P)!==-1});else for(var b=0,M=l.length;b<M;b++)Js(r,l[b],d,p);return this}function Sl(r,l){for(var d in r[Oe]){var p=d.split(/\d/)[0];(!l||l(p))&&Js(r,p,null,null,d)}}var Us={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Ks(r,l,d,p){var g=l+u(d)+(p?"_"+u(p):"");if(r[Oe]&&r[Oe][g])return this;var b=function(P){return d.call(p||r,P||window.event)},M=b;!W.touchNative&&W.pointer&&l.indexOf("touch")===0?b=Af(r,l,b):W.touch&&l==="dblclick"?b=Ff(r,b):"addEventListener"in r?l==="touchstart"||l==="touchmove"||l==="wheel"||l==="mousewheel"?r.addEventListener(Us[l]||l,b,W.passiveEvents?{passive:!1}:!1):l==="mouseenter"||l==="mouseleave"?(b=function(P){P=P||window.event,Ys(r,P)&&M(P)},r.addEventListener(Us[l],b,!1)):r.addEventListener(l,M,!1):r.attachEvent("on"+l,b),r[Oe]=r[Oe]||{},r[Oe][g]=b}function Js(r,l,d,p,g){g=g||l+u(d)+(p?"_"+u(p):"");var b=r[Oe]&&r[Oe][g];if(!b)return this;!W.touchNative&&W.pointer&&l.indexOf("touch")===0?If(r,l,b):W.touch&&l==="dblclick"?Vf(r,b):"removeEventListener"in r?r.removeEventListener(Us[l]||l,b,!1):r.detachEvent("on"+l,b),r[Oe][g]=null}function gn(r){return r.stopPropagation?r.stopPropagation():r.originalEvent?r.originalEvent._stopped=!0:r.cancelBubble=!0,this}function Gs(r){return Ks(r,"wheel",gn),this}function Si(r){return nt(r,"mousedown touchstart dblclick contextmenu",gn),r._leaflet_disable_click=!0,this}function Ht(r){return r.preventDefault?r.preventDefault():r.returnValue=!1,this}function _n(r){return Ht(r),gn(r),this}function Ml(r){if(r.composedPath)return r.composedPath();for(var l=[],d=r.target;d;)l.push(d),d=d.parentNode;return l}function Cl(r,l){if(!l)return new J(r.clientX,r.clientY);var d=qs(l),p=d.boundingClientRect;return new J((r.clientX-p.left)/d.x-l.clientLeft,(r.clientY-p.top)/d.y-l.clientTop)}var Wf=W.linux&&W.chrome?window.devicePixelRatio:W.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Tl(r){return W.edge?r.wheelDeltaY/2:r.deltaY&&r.deltaMode===0?-r.deltaY/Wf:r.deltaY&&r.deltaMode===1?-r.deltaY*20:r.deltaY&&r.deltaMode===2?-r.deltaY*60:r.deltaX||r.deltaZ?0:r.wheelDelta?(r.wheelDeltaY||r.wheelDelta)/2:r.detail&&Math.abs(r.detail)<32765?-r.detail*20:r.detail?r.detail/-32765*60:0}function Ys(r,l){var d=l.relatedTarget;if(!d)return!0;try{for(;d&&d!==r;)d=d.parentNode}catch{return!1}return d!==r}var jf={__proto__:null,on:nt,off:mt,stopPropagation:gn,disableScrollPropagation:Gs,disableClickPropagation:Si,preventDefault:Ht,stop:_n,getPropagationPath:Ml,getMousePosition:Cl,getWheelDelta:Tl,isExternalTarget:Ys,addListener:nt,removeListener:mt},Pl=dt.extend({run:function(r,l,d,p){this.stop(),this._el=r,this._inProgress=!0,this._duration=d||.25,this._easeOutPower=1/Math.max(p||.5,.2),this._startPos=mn(r),this._offset=l.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=Tt(this._animate,this),this._step()},_step:function(r){var l=+new Date-this._startTime,d=this._duration*1e3;l<d?this._runFrame(this._easeOut(l/d),r):(this._runFrame(1),this._complete())},_runFrame:function(r,l){var d=this._startPos.add(this._offset.multiplyBy(r));l&&d._round(),Et(this._el,d),this.fire("step")},_complete:function(){Ut(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(r){return 1-Math.pow(1-r,this._easeOutPower)}}),lt=dt.extend({options:{crs:Ls,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(r,l){l=x(this,l),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(r),this._initLayout(),this._onResize=a(this._onResize,this),this._initEvents(),l.maxBounds&&this.setMaxBounds(l.maxBounds),l.zoom!==void 0&&(this._zoom=this._limitZoom(l.zoom)),l.center&&l.zoom!==void 0&&this.setView(at(l.center),l.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=vi&&W.any3d&&!W.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),nt(this._proxy,xl,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(r,l,d){if(l=l===void 0?this._zoom:this._limitZoom(l),r=this._limitCenter(at(r),l,this.options.maxBounds),d=d||{},this._stop(),this._loaded&&!d.reset&&d!==!0){d.animate!==void 0&&(d.zoom=s({animate:d.animate},d.zoom),d.pan=s({animate:d.animate,duration:d.duration},d.pan));var p=this._zoom!==l?this._tryAnimatedZoom&&this._tryAnimatedZoom(r,l,d.zoom):this._tryAnimatedPan(r,d.pan);if(p)return clearTimeout(this._sizeTimer),this}return this._resetView(r,l,d.pan&&d.pan.noMoveStart),this},setZoom:function(r,l){return this._loaded?this.setView(this.getCenter(),r,{zoom:l}):(this._zoom=r,this)},zoomIn:function(r,l){return r=r||(W.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+r,l)},zoomOut:function(r,l){return r=r||(W.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-r,l)},setZoomAround:function(r,l,d){var p=this.getZoomScale(l),g=this.getSize().divideBy(2),b=r instanceof J?r:this.latLngToContainerPoint(r),M=b.subtract(g).multiplyBy(1-1/p),P=this.containerPointToLatLng(g.add(M));return this.setView(P,l,{zoom:d})},_getBoundsCenterZoom:function(r,l){l=l||{},r=r.getBounds?r.getBounds():Pt(r);var d=X(l.paddingTopLeft||l.padding||[0,0]),p=X(l.paddingBottomRight||l.padding||[0,0]),g=this.getBoundsZoom(r,!1,d.add(p));if(g=typeof l.maxZoom=="number"?Math.min(l.maxZoom,g):g,g===1/0)return{center:r.getCenter(),zoom:g};var b=p.subtract(d).divideBy(2),M=this.project(r.getSouthWest(),g),P=this.project(r.getNorthEast(),g),E=this.unproject(M.add(P).divideBy(2).add(b),g);return{center:E,zoom:g}},fitBounds:function(r,l){if(r=Pt(r),!r.isValid())throw new Error("Bounds are not valid.");var d=this._getBoundsCenterZoom(r,l);return this.setView(d.center,d.zoom,l)},fitWorld:function(r){return this.fitBounds([[-90,-180],[90,180]],r)},panTo:function(r,l){return this.setView(r,this._zoom,{pan:l})},panBy:function(r,l){if(r=X(r).round(),l=l||{},!r.x&&!r.y)return this.fire("moveend");if(l.animate!==!0&&!this.getSize().contains(r))return this._resetView(this.unproject(this.project(this.getCenter()).add(r)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Pl,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),l.noMoveStart||this.fire("movestart"),l.animate!==!1){it(this._mapPane,"leaflet-pan-anim");var d=this._getMapPanePos().subtract(r).round();this._panAnim.run(this._mapPane,d,l.duration||.25,l.easeLinearity)}else this._rawPanBy(r),this.fire("move").fire("moveend");return this},flyTo:function(r,l,d){if(d=d||{},d.animate===!1||!W.any3d)return this.setView(r,l,d);this._stop();var p=this.project(this.getCenter()),g=this.project(r),b=this.getSize(),M=this._zoom;r=at(r),l=l===void 0?M:l;var P=Math.max(b.x,b.y),E=P*this.getZoomScale(M,l),I=g.distanceTo(p)||1,$=1.42,Y=$*$;function rt(Ot){var kr=Ot?-1:1,Ip=Ot?E:P,Np=E*E-P*P+kr*Y*Y*I*I,Dp=2*Ip*Y*I,lo=Np/Dp,lc=Math.sqrt(lo*lo+1)-lo,zp=lc<1e-9?-18:Math.log(lc);return zp}function Yt(Ot){return(Math.exp(Ot)-Math.exp(-Ot))/2}function Rt(Ot){return(Math.exp(Ot)+Math.exp(-Ot))/2}function ge(Ot){return Yt(Ot)/Rt(Ot)}var re=rt(0);function Jn(Ot){return P*(Rt(re)/Rt(re+$*Ot))}function Ep(Ot){return P*(Rt(re)*ge(re+$*Ot)-Yt(re))/Y}function Op(Ot){return 1-Math.pow(1-Ot,1.5)}var Lp=Date.now(),oc=(rt(1)-re)/$,Ap=d.duration?1e3*d.duration:1e3*oc*.8;function ac(){var Ot=(Date.now()-Lp)/Ap,kr=Op(Ot)*oc;Ot<=1?(this._flyToFrame=Tt(ac,this),this._move(this.unproject(p.add(g.subtract(p).multiplyBy(Ep(kr)/I)),M),this.getScaleZoom(P/Jn(kr),M),{flyTo:!0})):this._move(r,l)._moveEnd(!0)}return this._moveStart(!0,d.noMoveStart),ac.call(this),this},flyToBounds:function(r,l){var d=this._getBoundsCenterZoom(r,l);return this.flyTo(d.center,d.zoom,l)},setMaxBounds:function(r){return r=Pt(r),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),r.isValid()?(this.options.maxBounds=r,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(r){var l=this.options.minZoom;return this.options.minZoom=r,this._loaded&&l!==r&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(r):this},setMaxZoom:function(r){var l=this.options.maxZoom;return this.options.maxZoom=r,this._loaded&&l!==r&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(r):this},panInsideBounds:function(r,l){this._enforcingBounds=!0;var d=this.getCenter(),p=this._limitCenter(d,this._zoom,Pt(r));return d.equals(p)||this.panTo(p,l),this._enforcingBounds=!1,this},panInside:function(r,l){l=l||{};var d=X(l.paddingTopLeft||l.padding||[0,0]),p=X(l.paddingBottomRight||l.padding||[0,0]),g=this.project(this.getCenter()),b=this.project(r),M=this.getPixelBounds(),P=At([M.min.add(d),M.max.subtract(p)]),E=P.getSize();if(!P.contains(b)){this._enforcingBounds=!0;var I=b.subtract(P.getCenter()),$=P.extend(b).getSize().subtract(E);g.x+=I.x<0?-$.x:$.x,g.y+=I.y<0?-$.y:$.y,this.panTo(this.unproject(g),l),this._enforcingBounds=!1}return this},invalidateSize:function(r){if(!this._loaded)return this;r=s({animate:!1,pan:!0},r===!0?{animate:!0}:r);var l=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var d=this.getSize(),p=l.divideBy(2).round(),g=d.divideBy(2).round(),b=p.subtract(g);return!b.x&&!b.y?this:(r.animate&&r.pan?this.panBy(b):(r.pan&&this._rawPanBy(b),this.fire("move"),r.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(a(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:l,newSize:d}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(r){if(r=this._locateOptions=s({timeout:1e4,watch:!1},r),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var l=a(this._handleGeolocationResponse,this),d=a(this._handleGeolocationError,this);return r.watch?this._locationWatchId=navigator.geolocation.watchPosition(l,d,r):navigator.geolocation.getCurrentPosition(l,d,r),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(r){if(this._container._leaflet_id){var l=r.code,d=r.message||(l===1?"permission denied":l===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:l,message:"Geolocation error: "+d+"."})}},_handleGeolocationResponse:function(r){if(this._container._leaflet_id){var l=r.coords.latitude,d=r.coords.longitude,p=new ft(l,d),g=p.toBounds(r.coords.accuracy*2),b=this._locateOptions;if(b.setView){var M=this.getBoundsZoom(g);this.setView(p,b.maxZoom?Math.min(M,b.maxZoom):M)}var P={latlng:p,bounds:g,timestamp:r.timestamp};for(var E in r.coords)typeof r.coords[E]=="number"&&(P[E]=r.coords[E]);this.fire("locationfound",P)}},addHandler:function(r,l){if(!l)return this;var d=this[r]=new l(this);return this._handlers.push(d),this.options[r]&&d.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),wt(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(Ut(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var r;for(r in this._layers)this._layers[r].remove();for(r in this._panes)wt(this._panes[r]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(r,l){var d="leaflet-pane"+(r?" leaflet-"+r.replace("Pane","")+"-pane":""),p=ct("div",d,l||this._mapPane);return r&&(this._panes[r]=p),p},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var r=this.getPixelBounds(),l=this.unproject(r.getBottomLeft()),d=this.unproject(r.getTopRight());return new ie(l,d)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(r,l,d){r=Pt(r),d=X(d||[0,0]);var p=this.getZoom()||0,g=this.getMinZoom(),b=this.getMaxZoom(),M=r.getNorthWest(),P=r.getSouthEast(),E=this.getSize().subtract(d),I=At(this.project(P,p),this.project(M,p)).getSize(),$=W.any3d?this.options.zoomSnap:1,Y=E.x/I.x,rt=E.y/I.y,Yt=l?Math.max(Y,rt):Math.min(Y,rt);return p=this.getScaleZoom(Yt,p),$&&(p=Math.round(p/($/100))*($/100),p=l?Math.ceil(p/$)*$:Math.floor(p/$)*$),Math.max(g,Math.min(b,p))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new J(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(r,l){var d=this._getTopLeftPoint(r,l);return new G(d,d.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(r){return this.options.crs.getProjectedBounds(r===void 0?this.getZoom():r)},getPane:function(r){return typeof r=="string"?this._panes[r]:r},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(r,l){var d=this.options.crs;return l=l===void 0?this._zoom:l,d.scale(r)/d.scale(l)},getScaleZoom:function(r,l){var d=this.options.crs;l=l===void 0?this._zoom:l;var p=d.zoom(r*d.scale(l));return isNaN(p)?1/0:p},project:function(r,l){return l=l===void 0?this._zoom:l,this.options.crs.latLngToPoint(at(r),l)},unproject:function(r,l){return l=l===void 0?this._zoom:l,this.options.crs.pointToLatLng(X(r),l)},layerPointToLatLng:function(r){var l=X(r).add(this.getPixelOrigin());return this.unproject(l)},latLngToLayerPoint:function(r){var l=this.project(at(r))._round();return l._subtract(this.getPixelOrigin())},wrapLatLng:function(r){return this.options.crs.wrapLatLng(at(r))},wrapLatLngBounds:function(r){return this.options.crs.wrapLatLngBounds(Pt(r))},distance:function(r,l){return this.options.crs.distance(at(r),at(l))},containerPointToLayerPoint:function(r){return X(r).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(r){return X(r).add(this._getMapPanePos())},containerPointToLatLng:function(r){var l=this.containerPointToLayerPoint(X(r));return this.layerPointToLatLng(l)},latLngToContainerPoint:function(r){return this.layerPointToContainerPoint(this.latLngToLayerPoint(at(r)))},mouseEventToContainerPoint:function(r){return Cl(r,this._container)},mouseEventToLayerPoint:function(r){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(r))},mouseEventToLatLng:function(r){return this.layerPointToLatLng(this.mouseEventToLayerPoint(r))},_initContainer:function(r){var l=this._container=wl(r);if(l){if(l._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");nt(l,"scroll",this._onScroll,this),this._containerId=u(l)},_initLayout:function(){var r=this._container;this._fadeAnimated=this.options.fadeAnimation&&W.any3d,it(r,"leaflet-container"+(W.touch?" leaflet-touch":"")+(W.retina?" leaflet-retina":"")+(W.ielt9?" leaflet-oldie":"")+(W.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var l=bi(r,"position");l!=="absolute"&&l!=="relative"&&l!=="fixed"&&l!=="sticky"&&(r.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var r=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Et(this._mapPane,new J(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(it(r.markerPane,"leaflet-zoom-hide"),it(r.shadowPane,"leaflet-zoom-hide"))},_resetView:function(r,l,d){Et(this._mapPane,new J(0,0));var p=!this._loaded;this._loaded=!0,l=this._limitZoom(l),this.fire("viewprereset");var g=this._zoom!==l;this._moveStart(g,d)._move(r,l)._moveEnd(g),this.fire("viewreset"),p&&this.fire("load")},_moveStart:function(r,l){return r&&this.fire("zoomstart"),l||this.fire("movestart"),this},_move:function(r,l,d,p){l===void 0&&(l=this._zoom);var g=this._zoom!==l;return this._zoom=l,this._lastCenter=r,this._pixelOrigin=this._getNewPixelOrigin(r),p?d&&d.pinch&&this.fire("zoom",d):((g||d&&d.pinch)&&this.fire("zoom",d),this.fire("move",d)),this},_moveEnd:function(r){return r&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return Ut(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(r){Et(this._mapPane,this._getMapPanePos().subtract(r))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(r){this._targets={},this._targets[u(this._container)]=this;var l=r?mt:nt;l(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&l(window,"resize",this._onResize,this),W.any3d&&this.options.transform3DLimit&&(r?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){Ut(this._resizeRequest),this._resizeRequest=Tt(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var r=this._getMapPanePos();Math.max(Math.abs(r.x),Math.abs(r.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(r,l){for(var d=[],p,g=l==="mouseout"||l==="mouseover",b=r.target||r.srcElement,M=!1;b;){if(p=this._targets[u(b)],p&&(l==="click"||l==="preclick")&&this._draggableMoved(p)){M=!0;break}if(p&&p.listens(l,!0)&&(g&&!Ys(b,r)||(d.push(p),g))||b===this._container)break;b=b.parentNode}return!d.length&&!M&&!g&&this.listens(l,!0)&&(d=[this]),d},_isClickDisabled:function(r){for(;r&&r!==this._container;){if(r._leaflet_disable_click)return!0;r=r.parentNode}},_handleDOMEvent:function(r){var l=r.target||r.srcElement;if(!(!this._loaded||l._leaflet_disable_events||r.type==="click"&&this._isClickDisabled(l))){var d=r.type;d==="mousedown"&&js(l),this._fireDOMEvent(r,d)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(r,l,d){if(r.type==="click"){var p=s({},r);p.type="preclick",this._fireDOMEvent(p,p.type,d)}var g=this._findEventTargets(r,l);if(d){for(var b=[],M=0;M<d.length;M++)d[M].listens(l,!0)&&b.push(d[M]);g=b.concat(g)}if(g.length){l==="contextmenu"&&Ht(r);var P=g[0],E={originalEvent:r};if(r.type!=="keypress"&&r.type!=="keydown"&&r.type!=="keyup"){var I=P.getLatLng&&(!P._radius||P._radius<=10);E.containerPoint=I?this.latLngToContainerPoint(P.getLatLng()):this.mouseEventToContainerPoint(r),E.layerPoint=this.containerPointToLayerPoint(E.containerPoint),E.latlng=I?P.getLatLng():this.layerPointToLatLng(E.layerPoint)}for(M=0;M<g.length;M++)if(g[M].fire(l,E,!0),E.originalEvent._stopped||g[M].options.bubblingMouseEvents===!1&&V(this._mouseEvents,l)!==-1)return}},_draggableMoved:function(r){return r=r.dragging&&r.dragging.enabled()?r:this,r.dragging&&r.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var r=0,l=this._handlers.length;r<l;r++)this._handlers[r].disable()},whenReady:function(r,l){return this._loaded?r.call(l||this,{target:this}):this.on("load",r,l),this},_getMapPanePos:function(){return mn(this._mapPane)||new J(0,0)},_moved:function(){var r=this._getMapPanePos();return r&&!r.equals([0,0])},_getTopLeftPoint:function(r,l){var d=r&&l!==void 0?this._getNewPixelOrigin(r,l):this.getPixelOrigin();return d.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(r,l){var d=this.getSize()._divideBy(2);return this.project(r,l)._subtract(d)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(r,l,d){var p=this._getNewPixelOrigin(d,l);return this.project(r,l)._subtract(p)},_latLngBoundsToNewLayerBounds:function(r,l,d){var p=this._getNewPixelOrigin(d,l);return At([this.project(r.getSouthWest(),l)._subtract(p),this.project(r.getNorthWest(),l)._subtract(p),this.project(r.getSouthEast(),l)._subtract(p),this.project(r.getNorthEast(),l)._subtract(p)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(r){return this.latLngToLayerPoint(r).subtract(this._getCenterLayerPoint())},_limitCenter:function(r,l,d){if(!d)return r;var p=this.project(r,l),g=this.getSize().divideBy(2),b=new G(p.subtract(g),p.add(g)),M=this._getBoundsOffset(b,d,l);return Math.abs(M.x)<=1&&Math.abs(M.y)<=1?r:this.unproject(p.add(M),l)},_limitOffset:function(r,l){if(!l)return r;var d=this.getPixelBounds(),p=new G(d.min.add(r),d.max.add(r));return r.add(this._getBoundsOffset(p,l))},_getBoundsOffset:function(r,l,d){var p=At(this.project(l.getNorthEast(),d),this.project(l.getSouthWest(),d)),g=p.min.subtract(r.min),b=p.max.subtract(r.max),M=this._rebound(g.x,-b.x),P=this._rebound(g.y,-b.y);return new J(M,P)},_rebound:function(r,l){return r+l>0?Math.round(r-l)/2:Math.max(0,Math.ceil(r))-Math.max(0,Math.floor(l))},_limitZoom:function(r){var l=this.getMinZoom(),d=this.getMaxZoom(),p=W.any3d?this.options.zoomSnap:1;return p&&(r=Math.round(r/p)*p),Math.max(l,Math.min(d,r))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Mt(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(r,l){var d=this._getCenterOffset(r)._trunc();return(l&&l.animate)!==!0&&!this.getSize().contains(d)?!1:(this.panBy(d,l),!0)},_createAnimProxy:function(){var r=this._proxy=ct("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(r),this.on("zoomanim",function(l){var d=Bs,p=this._proxy.style[d];pn(this._proxy,this.project(l.center,l.zoom),this.getZoomScale(l.zoom,1)),p===this._proxy.style[d]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){wt(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var r=this.getCenter(),l=this.getZoom();pn(this._proxy,this.project(r,l),this.getZoomScale(l,1))},_catchTransitionEnd:function(r){this._animatingZoom&&r.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(r,l,d){if(this._animatingZoom)return!0;if(d=d||{},!this._zoomAnimated||d.animate===!1||this._nothingToAnimate()||Math.abs(l-this._zoom)>this.options.zoomAnimationThreshold)return!1;var p=this.getZoomScale(l),g=this._getCenterOffset(r)._divideBy(1-1/p);return d.animate!==!0&&!this.getSize().contains(g)?!1:(Tt(function(){this._moveStart(!0,d.noMoveStart||!1)._animateZoom(r,l,!0)},this),!0)},_animateZoom:function(r,l,d,p){this._mapPane&&(d&&(this._animatingZoom=!0,this._animateToCenter=r,this._animateToZoom=l,it(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:r,zoom:l,noUpdate:p}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(a(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Mt(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function qf(r,l){return new lt(r,l)}var we=ue.extend({options:{position:"topright"},initialize:function(r){x(this,r)},getPosition:function(){return this.options.position},setPosition:function(r){var l=this._map;return l&&l.removeControl(this),this.options.position=r,l&&l.addControl(this),this},getContainer:function(){return this._container},addTo:function(r){this.remove(),this._map=r;var l=this._container=this.onAdd(r),d=this.getPosition(),p=r._controlCorners[d];return it(l,"leaflet-control"),d.indexOf("bottom")!==-1?p.insertBefore(l,p.firstChild):p.appendChild(l),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(wt(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(r){this._map&&r&&r.screenX>0&&r.screenY>0&&this._map.getContainer().focus()}}),Mi=function(r){return new we(r)};lt.include({addControl:function(r){return r.addTo(this),this},removeControl:function(r){return r.remove(),this},_initControlPos:function(){var r=this._controlCorners={},l="leaflet-",d=this._controlContainer=ct("div",l+"control-container",this._container);function p(g,b){var M=l+g+" "+l+b;r[g+b]=ct("div",M,d)}p("top","left"),p("top","right"),p("bottom","left"),p("bottom","right")},_clearControlPos:function(){for(var r in this._controlCorners)wt(this._controlCorners[r]);wt(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var El=we.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(r,l,d,p){return d<p?-1:p<d?1:0}},initialize:function(r,l,d){x(this,d),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var p in r)this._addLayer(r[p],p);for(p in l)this._addLayer(l[p],p,!0)},onAdd:function(r){this._initLayout(),this._update(),this._map=r,r.on("zoomend",this._checkDisabledLayers,this);for(var l=0;l<this._layers.length;l++)this._layers[l].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(r){return we.prototype.addTo.call(this,r),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var r=0;r<this._layers.length;r++)this._layers[r].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(r,l){return this._addLayer(r,l),this._map?this._update():this},addOverlay:function(r,l){return this._addLayer(r,l,!0),this._map?this._update():this},removeLayer:function(r){r.off("add remove",this._onLayerChange,this);var l=this._getLayer(u(r));return l&&this._layers.splice(this._layers.indexOf(l),1),this._map?this._update():this},expand:function(){it(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var r=this._map.getSize().y-(this._container.offsetTop+50);return r<this._section.clientHeight?(it(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=r+"px"):Mt(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Mt(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var r="leaflet-control-layers",l=this._container=ct("div",r),d=this.options.collapsed;l.setAttribute("aria-haspopup",!0),Si(l),Gs(l);var p=this._section=ct("section",r+"-list");d&&(this._map.on("click",this.collapse,this),nt(l,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var g=this._layersLink=ct("a",r+"-toggle",l);g.href="#",g.title="Layers",g.setAttribute("role","button"),nt(g,{keydown:function(b){b.keyCode===13&&this._expandSafely()},click:function(b){Ht(b),this._expandSafely()}},this),d||this.expand(),this._baseLayersList=ct("div",r+"-base",p),this._separator=ct("div",r+"-separator",p),this._overlaysList=ct("div",r+"-overlays",p),l.appendChild(p)},_getLayer:function(r){for(var l=0;l<this._layers.length;l++)if(this._layers[l]&&u(this._layers[l].layer)===r)return this._layers[l]},_addLayer:function(r,l,d){this._map&&r.on("add remove",this._onLayerChange,this),this._layers.push({layer:r,name:l,overlay:d}),this.options.sortLayers&&this._layers.sort(a(function(p,g){return this.options.sortFunction(p.layer,g.layer,p.name,g.name)},this)),this.options.autoZIndex&&r.setZIndex&&(this._lastZIndex++,r.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;ar(this._baseLayersList),ar(this._overlaysList),this._layerControlInputs=[];var r,l,d,p,g=0;for(d=0;d<this._layers.length;d++)p=this._layers[d],this._addItem(p),l=l||p.overlay,r=r||!p.overlay,g+=p.overlay?0:1;return this.options.hideSingleBase&&(r=r&&g>1,this._baseLayersList.style.display=r?"":"none"),this._separator.style.display=l&&r?"":"none",this},_onLayerChange:function(r){this._handlingClick||this._update();var l=this._getLayer(u(r.target)),d=l.overlay?r.type==="add"?"overlayadd":"overlayremove":r.type==="add"?"baselayerchange":null;d&&this._map.fire(d,l)},_createRadioElement:function(r,l){var d='<input type="radio" class="leaflet-control-layers-selector" name="'+r+'"'+(l?' checked="checked"':"")+"/>",p=document.createElement("div");return p.innerHTML=d,p.firstChild},_addItem:function(r){var l=document.createElement("label"),d=this._map.hasLayer(r.layer),p;r.overlay?(p=document.createElement("input"),p.type="checkbox",p.className="leaflet-control-layers-selector",p.defaultChecked=d):p=this._createRadioElement("leaflet-base-layers_"+u(this),d),this._layerControlInputs.push(p),p.layerId=u(r.layer),nt(p,"click",this._onInputClick,this);var g=document.createElement("span");g.innerHTML=" "+r.name;var b=document.createElement("span");l.appendChild(b),b.appendChild(p),b.appendChild(g);var M=r.overlay?this._overlaysList:this._baseLayersList;return M.appendChild(l),this._checkDisabledLayers(),l},_onInputClick:function(){if(!this._preventClick){var r=this._layerControlInputs,l,d,p=[],g=[];this._handlingClick=!0;for(var b=r.length-1;b>=0;b--)l=r[b],d=this._getLayer(l.layerId).layer,l.checked?p.push(d):l.checked||g.push(d);for(b=0;b<g.length;b++)this._map.hasLayer(g[b])&&this._map.removeLayer(g[b]);for(b=0;b<p.length;b++)this._map.hasLayer(p[b])||this._map.addLayer(p[b]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var r=this._layerControlInputs,l,d,p=this._map.getZoom(),g=r.length-1;g>=0;g--)l=r[g],d=this._getLayer(l.layerId).layer,l.disabled=d.options.minZoom!==void 0&&p<d.options.minZoom||d.options.maxZoom!==void 0&&p>d.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var r=this._section;this._preventClick=!0,nt(r,"click",Ht),this.expand();var l=this;setTimeout(function(){mt(r,"click",Ht),l._preventClick=!1})}}),Uf=function(r,l,d){return new El(r,l,d)},Xs=we.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(r){var l="leaflet-control-zoom",d=ct("div",l+" leaflet-bar"),p=this.options;return this._zoomInButton=this._createButton(p.zoomInText,p.zoomInTitle,l+"-in",d,this._zoomIn),this._zoomOutButton=this._createButton(p.zoomOutText,p.zoomOutTitle,l+"-out",d,this._zoomOut),this._updateDisabled(),r.on("zoomend zoomlevelschange",this._updateDisabled,this),d},onRemove:function(r){r.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(r){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(r.shiftKey?3:1))},_zoomOut:function(r){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(r.shiftKey?3:1))},_createButton:function(r,l,d,p,g){var b=ct("a",d,p);return b.innerHTML=r,b.href="#",b.title=l,b.setAttribute("role","button"),b.setAttribute("aria-label",l),Si(b),nt(b,"click",_n),nt(b,"click",g,this),nt(b,"click",this._refocusOnMap,this),b},_updateDisabled:function(){var r=this._map,l="leaflet-disabled";Mt(this._zoomInButton,l),Mt(this._zoomOutButton,l),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||r._zoom===r.getMinZoom())&&(it(this._zoomOutButton,l),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||r._zoom===r.getMaxZoom())&&(it(this._zoomInButton,l),this._zoomInButton.setAttribute("aria-disabled","true"))}});lt.mergeOptions({zoomControl:!0}),lt.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Xs,this.addControl(this.zoomControl))});var Kf=function(r){return new Xs(r)},Ol=we.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(r){var l="leaflet-control-scale",d=ct("div",l),p=this.options;return this._addScales(p,l+"-line",d),r.on(p.updateWhenIdle?"moveend":"move",this._update,this),r.whenReady(this._update,this),d},onRemove:function(r){r.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(r,l,d){r.metric&&(this._mScale=ct("div",l,d)),r.imperial&&(this._iScale=ct("div",l,d))},_update:function(){var r=this._map,l=r.getSize().y/2,d=r.distance(r.containerPointToLatLng([0,l]),r.containerPointToLatLng([this.options.maxWidth,l]));this._updateScales(d)},_updateScales:function(r){this.options.metric&&r&&this._updateMetric(r),this.options.imperial&&r&&this._updateImperial(r)},_updateMetric:function(r){var l=this._getRoundNum(r),d=l<1e3?l+" m":l/1e3+" km";this._updateScale(this._mScale,d,l/r)},_updateImperial:function(r){var l=r*3.2808399,d,p,g;l>5280?(d=l/5280,p=this._getRoundNum(d),this._updateScale(this._iScale,p+" mi",p/d)):(g=this._getRoundNum(l),this._updateScale(this._iScale,g+" ft",g/l))},_updateScale:function(r,l,d){r.style.width=Math.round(this.options.maxWidth*d)+"px",r.innerHTML=l},_getRoundNum:function(r){var l=Math.pow(10,(Math.floor(r)+"").length-1),d=r/l;return d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:1,l*d}}),Jf=function(r){return new Ol(r)},Gf='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Qs=we.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(W.inlineSvg?Gf+" ":"")+"Leaflet</a>"},initialize:function(r){x(this,r),this._attributions={}},onAdd:function(r){r.attributionControl=this,this._container=ct("div","leaflet-control-attribution"),Si(this._container);for(var l in r._layers)r._layers[l].getAttribution&&this.addAttribution(r._layers[l].getAttribution());return this._update(),r.on("layeradd",this._addAttribution,this),this._container},onRemove:function(r){r.off("layeradd",this._addAttribution,this)},_addAttribution:function(r){r.layer.getAttribution&&(this.addAttribution(r.layer.getAttribution()),r.layer.once("remove",function(){this.removeAttribution(r.layer.getAttribution())},this))},setPrefix:function(r){return this.options.prefix=r,this._update(),this},addAttribution:function(r){return r?(this._attributions[r]||(this._attributions[r]=0),this._attributions[r]++,this._update(),this):this},removeAttribution:function(r){return r?(this._attributions[r]&&(this._attributions[r]--,this._update()),this):this},_update:function(){if(this._map){var r=[];for(var l in this._attributions)this._attributions[l]&&r.push(l);var d=[];this.options.prefix&&d.push(this.options.prefix),r.length&&d.push(r.join(", ")),this._container.innerHTML=d.join(' <span aria-hidden="true">|</span> ')}}});lt.mergeOptions({attributionControl:!0}),lt.addInitHook(function(){this.options.attributionControl&&new Qs().addTo(this)});var Yf=function(r){return new Qs(r)};we.Layers=El,we.Zoom=Xs,we.Scale=Ol,we.Attribution=Qs,Mi.layers=Uf,Mi.zoom=Kf,Mi.scale=Jf,Mi.attribution=Yf;var Le=ue.extend({initialize:function(r){this._map=r},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Le.addTo=function(r,l){return r.addHandler(l,this),this};var Xf={Events:Zt},Ll=W.touch?"touchstart mousedown":"mousedown",Ke=dt.extend({options:{clickTolerance:3},initialize:function(r,l,d,p){x(this,p),this._element=r,this._dragStartTarget=l||r,this._preventOutline=d},enable:function(){this._enabled||(nt(this._dragStartTarget,Ll,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Ke._dragging===this&&this.finishDrag(!0),mt(this._dragStartTarget,Ll,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(r){if(this._enabled&&(this._moved=!1,!$s(this._element,"leaflet-zoom-anim"))){if(r.touches&&r.touches.length!==1){Ke._dragging===this&&this.finishDrag();return}if(!(Ke._dragging||r.shiftKey||r.which!==1&&r.button!==1&&!r.touches)&&(Ke._dragging=this,this._preventOutline&&js(this._element),Zs(),xi(),!this._moving)){this.fire("down");var l=r.touches?r.touches[0]:r,d=kl(this._element);this._startPoint=new J(l.clientX,l.clientY),this._startPos=mn(this._element),this._parentScale=qs(d);var p=r.type==="mousedown";nt(document,p?"mousemove":"touchmove",this._onMove,this),nt(document,p?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(r){if(this._enabled){if(r.touches&&r.touches.length>1){this._moved=!0;return}var l=r.touches&&r.touches.length===1?r.touches[0]:r,d=new J(l.clientX,l.clientY)._subtract(this._startPoint);!d.x&&!d.y||Math.abs(d.x)+Math.abs(d.y)<this.options.clickTolerance||(d.x/=this._parentScale.x,d.y/=this._parentScale.y,Ht(r),this._moved||(this.fire("dragstart"),this._moved=!0,it(document.body,"leaflet-dragging"),this._lastTarget=r.target||r.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),it(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(d),this._moving=!0,this._lastEvent=r,this._updatePosition())}},_updatePosition:function(){var r={originalEvent:this._lastEvent};this.fire("predrag",r),Et(this._element,this._newPos),this.fire("drag",r)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(r){Mt(document.body,"leaflet-dragging"),this._lastTarget&&(Mt(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),mt(document,"mousemove touchmove",this._onMove,this),mt(document,"mouseup touchend touchcancel",this._onUp,this),Hs(),wi();var l=this._moved&&this._moving;this._moving=!1,Ke._dragging=!1,l&&this.fire("dragend",{noInertia:r,distance:this._newPos.distanceTo(this._startPos)})}});function Al(r,l,d){var p,g=[1,4,2,8],b,M,P,E,I,$,Y,rt;for(b=0,$=r.length;b<$;b++)r[b]._code=yn(r[b],l);for(P=0;P<4;P++){for(Y=g[P],p=[],b=0,$=r.length,M=$-1;b<$;M=b++)E=r[b],I=r[M],E._code&Y?I._code&Y||(rt=hr(I,E,Y,l,d),rt._code=yn(rt,l),p.push(rt)):(I._code&Y&&(rt=hr(I,E,Y,l,d),rt._code=yn(rt,l),p.push(rt)),p.push(E));r=p}return r}function Il(r,l){var d,p,g,b,M,P,E,I,$;if(!r||r.length===0)throw new Error("latlngs not passed");me(r)||(console.warn("latlngs are not flat! Only the first ring will be used"),r=r[0]);var Y=at([0,0]),rt=Pt(r),Yt=rt.getNorthWest().distanceTo(rt.getSouthWest())*rt.getNorthEast().distanceTo(rt.getNorthWest());Yt<1700&&(Y=to(r));var Rt=r.length,ge=[];for(d=0;d<Rt;d++){var re=at(r[d]);ge.push(l.project(at([re.lat-Y.lat,re.lng-Y.lng])))}for(P=E=I=0,d=0,p=Rt-1;d<Rt;p=d++)g=ge[d],b=ge[p],M=g.y*b.x-b.y*g.x,E+=(g.x+b.x)*M,I+=(g.y+b.y)*M,P+=M*3;P===0?$=ge[0]:$=[E/P,I/P];var Jn=l.unproject(X($));return at([Jn.lat+Y.lat,Jn.lng+Y.lng])}function to(r){for(var l=0,d=0,p=0,g=0;g<r.length;g++){var b=at(r[g]);l+=b.lat,d+=b.lng,p++}return at([l/p,d/p])}var Qf={__proto__:null,clipPolygon:Al,polygonCenter:Il,centroid:to};function Nl(r,l){if(!l||!r.length)return r.slice();var d=l*l;return r=np(r,d),r=ep(r,d),r}function Dl(r,l,d){return Math.sqrt(Ci(r,l,d,!0))}function tp(r,l,d){return Ci(r,l,d)}function ep(r,l){var d=r.length,p=typeof Uint8Array<"u"?Uint8Array:Array,g=new p(d);g[0]=g[d-1]=1,eo(r,g,l,0,d-1);var b,M=[];for(b=0;b<d;b++)g[b]&&M.push(r[b]);return M}function eo(r,l,d,p,g){var b=0,M,P,E;for(P=p+1;P<=g-1;P++)E=Ci(r[P],r[p],r[g],!0),E>b&&(M=P,b=E);b>d&&(l[M]=1,eo(r,l,d,p,M),eo(r,l,d,M,g))}function np(r,l){for(var d=[r[0]],p=1,g=0,b=r.length;p<b;p++)ip(r[p],r[g])>l&&(d.push(r[p]),g=p);return g<b-1&&d.push(r[b-1]),d}var zl;function Rl(r,l,d,p,g){var b=p?zl:yn(r,d),M=yn(l,d),P,E,I;for(zl=M;;){if(!(b|M))return[r,l];if(b&M)return!1;P=b||M,E=hr(r,l,P,d,g),I=yn(E,d),P===b?(r=E,b=I):(l=E,M=I)}}function hr(r,l,d,p,g){var b=l.x-r.x,M=l.y-r.y,P=p.min,E=p.max,I,$;return d&8?(I=r.x+b*(E.y-r.y)/M,$=E.y):d&4?(I=r.x+b*(P.y-r.y)/M,$=P.y):d&2?(I=E.x,$=r.y+M*(E.x-r.x)/b):d&1&&(I=P.x,$=r.y+M*(P.x-r.x)/b),new J(I,$,g)}function yn(r,l){var d=0;return r.x<l.min.x?d|=1:r.x>l.max.x&&(d|=2),r.y<l.min.y?d|=4:r.y>l.max.y&&(d|=8),d}function ip(r,l){var d=l.x-r.x,p=l.y-r.y;return d*d+p*p}function Ci(r,l,d,p){var g=l.x,b=l.y,M=d.x-g,P=d.y-b,E=M*M+P*P,I;return E>0&&(I=((r.x-g)*M+(r.y-b)*P)/E,I>1?(g=d.x,b=d.y):I>0&&(g+=M*I,b+=P*I)),M=r.x-g,P=r.y-b,p?M*M+P*P:new J(g,b)}function me(r){return!N(r[0])||typeof r[0][0]!="object"&&typeof r[0][0]<"u"}function Bl(r){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),me(r)}function $l(r,l){var d,p,g,b,M,P,E,I;if(!r||r.length===0)throw new Error("latlngs not passed");me(r)||(console.warn("latlngs are not flat! Only the first ring will be used"),r=r[0]);var $=at([0,0]),Y=Pt(r),rt=Y.getNorthWest().distanceTo(Y.getSouthWest())*Y.getNorthEast().distanceTo(Y.getNorthWest());rt<1700&&($=to(r));var Yt=r.length,Rt=[];for(d=0;d<Yt;d++){var ge=at(r[d]);Rt.push(l.project(at([ge.lat-$.lat,ge.lng-$.lng])))}for(d=0,p=0;d<Yt-1;d++)p+=Rt[d].distanceTo(Rt[d+1])/2;if(p===0)I=Rt[0];else for(d=0,b=0;d<Yt-1;d++)if(M=Rt[d],P=Rt[d+1],g=M.distanceTo(P),b+=g,b>p){E=(b-p)/g,I=[P.x-E*(P.x-M.x),P.y-E*(P.y-M.y)];break}var re=l.unproject(X(I));return at([re.lat+$.lat,re.lng+$.lng])}var rp={__proto__:null,simplify:Nl,pointToSegmentDistance:Dl,closestPointOnSegment:tp,clipSegment:Rl,_getEdgeIntersection:hr,_getBitCode:yn,_sqClosestPointOnSegment:Ci,isFlat:me,_flat:Bl,polylineCenter:$l},no={project:function(r){return new J(r.lng,r.lat)},unproject:function(r){return new ft(r.y,r.x)},bounds:new G([-180,-90],[180,90])},io={R:6378137,R_MINOR:6356752314245179e-9,bounds:new G([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(r){var l=Math.PI/180,d=this.R,p=r.lat*l,g=this.R_MINOR/d,b=Math.sqrt(1-g*g),M=b*Math.sin(p),P=Math.tan(Math.PI/4-p/2)/Math.pow((1-M)/(1+M),b/2);return p=-d*Math.log(Math.max(P,1e-10)),new J(r.lng*l*d,p)},unproject:function(r){for(var l=180/Math.PI,d=this.R,p=this.R_MINOR/d,g=Math.sqrt(1-p*p),b=Math.exp(-r.y/d),M=Math.PI/2-2*Math.atan(b),P=0,E=.1,I;P<15&&Math.abs(E)>1e-7;P++)I=g*Math.sin(M),I=Math.pow((1-I)/(1+I),g/2),E=Math.PI/2-2*Math.atan(b*I)-M,M+=E;return new ft(M*l,r.x*l/d)}},sp={__proto__:null,LonLat:no,Mercator:io,SphericalMercator:Es},op=s({},Ue,{code:"EPSG:3395",projection:io,transformation:(function(){var r=.5/(Math.PI*io.R);return _i(r,.5,-r,.5)})()}),Fl=s({},Ue,{code:"EPSG:4326",projection:no,transformation:_i(1/180,1,-1/180,.5)}),ap=s({},Re,{projection:no,transformation:_i(1,0,-1,0),scale:function(r){return Math.pow(2,r)},zoom:function(r){return Math.log(r)/Math.LN2},distance:function(r,l){var d=l.lng-r.lng,p=l.lat-r.lat;return Math.sqrt(d*d+p*p)},infinite:!0});Re.Earth=Ue,Re.EPSG3395=op,Re.EPSG3857=Ls,Re.EPSG900913=ff,Re.EPSG4326=Fl,Re.Simple=ap;var ke=dt.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(r){return r.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(r){return r&&r.removeLayer(this),this},getPane:function(r){return this._map.getPane(r?this.options[r]||r:this.options.pane)},addInteractiveTarget:function(r){return this._map._targets[u(r)]=this,this},removeInteractiveTarget:function(r){return delete this._map._targets[u(r)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(r){var l=r.target;if(l.hasLayer(this)){if(this._map=l,this._zoomAnimated=l._zoomAnimated,this.getEvents){var d=this.getEvents();l.on(d,this),this.once("remove",function(){l.off(d,this)},this)}this.onAdd(l),this.fire("add"),l.fire("layeradd",{layer:this})}}});lt.include({addLayer:function(r){if(!r._layerAdd)throw new Error("The provided object is not a Layer.");var l=u(r);return this._layers[l]?this:(this._layers[l]=r,r._mapToAdd=this,r.beforeAdd&&r.beforeAdd(this),this.whenReady(r._layerAdd,r),this)},removeLayer:function(r){var l=u(r);return this._layers[l]?(this._loaded&&r.onRemove(this),delete this._layers[l],this._loaded&&(this.fire("layerremove",{layer:r}),r.fire("remove")),r._map=r._mapToAdd=null,this):this},hasLayer:function(r){return u(r)in this._layers},eachLayer:function(r,l){for(var d in this._layers)r.call(l,this._layers[d]);return this},_addLayers:function(r){r=r?N(r)?r:[r]:[];for(var l=0,d=r.length;l<d;l++)this.addLayer(r[l])},_addZoomLimit:function(r){(!isNaN(r.options.maxZoom)||!isNaN(r.options.minZoom))&&(this._zoomBoundLayers[u(r)]=r,this._updateZoomLevels())},_removeZoomLimit:function(r){var l=u(r);this._zoomBoundLayers[l]&&(delete this._zoomBoundLayers[l],this._updateZoomLevels())},_updateZoomLevels:function(){var r=1/0,l=-1/0,d=this._getZoomSpan();for(var p in this._zoomBoundLayers){var g=this._zoomBoundLayers[p].options;r=g.minZoom===void 0?r:Math.min(r,g.minZoom),l=g.maxZoom===void 0?l:Math.max(l,g.maxZoom)}this._layersMaxZoom=l===-1/0?void 0:l,this._layersMinZoom=r===1/0?void 0:r,d!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Wn=ke.extend({initialize:function(r,l){x(this,l),this._layers={};var d,p;if(r)for(d=0,p=r.length;d<p;d++)this.addLayer(r[d])},addLayer:function(r){var l=this.getLayerId(r);return this._layers[l]=r,this._map&&this._map.addLayer(r),this},removeLayer:function(r){var l=r in this._layers?r:this.getLayerId(r);return this._map&&this._layers[l]&&this._map.removeLayer(this._layers[l]),delete this._layers[l],this},hasLayer:function(r){var l=typeof r=="number"?r:this.getLayerId(r);return l in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(r){var l=Array.prototype.slice.call(arguments,1),d,p;for(d in this._layers)p=this._layers[d],p[r]&&p[r].apply(p,l);return this},onAdd:function(r){this.eachLayer(r.addLayer,r)},onRemove:function(r){this.eachLayer(r.removeLayer,r)},eachLayer:function(r,l){for(var d in this._layers)r.call(l,this._layers[d]);return this},getLayer:function(r){return this._layers[r]},getLayers:function(){var r=[];return this.eachLayer(r.push,r),r},setZIndex:function(r){return this.invoke("setZIndex",r)},getLayerId:function(r){return u(r)}}),lp=function(r,l){return new Wn(r,l)},Be=Wn.extend({addLayer:function(r){return this.hasLayer(r)?this:(r.addEventParent(this),Wn.prototype.addLayer.call(this,r),this.fire("layeradd",{layer:r}))},removeLayer:function(r){return this.hasLayer(r)?(r in this._layers&&(r=this._layers[r]),r.removeEventParent(this),Wn.prototype.removeLayer.call(this,r),this.fire("layerremove",{layer:r})):this},setStyle:function(r){return this.invoke("setStyle",r)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var r=new ie;for(var l in this._layers){var d=this._layers[l];r.extend(d.getBounds?d.getBounds():d.getLatLng())}return r}}),cp=function(r,l){return new Be(r,l)},jn=ue.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(r){x(this,r)},createIcon:function(r){return this._createIcon("icon",r)},createShadow:function(r){return this._createIcon("shadow",r)},_createIcon:function(r,l){var d=this._getIconUrl(r);if(!d){if(r==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var p=this._createImg(d,l&&l.tagName==="IMG"?l:null);return this._setIconStyles(p,r),(this.options.crossOrigin||this.options.crossOrigin==="")&&(p.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),p},_setIconStyles:function(r,l){var d=this.options,p=d[l+"Size"];typeof p=="number"&&(p=[p,p]);var g=X(p),b=X(l==="shadow"&&d.shadowAnchor||d.iconAnchor||g&&g.divideBy(2,!0));r.className="leaflet-marker-"+l+" "+(d.className||""),b&&(r.style.marginLeft=-b.x+"px",r.style.marginTop=-b.y+"px"),g&&(r.style.width=g.x+"px",r.style.height=g.y+"px")},_createImg:function(r,l){return l=l||document.createElement("img"),l.src=r,l},_getIconUrl:function(r){return W.retina&&this.options[r+"RetinaUrl"]||this.options[r+"Url"]}});function up(r){return new jn(r)}var Ti=jn.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(r){return typeof Ti.imagePath!="string"&&(Ti.imagePath=this._detectIconPath()),(this.options.imagePath||Ti.imagePath)+jn.prototype._getIconUrl.call(this,r)},_stripUrl:function(r){var l=function(d,p,g){var b=p.exec(d);return b&&b[g]};return r=l(r,/^url\((['"])?(.+)\1\)$/,2),r&&l(r,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var r=ct("div","leaflet-default-icon-path",document.body),l=bi(r,"background-image")||bi(r,"backgroundImage");if(document.body.removeChild(r),l=this._stripUrl(l),l)return l;var d=document.querySelector('link[href$="leaflet.css"]');return d?d.href.substring(0,d.href.length-11-1):""}}),Vl=Le.extend({initialize:function(r){this._marker=r},addHooks:function(){var r=this._marker._icon;this._draggable||(this._draggable=new Ke(r,r,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),it(r,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Mt(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(r){var l=this._marker,d=l._map,p=this._marker.options.autoPanSpeed,g=this._marker.options.autoPanPadding,b=mn(l._icon),M=d.getPixelBounds(),P=d.getPixelOrigin(),E=At(M.min._subtract(P).add(g),M.max._subtract(P).subtract(g));if(!E.contains(b)){var I=X((Math.max(E.max.x,b.x)-E.max.x)/(M.max.x-E.max.x)-(Math.min(E.min.x,b.x)-E.min.x)/(M.min.x-E.min.x),(Math.max(E.max.y,b.y)-E.max.y)/(M.max.y-E.max.y)-(Math.min(E.min.y,b.y)-E.min.y)/(M.min.y-E.min.y)).multiplyBy(p);d.panBy(I,{animate:!1}),this._draggable._newPos._add(I),this._draggable._startPos._add(I),Et(l._icon,this._draggable._newPos),this._onDrag(r),this._panRequest=Tt(this._adjustPan.bind(this,r))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(r){this._marker.options.autoPan&&(Ut(this._panRequest),this._panRequest=Tt(this._adjustPan.bind(this,r)))},_onDrag:function(r){var l=this._marker,d=l._shadow,p=mn(l._icon),g=l._map.layerPointToLatLng(p);d&&Et(d,p),l._latlng=g,r.latlng=g,r.oldLatLng=this._oldLatLng,l.fire("move",r).fire("drag",r)},_onDragEnd:function(r){Ut(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",r)}}),fr=ke.extend({options:{icon:new Ti,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(r,l){x(this,l),this._latlng=at(r)},onAdd:function(r){this._zoomAnimated=this._zoomAnimated&&r.options.markerZoomAnimation,this._zoomAnimated&&r.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(r){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&r.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(r){var l=this._latlng;return this._latlng=at(r),this.update(),this.fire("move",{oldLatLng:l,latlng:this._latlng})},setZIndexOffset:function(r){return this.options.zIndexOffset=r,this.update()},getIcon:function(){return this.options.icon},setIcon:function(r){return this.options.icon=r,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var r=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(r)}return this},_initIcon:function(){var r=this.options,l="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),d=r.icon.createIcon(this._icon),p=!1;d!==this._icon&&(this._icon&&this._removeIcon(),p=!0,r.title&&(d.title=r.title),d.tagName==="IMG"&&(d.alt=r.alt||"")),it(d,l),r.keyboard&&(d.tabIndex="0",d.setAttribute("role","button")),this._icon=d,r.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&nt(d,"focus",this._panOnFocus,this);var g=r.icon.createShadow(this._shadow),b=!1;g!==this._shadow&&(this._removeShadow(),b=!0),g&&(it(g,l),g.alt=""),this._shadow=g,r.opacity<1&&this._updateOpacity(),p&&this.getPane().appendChild(this._icon),this._initInteraction(),g&&b&&this.getPane(r.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&mt(this._icon,"focus",this._panOnFocus,this),wt(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&wt(this._shadow),this._shadow=null},_setPos:function(r){this._icon&&Et(this._icon,r),this._shadow&&Et(this._shadow,r),this._zIndex=r.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(r){this._icon&&(this._icon.style.zIndex=this._zIndex+r)},_animateZoom:function(r){var l=this._map._latLngToNewLayerPoint(this._latlng,r.zoom,r.center).round();this._setPos(l)},_initInteraction:function(){if(this.options.interactive&&(it(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Vl)){var r=this.options.draggable;this.dragging&&(r=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Vl(this),r&&this.dragging.enable()}},setOpacity:function(r){return this.options.opacity=r,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var r=this.options.opacity;this._icon&&pe(this._icon,r),this._shadow&&pe(this._shadow,r)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var r=this._map;if(r){var l=this.options.icon.options,d=l.iconSize?X(l.iconSize):X(0,0),p=l.iconAnchor?X(l.iconAnchor):X(0,0);r.panInside(this._latlng,{paddingTopLeft:p,paddingBottomRight:d.subtract(p)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function dp(r,l){return new fr(r,l)}var Je=ke.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(r){this._renderer=r.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(r){return x(this,r),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&r&&Object.prototype.hasOwnProperty.call(r,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),pr=Je.extend({options:{fill:!0,radius:10},initialize:function(r,l){x(this,l),this._latlng=at(r),this._radius=this.options.radius},setLatLng:function(r){var l=this._latlng;return this._latlng=at(r),this.redraw(),this.fire("move",{oldLatLng:l,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(r){return this.options.radius=this._radius=r,this.redraw()},getRadius:function(){return this._radius},setStyle:function(r){var l=r&&r.radius||this._radius;return Je.prototype.setStyle.call(this,r),this.setRadius(l),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var r=this._radius,l=this._radiusY||r,d=this._clickTolerance(),p=[r+d,l+d];this._pxBounds=new G(this._point.subtract(p),this._point.add(p))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(r){return r.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function hp(r,l){return new pr(r,l)}var ro=pr.extend({initialize:function(r,l,d){if(typeof l=="number"&&(l=s({},d,{radius:l})),x(this,l),this._latlng=at(r),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(r){return this._mRadius=r,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var r=[this._radius,this._radiusY||this._radius];return new ie(this._map.layerPointToLatLng(this._point.subtract(r)),this._map.layerPointToLatLng(this._point.add(r)))},setStyle:Je.prototype.setStyle,_project:function(){var r=this._latlng.lng,l=this._latlng.lat,d=this._map,p=d.options.crs;if(p.distance===Ue.distance){var g=Math.PI/180,b=this._mRadius/Ue.R/g,M=d.project([l+b,r]),P=d.project([l-b,r]),E=M.add(P).divideBy(2),I=d.unproject(E).lat,$=Math.acos((Math.cos(b*g)-Math.sin(l*g)*Math.sin(I*g))/(Math.cos(l*g)*Math.cos(I*g)))/g;(isNaN($)||$===0)&&($=b/Math.cos(Math.PI/180*l)),this._point=E.subtract(d.getPixelOrigin()),this._radius=isNaN($)?0:E.x-d.project([I,r-$]).x,this._radiusY=E.y-M.y}else{var Y=p.unproject(p.project(this._latlng).subtract([this._mRadius,0]));this._point=d.latLngToLayerPoint(this._latlng),this._radius=this._point.x-d.latLngToLayerPoint(Y).x}this._updateBounds()}});function fp(r,l,d){return new ro(r,l,d)}var $e=Je.extend({options:{smoothFactor:1,noClip:!1},initialize:function(r,l){x(this,l),this._setLatLngs(r)},getLatLngs:function(){return this._latlngs},setLatLngs:function(r){return this._setLatLngs(r),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(r){for(var l=1/0,d=null,p=Ci,g,b,M=0,P=this._parts.length;M<P;M++)for(var E=this._parts[M],I=1,$=E.length;I<$;I++){g=E[I-1],b=E[I];var Y=p(r,g,b,!0);Y<l&&(l=Y,d=p(r,g,b))}return d&&(d.distance=Math.sqrt(l)),d},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return $l(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(r,l){return l=l||this._defaultShape(),r=at(r),l.push(r),this._bounds.extend(r),this.redraw()},_setLatLngs:function(r){this._bounds=new ie,this._latlngs=this._convertLatLngs(r)},_defaultShape:function(){return me(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(r){for(var l=[],d=me(r),p=0,g=r.length;p<g;p++)d?(l[p]=at(r[p]),this._bounds.extend(l[p])):l[p]=this._convertLatLngs(r[p]);return l},_project:function(){var r=new G;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,r),this._bounds.isValid()&&r.isValid()&&(this._rawPxBounds=r,this._updateBounds())},_updateBounds:function(){var r=this._clickTolerance(),l=new J(r,r);this._rawPxBounds&&(this._pxBounds=new G([this._rawPxBounds.min.subtract(l),this._rawPxBounds.max.add(l)]))},_projectLatlngs:function(r,l,d){var p=r[0]instanceof ft,g=r.length,b,M;if(p){for(M=[],b=0;b<g;b++)M[b]=this._map.latLngToLayerPoint(r[b]),d.extend(M[b]);l.push(M)}else for(b=0;b<g;b++)this._projectLatlngs(r[b],l,d)},_clipPoints:function(){var r=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(r))){if(this.options.noClip){this._parts=this._rings;return}var l=this._parts,d,p,g,b,M,P,E;for(d=0,g=0,b=this._rings.length;d<b;d++)for(E=this._rings[d],p=0,M=E.length;p<M-1;p++)P=Rl(E[p],E[p+1],r,p,!0),P&&(l[g]=l[g]||[],l[g].push(P[0]),(P[1]!==E[p+1]||p===M-2)&&(l[g].push(P[1]),g++))}},_simplifyPoints:function(){for(var r=this._parts,l=this.options.smoothFactor,d=0,p=r.length;d<p;d++)r[d]=Nl(r[d],l)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(r,l){var d,p,g,b,M,P,E=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(r))return!1;for(d=0,b=this._parts.length;d<b;d++)for(P=this._parts[d],p=0,M=P.length,g=M-1;p<M;g=p++)if(!(!l&&p===0)&&Dl(r,P[g],P[p])<=E)return!0;return!1}});function pp(r,l){return new $e(r,l)}$e._flat=Bl;var qn=$e.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Il(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(r){var l=$e.prototype._convertLatLngs.call(this,r),d=l.length;return d>=2&&l[0]instanceof ft&&l[0].equals(l[d-1])&&l.pop(),l},_setLatLngs:function(r){$e.prototype._setLatLngs.call(this,r),me(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return me(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var r=this._renderer._bounds,l=this.options.weight,d=new J(l,l);if(r=new G(r.min.subtract(d),r.max.add(d)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(r))){if(this.options.noClip){this._parts=this._rings;return}for(var p=0,g=this._rings.length,b;p<g;p++)b=Al(this._rings[p],r,!0),b.length&&this._parts.push(b)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(r){var l=!1,d,p,g,b,M,P,E,I;if(!this._pxBounds||!this._pxBounds.contains(r))return!1;for(b=0,E=this._parts.length;b<E;b++)for(d=this._parts[b],M=0,I=d.length,P=I-1;M<I;P=M++)p=d[M],g=d[P],p.y>r.y!=g.y>r.y&&r.x<(g.x-p.x)*(r.y-p.y)/(g.y-p.y)+p.x&&(l=!l);return l||$e.prototype._containsPoint.call(this,r,!0)}});function mp(r,l){return new qn(r,l)}var Fe=Be.extend({initialize:function(r,l){x(this,l),this._layers={},r&&this.addData(r)},addData:function(r){var l=N(r)?r:r.features,d,p,g;if(l){for(d=0,p=l.length;d<p;d++)g=l[d],(g.geometries||g.geometry||g.features||g.coordinates)&&this.addData(g);return this}var b=this.options;if(b.filter&&!b.filter(r))return this;var M=mr(r,b);return M?(M.feature=yr(r),M.defaultOptions=M.options,this.resetStyle(M),b.onEachFeature&&b.onEachFeature(r,M),this.addLayer(M)):this},resetStyle:function(r){return r===void 0?this.eachLayer(this.resetStyle,this):(r.options=s({},r.defaultOptions),this._setLayerStyle(r,this.options.style),this)},setStyle:function(r){return this.eachLayer(function(l){this._setLayerStyle(l,r)},this)},_setLayerStyle:function(r,l){r.setStyle&&(typeof l=="function"&&(l=l(r.feature)),r.setStyle(l))}});function mr(r,l){var d=r.type==="Feature"?r.geometry:r,p=d?d.coordinates:null,g=[],b=l&&l.pointToLayer,M=l&&l.coordsToLatLng||so,P,E,I,$;if(!p&&!d)return null;switch(d.type){case"Point":return P=M(p),Zl(b,r,P,l);case"MultiPoint":for(I=0,$=p.length;I<$;I++)P=M(p[I]),g.push(Zl(b,r,P,l));return new Be(g);case"LineString":case"MultiLineString":return E=gr(p,d.type==="LineString"?0:1,M),new $e(E,l);case"Polygon":case"MultiPolygon":return E=gr(p,d.type==="Polygon"?1:2,M),new qn(E,l);case"GeometryCollection":for(I=0,$=d.geometries.length;I<$;I++){var Y=mr({geometry:d.geometries[I],type:"Feature",properties:r.properties},l);Y&&g.push(Y)}return new Be(g);case"FeatureCollection":for(I=0,$=d.features.length;I<$;I++){var rt=mr(d.features[I],l);rt&&g.push(rt)}return new Be(g);default:throw new Error("Invalid GeoJSON object.")}}function Zl(r,l,d,p){return r?r(l,d):new fr(d,p&&p.markersInheritOptions&&p)}function so(r){return new ft(r[1],r[0],r[2])}function gr(r,l,d){for(var p=[],g=0,b=r.length,M;g<b;g++)M=l?gr(r[g],l-1,d):(d||so)(r[g]),p.push(M);return p}function oo(r,l){return r=at(r),r.alt!==void 0?[_(r.lng,l),_(r.lat,l),_(r.alt,l)]:[_(r.lng,l),_(r.lat,l)]}function _r(r,l,d,p){for(var g=[],b=0,M=r.length;b<M;b++)g.push(l?_r(r[b],me(r[b])?0:l-1,d,p):oo(r[b],p));return!l&&d&&g.length>0&&g.push(g[0].slice()),g}function Un(r,l){return r.feature?s({},r.feature,{geometry:l}):yr(l)}function yr(r){return r.type==="Feature"||r.type==="FeatureCollection"?r:{type:"Feature",properties:{},geometry:r}}var ao={toGeoJSON:function(r){return Un(this,{type:"Point",coordinates:oo(this.getLatLng(),r)})}};fr.include(ao),ro.include(ao),pr.include(ao),$e.include({toGeoJSON:function(r){var l=!me(this._latlngs),d=_r(this._latlngs,l?1:0,!1,r);return Un(this,{type:(l?"Multi":"")+"LineString",coordinates:d})}}),qn.include({toGeoJSON:function(r){var l=!me(this._latlngs),d=l&&!me(this._latlngs[0]),p=_r(this._latlngs,d?2:l?1:0,!0,r);return l||(p=[p]),Un(this,{type:(d?"Multi":"")+"Polygon",coordinates:p})}}),Wn.include({toMultiPoint:function(r){var l=[];return this.eachLayer(function(d){l.push(d.toGeoJSON(r).geometry.coordinates)}),Un(this,{type:"MultiPoint",coordinates:l})},toGeoJSON:function(r){var l=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(l==="MultiPoint")return this.toMultiPoint(r);var d=l==="GeometryCollection",p=[];return this.eachLayer(function(g){if(g.toGeoJSON){var b=g.toGeoJSON(r);if(d)p.push(b.geometry);else{var M=yr(b);M.type==="FeatureCollection"?p.push.apply(p,M.features):p.push(M)}}}),d?Un(this,{geometries:p,type:"GeometryCollection"}):{type:"FeatureCollection",features:p}}});function Hl(r,l){return new Fe(r,l)}var gp=Hl,vr=ke.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(r,l,d){this._url=r,this._bounds=Pt(l),x(this,d)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(it(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){wt(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(r){return this.options.opacity=r,this._image&&this._updateOpacity(),this},setStyle:function(r){return r.opacity&&this.setOpacity(r.opacity),this},bringToFront:function(){return this._map&&Zn(this._image),this},bringToBack:function(){return this._map&&Hn(this._image),this},setUrl:function(r){return this._url=r,this._image&&(this._image.src=r),this},setBounds:function(r){return this._bounds=Pt(r),this._map&&this._reset(),this},getEvents:function(){var r={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(r.zoomanim=this._animateZoom),r},setZIndex:function(r){return this.options.zIndex=r,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var r=this._url.tagName==="IMG",l=this._image=r?this._url:ct("img");if(it(l,"leaflet-image-layer"),this._zoomAnimated&&it(l,"leaflet-zoom-animated"),this.options.className&&it(l,this.options.className),l.onselectstart=m,l.onmousemove=m,l.onload=a(this.fire,this,"load"),l.onerror=a(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(l.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),r){this._url=l.src;return}l.src=this._url,l.alt=this.options.alt},_animateZoom:function(r){var l=this._map.getZoomScale(r.zoom),d=this._map._latLngBoundsToNewLayerBounds(this._bounds,r.zoom,r.center).min;pn(this._image,d,l)},_reset:function(){var r=this._image,l=new G(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),d=l.getSize();Et(r,l.min),r.style.width=d.x+"px",r.style.height=d.y+"px"},_updateOpacity:function(){pe(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var r=this.options.errorOverlayUrl;r&&this._url!==r&&(this._url=r,this._image.src=r)},getCenter:function(){return this._bounds.getCenter()}}),_p=function(r,l,d){return new vr(r,l,d)},Wl=vr.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var r=this._url.tagName==="VIDEO",l=this._image=r?this._url:ct("video");if(it(l,"leaflet-image-layer"),this._zoomAnimated&&it(l,"leaflet-zoom-animated"),this.options.className&&it(l,this.options.className),l.onselectstart=m,l.onmousemove=m,l.onloadeddata=a(this.fire,this,"load"),r){for(var d=l.getElementsByTagName("source"),p=[],g=0;g<d.length;g++)p.push(d[g].src);this._url=d.length>0?p:[l.src];return}N(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(l.style,"objectFit")&&(l.style.objectFit="fill"),l.autoplay=!!this.options.autoplay,l.loop=!!this.options.loop,l.muted=!!this.options.muted,l.playsInline=!!this.options.playsInline;for(var b=0;b<this._url.length;b++){var M=ct("source");M.src=this._url[b],l.appendChild(M)}}});function yp(r,l,d){return new Wl(r,l,d)}var jl=vr.extend({_initImage:function(){var r=this._image=this._url;it(r,"leaflet-image-layer"),this._zoomAnimated&&it(r,"leaflet-zoom-animated"),this.options.className&&it(r,this.options.className),r.onselectstart=m,r.onmousemove=m}});function vp(r,l,d){return new jl(r,l,d)}var Ae=ke.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(r,l){r&&(r instanceof ft||N(r))?(this._latlng=at(r),x(this,l)):(x(this,r),this._source=l),this.options.content&&(this._content=this.options.content)},openOn:function(r){return r=arguments.length?r:this._source._map,r.hasLayer(this)||r.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(r){return this._map?this.close():(arguments.length?this._source=r:r=this._source,this._prepareOpen(),this.openOn(r._map)),this},onAdd:function(r){this._zoomAnimated=r._zoomAnimated,this._container||this._initLayout(),r._fadeAnimated&&pe(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),r._fadeAnimated&&pe(this._container,1),this.bringToFront(),this.options.interactive&&(it(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(r){r._fadeAnimated?(pe(this._container,0),this._removeTimeout=setTimeout(a(wt,void 0,this._container),200)):wt(this._container),this.options.interactive&&(Mt(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(r){return this._latlng=at(r),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(r){return this._content=r,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var r={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(r.zoomanim=this._animateZoom),r},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Zn(this._container),this},bringToBack:function(){return this._map&&Hn(this._container),this},_prepareOpen:function(r){var l=this._source;if(!l._map)return!1;if(l instanceof Be){l=null;var d=this._source._layers;for(var p in d)if(d[p]._map){l=d[p];break}if(!l)return!1;this._source=l}if(!r)if(l.getCenter)r=l.getCenter();else if(l.getLatLng)r=l.getLatLng();else if(l.getBounds)r=l.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(r),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var r=this._contentNode,l=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof l=="string")r.innerHTML=l;else{for(;r.hasChildNodes();)r.removeChild(r.firstChild);r.appendChild(l)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var r=this._map.latLngToLayerPoint(this._latlng),l=X(this.options.offset),d=this._getAnchor();this._zoomAnimated?Et(this._container,r.add(d)):l=l.add(r).add(d);var p=this._containerBottom=-l.y,g=this._containerLeft=-Math.round(this._containerWidth/2)+l.x;this._container.style.bottom=p+"px",this._container.style.left=g+"px"}},_getAnchor:function(){return[0,0]}});lt.include({_initOverlay:function(r,l,d,p){var g=l;return g instanceof r||(g=new r(p).setContent(l)),d&&g.setLatLng(d),g}}),ke.include({_initOverlay:function(r,l,d,p){var g=d;return g instanceof r?(x(g,p),g._source=this):(g=l&&!p?l:new r(p,this),g.setContent(d)),g}});var br=Ae.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(r){return r=arguments.length?r:this._source._map,!r.hasLayer(this)&&r._popup&&r._popup.options.autoClose&&r.removeLayer(r._popup),r._popup=this,Ae.prototype.openOn.call(this,r)},onAdd:function(r){Ae.prototype.onAdd.call(this,r),r.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Je||this._source.on("preclick",gn))},onRemove:function(r){Ae.prototype.onRemove.call(this,r),r.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Je||this._source.off("preclick",gn))},getEvents:function(){var r=Ae.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(r.preclick=this.close),this.options.keepInView&&(r.moveend=this._adjustPan),r},_initLayout:function(){var r="leaflet-popup",l=this._container=ct("div",r+" "+(this.options.className||"")+" leaflet-zoom-animated"),d=this._wrapper=ct("div",r+"-content-wrapper",l);if(this._contentNode=ct("div",r+"-content",d),Si(l),Gs(this._contentNode),nt(l,"contextmenu",gn),this._tipContainer=ct("div",r+"-tip-container",l),this._tip=ct("div",r+"-tip",this._tipContainer),this.options.closeButton){var p=this._closeButton=ct("a",r+"-close-button",l);p.setAttribute("role","button"),p.setAttribute("aria-label","Close popup"),p.href="#close",p.innerHTML='<span aria-hidden="true">&#215;</span>',nt(p,"click",function(g){Ht(g),this.close()},this)}},_updateLayout:function(){var r=this._contentNode,l=r.style;l.width="",l.whiteSpace="nowrap";var d=r.offsetWidth;d=Math.min(d,this.options.maxWidth),d=Math.max(d,this.options.minWidth),l.width=d+1+"px",l.whiteSpace="",l.height="";var p=r.offsetHeight,g=this.options.maxHeight,b="leaflet-popup-scrolled";g&&p>g?(l.height=g+"px",it(r,b)):Mt(r,b),this._containerWidth=this._container.offsetWidth},_animateZoom:function(r){var l=this._map._latLngToNewLayerPoint(this._latlng,r.zoom,r.center),d=this._getAnchor();Et(this._container,l.add(d))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var r=this._map,l=parseInt(bi(this._container,"marginBottom"),10)||0,d=this._container.offsetHeight+l,p=this._containerWidth,g=new J(this._containerLeft,-d-this._containerBottom);g._add(mn(this._container));var b=r.layerPointToContainerPoint(g),M=X(this.options.autoPanPadding),P=X(this.options.autoPanPaddingTopLeft||M),E=X(this.options.autoPanPaddingBottomRight||M),I=r.getSize(),$=0,Y=0;b.x+p+E.x>I.x&&($=b.x+p-I.x+E.x),b.x-$-P.x<0&&($=b.x-P.x),b.y+d+E.y>I.y&&(Y=b.y+d-I.y+E.y),b.y-Y-P.y<0&&(Y=b.y-P.y),($||Y)&&(this.options.keepInView&&(this._autopanning=!0),r.fire("autopanstart").panBy([$,Y]))}},_getAnchor:function(){return X(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),bp=function(r,l){return new br(r,l)};lt.mergeOptions({closePopupOnClick:!0}),lt.include({openPopup:function(r,l,d){return this._initOverlay(br,r,l,d).openOn(this),this},closePopup:function(r){return r=arguments.length?r:this._popup,r&&r.close(),this}}),ke.include({bindPopup:function(r,l){return this._popup=this._initOverlay(br,this._popup,r,l),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(r){return this._popup&&(this instanceof Be||(this._popup._source=this),this._popup._prepareOpen(r||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(r){return this._popup&&this._popup.setContent(r),this},getPopup:function(){return this._popup},_openPopup:function(r){if(!(!this._popup||!this._map)){_n(r);var l=r.layer||r.target;if(this._popup._source===l&&!(l instanceof Je)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(r.latlng);return}this._popup._source=l,this.openPopup(r.latlng)}},_movePopup:function(r){this._popup.setLatLng(r.latlng)},_onKeyPress:function(r){r.originalEvent.keyCode===13&&this._openPopup(r)}});var xr=Ae.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(r){Ae.prototype.onAdd.call(this,r),this.setOpacity(this.options.opacity),r.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(r){Ae.prototype.onRemove.call(this,r),r.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var r=Ae.prototype.getEvents.call(this);return this.options.permanent||(r.preclick=this.close),r},_initLayout:function(){var r="leaflet-tooltip",l=r+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=ct("div",l),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+u(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(r){var l,d,p=this._map,g=this._container,b=p.latLngToContainerPoint(p.getCenter()),M=p.layerPointToContainerPoint(r),P=this.options.direction,E=g.offsetWidth,I=g.offsetHeight,$=X(this.options.offset),Y=this._getAnchor();P==="top"?(l=E/2,d=I):P==="bottom"?(l=E/2,d=0):P==="center"?(l=E/2,d=I/2):P==="right"?(l=0,d=I/2):P==="left"?(l=E,d=I/2):M.x<b.x?(P="right",l=0,d=I/2):(P="left",l=E+($.x+Y.x)*2,d=I/2),r=r.subtract(X(l,d,!0)).add($).add(Y),Mt(g,"leaflet-tooltip-right"),Mt(g,"leaflet-tooltip-left"),Mt(g,"leaflet-tooltip-top"),Mt(g,"leaflet-tooltip-bottom"),it(g,"leaflet-tooltip-"+P),Et(g,r)},_updatePosition:function(){var r=this._map.latLngToLayerPoint(this._latlng);this._setPosition(r)},setOpacity:function(r){this.options.opacity=r,this._container&&pe(this._container,r)},_animateZoom:function(r){var l=this._map._latLngToNewLayerPoint(this._latlng,r.zoom,r.center);this._setPosition(l)},_getAnchor:function(){return X(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),xp=function(r,l){return new xr(r,l)};lt.include({openTooltip:function(r,l,d){return this._initOverlay(xr,r,l,d).openOn(this),this},closeTooltip:function(r){return r.close(),this}}),ke.include({bindTooltip:function(r,l){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(xr,this._tooltip,r,l),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(r){if(!(!r&&this._tooltipHandlersAdded)){var l=r?"off":"on",d={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?d.add=this._openTooltip:(d.mouseover=this._openTooltip,d.mouseout=this.closeTooltip,d.click=this._openTooltip,this._map?this._addFocusListeners():d.add=this._addFocusListeners),this._tooltip.options.sticky&&(d.mousemove=this._moveTooltip),this[l](d),this._tooltipHandlersAdded=!r}},openTooltip:function(r){return this._tooltip&&(this instanceof Be||(this._tooltip._source=this),this._tooltip._prepareOpen(r)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(r){return this._tooltip&&this._tooltip.setContent(r),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(r){var l=typeof r.getElement=="function"&&r.getElement();l&&(nt(l,"focus",function(){this._tooltip._source=r,this.openTooltip()},this),nt(l,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(r){var l=typeof r.getElement=="function"&&r.getElement();l&&l.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(r){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var l=this;this._map.once("moveend",function(){l._openOnceFlag=!1,l._openTooltip(r)});return}this._tooltip._source=r.layer||r.target,this.openTooltip(this._tooltip.options.sticky?r.latlng:void 0)}},_moveTooltip:function(r){var l=r.latlng,d,p;this._tooltip.options.sticky&&r.originalEvent&&(d=this._map.mouseEventToContainerPoint(r.originalEvent),p=this._map.containerPointToLayerPoint(d),l=this._map.layerPointToLatLng(p)),this._tooltip.setLatLng(l)}});var ql=jn.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(r){var l=r&&r.tagName==="DIV"?r:document.createElement("div"),d=this.options;if(d.html instanceof Element?(ar(l),l.appendChild(d.html)):l.innerHTML=d.html!==!1?d.html:"",d.bgPos){var p=X(d.bgPos);l.style.backgroundPosition=-p.x+"px "+-p.y+"px"}return this._setIconStyles(l,"icon"),l},createShadow:function(){return null}});function wp(r){return new ql(r)}jn.Default=Ti;var Pi=ke.extend({options:{tileSize:256,opacity:1,updateWhenIdle:W.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(r){x(this,r)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(r){r._addZoomLimit(this)},onRemove:function(r){this._removeAllTiles(),wt(this._container),r._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Zn(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Hn(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(r){return this.options.opacity=r,this._updateOpacity(),this},setZIndex:function(r){return this.options.zIndex=r,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var r=this._clampZoom(this._map.getZoom());r!==this._tileZoom&&(this._tileZoom=r,this._updateLevels()),this._update()}return this},getEvents:function(){var r={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=h(this._onMoveEnd,this.options.updateInterval,this)),r.move=this._onMove),this._zoomAnimated&&(r.zoomanim=this._animateZoom),r},createTile:function(){return document.createElement("div")},getTileSize:function(){var r=this.options.tileSize;return r instanceof J?r:new J(r,r)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(r){for(var l=this.getPane().children,d=-r(-1/0,1/0),p=0,g=l.length,b;p<g;p++)b=l[p].style.zIndex,l[p]!==this._container&&b&&(d=r(d,+b));isFinite(d)&&(this.options.zIndex=d+r(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!W.ielt9){pe(this._container,this.options.opacity);var r=+new Date,l=!1,d=!1;for(var p in this._tiles){var g=this._tiles[p];if(!(!g.current||!g.loaded)){var b=Math.min(1,(r-g.loaded)/200);pe(g.el,b),b<1?l=!0:(g.active?d=!0:this._onOpaqueTile(g),g.active=!0)}}d&&!this._noPrune&&this._pruneTiles(),l&&(Ut(this._fadeFrame),this._fadeFrame=Tt(this._updateOpacity,this))}},_onOpaqueTile:m,_initContainer:function(){this._container||(this._container=ct("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var r=this._tileZoom,l=this.options.maxZoom;if(r!==void 0){for(var d in this._levels)d=Number(d),this._levels[d].el.children.length||d===r?(this._levels[d].el.style.zIndex=l-Math.abs(r-d),this._onUpdateLevel(d)):(wt(this._levels[d].el),this._removeTilesAtZoom(d),this._onRemoveLevel(d),delete this._levels[d]);var p=this._levels[r],g=this._map;return p||(p=this._levels[r]={},p.el=ct("div","leaflet-tile-container leaflet-zoom-animated",this._container),p.el.style.zIndex=l,p.origin=g.project(g.unproject(g.getPixelOrigin()),r).round(),p.zoom=r,this._setZoomTransform(p,g.getCenter(),g.getZoom()),m(p.el.offsetWidth),this._onCreateLevel(p)),this._level=p,p}},_onUpdateLevel:m,_onRemoveLevel:m,_onCreateLevel:m,_pruneTiles:function(){if(this._map){var r,l,d=this._map.getZoom();if(d>this.options.maxZoom||d<this.options.minZoom){this._removeAllTiles();return}for(r in this._tiles)l=this._tiles[r],l.retain=l.current;for(r in this._tiles)if(l=this._tiles[r],l.current&&!l.active){var p=l.coords;this._retainParent(p.x,p.y,p.z,p.z-5)||this._retainChildren(p.x,p.y,p.z,p.z+2)}for(r in this._tiles)this._tiles[r].retain||this._removeTile(r)}},_removeTilesAtZoom:function(r){for(var l in this._tiles)this._tiles[l].coords.z===r&&this._removeTile(l)},_removeAllTiles:function(){for(var r in this._tiles)this._removeTile(r)},_invalidateAll:function(){for(var r in this._levels)wt(this._levels[r].el),this._onRemoveLevel(Number(r)),delete this._levels[r];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(r,l,d,p){var g=Math.floor(r/2),b=Math.floor(l/2),M=d-1,P=new J(+g,+b);P.z=+M;var E=this._tileCoordsToKey(P),I=this._tiles[E];return I&&I.active?(I.retain=!0,!0):(I&&I.loaded&&(I.retain=!0),M>p?this._retainParent(g,b,M,p):!1)},_retainChildren:function(r,l,d,p){for(var g=2*r;g<2*r+2;g++)for(var b=2*l;b<2*l+2;b++){var M=new J(g,b);M.z=d+1;var P=this._tileCoordsToKey(M),E=this._tiles[P];if(E&&E.active){E.retain=!0;continue}else E&&E.loaded&&(E.retain=!0);d+1<p&&this._retainChildren(g,b,d+1,p)}},_resetView:function(r){var l=r&&(r.pinch||r.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),l,l)},_animateZoom:function(r){this._setView(r.center,r.zoom,!0,r.noUpdate)},_clampZoom:function(r){var l=this.options;return l.minNativeZoom!==void 0&&r<l.minNativeZoom?l.minNativeZoom:l.maxNativeZoom!==void 0&&l.maxNativeZoom<r?l.maxNativeZoom:r},_setView:function(r,l,d,p){var g=Math.round(l);this.options.maxZoom!==void 0&&g>this.options.maxZoom||this.options.minZoom!==void 0&&g<this.options.minZoom?g=void 0:g=this._clampZoom(g);var b=this.options.updateWhenZooming&&g!==this._tileZoom;(!p||b)&&(this._tileZoom=g,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),g!==void 0&&this._update(r),d||this._pruneTiles(),this._noPrune=!!d),this._setZoomTransforms(r,l)},_setZoomTransforms:function(r,l){for(var d in this._levels)this._setZoomTransform(this._levels[d],r,l)},_setZoomTransform:function(r,l,d){var p=this._map.getZoomScale(d,r.zoom),g=r.origin.multiplyBy(p).subtract(this._map._getNewPixelOrigin(l,d)).round();W.any3d?pn(r.el,g,p):Et(r.el,g)},_resetGrid:function(){var r=this._map,l=r.options.crs,d=this._tileSize=this.getTileSize(),p=this._tileZoom,g=this._map.getPixelWorldBounds(this._tileZoom);g&&(this._globalTileRange=this._pxBoundsToTileRange(g)),this._wrapX=l.wrapLng&&!this.options.noWrap&&[Math.floor(r.project([0,l.wrapLng[0]],p).x/d.x),Math.ceil(r.project([0,l.wrapLng[1]],p).x/d.y)],this._wrapY=l.wrapLat&&!this.options.noWrap&&[Math.floor(r.project([l.wrapLat[0],0],p).y/d.x),Math.ceil(r.project([l.wrapLat[1],0],p).y/d.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(r){var l=this._map,d=l._animatingZoom?Math.max(l._animateToZoom,l.getZoom()):l.getZoom(),p=l.getZoomScale(d,this._tileZoom),g=l.project(r,this._tileZoom).floor(),b=l.getSize().divideBy(p*2);return new G(g.subtract(b),g.add(b))},_update:function(r){var l=this._map;if(l){var d=this._clampZoom(l.getZoom());if(r===void 0&&(r=l.getCenter()),this._tileZoom!==void 0){var p=this._getTiledPixelBounds(r),g=this._pxBoundsToTileRange(p),b=g.getCenter(),M=[],P=this.options.keepBuffer,E=new G(g.getBottomLeft().subtract([P,-P]),g.getTopRight().add([P,-P]));if(!(isFinite(g.min.x)&&isFinite(g.min.y)&&isFinite(g.max.x)&&isFinite(g.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var I in this._tiles){var $=this._tiles[I].coords;($.z!==this._tileZoom||!E.contains(new J($.x,$.y)))&&(this._tiles[I].current=!1)}if(Math.abs(d-this._tileZoom)>1){this._setView(r,d);return}for(var Y=g.min.y;Y<=g.max.y;Y++)for(var rt=g.min.x;rt<=g.max.x;rt++){var Yt=new J(rt,Y);if(Yt.z=this._tileZoom,!!this._isValidTile(Yt)){var Rt=this._tiles[this._tileCoordsToKey(Yt)];Rt?Rt.current=!0:M.push(Yt)}}if(M.sort(function(re,Jn){return re.distanceTo(b)-Jn.distanceTo(b)}),M.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var ge=document.createDocumentFragment();for(rt=0;rt<M.length;rt++)this._addTile(M[rt],ge);this._level.el.appendChild(ge)}}}},_isValidTile:function(r){var l=this._map.options.crs;if(!l.infinite){var d=this._globalTileRange;if(!l.wrapLng&&(r.x<d.min.x||r.x>d.max.x)||!l.wrapLat&&(r.y<d.min.y||r.y>d.max.y))return!1}if(!this.options.bounds)return!0;var p=this._tileCoordsToBounds(r);return Pt(this.options.bounds).overlaps(p)},_keyToBounds:function(r){return this._tileCoordsToBounds(this._keyToTileCoords(r))},_tileCoordsToNwSe:function(r){var l=this._map,d=this.getTileSize(),p=r.scaleBy(d),g=p.add(d),b=l.unproject(p,r.z),M=l.unproject(g,r.z);return[b,M]},_tileCoordsToBounds:function(r){var l=this._tileCoordsToNwSe(r),d=new ie(l[0],l[1]);return this.options.noWrap||(d=this._map.wrapLatLngBounds(d)),d},_tileCoordsToKey:function(r){return r.x+":"+r.y+":"+r.z},_keyToTileCoords:function(r){var l=r.split(":"),d=new J(+l[0],+l[1]);return d.z=+l[2],d},_removeTile:function(r){var l=this._tiles[r];l&&(wt(l.el),delete this._tiles[r],this.fire("tileunload",{tile:l.el,coords:this._keyToTileCoords(r)}))},_initTile:function(r){it(r,"leaflet-tile");var l=this.getTileSize();r.style.width=l.x+"px",r.style.height=l.y+"px",r.onselectstart=m,r.onmousemove=m,W.ielt9&&this.options.opacity<1&&pe(r,this.options.opacity)},_addTile:function(r,l){var d=this._getTilePos(r),p=this._tileCoordsToKey(r),g=this.createTile(this._wrapCoords(r),a(this._tileReady,this,r));this._initTile(g),this.createTile.length<2&&Tt(a(this._tileReady,this,r,null,g)),Et(g,d),this._tiles[p]={el:g,coords:r,current:!0},l.appendChild(g),this.fire("tileloadstart",{tile:g,coords:r})},_tileReady:function(r,l,d){l&&this.fire("tileerror",{error:l,tile:d,coords:r});var p=this._tileCoordsToKey(r);d=this._tiles[p],d&&(d.loaded=+new Date,this._map._fadeAnimated?(pe(d.el,0),Ut(this._fadeFrame),this._fadeFrame=Tt(this._updateOpacity,this)):(d.active=!0,this._pruneTiles()),l||(it(d.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:d.el,coords:r})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),W.ielt9||!this._map._fadeAnimated?Tt(this._pruneTiles,this):setTimeout(a(this._pruneTiles,this),250)))},_getTilePos:function(r){return r.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(r){var l=new J(this._wrapX?f(r.x,this._wrapX):r.x,this._wrapY?f(r.y,this._wrapY):r.y);return l.z=r.z,l},_pxBoundsToTileRange:function(r){var l=this.getTileSize();return new G(r.min.unscaleBy(l).floor(),r.max.unscaleBy(l).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var r in this._tiles)if(!this._tiles[r].loaded)return!1;return!0}});function kp(r){return new Pi(r)}var Kn=Pi.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(r,l){this._url=r,l=x(this,l),l.detectRetina&&W.retina&&l.maxZoom>0?(l.tileSize=Math.floor(l.tileSize/2),l.zoomReverse?(l.zoomOffset--,l.minZoom=Math.min(l.maxZoom,l.minZoom+1)):(l.zoomOffset++,l.maxZoom=Math.max(l.minZoom,l.maxZoom-1)),l.minZoom=Math.max(0,l.minZoom)):l.zoomReverse?l.minZoom=Math.min(l.maxZoom,l.minZoom):l.maxZoom=Math.max(l.minZoom,l.maxZoom),typeof l.subdomains=="string"&&(l.subdomains=l.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(r,l){return this._url===r&&l===void 0&&(l=!0),this._url=r,l||this.redraw(),this},createTile:function(r,l){var d=document.createElement("img");return nt(d,"load",a(this._tileOnLoad,this,l,d)),nt(d,"error",a(this._tileOnError,this,l,d)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(d.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(d.referrerPolicy=this.options.referrerPolicy),d.alt="",d.src=this.getTileUrl(r),d},getTileUrl:function(r){var l={r:W.retina?"@2x":"",s:this._getSubdomain(r),x:r.x,y:r.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var d=this._globalTileRange.max.y-r.y;this.options.tms&&(l.y=d),l["-y"]=d}return O(this._url,s(l,this.options))},_tileOnLoad:function(r,l){W.ielt9?setTimeout(a(r,this,null,l),0):r(null,l)},_tileOnError:function(r,l,d){var p=this.options.errorTileUrl;p&&l.getAttribute("src")!==p&&(l.src=p),r(d,l)},_onTileRemove:function(r){r.tile.onload=null},_getZoomForUrl:function(){var r=this._tileZoom,l=this.options.maxZoom,d=this.options.zoomReverse,p=this.options.zoomOffset;return d&&(r=l-r),r+p},_getSubdomain:function(r){var l=Math.abs(r.x+r.y)%this.options.subdomains.length;return this.options.subdomains[l]},_abortLoading:function(){var r,l;for(r in this._tiles)if(this._tiles[r].coords.z!==this._tileZoom&&(l=this._tiles[r].el,l.onload=m,l.onerror=m,!l.complete)){l.src=F;var d=this._tiles[r].coords;wt(l),delete this._tiles[r],this.fire("tileabort",{tile:l,coords:d})}},_removeTile:function(r){var l=this._tiles[r];if(l)return l.el.setAttribute("src",F),Pi.prototype._removeTile.call(this,r)},_tileReady:function(r,l,d){if(!(!this._map||d&&d.getAttribute("src")===F))return Pi.prototype._tileReady.call(this,r,l,d)}});function Ul(r,l){return new Kn(r,l)}var Kl=Kn.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(r,l){this._url=r;var d=s({},this.defaultWmsParams);for(var p in l)p in this.options||(d[p]=l[p]);l=x(this,l);var g=l.detectRetina&&W.retina?2:1,b=this.getTileSize();d.width=b.x*g,d.height=b.y*g,this.wmsParams=d},onAdd:function(r){this._crs=this.options.crs||r.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var l=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[l]=this._crs.code,Kn.prototype.onAdd.call(this,r)},getTileUrl:function(r){var l=this._tileCoordsToNwSe(r),d=this._crs,p=At(d.project(l[0]),d.project(l[1])),g=p.min,b=p.max,M=(this._wmsVersion>=1.3&&this._crs===Fl?[g.y,g.x,b.y,b.x]:[g.x,g.y,b.x,b.y]).join(","),P=Kn.prototype.getTileUrl.call(this,r);return P+k(this.wmsParams,P,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+M},setParams:function(r,l){return s(this.wmsParams,r),l||this.redraw(),this}});function Sp(r,l){return new Kl(r,l)}Kn.WMS=Kl,Ul.wms=Sp;var Ve=ke.extend({options:{padding:.1},initialize:function(r){x(this,r),u(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),it(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var r={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(r.zoomanim=this._onAnimZoom),r},_onAnimZoom:function(r){this._updateTransform(r.center,r.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(r,l){var d=this._map.getZoomScale(l,this._zoom),p=this._map.getSize().multiplyBy(.5+this.options.padding),g=this._map.project(this._center,l),b=p.multiplyBy(-d).add(g).subtract(this._map._getNewPixelOrigin(r,l));W.any3d?pn(this._container,b,d):Et(this._container,b)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var r in this._layers)this._layers[r]._reset()},_onZoomEnd:function(){for(var r in this._layers)this._layers[r]._project()},_updatePaths:function(){for(var r in this._layers)this._layers[r]._update()},_update:function(){var r=this.options.padding,l=this._map.getSize(),d=this._map.containerPointToLayerPoint(l.multiplyBy(-r)).round();this._bounds=new G(d,d.add(l.multiplyBy(1+r*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Jl=Ve.extend({options:{tolerance:0},getEvents:function(){var r=Ve.prototype.getEvents.call(this);return r.viewprereset=this._onViewPreReset,r},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Ve.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var r=this._container=document.createElement("canvas");nt(r,"mousemove",this._onMouseMove,this),nt(r,"click dblclick mousedown mouseup contextmenu",this._onClick,this),nt(r,"mouseout",this._handleMouseOut,this),r._leaflet_disable_events=!0,this._ctx=r.getContext("2d")},_destroyContainer:function(){Ut(this._redrawRequest),delete this._ctx,wt(this._container),mt(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var r;this._redrawBounds=null;for(var l in this._layers)r=this._layers[l],r._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Ve.prototype._update.call(this);var r=this._bounds,l=this._container,d=r.getSize(),p=W.retina?2:1;Et(l,r.min),l.width=p*d.x,l.height=p*d.y,l.style.width=d.x+"px",l.style.height=d.y+"px",W.retina&&this._ctx.scale(2,2),this._ctx.translate(-r.min.x,-r.min.y),this.fire("update")}},_reset:function(){Ve.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(r){this._updateDashArray(r),this._layers[u(r)]=r;var l=r._order={layer:r,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=l),this._drawLast=l,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(r){this._requestRedraw(r)},_removePath:function(r){var l=r._order,d=l.next,p=l.prev;d?d.prev=p:this._drawLast=p,p?p.next=d:this._drawFirst=d,delete r._order,delete this._layers[u(r)],this._requestRedraw(r)},_updatePath:function(r){this._extendRedrawBounds(r),r._project(),r._update(),this._requestRedraw(r)},_updateStyle:function(r){this._updateDashArray(r),this._requestRedraw(r)},_updateDashArray:function(r){if(typeof r.options.dashArray=="string"){var l=r.options.dashArray.split(/[, ]+/),d=[],p,g;for(g=0;g<l.length;g++){if(p=Number(l[g]),isNaN(p))return;d.push(p)}r.options._dashArray=d}else r.options._dashArray=r.options.dashArray},_requestRedraw:function(r){this._map&&(this._extendRedrawBounds(r),this._redrawRequest=this._redrawRequest||Tt(this._redraw,this))},_extendRedrawBounds:function(r){if(r._pxBounds){var l=(r.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new G,this._redrawBounds.extend(r._pxBounds.min.subtract([l,l])),this._redrawBounds.extend(r._pxBounds.max.add([l,l]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var r=this._redrawBounds;if(r){var l=r.getSize();this._ctx.clearRect(r.min.x,r.min.y,l.x,l.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var r,l=this._redrawBounds;if(this._ctx.save(),l){var d=l.getSize();this._ctx.beginPath(),this._ctx.rect(l.min.x,l.min.y,d.x,d.y),this._ctx.clip()}this._drawing=!0;for(var p=this._drawFirst;p;p=p.next)r=p.layer,(!l||r._pxBounds&&r._pxBounds.intersects(l))&&r._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(r,l){if(this._drawing){var d,p,g,b,M=r._parts,P=M.length,E=this._ctx;if(P){for(E.beginPath(),d=0;d<P;d++){for(p=0,g=M[d].length;p<g;p++)b=M[d][p],E[p?"lineTo":"moveTo"](b.x,b.y);l&&E.closePath()}this._fillStroke(E,r)}}},_updateCircle:function(r){if(!(!this._drawing||r._empty())){var l=r._point,d=this._ctx,p=Math.max(Math.round(r._radius),1),g=(Math.max(Math.round(r._radiusY),1)||p)/p;g!==1&&(d.save(),d.scale(1,g)),d.beginPath(),d.arc(l.x,l.y/g,p,0,Math.PI*2,!1),g!==1&&d.restore(),this._fillStroke(d,r)}},_fillStroke:function(r,l){var d=l.options;d.fill&&(r.globalAlpha=d.fillOpacity,r.fillStyle=d.fillColor||d.color,r.fill(d.fillRule||"evenodd")),d.stroke&&d.weight!==0&&(r.setLineDash&&r.setLineDash(l.options&&l.options._dashArray||[]),r.globalAlpha=d.opacity,r.lineWidth=d.weight,r.strokeStyle=d.color,r.lineCap=d.lineCap,r.lineJoin=d.lineJoin,r.stroke())},_onClick:function(r){for(var l=this._map.mouseEventToLayerPoint(r),d,p,g=this._drawFirst;g;g=g.next)d=g.layer,d.options.interactive&&d._containsPoint(l)&&(!(r.type==="click"||r.type==="preclick")||!this._map._draggableMoved(d))&&(p=d);this._fireEvent(p?[p]:!1,r)},_onMouseMove:function(r){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var l=this._map.mouseEventToLayerPoint(r);this._handleMouseHover(r,l)}},_handleMouseOut:function(r){var l=this._hoveredLayer;l&&(Mt(this._container,"leaflet-interactive"),this._fireEvent([l],r,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(r,l){if(!this._mouseHoverThrottled){for(var d,p,g=this._drawFirst;g;g=g.next)d=g.layer,d.options.interactive&&d._containsPoint(l)&&(p=d);p!==this._hoveredLayer&&(this._handleMouseOut(r),p&&(it(this._container,"leaflet-interactive"),this._fireEvent([p],r,"mouseover"),this._hoveredLayer=p)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,r),this._mouseHoverThrottled=!0,setTimeout(a(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(r,l,d){this._map._fireDOMEvent(l,d||l.type,r)},_bringToFront:function(r){var l=r._order;if(l){var d=l.next,p=l.prev;if(d)d.prev=p;else return;p?p.next=d:d&&(this._drawFirst=d),l.prev=this._drawLast,this._drawLast.next=l,l.next=null,this._drawLast=l,this._requestRedraw(r)}},_bringToBack:function(r){var l=r._order;if(l){var d=l.next,p=l.prev;if(p)p.next=d;else return;d?d.prev=p:p&&(this._drawLast=p),l.prev=null,l.next=this._drawFirst,this._drawFirst.prev=l,this._drawFirst=l,this._requestRedraw(r)}}});function Gl(r){return W.canvas?new Jl(r):null}var Ei=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(r){return document.createElement("<lvml:"+r+' class="lvml">')}}catch{}return function(r){return document.createElement("<"+r+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),Mp={_initContainer:function(){this._container=ct("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Ve.prototype._update.call(this),this.fire("update"))},_initPath:function(r){var l=r._container=Ei("shape");it(l,"leaflet-vml-shape "+(this.options.className||"")),l.coordsize="1 1",r._path=Ei("path"),l.appendChild(r._path),this._updateStyle(r),this._layers[u(r)]=r},_addPath:function(r){var l=r._container;this._container.appendChild(l),r.options.interactive&&r.addInteractiveTarget(l)},_removePath:function(r){var l=r._container;wt(l),r.removeInteractiveTarget(l),delete this._layers[u(r)]},_updateStyle:function(r){var l=r._stroke,d=r._fill,p=r.options,g=r._container;g.stroked=!!p.stroke,g.filled=!!p.fill,p.stroke?(l||(l=r._stroke=Ei("stroke")),g.appendChild(l),l.weight=p.weight+"px",l.color=p.color,l.opacity=p.opacity,p.dashArray?l.dashStyle=N(p.dashArray)?p.dashArray.join(" "):p.dashArray.replace(/( *, *)/g," "):l.dashStyle="",l.endcap=p.lineCap.replace("butt","flat"),l.joinstyle=p.lineJoin):l&&(g.removeChild(l),r._stroke=null),p.fill?(d||(d=r._fill=Ei("fill")),g.appendChild(d),d.color=p.fillColor||p.color,d.opacity=p.fillOpacity):d&&(g.removeChild(d),r._fill=null)},_updateCircle:function(r){var l=r._point.round(),d=Math.round(r._radius),p=Math.round(r._radiusY||d);this._setPath(r,r._empty()?"M0 0":"AL "+l.x+","+l.y+" "+d+","+p+" 0,"+65535*360)},_setPath:function(r,l){r._path.v=l},_bringToFront:function(r){Zn(r._container)},_bringToBack:function(r){Hn(r._container)}},wr=W.vml?Ei:tl,Oi=Ve.extend({_initContainer:function(){this._container=wr("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=wr("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){wt(this._container),mt(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Ve.prototype._update.call(this);var r=this._bounds,l=r.getSize(),d=this._container;(!this._svgSize||!this._svgSize.equals(l))&&(this._svgSize=l,d.setAttribute("width",l.x),d.setAttribute("height",l.y)),Et(d,r.min),d.setAttribute("viewBox",[r.min.x,r.min.y,l.x,l.y].join(" ")),this.fire("update")}},_initPath:function(r){var l=r._path=wr("path");r.options.className&&it(l,r.options.className),r.options.interactive&&it(l,"leaflet-interactive"),this._updateStyle(r),this._layers[u(r)]=r},_addPath:function(r){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(r._path),r.addInteractiveTarget(r._path)},_removePath:function(r){wt(r._path),r.removeInteractiveTarget(r._path),delete this._layers[u(r)]},_updatePath:function(r){r._project(),r._update()},_updateStyle:function(r){var l=r._path,d=r.options;l&&(d.stroke?(l.setAttribute("stroke",d.color),l.setAttribute("stroke-opacity",d.opacity),l.setAttribute("stroke-width",d.weight),l.setAttribute("stroke-linecap",d.lineCap),l.setAttribute("stroke-linejoin",d.lineJoin),d.dashArray?l.setAttribute("stroke-dasharray",d.dashArray):l.removeAttribute("stroke-dasharray"),d.dashOffset?l.setAttribute("stroke-dashoffset",d.dashOffset):l.removeAttribute("stroke-dashoffset")):l.setAttribute("stroke","none"),d.fill?(l.setAttribute("fill",d.fillColor||d.color),l.setAttribute("fill-opacity",d.fillOpacity),l.setAttribute("fill-rule",d.fillRule||"evenodd")):l.setAttribute("fill","none"))},_updatePoly:function(r,l){this._setPath(r,el(r._parts,l))},_updateCircle:function(r){var l=r._point,d=Math.max(Math.round(r._radius),1),p=Math.max(Math.round(r._radiusY),1)||d,g="a"+d+","+p+" 0 1,0 ",b=r._empty()?"M0 0":"M"+(l.x-d)+","+l.y+g+d*2+",0 "+g+-d*2+",0 ";this._setPath(r,b)},_setPath:function(r,l){r._path.setAttribute("d",l)},_bringToFront:function(r){Zn(r._path)},_bringToBack:function(r){Hn(r._path)}});W.vml&&Oi.include(Mp);function Yl(r){return W.svg||W.vml?new Oi(r):null}lt.include({getRenderer:function(r){var l=r.options.renderer||this._getPaneRenderer(r.options.pane)||this.options.renderer||this._renderer;return l||(l=this._renderer=this._createRenderer()),this.hasLayer(l)||this.addLayer(l),l},_getPaneRenderer:function(r){if(r==="overlayPane"||r===void 0)return!1;var l=this._paneRenderers[r];return l===void 0&&(l=this._createRenderer({pane:r}),this._paneRenderers[r]=l),l},_createRenderer:function(r){return this.options.preferCanvas&&Gl(r)||Yl(r)}});var Xl=qn.extend({initialize:function(r,l){qn.prototype.initialize.call(this,this._boundsToLatLngs(r),l)},setBounds:function(r){return this.setLatLngs(this._boundsToLatLngs(r))},_boundsToLatLngs:function(r){return r=Pt(r),[r.getSouthWest(),r.getNorthWest(),r.getNorthEast(),r.getSouthEast()]}});function Cp(r,l){return new Xl(r,l)}Oi.create=wr,Oi.pointsToPath=el,Fe.geometryToLayer=mr,Fe.coordsToLatLng=so,Fe.coordsToLatLngs=gr,Fe.latLngToCoords=oo,Fe.latLngsToCoords=_r,Fe.getFeature=Un,Fe.asFeature=yr,lt.mergeOptions({boxZoom:!0});var Ql=Le.extend({initialize:function(r){this._map=r,this._container=r._container,this._pane=r._panes.overlayPane,this._resetStateTimeout=0,r.on("unload",this._destroy,this)},addHooks:function(){nt(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){mt(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){wt(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(r){if(!r.shiftKey||r.which!==1&&r.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),xi(),Zs(),this._startPoint=this._map.mouseEventToContainerPoint(r),nt(document,{contextmenu:_n,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(r){this._moved||(this._moved=!0,this._box=ct("div","leaflet-zoom-box",this._container),it(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(r);var l=new G(this._point,this._startPoint),d=l.getSize();Et(this._box,l.min),this._box.style.width=d.x+"px",this._box.style.height=d.y+"px"},_finish:function(){this._moved&&(wt(this._box),Mt(this._container,"leaflet-crosshair")),wi(),Hs(),mt(document,{contextmenu:_n,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(r){if(!(r.which!==1&&r.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(a(this._resetState,this),0);var l=new ie(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(l).fire("boxzoomend",{boxZoomBounds:l})}},_onKeyDown:function(r){r.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});lt.addInitHook("addHandler","boxZoom",Ql),lt.mergeOptions({doubleClickZoom:!0});var tc=Le.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(r){var l=this._map,d=l.getZoom(),p=l.options.zoomDelta,g=r.originalEvent.shiftKey?d-p:d+p;l.options.doubleClickZoom==="center"?l.setZoom(g):l.setZoomAround(r.containerPoint,g)}});lt.addInitHook("addHandler","doubleClickZoom",tc),lt.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var ec=Le.extend({addHooks:function(){if(!this._draggable){var r=this._map;this._draggable=new Ke(r._mapPane,r._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),r.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),r.on("zoomend",this._onZoomEnd,this),r.whenReady(this._onZoomEnd,this))}it(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Mt(this._map._container,"leaflet-grab"),Mt(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var r=this._map;if(r._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var l=Pt(this._map.options.maxBounds);this._offsetLimit=At(this._map.latLngToContainerPoint(l.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(l.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;r.fire("movestart").fire("dragstart"),r.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(r){if(this._map.options.inertia){var l=this._lastTime=+new Date,d=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(d),this._times.push(l),this._prunePositions(l)}this._map.fire("move",r).fire("drag",r)},_prunePositions:function(r){for(;this._positions.length>1&&r-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var r=this._map.getSize().divideBy(2),l=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=l.subtract(r).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(r,l){return r-(r-l)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var r=this._draggable._newPos.subtract(this._draggable._startPos),l=this._offsetLimit;r.x<l.min.x&&(r.x=this._viscousLimit(r.x,l.min.x)),r.y<l.min.y&&(r.y=this._viscousLimit(r.y,l.min.y)),r.x>l.max.x&&(r.x=this._viscousLimit(r.x,l.max.x)),r.y>l.max.y&&(r.y=this._viscousLimit(r.y,l.max.y)),this._draggable._newPos=this._draggable._startPos.add(r)}},_onPreDragWrap:function(){var r=this._worldWidth,l=Math.round(r/2),d=this._initialWorldOffset,p=this._draggable._newPos.x,g=(p-l+d)%r+l-d,b=(p+l+d)%r-l-d,M=Math.abs(g+d)<Math.abs(b+d)?g:b;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=M},_onDragEnd:function(r){var l=this._map,d=l.options,p=!d.inertia||r.noInertia||this._times.length<2;if(l.fire("dragend",r),p)l.fire("moveend");else{this._prunePositions(+new Date);var g=this._lastPos.subtract(this._positions[0]),b=(this._lastTime-this._times[0])/1e3,M=d.easeLinearity,P=g.multiplyBy(M/b),E=P.distanceTo([0,0]),I=Math.min(d.inertiaMaxSpeed,E),$=P.multiplyBy(I/E),Y=I/(d.inertiaDeceleration*M),rt=$.multiplyBy(-Y/2).round();!rt.x&&!rt.y?l.fire("moveend"):(rt=l._limitOffset(rt,l.options.maxBounds),Tt(function(){l.panBy(rt,{duration:Y,easeLinearity:M,noMoveStart:!0,animate:!0})}))}}});lt.addInitHook("addHandler","dragging",ec),lt.mergeOptions({keyboard:!0,keyboardPanDelta:80});var nc=Le.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(r){this._map=r,this._setPanDelta(r.options.keyboardPanDelta),this._setZoomDelta(r.options.zoomDelta)},addHooks:function(){var r=this._map._container;r.tabIndex<=0&&(r.tabIndex="0"),nt(r,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),mt(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var r=document.body,l=document.documentElement,d=r.scrollTop||l.scrollTop,p=r.scrollLeft||l.scrollLeft;this._map._container.focus(),window.scrollTo(p,d)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(r){var l=this._panKeys={},d=this.keyCodes,p,g;for(p=0,g=d.left.length;p<g;p++)l[d.left[p]]=[-1*r,0];for(p=0,g=d.right.length;p<g;p++)l[d.right[p]]=[r,0];for(p=0,g=d.down.length;p<g;p++)l[d.down[p]]=[0,r];for(p=0,g=d.up.length;p<g;p++)l[d.up[p]]=[0,-1*r]},_setZoomDelta:function(r){var l=this._zoomKeys={},d=this.keyCodes,p,g;for(p=0,g=d.zoomIn.length;p<g;p++)l[d.zoomIn[p]]=r;for(p=0,g=d.zoomOut.length;p<g;p++)l[d.zoomOut[p]]=-r},_addHooks:function(){nt(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){mt(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(r){if(!(r.altKey||r.ctrlKey||r.metaKey)){var l=r.keyCode,d=this._map,p;if(l in this._panKeys){if(!d._panAnim||!d._panAnim._inProgress)if(p=this._panKeys[l],r.shiftKey&&(p=X(p).multiplyBy(3)),d.options.maxBounds&&(p=d._limitOffset(X(p),d.options.maxBounds)),d.options.worldCopyJump){var g=d.wrapLatLng(d.unproject(d.project(d.getCenter()).add(p)));d.panTo(g)}else d.panBy(p)}else if(l in this._zoomKeys)d.setZoom(d.getZoom()+(r.shiftKey?3:1)*this._zoomKeys[l]);else if(l===27&&d._popup&&d._popup.options.closeOnEscapeKey)d.closePopup();else return;_n(r)}}});lt.addInitHook("addHandler","keyboard",nc),lt.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var ic=Le.extend({addHooks:function(){nt(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){mt(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(r){var l=Tl(r),d=this._map.options.wheelDebounceTime;this._delta+=l,this._lastMousePos=this._map.mouseEventToContainerPoint(r),this._startTime||(this._startTime=+new Date);var p=Math.max(d-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(a(this._performZoom,this),p),_n(r)},_performZoom:function(){var r=this._map,l=r.getZoom(),d=this._map.options.zoomSnap||0;r._stop();var p=this._delta/(this._map.options.wheelPxPerZoomLevel*4),g=4*Math.log(2/(1+Math.exp(-Math.abs(p))))/Math.LN2,b=d?Math.ceil(g/d)*d:g,M=r._limitZoom(l+(this._delta>0?b:-b))-l;this._delta=0,this._startTime=null,M&&(r.options.scrollWheelZoom==="center"?r.setZoom(l+M):r.setZoomAround(this._lastMousePos,l+M))}});lt.addInitHook("addHandler","scrollWheelZoom",ic);var Tp=600;lt.mergeOptions({tapHold:W.touchNative&&W.safari&&W.mobile,tapTolerance:15});var rc=Le.extend({addHooks:function(){nt(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){mt(this._map._container,"touchstart",this._onDown,this)},_onDown:function(r){if(clearTimeout(this._holdTimeout),r.touches.length===1){var l=r.touches[0];this._startPos=this._newPos=new J(l.clientX,l.clientY),this._holdTimeout=setTimeout(a(function(){this._cancel(),this._isTapValid()&&(nt(document,"touchend",Ht),nt(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",l))},this),Tp),nt(document,"touchend touchcancel contextmenu",this._cancel,this),nt(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function r(){mt(document,"touchend",Ht),mt(document,"touchend touchcancel",r)},_cancel:function(){clearTimeout(this._holdTimeout),mt(document,"touchend touchcancel contextmenu",this._cancel,this),mt(document,"touchmove",this._onMove,this)},_onMove:function(r){var l=r.touches[0];this._newPos=new J(l.clientX,l.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(r,l){var d=new MouseEvent(r,{bubbles:!0,cancelable:!0,view:window,screenX:l.screenX,screenY:l.screenY,clientX:l.clientX,clientY:l.clientY});d._simulated=!0,l.target.dispatchEvent(d)}});lt.addInitHook("addHandler","tapHold",rc),lt.mergeOptions({touchZoom:W.touch,bounceAtZoomLimits:!0});var sc=Le.extend({addHooks:function(){it(this._map._container,"leaflet-touch-zoom"),nt(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Mt(this._map._container,"leaflet-touch-zoom"),mt(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(r){var l=this._map;if(!(!r.touches||r.touches.length!==2||l._animatingZoom||this._zooming)){var d=l.mouseEventToContainerPoint(r.touches[0]),p=l.mouseEventToContainerPoint(r.touches[1]);this._centerPoint=l.getSize()._divideBy(2),this._startLatLng=l.containerPointToLatLng(this._centerPoint),l.options.touchZoom!=="center"&&(this._pinchStartLatLng=l.containerPointToLatLng(d.add(p)._divideBy(2))),this._startDist=d.distanceTo(p),this._startZoom=l.getZoom(),this._moved=!1,this._zooming=!0,l._stop(),nt(document,"touchmove",this._onTouchMove,this),nt(document,"touchend touchcancel",this._onTouchEnd,this),Ht(r)}},_onTouchMove:function(r){if(!(!r.touches||r.touches.length!==2||!this._zooming)){var l=this._map,d=l.mouseEventToContainerPoint(r.touches[0]),p=l.mouseEventToContainerPoint(r.touches[1]),g=d.distanceTo(p)/this._startDist;if(this._zoom=l.getScaleZoom(g,this._startZoom),!l.options.bounceAtZoomLimits&&(this._zoom<l.getMinZoom()&&g<1||this._zoom>l.getMaxZoom()&&g>1)&&(this._zoom=l._limitZoom(this._zoom)),l.options.touchZoom==="center"){if(this._center=this._startLatLng,g===1)return}else{var b=d._add(p)._divideBy(2)._subtract(this._centerPoint);if(g===1&&b.x===0&&b.y===0)return;this._center=l.unproject(l.project(this._pinchStartLatLng,this._zoom).subtract(b),this._zoom)}this._moved||(l._moveStart(!0,!1),this._moved=!0),Ut(this._animRequest);var M=a(l._move,l,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=Tt(M,this,!0),Ht(r)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,Ut(this._animRequest),mt(document,"touchmove",this._onTouchMove,this),mt(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});lt.addInitHook("addHandler","touchZoom",sc),lt.BoxZoom=Ql,lt.DoubleClickZoom=tc,lt.Drag=ec,lt.Keyboard=nc,lt.ScrollWheelZoom=ic,lt.TapHold=rc,lt.TouchZoom=sc,e.Bounds=G,e.Browser=W,e.CRS=Re,e.Canvas=Jl,e.Circle=ro,e.CircleMarker=pr,e.Class=ue,e.Control=we,e.DivIcon=ql,e.DivOverlay=Ae,e.DomEvent=jf,e.DomUtil=Hf,e.Draggable=Ke,e.Evented=dt,e.FeatureGroup=Be,e.GeoJSON=Fe,e.GridLayer=Pi,e.Handler=Le,e.Icon=jn,e.ImageOverlay=vr,e.LatLng=ft,e.LatLngBounds=ie,e.Layer=ke,e.LayerGroup=Wn,e.LineUtil=rp,e.Map=lt,e.Marker=fr,e.Mixin=Xf,e.Path=Je,e.Point=J,e.PolyUtil=Qf,e.Polygon=qn,e.Polyline=$e,e.Popup=br,e.PosAnimation=Pl,e.Projection=sp,e.Rectangle=Xl,e.Renderer=Ve,e.SVG=Oi,e.SVGOverlay=jl,e.TileLayer=Kn,e.Tooltip=xr,e.Transformation=Os,e.Util=mi,e.VideoOverlay=Wl,e.bind=a,e.bounds=At,e.canvas=Gl,e.circle=fp,e.circleMarker=hp,e.control=Mi,e.divIcon=wp,e.extend=s,e.featureGroup=cp,e.geoJSON=Hl,e.geoJson=gp,e.gridLayer=kp,e.icon=up,e.imageOverlay=_p,e.latLng=at,e.latLngBounds=Pt,e.layerGroup=lp,e.map=qf,e.marker=dp,e.point=X,e.polygon=mp,e.polyline=pp,e.popup=bp,e.rectangle=Cp,e.setOptions=x,e.stamp=u,e.svg=Yl,e.svgOverlay=vp,e.tileLayer=Ul,e.tooltip=xp,e.transformation=_i,e.version=i,e.videoOverlay=yp;var Pp=window.L;e.noConflict=function(){return window.L=Pp,this},window.L=e}))})(Di,Di.exports)),Di.exports}var df=N1();const D1=em(df),z1=Om({__proto__:null,default:D1},[df]),R1={class:"relative overflow-hidden w-full aspect-video"},B1={class:"flex gap-2 p-2 absolute bottom-0 left-1/2 -translate-x-1/2"},Ps=_t({__name:"map.client",props:{zoom:{default:15},controls:{type:Boolean,default:!0},gpxFile:{}},emits:["ready"],async setup(n,{emit:t}){let e,i;const s=([e,i]=cc(()=>uc(()=>Promise.resolve().then(()=>z1),void 0,import.meta.url)),e=await e,i(),e).default;[e,i]=cc(()=>uc(()=>import("./TgcNmIV-.js"),[],import.meta.url)),await e,i();let o;const a=t,c=n,u=q(!1),h=q(null),f=()=>{o?.setZoom(o.getZoom()+1)},m=()=>{o?.setZoom(o.getZoom()-1)},_=()=>{a("ready",s,o),u.value=!0},y=()=>{h.value&&(o=s.map(h.value,{worldCopyJump:!0,scrollWheelZoom:!1,minZoom:3,zoomControl:!1}).whenReady(_),s.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'<a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors'}).addTo(o),c.gpxFile&&new L.GPX(c.gpxFile,{async:!0,polyline_options:{color:"#f06723",weight:3},marker_options:{endIconUrl:"leaf-green.png",startIconUrl:"leaf-red.png",wptIcons:{}}}).on("loaded",v=>{v.target.getBounds(),o.fitBounds(v.target.getBounds())}).on("layeradd",v=>{console.log(v.layer._layers)}).addTo(o))};return he(()=>c.gpxFile,()=>{y()}),xe(async()=>{y()}),(v,x)=>{const k=ce;return z(),K("div",R1,[D("div",{class:"bg-white w-full h-full rounded-md",ref_key:"mapEl",ref:h},null,512),D("div",B1,[S(k,{variant:"secondary",size:"icon",onClick:f},{default:T(()=>[S(w(us))]),_:1}),S(k,{variant:"secondary",size:"icon",onClick:m},{default:T(()=>[S(w(zu))]),_:1})])])}}}),$1=cs(Ps),F1={class:"flex flex-wrap gap-2 items-center"},V1={class:"flex gap-2"},Z1={class:"w-full text-center block p-3 border border-dashed rounded-md"},H1=_t({__name:"mapUpload",props:{trailRace:{}},emits:["update"],setup(n,{emit:t}){const e=n,{axios:i}=cn(),s=t,o=q(!1),a=q(!1),c=q(!1),u=q(""),h=q(null),f=_=>{const y=_.target.files??[];if(y?.length==0)return;const v=new FileReader,x=y[0];v.onload=()=>{h.value=x.name,u.value=v.result},x&&v.readAsDataURL(x)},m=async()=>{a.value=!0,await i.put(`/events/${e.trailRace.id}/upload_map_file`,{file:u.value}),a.value=!1,s("update")};return xe(()=>{e.trailRace.image_id||(c.value=!0)}),(_,y)=>{const v=ce,x=Rn,k=Bn,C=Qi,O=$1,N=zn,V=Dn;return z(),K(gt,null,[D("div",F1,[y[3]||(y[3]=D("h2",{class:"text-xs uppercase grow mb-2"},"Upload map file",-1)),D("div",V1,[w(u)?(z(),tt(v,{key:0,variant:"secondary",size:"sm",onClick:m,disabled:w(a),permissions:"event_edit"},{default:T(()=>[w(a)?(z(),tt(w(fi),{key:1,class:"animate-spin relative"})):(z(),tt(w(hi),{key:0})),y[2]||(y[2]=Z(" Save ",-1))]),_:1},8,["disabled"])):bt("",!0),S(v,{variant:"destructive",size:"icon",onClick:y[0]||(y[0]=F=>o.value=!0)},{default:T(()=>[S(w(ds))]),_:1})]),D("label",Z1,[D("input",{type:"file",onChange:f,class:"hidden",accept:".gpx"},null,32),D("span",null,st(w(h)??"Upload .gpx file"),1)])]),S(V,{open:w(o),"onUpdate:open":y[1]||(y[1]=F=>o.value=!1)},{default:T(()=>[S(N,{class:"sm:max-w-[1000px]"},{default:T(()=>[S(C,null,{default:T(()=>[S(x,null,{default:T(()=>[...y[4]||(y[4]=[Z("Map",-1)])]),_:1}),S(k,null,{default:T(()=>[...y[5]||(y[5]=[Z("Some text",-1)])]),_:1})]),_:1}),S(O,{"map-id":"someId",center:[27.756846786775668,85.3124535214843],gpxFile:w(as)(_.trailRace.map_file?.file_name)},null,8,["gpxFile"])]),_:1})]),_:1},8,["open"])],64)}}}),na=sa("stage",()=>{const n=q([]),t=q(!1),{axios:e}=cn();return{stages:n,isLoading:t,fetch:async a=>{t.value=!0;const{data:c}=await e.get(`/events/${a}/stages`);c&&(n.value=c),t.value=!1},save:async(a,c)=>{const u=c.id?"put":"post",h=c.id?`/events/stages/${c.id}`:`/events/${a}/stages`;await e[u](h,c)},destory:async a=>{await e.delete(`/events/stages/${a}`)}}}),W1=cs(Ps),j1={key:0,class:"w-full h-[480px] relative"},q1=["src"],U1={key:0,class:"w-full h-[480px]"},K1=["src"],J1={class:"w-full flex flex-col gap-2 relative"},G1={class:"py-4 px-4 flex border border-dashed rounded-sm"},Y1={class:"text-gray-700 flex-grow"},X1={class:"flex gap-4"},Q1={class:"flex flex-col gap-2 relative"},tw={class:"py-4 px-4 flex border border-dashed rounded-sm"},ew={class:"text-gray-700 flex-grow"},nw={class:"text-right"},iw=_t({__name:"form",props:{eventId:{},stage:{}},emits:["update"],setup(n,{emit:t}){const e=n,i=t,{save:s}=na(),o=q(!1),a=q(""),c=q(""),u=q(null),h=q(),f=q(),m=q({map:!1,thumbnail:!1}),_=async C=>{o.value=!0,await s(e.eventId,C),o.value=!1,i("update")},y=(C,O)=>{const N=C.target.files??[];if(N?.length==0)return;const V=new FileReader,F=N[0];V.onload=()=>{a.value=F.name,u.value&&u.value.setFieldValue(O,V.result)},F&&V.readAsDataURL(F)},v=(C,O)=>{const N=C.target.files??[];if(N?.length==0)return;const V=new FileReader,F=N[0];V.onload=()=>{c.value=F.name,u.value&&u.value.setFieldValue(O,V.result)},F&&V.readAsDataURL(F)},x=C=>{u.value&&u.value.resetField(C)},k=()=>{u.value&&(u.value.setFieldValue("event_id",e.eventId),e.stage&&(u.value.setValues({id:e.stage.id,name:e.stage.name,excerpt:e.stage.excerpt,description:e.stage.description,location:e.stage.location,difficulty:e.stage.difficulty,distance:e.stage.distance,thumbnail:e.stage.thumbnail.file_name,map:e.stage.map_file.file_name}),e.stage.thumbnail.file_name&&(m.value.thumbnail=!0),e.stage.map_file.file_name&&(m.value.map=!0),e.stage.start&&(u.value.setFieldValue("start",e.stage.start),h.value=$r(Mn(e.stage.start).format("YYYY-MM-DD"))),e.stage.end&&(u.value.setFieldValue("end",e.stage.end),f.value=$r(Mn(e.stage.end).format("YYYY-MM-DD")))))};return he(h,()=>{u.value&&u.value.setFieldValue("start",`${h.value.year}-${h.value.month}-${h.value.day}`)}),he(f,()=>{u.value&&u.value.setFieldValue("end",`${f.value.year}-${f.value.month}-${f.value.day}`)}),he(u,()=>{k()}),oa(()=>{u.value&&k()}),(C,O)=>{const N=ce,V=aa,F=la,et=Bu,ot=$u,R=da,ut=ua,xt=fa,Tt=ha,Ut=ca,mi=Xa,ue=Fu,gi=Rn,Zt=Bn,dt=W1,J=zn,rr=Dn;return z(),tt(w(fs),{onSubmit:_,"validation-schema":w(nm),class:"flex flex-col gap-4 relative",ref_key:"form",ref:u},{default:T(({values:X})=>[w(m).thumbnail?(z(),K("div",j1,[D("img",{src:w(ia)(C.stage?.thumbnail.file_name),class:"size-full object-cover"},null,8,q1),S(N,{onClick:O[0]||(O[0]=G=>w(m).thumbnail=!1),class:"absolute top-2 right-2"},{default:T(()=>[...O[8]||(O[8]=[Z("change image",-1)])]),_:1})])):(z(),K(gt,{key:1},[X.thumbnail?(z(),K("div",U1,[D("img",{src:X.thumbnail,class:"size-full object-cover"},null,8,K1),S(N,{onClick:O[1]||(O[1]=G=>w(m).thumbnail=!0),class:"absolute top-2 right-2"},{default:T(()=>[...O[9]||(O[9]=[Z("cancel",-1)])]),_:1})])):bt("",!0),D("div",J1,[D("label",G1,[D("input",{type:"file",onChange:O[2]||(O[2]=G=>v(G,"thumbnail")),accept:".jpg, .jpeg, .png, image/jpeg, image/png",class:"hidden"},null,32),D("span",Y1,st(w(c)?w(c):"Upload image file"),1)]),w(c)?(z(),tt(N,{key:0,type:"button",onClick:O[3]||(O[3]=()=>{x("thumbnail"),c.value=""}),size:"icon",modifier:"outline",class:"absolute top-1/2 right-2 -translate-y-1/2"},{default:T(()=>[S(w(Fi))]),_:1})):bt("",!0),S(w(It),{name:"thumbnail"})])],64)),S(w(vt),{name:"event_id",as:"div",class:"flex flex-col gap-2"},{default:T(({field:G})=>[S(V,Bt({type:"hidden"},G,{id:"esf__name"}),null,16)]),_:1}),S(w(vt),{name:"id",as:"div",class:"flex flex-col gap-2"},{default:T(({field:G})=>[S(V,Bt({type:"hidden"},G,{id:"esf__id"}),null,16)]),_:1}),S(w(vt),{name:"name",as:"div",class:"flex flex-col gap-2"},{default:T(({field:G})=>[S(F,{for:"esf__name"},{default:T(()=>[...O[10]||(O[10]=[Z("Name",-1)])]),_:1}),S(V,Bt(G,{id:"esf__name"}),null,16),S(w(It),{name:"name"})]),_:1}),S(w(vt),{name:"excerpt",as:"div",class:"flex flex-col gap-2"},{default:T(({field:G})=>[S(F,{for:"esf__excerpt"},{default:T(()=>[...O[11]||(O[11]=[Z("Excerpt",-1)])]),_:1}),S(et,Bt(G,{id:"esf__excerpt"}),null,16),S(w(It),{name:"excerpt"})]),_:1}),D("div",X1,[S(w(vt),{name:"start",as:"div",class:"w-1/4 flex flex-col gap-2"},{default:T(()=>[S(F,{for:"ef__start"},{default:T(()=>[...O[12]||(O[12]=[Z("Start Date",-1)])]),_:1}),S(ot,{label:"Start date","model-value":w(h),"onUpdate:modelValue":O[4]||(O[4]=G=>h.value=G)},null,8,["model-value"]),S(w(It),{name:"start"})]),_:1}),S(w(vt),{name:"end",as:"div",class:"w-1/4 flex flex-col gap-2"},{default:T(()=>[S(F,{for:"ef__end"},{default:T(()=>[...O[13]||(O[13]=[Z("End Date",-1)])]),_:1}),S(ot,{label:"End date","min-value":w(h),"model-value":w(f),"onUpdate:modelValue":O[5]||(O[5]=G=>f.value=G)},null,8,["min-value","model-value"]),S(w(It),{name:"end"})]),_:1}),S(w(vt),{name:"difficulty",as:"div",class:"w-1/4 flex flex-col gap-2"},{default:T(({field:G})=>[S(F,{for:"ef__difficulty"},{default:T(()=>[...O[14]||(O[14]=[Z("Difficulty",-1)])]),_:1}),S(Ut,Bt(G,{autocomplete:"sex","default-value":C.stage?.difficulty}),{default:T(()=>[S(ut,{class:"w-full"},{default:T(()=>[S(R,{placeholder:"Select a difficulty"})]),_:1}),S(Tt,null,{default:T(()=>[(z(),K(gt,null,se(["moderate","easy","difficult"],At=>S(xt,{value:At},{default:T(()=>[Z(st(At),1)]),_:2},1032,["value"])),64))]),_:1})]),_:2},1040,["default-value"]),S(w(It),{name:"difficulty"})]),_:1}),S(w(vt),{name:"distance",as:"div",class:"w-1/4 flex flex-col gap-2"},{default:T(({field:G})=>[S(F,{for:"ef__distance"},{default:T(()=>[...O[15]||(O[15]=[Z("Distance",-1)])]),_:1}),S(V,Bt(G,{id:"ef__distance"}),null,16),S(w(It),{name:"distance"})]),_:1})]),S(w(vt),{name:"location",as:"div",class:"flex flex-col gap-2"},{default:T(({field:G})=>[S(F,{for:"esf__location"},{default:T(()=>[...O[16]||(O[16]=[Z("Location",-1)])]),_:1}),S(V,Bt(G,{id:"esf__location"}),null,16),S(w(It),{name:"location"})]),_:1}),S(w(vt),{name:"description",as:"div",class:"flex flex-col gap-2"},{default:T(({value:G,handleChange:At})=>[S(mi,{"model-value":G??"","onUpdate:modelValue":At,disabled:!1,timer:1e3},null,8,["model-value","onUpdate:modelValue"])]),_:1}),D("div",Q1,[w(m).map?(z(),tt(rr,{key:1},{default:T(()=>[S(ue,{"as-child":""},{default:T(()=>[S(N,{type:"button",size:"icon",variant:"ghost"},{default:T(()=>[S(w(ds))]),_:1})]),_:1}),S(J,{class:"sm:max-w-[1000px]"},{default:T(()=>[S(gi,null,{default:T(()=>[Z(st(C.stage?.name)+"'s map",1)]),_:1}),S(Zt,null,{default:T(()=>[...O[17]||(O[17]=[Z("lorem",-1)])]),_:1}),S(dt,{"gpx-file":w(as)(C.stage?.map_file.file_name)},null,8,["gpx-file"])]),_:1})]),_:1})):(z(),K(gt,{key:0},[D("label",tw,[D("input",{type:"file",onChange:O[6]||(O[6]=G=>y(G,"map")),accept:".gpx",class:"hidden"},null,32),D("span",ew,st(w(a)?w(a):"Upload GPX file"),1)]),w(a)?(z(),tt(N,{key:0,type:"button",onClick:O[7]||(O[7]=()=>{x("map"),a.value=""}),size:"icon",modifier:"outline",class:"absolute top-1/2 right-2 -translate-y-1/2"},{default:T(()=>[S(w(Fi))]),_:1})):bt("",!0),S(w(It),{name:"map"})],64))]),D("div",nw,[S(N,{type:"submit",disabled:w(o)},{default:T(()=>[w(o)?(z(),tt(w(fi),{key:0,class:"animate-spin"})):(z(),tt(w(hi),{key:1})),O[18]||(O[18]=Z(" Save ",-1))]),_:1},8,["disabled"])])]),_:1},8,["validation-schema"])}}}),hf=sa("checkpoints",()=>{const n=q([]),t=q(!1),{axios:e}=cn();return{checkpoints:n,isLoading:t,fetch:async c=>{t.value=!0;const{data:u}=await e.get(`/events/${c}/checkpoints`);u&&(n.value=u),t.value=!1},save:async(c,u)=>{const h=u.id?"put":"post",f=u.id?`/events/checkpoints/${u.id}`:`/events/${c}/checkpoints`;await e[h](f,u)},destory:async c=>{await e.delete(`/events/checkpoints/${c}`)},assignVolunteerToCheckpoint:async(c,u)=>{await e.patch(`events/checkpoints/${u}/assign_volunteer/${c}`)}}}),rw={class:"text-right"},sw=_t({__name:"form",props:{stageCategoryId:{},checkpoint:{}},emits:["update"],setup(n,{emit:t}){const e=n,i=t,{save:s}=hf(),o=q(!1),a=q(null),c=async f=>{o.value=!0,await s(e.stageCategoryId,f),o.value=!1,i("update"),h()},u=()=>{a.value&&(a.value.setFieldValue("stage_category_id",e.stageCategoryId),e.checkpoint&&a.value.setValues({id:e.checkpoint.id,name:e.checkpoint.name}))},h=()=>{a.value?.resetForm()};return he(a,()=>{u()}),oa(()=>{a.value&&u()}),(f,m)=>{const _=aa,y=la,v=ce;return z(),tt(w(fs),{onSubmit:c,"validation-schema":w(im),class:"flex flex-col gap-4",ref_key:"form",ref:a},{default:T(()=>[S(w(vt),{name:"stage_category_id",as:"div",class:"flex flex-col gap-2"},{default:T(({field:x})=>[S(_,Bt({type:"hidden"},x,{id:"esf__name"}),null,16)]),_:1}),S(w(vt),{name:"id",as:"div",class:"flex flex-col gap-2"},{default:T(({field:x})=>[S(_,Bt({type:"hidden"},x,{id:"esf__id"}),null,16)]),_:1}),S(w(vt),{name:"name",as:"div",class:"flex flex-col gap-2"},{default:T(({field:x})=>[S(y,{for:"esf__name"},{default:T(()=>[...m[0]||(m[0]=[Z("Name",-1)])]),_:1}),S(_,Bt(x,{id:"esf__name"}),null,16),S(w(It),{name:"name"})]),_:1}),D("div",rw,[S(v,{type:"submit",disabled:w(o)},{default:T(()=>[w(o)?(z(),tt(w(fi),{key:0})):(z(),tt(w(hi),{key:1})),m[1]||(m[1]=Z(" Save ",-1))]),_:1},8,["disabled"])])]),_:1},8,["validation-schema"])}}}),ow={class:"pt-8 pl-8"},aw={class:"flex gap-2 pb-4 mb-5 border-b"},lw={class:"divide-y space-y-3"},cw=["value"],uw={class:"grow space-y-1"},dw={class:"block"},hw={class:"flex justify-end gap-2"},fw=_t({__name:"list",props:{stageCategoryId:{}},emits:["update"],setup(n,{emit:t}){const e=t,i=n,{axios:s}=cn(),o=q([]),a=q(!1),c=q(null),u=async()=>{const{data:f}=await s.get(`/events/${i.stageCategoryId}/checkpoints`);o.value=f},h=async f=>{await s.delete(`/events/checkpoints/${f}`)};return xe(async()=>{await u()}),(f,m)=>{const _=ce,y=hs,v=Rn,x=Bn,k=Qi,C=zn,O=Dn;return z(),K(gt,null,[D("div",ow,[D("div",aw,[m[4]||(m[4]=D("div",{class:"grow"},[D("h3",null,"Checkpoints")],-1)),S(_,{variant:"secondary",size:"sm",modifier:"outline",onClick:m[0]||(m[0]=N=>a.value=!0)},{default:T(()=>[S(w(us)),m[3]||(m[3]=Z(" Add a Checkpoint ",-1))]),_:1})]),D("ul",lw,[(z(!0),K(gt,null,se(w(o),N=>(z(),K("li",{class:"flex gap-2 pb-3",value:N.id},[D("div",uw,[D("strong",dw,st(N.name),1),N.volunteers.length>0?(z(),tt(y,{key:0,variant:"outline"},{default:T(()=>[Z(" has "+st(N.volunteers.length)+" volunteer"+st(N.volunteers.length>1?"s":"")+" assigned ",1)]),_:2},1024)):bt("",!0)]),D("div",hw,[S(_,{modifier:"outline",variant:"destructive",size:"icon",onClick:async()=>{await h(N.id),await u()}},{default:T(()=>[S(w(Vu))]),_:2},1032,["onClick"]),S(_,{modifier:"outline",size:"icon",onClick:()=>{a.value=!0,c.value=N}},{default:T(()=>[S(w(Fr))]),_:2},1032,["onClick"])])],8,cw))),256))])]),S(O,{open:w(a),"onUpdate:open":m[2]||(m[2]=N=>a.value=!1)},{default:T(()=>[S(C,null,{default:T(()=>[S(k,null,{default:T(()=>[S(v,null,{default:T(()=>[...m[5]||(m[5]=[Z("Stage form",-1)])]),_:1}),S(x,null,{default:T(()=>[...m[6]||(m[6]=[Z("Lorem, ipsum dolor sit amet consectetur adipisicing elit. Possimus assumenda, maxime distinctio at facere nesciunt vero eius neque voluptates numquam libero vel provident aliquam, iusto, dolorum non. Laboriosam, eveniet quibusdam.",-1)])]),_:1})]),_:1}),S(sw,{stageCategoryId:f.stageCategoryId,checkpoint:w(c),onUpdate:m[1]||(m[1]=()=>{a.value=!1,c.value=null,u(),e("update")})},null,8,["stageCategoryId","checkpoint"])]),_:1})]),_:1},8,["open"])],64)}}}),pw=cs(Ps),mw={class:"flex gap-4"},gw={class:"flex flex-col gap-2 relative"},_w={class:"py-4 px-4 flex border border-dashed rounded-sm"},yw={class:"text-gray-700 flex-grow"},vw={class:"text-right"},bw=_t({__name:"Form",props:{stageId:{},category:{}},emits:["update"],setup(n,{emit:t}){const e=t,i=n,{axios:s}=cn(),o=q(!1),a=q(),c=q(""),u=q(),h=q(),f=q({map:!1,thumbnail:!1}),m=async({id:v,...x})=>{o.value=!0;const k=v?"put":"post",C=v?`/events/${i.stageId}/stage_categories/${v}`:`/events/${i.stageId}/stage_categories`;await s[k](C,x),e("update"),o.value=!1},_=(v,x)=>{const k=v.target.files??[];if(k?.length==0)return;const C=new FileReader,O=k[0];C.onload=()=>{c.value=O.name,a.value&&a.value.setFieldValue(x,C.result)},O&&C.readAsDataURL(O)},y=v=>{a.value&&a.value.resetField(v)};return he(u,()=>{a.value&&a.value.setFieldValue("start",`${u.value.year}-${u.value.month}-${u.value.day}`)}),he(h,()=>{a.value&&a.value.setFieldValue("end",`${h.value.year}-${h.value.month}-${h.value.day}`)}),xe(()=>{a.value&&(a.value.setFieldValue("stage_id",i.stageId),i.category&&(a.value.setValues({id:i.category.id,name:i.category.name,excerpt:i.category.excerpt,description:i.category.description,distance:i.category.distance,difficulty:i.category.difficulty,location:i.category.location,start:i.category.start,end:i.category.end}),i.category.start&&(a.value.setFieldValue("start",i.category.start),u.value=$r(Mn(i.category.start).format("YYYY-MM-DD"))),i.category.end&&(a.value.setFieldValue("end",i.category.end),h.value=$r(Mn(i.category.end).format("YYYY-MM-DD")))))}),(v,x)=>{const k=aa,C=la,O=Bu,N=$u,V=da,F=ua,et=fa,ot=ha,R=ca,ut=Xa,xt=ce,Tt=Fu,Ut=Rn,mi=Bn,ue=pw,gi=zn,Zt=Dn;return z(),tt(w(fs),{"validation-schema":w(rm),onSubmit:m,class:"flex flex-col gap-4",ref_key:"form",ref:a},{default:T(()=>[S(w(vt),{name:"id"},{default:T(({field:dt})=>[S(k,Bt({type:"hidden"},dt),null,16)]),_:1}),S(w(vt),{name:"stage_id"},{default:T(({field:dt})=>[S(k,Bt({type:"hidden"},dt),null,16)]),_:1}),S(w(vt),{name:"name",as:"div",class:"flex flex-col gap-1"},{default:T(({field:dt})=>[S(C,{for:"scf__name"},{default:T(()=>[...x[4]||(x[4]=[Z("Name",-1)])]),_:1}),S(k,co(uo(dt)),null,16),S(w(It),{name:"name"})]),_:1}),S(w(vt),{name:"excerpt",as:"div",class:"flex flex-col gap-1"},{default:T(({field:dt})=>[S(C,{for:"scf__excerpt"},{default:T(()=>[...x[5]||(x[5]=[Z("Short description",-1)])]),_:1}),S(O,co(uo(dt)),null,16),S(w(It),{name:"excerpt"})]),_:1}),D("div",mw,[S(w(vt),{name:"start",as:"div",class:"w-1/4 flex flex-col gap-2"},{default:T(()=>[S(C,{for:"ef__start"},{default:T(()=>[...x[6]||(x[6]=[Z("Start Date",-1)])]),_:1}),S(N,{label:"Start date","model-value":w(u),"onUpdate:modelValue":x[0]||(x[0]=dt=>u.value=dt)},null,8,["model-value"]),S(w(It),{name:"start"})]),_:1}),S(w(vt),{name:"end",as:"div",class:"w-1/4 flex flex-col gap-2"},{default:T(()=>[S(C,{for:"ef__end"},{default:T(()=>[...x[7]||(x[7]=[Z("End Date",-1)])]),_:1}),S(N,{label:"End date","min-value":w(u),"model-value":w(h),"onUpdate:modelValue":x[1]||(x[1]=dt=>h.value=dt)},null,8,["min-value","model-value"]),S(w(It),{name:"end"})]),_:1}),S(w(vt),{name:"difficulty",as:"div",class:"w-1/4 flex flex-col gap-2"},{default:T(({field:dt})=>[S(C,{for:"ef__difficulty"},{default:T(()=>[...x[8]||(x[8]=[Z("Difficulty",-1)])]),_:1}),S(R,Bt(dt,{autocomplete:"sex","default-value":v.category?.difficulty}),{default:T(()=>[S(F,{class:"w-full"},{default:T(()=>[S(V,{placeholder:"Select a difficulty"})]),_:1}),S(ot,null,{default:T(()=>[(z(),K(gt,null,se(["moderate","easy","difficult"],J=>S(et,{value:J},{default:T(()=>[Z(st(J),1)]),_:2},1032,["value"])),64))]),_:1})]),_:2},1040,["default-value"]),S(w(It),{name:"difficulty"})]),_:1}),S(w(vt),{name:"distance",as:"div",class:"w-1/4 flex flex-col gap-2"},{default:T(({field:dt})=>[S(C,{for:"ef__distance"},{default:T(()=>[...x[9]||(x[9]=[Z("Distance",-1)])]),_:1}),S(k,Bt(dt,{id:"ef__distance"}),null,16),S(w(It),{name:"distance"})]),_:1})]),S(w(vt),{name:"location",as:"div",class:"flex flex-col gap-1"},{default:T(({field:dt})=>[S(C,{for:"scf__location"},{default:T(()=>[...x[10]||(x[10]=[Z("Location",-1)])]),_:1}),S(k,co(uo(dt)),null,16),S(w(It),{name:"location"})]),_:1}),S(w(vt),{name:"description",as:"div",class:"flex flex-col gap-2"},{default:T(({value:dt,handleChange:J})=>[S(ut,{"model-value":dt??"","onUpdate:modelValue":J,disabled:!1,timer:1e3},null,8,["model-value","onUpdate:modelValue"]),S(w(It),{name:"description"})]),_:1}),D("div",gw,[w(f).map?(z(),tt(Zt,{key:1},{default:T(()=>[S(Tt,{"as-child":""},{default:T(()=>[S(xt,{type:"button",size:"icon",variant:"ghost"},{default:T(()=>[S(w(ds))]),_:1})]),_:1}),S(gi,{class:"sm:max-w-[1000px]"},{default:T(()=>[S(Ut,null,{default:T(()=>[Z(st(v.category?.name)+"'s map",1)]),_:1}),S(mi,null,{default:T(()=>[...x[11]||(x[11]=[Z("lorem",-1)])]),_:1}),S(ue,{"gpx-file":w(as)(v.category?.map_file.file_name)},null,8,["gpx-file"])]),_:1})]),_:1})):(z(),K(gt,{key:0},[D("label",_w,[D("input",{type:"file",onChange:x[2]||(x[2]=dt=>_(dt,"map")),accept:".gpx",class:"hidden"},null,32),D("span",yw,st(w(c)?w(c):"Upload GPX file"),1)]),w(c)?(z(),tt(xt,{key:0,type:"button",onClick:x[3]||(x[3]=()=>{y("map"),c.value=""}),size:"icon",modifier:"outline",class:"absolute top-1/2 right-2 -translate-y-1/2"},{default:T(()=>[S(w(Fi))]),_:1})):bt("",!0),S(w(It),{name:"map"})],64))]),D("div",vw,[S(xt,{type:"submit",disabled:w(o)},{default:T(()=>[w(o)?(z(),tt(w(fi),{key:0,class:"animate-spin"})):(z(),tt(w(hi),{key:1})),x[12]||(x[12]=Z(" Save ",-1))]),_:1},8,["disabled"])])]),_:1},8,["validation-schema"])}}}),xw={class:"pt-8 pl-8"},ww={class:"flex gap-2 pb-4 mb-5 border-b"},kw={key:0,class:"pb-8 space-y-16"},Sw={class:"flex gap-2"},Mw={class:"grow"},Cw=["textContent"],Tw={class:"flex gap-2"},Pw={class:"border-t border-dashed pt-4"},Ew=_t({__name:"List",props:{stageId:{}},emits:["update"],setup(n,{emit:t}){const e=t,i=n,{axios:s}=cn(),o=q(!1),a=q(null),c=q([]),u=async()=>{const{data:h}=await s.get(`/events/${i.stageId}/stage_categories`);c.value=h};return xe(()=>{u()}),(h,f)=>{const m=ce,_=Rn,y=Bn,v=Qi,x=zn,k=Dn;return z(),K(gt,null,[D("div",xw,[D("div",ww,[f[4]||(f[4]=D("div",{class:"grow"},[D("h2",null,"Category")],-1)),S(m,{variant:"secondary",size:"sm",modifier:"outline",onClick:f[0]||(f[0]=C=>o.value=!0)},{default:T(()=>[S(w(us)),f[3]||(f[3]=Z(" Add a Category ",-1))]),_:1})]),w(c).length>0?(z(),K("div",kw,[(z(!0),K(gt,null,se(w(c),C=>(z(),K("div",null,[D("div",Sw,[D("div",Mw,[D("strong",null,st(C.name),1),D("p",{class:"mb-4",textContent:st(C.excerpt)},null,8,Cw)]),D("div",Tw,[S(m,{variant:"secondary",size:"icon",modifier:"outline"},{default:T(()=>[S(w(Fr))]),_:1}),S(m,{variant:"destructive",size:"icon",modifier:"outline"},{default:T(()=>[S(w(Fr))]),_:1})])]),D("div",Pw,[S(fw,{"stage-category-id":C.id},null,8,["stage-category-id"])])]))),256))])):bt("",!0)]),S(k,{open:w(o),"onUpdate:open":f[2]||(f[2]=C=>o.value=!1)},{default:T(()=>[S(x,{class:"sm:max-w-[1000px] max-h-full overflow-y-auto"},{default:T(()=>[S(v,null,{default:T(()=>[S(_,null,{default:T(()=>[Z(st(w(a)?"Edit "+w(a).name:"Add category"),1)]),_:1}),S(y)]),_:1}),S(bw,{"stage-id":h.stageId,category:w(a),onUpdate:f[1]||(f[1]=async()=>{o.value=!1,await u(),e("update")})},null,8,["stage-id","category"])]),_:1})]),_:1},8,["open"])],64)}}}),Ow=cs(Ps),Lw={class:"text-right mb-12"},Aw={class:"space-y-4"},Iw={class:"grow"},Nw={class:"flex justify-end gap-2 pb-4 mb-8 border-b"},Dw={class:"space-y-2"},zw={class:"text-xl"},Rw={class:"space-x-3"},Bw=["textContent"],$w=_t({__name:"list",props:{eventId:{}},emits:["update"],setup(n,{emit:t}){const e=t,i=n,{fetch:s,destory:o}=na(),{stages:a}=Du(na()),c=q(!1),u=q(null),h=q(null);return xe(async()=>{await s(i.eventId)}),(f,m)=>{const _=ce,y=Uu,v=qu,x=hs,k=ju,C=Wu,O=Rn,N=Bn,V=Qi,F=zn,et=Dn,ot=Ow;return z(),K(gt,null,[D("div",Lw,[S(_,{variant:"secondary",onClick:m[0]||(m[0]=R=>c.value=!0)},{default:T(()=>[S(w(us)),m[4]||(m[4]=Z(" Add stage ",-1))]),_:1})]),D("div",Aw,[S(C,{orientation:"vertical","default-value":w(a)[0]?.id,class:"flex-row gap-4"},{default:T(()=>[S(v,{class:"flex-col h-full"},{default:T(()=>[(z(!0),K(gt,null,se(w(a),R=>(z(),tt(y,{value:R.id},{default:T(()=>[Z(st(R.name),1)]),_:2},1032,["value"]))),256))]),_:1}),D("div",Iw,[(z(!0),K(gt,null,se(w(a),R=>(z(),tt(k,{value:R.id},{default:T(()=>[D("div",Nw,[S(_,{variant:"runner",size:"icon",onClick:()=>{u.value=R}},{default:T(()=>[S(w(ds))]),_:2},1032,["onClick"]),S(_,{variant:"destructive",onClick:async()=>{await w(o)(R.id),w(s)(f.eventId)}},{default:T(()=>[S(w(Vu))]),_:2},1032,["onClick"]),S(_,{size:"icon",onClick:()=>{c.value=!0,h.value=R}},{default:T(()=>[S(w(Fr))]),_:2},1032,["onClick"])]),D("div",Dw,[D("h2",zw,st(R.name),1),D("div",Rw,[R.runners.length>0?(z(),tt(x,{key:0},{default:T(()=>[Z("runners "+st(R.runners.length),1)]),_:2},1024)):bt("",!0),R.volunteers.length>0?(z(),tt(x,{key:1},{default:T(()=>[Z("volunteers "+st(R.volunteers.length),1)]),_:2},1024)):bt("",!0)]),D("p",{textContent:st(R.excerpt)},null,8,Bw),S(Ew,{"stage-id":R.id},null,8,["stage-id"])])]),_:2},1032,["value"]))),256))])]),_:1},8,["default-value"])]),S(et,{open:w(c),"onUpdate:open":m[2]||(m[2]=R=>c.value=!1)},{default:T(()=>[S(F,{class:"sm:max-w-[1000px] max-h-full overflow-y-auto"},{default:T(()=>[S(V,null,{default:T(()=>[S(O,null,{default:T(()=>[...m[5]||(m[5]=[Z("Stage form",-1)])]),_:1}),S(N,null,{default:T(()=>[...m[6]||(m[6]=[Z("Lorem, ipsum dolor sit amet consectetur adipisicing elit. Possimus assumenda, maxime. ",-1)])]),_:1})]),_:1}),S(iw,{"event-id":f.eventId,stage:w(h),onUpdate:m[1]||(m[1]=()=>{c.value=!1,h.value=null,w(s)(f.eventId),e("update")})},null,8,["event-id","stage"])]),_:1})]),_:1},8,["open"]),S(et,{open:w(u)!=null,"onUpdate:open":m[3]||(m[3]=R=>u.value=null)},{default:T(()=>[S(F,{class:"sm:max-w-[1000px]"},{default:T(()=>[S(V,null,{default:T(()=>[S(O,null,{default:T(()=>[...m[7]||(m[7]=[Z("Map",-1)])]),_:1}),S(N,null,{default:T(()=>[...m[8]||(m[8]=[Z("Some text",-1)])]),_:1})]),_:1}),w(u)?(z(),tt(ot,{key:0,"map-id":"someId",center:[27.756846786775668,85.3124535214843],gpxFile:w(as)(w(u)?.map_file.file_name)},null,8,["gpxFile"])):bt("",!0)]),_:1})]),_:1},8,["open"])],64)}}}),Ou=sa("gallery",()=>{const n=q([]),{axios:t}=cn();return{galleries:n,fetch:async o=>{const{data:a}=await t.get(`/events/${o}/galleries`);n.value=a},save:async(o,a)=>{await t.post(`/events/${o}/galleries`,{images:a})},destory:async(o,a)=>{await t.delete(`/events/${o}/galleries/${a}`)}}}),Fw={class:"flex flex-wrap gap-4"},Vw={class:"w-[calc(25%-16px)] h-[250px] rounded overflow-hidden relative border border-dashed hover:border-gray-600 transition-colors"},Zw={key:1,class:"w-full h-full flex justify-center items-center p-3"},Hw={class:"w-[calc(25%-16px)] h-[250px] p-2 rounded overflow-hidden relative border border-dashed"},Ww=["src"],jw={class:"w-[calc(25%-16px)] h-[250px] p-2 rounded overflow-hidden relative border border-dashed"},qw=["src"],Uw=_t({__name:"list",props:{eventId:{}},setup(n){const t=n,{galleries:e}=Du(Ou()),{fetch:i,save:s,destory:o}=Ou(),a=q([]),c=q(!1),u=m=>{if(m.target==null)return;const _=m.target.files;if(_&&_?.length>0)for(const y of _){const v=new FileReader;v.readAsDataURL(y),v.onload=()=>{a.value.push(v.result)}}},h=m=>{a.value.splice(m,1)},f=async()=>{c.value=!0,await s(t.eventId,a.value),i(t.eventId),a.value=[],c.value=!1};return he(()=>t.eventId,()=>{i(t.eventId)}),xe(()=>{i(t.eventId)}),(m,_)=>{const y=ce;return z(),K("div",Fw,[D("div",Vw,[w(a).length>0?(z(),tt(y,{key:0,class:"absolute top-1/2 right-1/2 translate-x-1/2 -translate-y-1/2",onClick:f},{default:T(()=>[..._[0]||(_[0]=[Z(" Save ",-1)])]),_:1})):(z(),K("label",Zw,[D("input",{type:"file",accept:"image/*",onChange:u,multiple:"",class:"sr-only"},null,32),_[1]||(_[1]=D("div",{class:"text-center"},[D("strong",{class:"text-lg block"},"Upload image"),D("span",{class:"text-xs"},"You can upload multiple images")],-1))]))]),(z(!0),K(gt,null,se(w(a),(v,x)=>(z(),K("figure",Hw,[D("img",{src:v,alt:"image description",class:"w-full h-full object-contain object-center"},null,8,Ww),S(y,{variant:"secondary",size:"icon",class:"absolute top-2 right-2 z-[2]",onClick:k=>h(x)},{default:T(()=>[S(w(Fi))]),_:2},1032,["onClick"])]))),256)),(z(!0),K(gt,null,se(w(e),v=>(z(),K("figure",jw,[D("img",{src:w(ia)(v.file_name),alt:"image description",class:"w-full h-full object-contain object-center"},null,8,qw),S(y,{variant:"secondary",size:"icon",class:"absolute top-2 right-2 z-[2]",onClick:async()=>{await w(o)(m.eventId,v.id),w(i)(m.eventId)}},{default:T(()=>[S(w(Mm))]),_:2},1032,["onClick"])]))),256))])}}}),Kw={class:"inline-block align-top"},Jw={class:"text-right"},Gw=_t({__name:"AssignCheckpointForm",props:{volunteer:{},checkpoints:{}},emits:["update"],setup(n,{emit:t}){const e=t,i=n,{assignVolunteerToCheckpoint:s}=hf(),o=q(!1);q();const a=async c=>{o.value=!0,await s(i.volunteer.id,c.checkpoint_id),o.value=!1,e("update")};return(c,u)=>{const h=da,f=ua,m=fa,_=ha,y=ca,v=ce;return z(),tt(w(fs),{onSubmit:a,class:"space-y-4 pt-8"},{default:T(()=>[S(w(vt),{name:"checkpoint_id",as:"div",class:"space-y-2"},{default:T(({field:x})=>[D("label",Kw,[u[0]||(u[0]=Z("Choose a checkpoint to assign to ",-1)),D("strong",null,st(c.volunteer.personal.first_name),1)]),S(y,{"model-value":String(x.value??""),"onUpdate:modelValue":k=>x.onChange(k)},{default:T(()=>[S(f,{class:"w-full h-12"},{default:T(()=>[S(h,{placeholder:"Select a checkpoint"})]),_:1}),S(_,null,{default:T(()=>[(z(!0),K(gt,null,se(c.checkpoints,k=>(z(),tt(m,{value:k.id},{default:T(()=>[Z(st(k.name),1)]),_:2},1032,["value"]))),256))]),_:1})]),_:2},1032,["model-value","onUpdate:modelValue"])]),_:1}),D("div",Jw,[S(v,{variant:"default",type:"submit",class:"w-full sm:w-auto px-8 py-3 h-12 text-base font-medium",disabled:w(o),"aria-busy":w(o)},{default:T(()=>[w(o)?(z(),tt(w(Ru),{key:0,size:20,class:"animate-spin mr-2"})):bt("",!0),u[1]||(u[1]=Z(" Assign ",-1))]),_:1},8,["disabled","aria-busy"])])]),_:1})}}}),Yw={class:"divide-y space-y-4 [&>li]:pb-4"},Xw={class:"flex gap-2 items-center"},Qw={class:"grow space-y-1"},tk={class:"text-lg block"},ek={key:0},nk=_t({__name:"list",props:{stages:{}},emits:["update"],setup(n,{emit:t}){const e=t,i=q(null),s=q([]);return(o,a)=>{const c=hs,u=ce,h=Rn,f=Bn,m=Qi,_=Gw,y=zn,v=Dn;return z(),K(gt,null,[D("ul",Yw,[(z(!0),K(gt,null,se(o.stages,x=>(z(),K(gt,null,[(z(!0),K(gt,null,se(x.volunteers,k=>(z(),K("li",Xw,[D("div",Qw,[D("strong",tk,st(k.personal.first_name)+" "+st(k.personal.middle_name)+" "+st(k.personal.last_name),1),S(c,{variant:"outline"},{default:T(()=>[Z(st(k.stages.map(C=>C.name).join(", ")),1)]),_:2},1024),k?.checkpoints.length>0?(z(),K("p",ek,"Assigned to: "+st(k?.checkpoints.map(C=>C.name).join(", ")),1)):bt("",!0)]),k.checkpoints.length==0?(z(),tt(u,{key:0,variant:"secondary",modifier:"outline",onClick:()=>{i.value=k,s.value=x.stage_categories.map(C=>C.checkpoints).reduce((C,O)=>[...C,...O],[])}},{default:T(()=>[...a[2]||(a[2]=[Z("Assign to checkpoint",-1)])]),_:2},1032,["onClick"])):bt("",!0)]))),256))],64))),256))]),w(i)?(z(),tt(v,{key:0,open:w(i)!=null,"onUpdate:open":a[1]||(a[1]=x=>i.value=null)},{default:T(()=>[S(y,null,{default:T(()=>[S(m,null,{default:T(()=>[S(h,{class:"text-2xl"},{default:T(()=>[...a[3]||(a[3]=[Z("Assign volunteers to checkpoint",-1)])]),_:1}),S(f,null,{default:T(()=>[...a[4]||(a[4]=[Z("You can indiviually assign volunteers to the available checkpoints ",-1)])]),_:1})]),_:1}),S(_,{volunteer:w(i),checkpoints:w(s),onUpdate:a[0]||(a[0]=()=>{i.value=null,e("update")})},null,8,["volunteer","checkpoints"])]),_:1})]),_:1},8,["open"])):bt("",!0)],64)}}}),ik={class:"divide-y space-y-4 [&>li]:pb-4"},rk={class:"flex gap-2 items-center"},sk={class:"grow space-y-3"},ok={class:"text-lg"},ak={class:"text-sm block not-italic"},lk={key:0,class:"text-sm space-y-1"},ck={class:"flex justify-between gap-1"},uk={class:"font-normal"},dk={class:"not-italic"},hk=_t({__name:"list",props:{stages:{}},emits:["update"],setup(n,{emit:t}){return(e,i)=>{const s=hs;return z(),K("ul",ik,[(z(!0),K(gt,null,se(e.stages,o=>(z(),K(gt,null,[(z(!0),K(gt,null,se(o.runners,a=>(z(),K("li",rk,[D("div",sk,[D("strong",ok,[Z(st(a.personal.first_name)+" "+st(a.personal.middle_name)+" "+st(a.personal.last_name)+" ",1),S(s,{variant:"outline"},{default:T(()=>[Z(st(w(Mn)().diff(w(Mn)(a.personal.date_of_birth),"years"))+" "+st(a.personal?.gender?.name.charAt(0).toUpperCase()),1)]),_:2},1024)]),D("em",ak,st(a.bib),1),a.volunteer_on_checkpoints.length>0?(z(),K("ul",lk,[(z(!0),K(gt,null,se(a.volunteer_on_checkpoints,c=>(z(),K("li",ck,[D("strong",uk,st(c.checkpoint.name),1),D("em",dk,st(w(Mn)(c.timer).format("YYYY-MM-DD HH:mm:ss")),1)]))),256))])):bt("",!0)])]))),256))],64))),256))])}}}),fk={class:"bg-white flex items-center gap-4 px-4 pt-4 pb-20 -mt-16 rounded-xl relative z-10"},pk={class:"flex-grow"},mk={class:"text-2xl"},gk={class:"flex gap-2 items-center"},_k={class:"flex flex-col gap-4"},yk={class:"text-md"},vk={class:"text"},cS=_t({__name:"[id]",setup(n){Pm({title:"Events"});const t=Iu(),{get:e}=Nu(),i=q(null),s=q(!1),o=async()=>{i.value=await e(t.params.id)};return oa(()=>{s.value=!0,o(),s.value=!1}),(a,c)=>{const u=ce,h=Uu,f=qu,m=ju,_=Wu;return w(i)?(z(),K(gt,{key:0},[S(Km,{"trail-race":w(i),onUpdate:o},null,8,["trail-race"]),D("div",fk,[D("div",pk,[D("h1",mk,st(w(i)?.name),1)]),D("div",gk,[S(u,{onClick:o,variant:"secondary",modifier:"outline",size:"icon"},{default:T(()=>[S(w(Em),{class:Xt({"animate-spin":w(s)})},null,8,["class"])]),_:1}),S(u,{onClick:c[0]||(c[0]=y=>("navigateTo"in a?a.navigateTo:w(sm))({name:"dashboard-events"}))},{default:T(()=>[S(w(Cm)),c[1]||(c[1]=Z(" Back ",-1))]),_:1})])]),S(_,{"default-value":"volunteers",class:"text-gray-600"},{default:T(()=>[S(f,{class:"uppercase"},{default:T(()=>[S(h,{value:"detail"},{default:T(()=>[...c[2]||(c[2]=[Z(" Details ",-1)])]),_:1}),S(h,{value:"stages"},{default:T(()=>[...c[3]||(c[3]=[Z(" Stages ",-1)])]),_:1}),S(h,{value:"runners"},{default:T(()=>[...c[4]||(c[4]=[Z(" Runners ",-1)])]),_:1}),S(h,{value:"volunteers"},{default:T(()=>[...c[5]||(c[5]=[Z(" Volunteers ",-1)])]),_:1}),S(h,{value:"gallery"},{default:T(()=>[...c[6]||(c[6]=[Z(" Galleries ",-1)])]),_:1}),S(h,{value:"sponsor"},{default:T(()=>[...c[7]||(c[7]=[Z(" Sponsors ",-1)])]),_:1})]),_:1}),S(m,{value:"detail"},{default:T(()=>[D("div",_k,[D("dl",yk,[c[8]||(c[8]=D("dt",null,"Starts:",-1)),D("dd",null,st(w(dc)(w(i)?.start)),1),c[9]||(c[9]=D("dt",null,"Ends:",-1)),D("dd",null,st(w(dc)(w(i)?.end)),1)]),D("div",vk,st(w(i).excerpt),1),S(H1,{"trail-race":w(i),onUpdate:o},null,8,["trail-race"]),S(A1,{"trail-race":w(i),onUpdate:o},null,8,["trail-race"])])]),_:1}),S(m,{value:"stages"},{default:T(()=>[S($w,{"event-id":w(t).params.id,onUpdate:o},null,8,["event-id"])]),_:1}),S(m,{value:"runners"},{default:T(()=>[S(hk,{stages:w(i).stages,onUpdate:o},null,8,["stages"])]),_:1}),S(m,{value:"volunteers"},{default:T(()=>[S(nk,{stages:w(i).stages,onUpdate:o},null,8,["stages"])]),_:1}),S(m,{value:"gallery"},{default:T(()=>[S(Uw,{"event-id":w(t).params.id},null,8,["event-id"])]),_:1})]),_:1})],64)):bt("",!0)}}});export{cS as default};
