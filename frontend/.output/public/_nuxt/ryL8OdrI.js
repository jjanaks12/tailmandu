import{i as g,u as _,o as B}from"./CeaXpSoW.js";import{P as S}from"./BolWmxc9.js";import{r as O,m as h,aS as E,X as b,e as T,E as m,aR as F,f as x,o as W,w as k,N as I,g as D,O as A}from"./CQTPwDMt.js";function L(r,i,n){const e=n.originalEvent.target,a=new CustomEvent(r,{bubbles:!1,cancelable:!0,detail:n});i&&e.addEventListener(r,i,{once:!0}),e.dispatchEvent(a)}const R="dismissableLayer.pointerDownOutside",q="dismissableLayer.focusOutside";function C(r,i){const n=i.closest("[data-dismissable-layer]"),e=r.dataset.dismissableLayer===""?r:r.querySelector("[data-dismissable-layer]"),a=Array.from(r.ownerDocument.querySelectorAll("[data-dismissable-layer]"));return!!(n&&(e===n||a.indexOf(e)<a.indexOf(n)))}function z(r,i,n=!0){const e=i?.value?.ownerDocument??globalThis?.document,a=O(!1),s=O(()=>{});return h(l=>{if(!g||!E(n))return;const o=async c=>{const f=c.target;if(!(!i?.value||!f)){if(C(i.value,f)){a.value=!1;return}if(c.target&&!a.value){let y=function(){L(R,r,w)};const w={originalEvent:c};c.pointerType==="touch"?(e.removeEventListener("click",s.value),s.value=y,e.addEventListener("click",s.value,{once:!0})):y()}else e.removeEventListener("click",s.value);a.value=!1}},d=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);l(()=>{window.clearTimeout(d),e.removeEventListener("pointerdown",o),e.removeEventListener("click",s.value)})}),{onPointerDownCapture:()=>{E(n)&&(a.value=!0)}}}function K(r,i,n=!0){const e=i?.value?.ownerDocument??globalThis?.document,a=O(!1);return h(s=>{if(!g||!E(n))return;const l=async o=>{if(!i?.value)return;await b(),await b();const d=o.target;!i.value||!d||C(i.value,d)||o.target&&!a.value&&L(q,r,{originalEvent:o})};e.addEventListener("focusin",l),s(()=>e.removeEventListener("focusin",l))}),{onFocusCapture:()=>{E(n)&&(a.value=!0)},onBlurCapture:()=>{E(n)&&(a.value=!1)}}}const u=F({layersRoot:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set});var N=T({__name:"DismissableLayer",props:{disableOutsidePointerEvents:{type:Boolean,required:!1,default:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","dismiss"],setup(r,{emit:i}){const n=r,e=i,{forwardRef:a,currentElement:s}=_(),l=m(()=>s.value?.ownerDocument??globalThis.document),o=m(()=>u.layersRoot),d=m(()=>s.value?Array.from(o.value).indexOf(s.value):-1),c=m(()=>u.layersWithOutsidePointerEventsDisabled.size>0),f=m(()=>{const t=Array.from(o.value),[v]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),p=t.indexOf(v);return d.value>=p}),w=z(async t=>{const v=[...u.branches].some(p=>p?.contains(t.target));!f.value||v||(e("pointerDownOutside",t),e("interactOutside",t),await b(),t.defaultPrevented||e("dismiss"))},s),y=K(t=>{[...u.branches].some(p=>p?.contains(t.target))||(e("focusOutside",t),e("interactOutside",t),t.defaultPrevented||e("dismiss"))},s);B("Escape",t=>{d.value===o.value.size-1&&(e("escapeKeyDown",t),t.defaultPrevented||e("dismiss"))});let P;return h(t=>{s.value&&(n.disableOutsidePointerEvents&&(u.layersWithOutsidePointerEventsDisabled.size===0&&(P=l.value.body.style.pointerEvents,l.value.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(s.value)),o.value.add(s.value),t(()=>{n.disableOutsidePointerEvents&&u.layersWithOutsidePointerEventsDisabled.size===1&&(l.value.body.style.pointerEvents=P)}))}),h(t=>{t(()=>{s.value&&(o.value.delete(s.value),u.layersWithOutsidePointerEventsDisabled.delete(s.value))})}),(t,v)=>(W(),x(D(S),{ref:D(a),"as-child":t.asChild,as:t.as,"data-dismissable-layer":"",style:A({pointerEvents:c.value?f.value?"auto":"none":void 0}),onFocusCapture:D(y).onFocusCapture,onBlurCapture:D(y).onBlurCapture,onPointerdownCapture:D(w).onPointerDownCapture},{default:k(()=>[I(t.$slots,"default")]),_:3},8,["as-child","as","style","onFocusCapture","onBlurCapture","onPointerdownCapture"]))}}),V=N;export{V as D,L as h};
