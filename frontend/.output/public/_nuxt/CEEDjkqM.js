import{u as $u,_ as Lt}from"./Dc14EJ-Z.js";import{u as Up,a as qp}from"./CVr1xrU2.js";import{c as Kp}from"./CLgC4hXA.js";import{u as Jp}from"./h64YkLeY.js";import{u as ss,a as Gp}from"./CeaXpSoW.js";import{u as Yp,P as Xp}from"./CzxnmzmQ.js";import{P as as,c as Qp}from"./BolWmxc9.js";import{e as ct,M as Fu,r as Z,f as j,o as I,w as C,N as $e,g as w,E as le,p as te,b as x,O as tm,h as lt,P as em,Q as nm,R as ls,n as Ct,l as ge,c as W,a as A,i as gi,d as N,S as Vu,T as aa,U as im,m as rm,V as sm,W as om,X as Hu,Y as am,K as ce,y as Bt,z as Zu,u as Wu,Z as ni,_ as lm,$ as gc,a0 as _c,F as at,t as q,a1 as la,I as ca,G as ua,a2 as cm,x as Me,a3 as um,a4 as po,a5 as mo,v as At,a6 as dm,a7 as ju,a8 as fm,a9 as hm,s as Uu,aa as pm,ab as mm,ac as gm,ad as _m,ae as ym,af as vm,B as bm}from"./CQTPwDMt.js";import{c as cs}from"./CPYLdFy8.js";import{R as xm}from"./DA7qY7rz.js";import{R as km,_ as wm}from"./qg7Sj3pz.js";import{f as yc}from"./D3obJynx.js";import{S as _i,B as Sm,I as Cm,U as Mm,a as Tm,R as Pm,W as Em,H as Om,b as Am,c as Lm,d as Im,e as Nm,f as Dm,L as zm,g as Rm,Q as Bm,M as qu,h as $m,i as Fm,T as Vm,C as Hm,j as Zm}from"./Dvfi7LgN.js";import{L as Ye}from"./DvMzyCV2.js";import{d as Wm}from"./CfwLjDUh.js";import{X as us}from"./m_3sjnvK.js";import{L as jm}from"./D_PCmc_n.js";import{_ as Xe,a as Qe,b as tn,c as en}from"./B-6L8vco.js";import{_ as _n}from"./G48mS-ph.js";import{c as da}from"./Dwo4jQtV.js";import{P as ds}from"./B2Pym-oW.js";import{M as fa}from"./yppJ34qV.js";import{_ as ir}from"./-mDNjDUg.js";import{_ as yi}from"./KnfxygQr.js";import{_ as fs}from"./CqJy5Exi.js";import{_ as Ku}from"./DIhd3umO.js";import{E as Mt,a as gt,F as vi}from"./B7w6sks-.js";import{$ as vc,_ as Um}from"./2l_uslt0.js";import{_ as hs,a as ps,b as ms,c as gs,d as _s}from"./BNgGaryp.js";import{_ as qm}from"./DgmoUr2i.js";import{P as ys,T as ha}from"./DPBHJpZ0.js";import{c as pa}from"./DBMhBydG.js";import{b as ma,e as ga,d as _a,_ as ya,a as va,c as Ju}from"./fXw_ShsL.js";import{_ as Km,a as Jm,b as Gm,c as Ym}from"./CKWUIjEz.js";import{_ as Xm,a as Qm}from"./DjzsvOB6.js";import{E as tg}from"./Bg53LPA2.js";import{_ as eg,a as ng,b as ig}from"./D_ldBVI9.js";import{u as rg}from"./C7UDQdGM.js";import{R as sg}from"./DNoDKpb3.js";import"./t8bd_pWY.js";import"./XOkL2u1L.js";import"./jgqZM5rn.js";import"./BZuA61f2.js";import"./DUG57Tk3.js";import"./BnorDR2v.js";import"./ryL8OdrI.js";import"./Bn7p2RX2.js";import"./2fW08hGM.js";import"./kRIii9yh.js";import"./DfmJcsV1.js";import"./BAgZFvTQ.js";import"./C6Y-ieo6.js";function og(n,t){for(var e=0;e<t.length;e++){const i=t[e];if(typeof i!="string"&&!Array.isArray(i)){for(const s in i)if(s!=="default"&&!(s in n)){const o=Object.getOwnPropertyDescriptor(i,s);o&&Object.defineProperty(n,s,o.get?o:{enumerable:!0,get:()=>i[s]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}const[ba,ag]=Kp("TabsRoot");var lg=ct({__name:"TabsRoot",props:{defaultValue:{type:null,required:!1},orientation:{type:String,required:!1,default:"horizontal"},dir:{type:String,required:!1},activationMode:{type:String,required:!1,default:"automatic"},modelValue:{type:null,required:!1},unmountOnHide:{type:Boolean,required:!1,default:!0},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},emits:["update:modelValue"],setup(n,{emit:t}){const e=n,i=t,{orientation:s,unmountOnHide:o,dir:a}=Fu(e),c=Jp(a);ss();const u=Gp(e,"modelValue",i,{defaultValue:e.defaultValue,passive:e.modelValue===void 0}),f=Z();return ag({modelValue:u,changeModelValue:h=>{u.value=h},orientation:s,dir:c,unmountOnHide:o,activationMode:e.activationMode,baseId:Yp(void 0,"reka-tabs"),tabsList:f}),(h,m)=>(I(),j(w(as),{dir:w(c),"data-orientation":w(s),"as-child":h.asChild,as:h.as},{default:C(()=>[$e(h.$slots,"default",{modelValue:w(u)})]),_:3},8,["dir","data-orientation","as-child","as"]))}}),cg=lg;function Gu(n,t){return`${n}-trigger-${t}`}function Yu(n,t){return`${n}-content-${t}`}var ug=ct({__name:"TabsContent",props:{value:{type:[String,Number],required:!0},forceMount:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(n){const t=n,{forwardRef:e}=ss(),i=ba(),s=le(()=>Gu(i.baseId,t.value)),o=le(()=>Yu(i.baseId,t.value)),a=le(()=>t.value===i.modelValue.value),c=Z(a.value);return te(()=>{requestAnimationFrame(()=>{c.value=!1})}),(u,f)=>(I(),j(w(Xp),{present:u.forceMount||a.value,"force-mount":""},{default:C(({present:h})=>[x(w(as),{id:o.value,ref:w(e),"as-child":u.asChild,as:u.as,role:"tabpanel","data-state":a.value?"active":"inactive","data-orientation":w(i).orientation.value,"aria-labelledby":s.value,hidden:!h,tabindex:"0",style:tm({animationDuration:c.value?"0s":void 0})},{default:C(()=>[!w(i).unmountOnHide.value||h?$e(u.$slots,"default",{key:0}):lt("v-if",!0)]),_:2},1032,["id","as-child","as","data-state","data-orientation","aria-labelledby","hidden","style"])]),_:3},8,["present"]))}}),dg=ug,fg=ct({__name:"TabsList",props:{loop:{type:Boolean,required:!1,default:!0},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(n){const t=n,{loop:e}=Fu(t),{forwardRef:i,currentElement:s}=ss(),o=ba();return o.tabsList=s,(a,c)=>(I(),j(w(xm),{"as-child":"",orientation:w(o).orientation.value,dir:w(o).dir.value,loop:w(e)},{default:C(()=>[x(w(as),{ref:w(i),role:"tablist","as-child":a.asChild,as:a.as,"aria-orientation":w(o).orientation.value},{default:C(()=>[$e(a.$slots,"default")]),_:3},8,["as-child","as","aria-orientation"])]),_:3},8,["orientation","dir","loop"]))}}),hg=fg,pg=ct({__name:"TabsTrigger",props:{value:{type:[String,Number],required:!0},disabled:{type:Boolean,required:!1,default:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"button"}},setup(n){const t=n,{forwardRef:e}=ss(),i=ba(),s=le(()=>Gu(i.baseId,t.value)),o=le(()=>Yu(i.baseId,t.value)),a=le(()=>t.value===i.modelValue.value);return(c,u)=>(I(),j(w(km),{"as-child":"",focusable:!c.disabled,active:a.value},{default:C(()=>[x(w(as),{id:s.value,ref:w(e),role:"tab",type:c.as==="button"?"button":void 0,as:c.as,"as-child":c.asChild,"aria-selected":a.value?"true":"false","aria-controls":o.value,"data-state":a.value?"active":"inactive",disabled:c.disabled,"data-disabled":c.disabled?"":void 0,"data-orientation":w(i).orientation.value,onMousedown:u[0]||(u[0]=nm(f=>{!c.disabled&&f.ctrlKey===!1?w(i).changeModelValue(c.value):f.preventDefault()},["left"])),onKeydown:u[1]||(u[1]=em(f=>w(i).changeModelValue(c.value),["enter","space"])),onFocus:u[2]||(u[2]=()=>{const f=w(i).activationMode!=="manual";!a.value&&!c.disabled&&f&&w(i).changeModelValue(c.value)})},{default:C(()=>[$e(c.$slots,"default")]),_:3},8,["id","type","as","as-child","aria-selected","aria-controls","data-state","disabled","data-disabled","data-orientation"])]),_:3},8,["focusable","active"]))}}),mg=pg;const Xu=ct({__name:"Tabs",props:{defaultValue:{},orientation:{},dir:{},activationMode:{},modelValue:{},unmountOnHide:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},emits:["update:modelValue"],setup(n,{emit:t}){const e=n,i=t,s=ls(e,"class"),o=Up(s,i);return(a,c)=>(I(),j(w(cg),Ct({"data-slot":"tabs"},w(o),{class:w(cs)("flex flex-col gap-2",e.class)}),{default:C(()=>[$e(a.$slots,"default")]),_:3},16,["class"]))}}),Qu=ct({__name:"TabsContent",props:{value:{},forceMount:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(n){const t=n,e=ls(t,"class");return(i,s)=>(I(),j(w(dg),Ct({"data-slot":"tabs-content",class:w(cs)("flex-1 outline-none",t.class)},w(e)),{default:C(()=>[$e(i.$slots,"default")]),_:3},16,["class"]))}}),td=ct({__name:"TabsList",props:{loop:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(n){const t=n,e=ls(t,"class");return(i,s)=>(I(),j(w(hg),Ct({"data-slot":"tabs-list"},w(e),{class:w(cs)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t.class)}),{default:C(()=>[$e(i.$slots,"default")]),_:3},16,["class"]))}}),ed=ct({__name:"TabsTrigger",props:{value:{},disabled:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup(n){const t=n,e=ls(t,"class"),i=qp(e);return(s,o)=>(I(),j(w(mg),Ct({"data-slot":"tabs-trigger"},w(i),{class:w(cs)("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t.class)}),{default:C(()=>[$e(s.$slots,"default")]),_:3},16,["class"]))}}),gg={class:"bg-accent aspect-[1030/350] -mt-12 -mx-12 relative z-10"},_g={key:0,class:""},yg=["src","alt"],vg=["diabled"],bg=["disabled"],xg=["src"],kg={key:1,class:"relative"},wg={class:"absolute top-2 right-2"},Sg=ct({__name:"imageUpload",props:{trailRace:{}},emits:["update"],setup(n,{emit:t}){const e=n,{axios:i}=ge(),s=t,{can:o}=$u(),a=Z(""),c=Z(!1),u=Z(!1),f=m=>{const g=m.target.files??[];if(g?.length==0)return;const y=new FileReader,v=g[0];y.onload=()=>{a.value=y.result},v&&y.readAsDataURL(v)},h=async()=>{u.value=!0,await i.put(`/events/${e.trailRace.id}/upload_thumbnail`,{image:a.value}),u.value=!1,c.value=!0,s("update")};return te(()=>{e.trailRace.image_id||(c.value=!0)}),(m,g)=>{const y=Lt;return I(),W("div",gg,[n.trailRace.image_id!=null&&(!w(c)||!w(o)("event_edit"))?(I(),W("figure",_g,[A("img",{src:w(gi)(n.trailRace?.thumbnail?.file_name),alt:n.trailRace.name,class:"w-full h-full object-cover absolute top-0 left-0 z-0"},null,8,yg)])):(I(),W("label",{key:1,class:"bg-gray-100 hover:bg-gray-200 h-full flex justify-center items-center cursor-pointer transition-colors overflow-hidden",diabled:w(u)},[A("input",{type:"file",class:"hidden",onChange:f,disabled:w(u),accept:".jpg, .jpeg, .png"},null,40,bg),w(a)?(I(),W("img",{key:0,src:w(a),alt:"Trail race preview image",class:"w-full h-full object-cover absolute top-0 left-0 z-0"},null,8,xg)):(I(),W("span",kg,"Upload image"))],8,vg)),A("div",wg,[n.trailRace.image_id!=null&&!w(c)?(I(),j(y,{key:0,onClick:g[0]||(g[0]=v=>c.value=!0),permissions:"event_edit"},{default:C(()=>[...g[1]||(g[1]=[N("Edit image",-1)])]),_:1})):lt("",!0),w(c)&&w(a)?(I(),j(y,{key:1,variant:"secondary",size:"sm",onClick:h,disabled:w(u),permissions:"event_edit"},{default:C(()=>[w(u)?(I(),j(w(Ye),{key:1,class:"animate-spin relative"})):(I(),j(w(_i),{key:0})),g[2]||(g[2]=N(" Save ",-1))]),_:1},8,["disabled"])):lt("",!0)])])}}});function Kt(n){this.content=n}Kt.prototype={constructor:Kt,find:function(n){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===n)return t;return-1},get:function(n){var t=this.find(n);return t==-1?void 0:this.content[t+1]},update:function(n,t,e){var i=e&&e!=n?this.remove(e):this,s=i.find(n),o=i.content.slice();return s==-1?o.push(e||n,t):(o[s+1]=t,e&&(o[s]=e)),new Kt(o)},remove:function(n){var t=this.find(n);if(t==-1)return this;var e=this.content.slice();return e.splice(t,2),new Kt(e)},addToStart:function(n,t){return new Kt([n,t].concat(this.remove(n).content))},addToEnd:function(n,t){var e=this.remove(n).content.slice();return e.push(n,t),new Kt(e)},addBefore:function(n,t,e){var i=this.remove(t),s=i.content.slice(),o=i.find(n);return s.splice(o==-1?s.length:o,0,t,e),new Kt(s)},forEach:function(n){for(var t=0;t<this.content.length;t+=2)n(this.content[t],this.content[t+1])},prepend:function(n){return n=Kt.from(n),n.size?new Kt(n.content.concat(this.subtract(n).content)):this},append:function(n){return n=Kt.from(n),n.size?new Kt(this.subtract(n).content.concat(n.content)):this},subtract:function(n){var t=this;n=Kt.from(n);for(var e=0;e<n.content.length;e+=2)t=t.remove(n.content[e]);return t},toObject:function(){var n={};return this.forEach(function(t,e){n[t]=e}),n},get size(){return this.content.length>>1}};Kt.from=function(n){if(n instanceof Kt)return n;var t=[];if(n)for(var e in n)t.push(e,n[e]);return new Kt(t)};function nd(n,t,e){for(let i=0;;i++){if(i==n.childCount||i==t.childCount)return n.childCount==t.childCount?null:e;let s=n.child(i),o=t.child(i);if(s==o){e+=s.nodeSize;continue}if(!s.sameMarkup(o))return e;if(s.isText&&s.text!=o.text){for(let a=0;s.text[a]==o.text[a];a++)e++;return e}if(s.content.size||o.content.size){let a=nd(s.content,o.content,e+1);if(a!=null)return a}e+=s.nodeSize}}function id(n,t,e,i){for(let s=n.childCount,o=t.childCount;;){if(s==0||o==0)return s==o?null:{a:e,b:i};let a=n.child(--s),c=t.child(--o),u=a.nodeSize;if(a==c){e-=u,i-=u;continue}if(!a.sameMarkup(c))return{a:e,b:i};if(a.isText&&a.text!=c.text){let f=0,h=Math.min(a.text.length,c.text.length);for(;f<h&&a.text[a.text.length-f-1]==c.text[c.text.length-f-1];)f++,e--,i--;return{a:e,b:i}}if(a.content.size||c.content.size){let f=id(a.content,c.content,e-1,i-1);if(f)return f}e-=u,i-=u}}class z{constructor(t,e){if(this.content=t,this.size=e||0,e==null)for(let i=0;i<t.length;i++)this.size+=t[i].nodeSize}nodesBetween(t,e,i,s=0,o){for(let a=0,c=0;c<e;a++){let u=this.content[a],f=c+u.nodeSize;if(f>t&&i(u,s+c,o||null,a)!==!1&&u.content.size){let h=c+1;u.nodesBetween(Math.max(0,t-h),Math.min(u.content.size,e-h),i,s+h)}c=f}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,e,i,s){let o="",a=!0;return this.nodesBetween(t,e,(c,u)=>{let f=c.isText?c.text.slice(Math.max(t,u)-u,e-u):c.isLeaf?s?typeof s=="function"?s(c):s:c.type.spec.leafText?c.type.spec.leafText(c):"":"";c.isBlock&&(c.isLeaf&&f||c.isTextblock)&&i&&(a?a=!1:o+=i),o+=f},0),o}append(t){if(!t.size)return this;if(!this.size)return t;let e=this.lastChild,i=t.firstChild,s=this.content.slice(),o=0;for(e.isText&&e.sameMarkup(i)&&(s[s.length-1]=e.withText(e.text+i.text),o=1);o<t.content.length;o++)s.push(t.content[o]);return new z(s,this.size+t.size)}cut(t,e=this.size){if(t==0&&e==this.size)return this;let i=[],s=0;if(e>t)for(let o=0,a=0;a<e;o++){let c=this.content[o],u=a+c.nodeSize;u>t&&((a<t||u>e)&&(c.isText?c=c.cut(Math.max(0,t-a),Math.min(c.text.length,e-a)):c=c.cut(Math.max(0,t-a-1),Math.min(c.content.size,e-a-1))),i.push(c),s+=c.nodeSize),a=u}return new z(i,s)}cutByIndex(t,e){return t==e?z.empty:t==0&&e==this.content.length?this:new z(this.content.slice(t,e))}replaceChild(t,e){let i=this.content[t];if(i==e)return this;let s=this.content.slice(),o=this.size+e.nodeSize-i.nodeSize;return s[t]=e,new z(s,o)}addToStart(t){return new z([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new z(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e}maybeChild(t){return this.content[t]||null}forEach(t){for(let e=0,i=0;e<this.content.length;e++){let s=this.content[e];t(s,i,e),i+=s.nodeSize}}findDiffStart(t,e=0){return nd(this,t,e)}findDiffEnd(t,e=this.size,i=t.size){return id(this,t,e,i)}findIndex(t){if(t==0)return Pr(0,t);if(t==this.size)return Pr(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let e=0,i=0;;e++){let s=this.child(e),o=i+s.nodeSize;if(o>=t)return o==t?Pr(e+1,o):Pr(e,i);i=o}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(t=>t.toJSON()):null}static fromJSON(t,e){if(!e)return z.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new z(e.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return z.empty;let e,i=0;for(let s=0;s<t.length;s++){let o=t[s];i+=o.nodeSize,s&&o.isText&&t[s-1].sameMarkup(o)?(e||(e=t.slice(0,s)),e[e.length-1]=o.withText(e[e.length-1].text+o.text)):e&&e.push(o)}return new z(e||t,i)}static from(t){if(!t)return z.empty;if(t instanceof z)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new z([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}z.empty=new z([],0);const go={index:0,offset:0};function Pr(n,t){return go.index=n,go.offset=t,go}function Zr(n,t){if(n===t)return!0;if(!(n&&typeof n=="object")||!(t&&typeof t=="object"))return!1;let e=Array.isArray(n);if(Array.isArray(t)!=e)return!1;if(e){if(n.length!=t.length)return!1;for(let i=0;i<n.length;i++)if(!Zr(n[i],t[i]))return!1}else{for(let i in n)if(!(i in t)||!Zr(n[i],t[i]))return!1;for(let i in t)if(!(i in n))return!1}return!0}let yt=class Bo{constructor(t,e){this.type=t,this.attrs=e}addToSet(t){let e,i=!1;for(let s=0;s<t.length;s++){let o=t[s];if(this.eq(o))return t;if(this.type.excludes(o.type))e||(e=t.slice(0,s));else{if(o.type.excludes(this.type))return t;!i&&o.type.rank>this.type.rank&&(e||(e=t.slice(0,s)),e.push(this),i=!0),e&&e.push(o)}}return e||(e=t.slice()),i||e.push(this),e}removeFromSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t}isInSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1}eq(t){return this==t||this.type==t.type&&Zr(this.attrs,t.attrs)}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");let i=t.marks[e.type];if(!i)throw new RangeError(`There is no mark type ${e.type} in this schema`);let s=i.create(e.attrs);return i.checkAttrs(s.attrs),s}static sameSet(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++)if(!t[i].eq(e[i]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&t.length==0)return Bo.none;if(t instanceof Bo)return[t];let e=t.slice();return e.sort((i,s)=>i.type.rank-s.type.rank),e}};yt.none=[];class Wr extends Error{}class F{constructor(t,e,i){this.content=t,this.openStart=e,this.openEnd=i}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,e){let i=sd(this.content,t+this.openStart,e);return i&&new F(i,this.openStart,this.openEnd)}removeBetween(t,e){return new F(rd(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,e){if(!e)return F.empty;let i=e.openStart||0,s=e.openEnd||0;if(typeof i!="number"||typeof s!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new F(z.fromJSON(t,e.content),i,s)}static maxOpen(t,e=!0){let i=0,s=0;for(let o=t.firstChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.firstChild)i++;for(let o=t.lastChild;o&&!o.isLeaf&&(e||!o.type.spec.isolating);o=o.lastChild)s++;return new F(t,i,s)}}F.empty=new F(z.empty,0,0);function rd(n,t,e){let{index:i,offset:s}=n.findIndex(t),o=n.maybeChild(i),{index:a,offset:c}=n.findIndex(e);if(s==t||o.isText){if(c!=e&&!n.child(a).isText)throw new RangeError("Removing non-flat range");return n.cut(0,t).append(n.cut(e))}if(i!=a)throw new RangeError("Removing non-flat range");return n.replaceChild(i,o.copy(rd(o.content,t-s-1,e-s-1)))}function sd(n,t,e,i){let{index:s,offset:o}=n.findIndex(t),a=n.maybeChild(s);if(o==t||a.isText)return i&&!i.canReplace(s,s,e)?null:n.cut(0,t).append(e).append(n.cut(t));let c=sd(a.content,t-o-1,e,a);return c&&n.replaceChild(s,a.copy(c))}function Cg(n,t,e){if(e.openStart>n.depth)throw new Wr("Inserted content deeper than insertion position");if(n.depth-e.openStart!=t.depth-e.openEnd)throw new Wr("Inconsistent open depths");return od(n,t,e,0)}function od(n,t,e,i){let s=n.index(i),o=n.node(i);if(s==t.index(i)&&i<n.depth-e.openStart){let a=od(n,t,e,i+1);return o.copy(o.content.replaceChild(s,a))}else if(e.content.size)if(!e.openStart&&!e.openEnd&&n.depth==i&&t.depth==i){let a=n.parent,c=a.content;return Nn(a,c.cut(0,n.parentOffset).append(e.content).append(c.cut(t.parentOffset)))}else{let{start:a,end:c}=Mg(e,n);return Nn(o,ld(n,a,c,t,i))}else return Nn(o,jr(n,t,i))}function ad(n,t){if(!t.type.compatibleContent(n.type))throw new Wr("Cannot join "+t.type.name+" onto "+n.type.name)}function $o(n,t,e){let i=n.node(e);return ad(i,t.node(e)),i}function In(n,t){let e=t.length-1;e>=0&&n.isText&&n.sameMarkup(t[e])?t[e]=n.withText(t[e].text+n.text):t.push(n)}function Vi(n,t,e,i){let s=(t||n).node(e),o=0,a=t?t.index(e):s.childCount;n&&(o=n.index(e),n.depth>e?o++:n.textOffset&&(In(n.nodeAfter,i),o++));for(let c=o;c<a;c++)In(s.child(c),i);t&&t.depth==e&&t.textOffset&&In(t.nodeBefore,i)}function Nn(n,t){return n.type.checkContent(t),n.copy(t)}function ld(n,t,e,i,s){let o=n.depth>s&&$o(n,t,s+1),a=i.depth>s&&$o(e,i,s+1),c=[];return Vi(null,n,s,c),o&&a&&t.index(s)==e.index(s)?(ad(o,a),In(Nn(o,ld(n,t,e,i,s+1)),c)):(o&&In(Nn(o,jr(n,t,s+1)),c),Vi(t,e,s,c),a&&In(Nn(a,jr(e,i,s+1)),c)),Vi(i,null,s,c),new z(c)}function jr(n,t,e){let i=[];if(Vi(null,n,e,i),n.depth>e){let s=$o(n,t,e+1);In(Nn(s,jr(n,t,e+1)),i)}return Vi(t,null,e,i),new z(i)}function Mg(n,t){let e=t.depth-n.openStart,s=t.node(e).copy(n.content);for(let o=e-1;o>=0;o--)s=t.node(o).copy(z.from(s));return{start:s.resolveNoCache(n.openStart+e),end:s.resolveNoCache(s.content.size-n.openEnd-e)}}class ji{constructor(t,e,i){this.pos=t,this.path=e,this.parentOffset=i,this.depth=e.length/3-1}resolveDepth(t){return t==null?this.depth:t<0?this.depth+t:t}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(t){return this.path[this.resolveDepth(t)*3]}index(t){return this.path[this.resolveDepth(t)*3+1]}indexAfter(t){return t=this.resolveDepth(t),this.index(t)+(t==this.depth&&!this.textOffset?0:1)}start(t){return t=this.resolveDepth(t),t==0?0:this.path[t*3-1]+1}end(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size}before(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]}after(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]+this.path[t*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;let i=this.pos-this.path[this.path.length-1],s=t.child(e);return i?t.child(e).cut(i):s}get nodeBefore(){let t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):t==0?null:this.parent.child(t-1)}posAtIndex(t,e){e=this.resolveDepth(e);let i=this.path[e*3],s=e==0?0:this.path[e*3-1]+1;for(let o=0;o<t;o++)s+=i.child(o).nodeSize;return s}marks(){let t=this.parent,e=this.index();if(t.content.size==0)return yt.none;if(this.textOffset)return t.child(e).marks;let i=t.maybeChild(e-1),s=t.maybeChild(e);if(!i){let c=i;i=s,s=c}let o=i.marks;for(var a=0;a<o.length;a++)o[a].type.spec.inclusive===!1&&(!s||!o[a].isInSet(s.marks))&&(o=o[a--].removeFromSet(o));return o}marksAcross(t){let e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;let i=e.marks,s=t.parent.maybeChild(t.index());for(var o=0;o<i.length;o++)i[o].type.spec.inclusive===!1&&(!s||!i[o].isInSet(s.marks))&&(i=i[o--].removeFromSet(i));return i}sharedDepth(t){for(let e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0}blockRange(t=this,e){if(t.pos<this.pos)return t.blockRange(this);for(let i=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);i>=0;i--)if(t.pos<=this.end(i)&&(!e||e(this.node(i))))return new Ur(this,t,i);return null}sameParent(t){return this.pos-this.parentOffset==t.pos-t.parentOffset}max(t){return t.pos>this.pos?t:this}min(t){return t.pos<this.pos?t:this}toString(){let t="";for(let e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset}static resolve(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");let i=[],s=0,o=e;for(let a=t;;){let{index:c,offset:u}=a.content.findIndex(o),f=o-u;if(i.push(a,c,s+u),!f||(a=a.child(c),a.isText))break;o=f-1,s+=u+1}return new ji(e,i,o)}static resolveCached(t,e){let i=bc.get(t);if(i)for(let o=0;o<i.elts.length;o++){let a=i.elts[o];if(a.pos==e)return a}else bc.set(t,i=new Tg);let s=i.elts[i.i]=ji.resolve(t,e);return i.i=(i.i+1)%Pg,s}}class Tg{constructor(){this.elts=[],this.i=0}}const Pg=12,bc=new WeakMap;class Ur{constructor(t,e,i){this.$from=t,this.$to=e,this.depth=i}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const Eg=Object.create(null);class ke{constructor(t,e,i,s=yt.none){this.type=t,this.attrs=e,this.marks=s,this.content=i||z.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(t){return this.content.child(t)}maybeChild(t){return this.content.maybeChild(t)}forEach(t){this.content.forEach(t)}nodesBetween(t,e,i,s=0){this.content.nodesBetween(t,e,i,s,this)}descendants(t){this.nodesBetween(0,this.content.size,t)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(t,e,i,s){return this.content.textBetween(t,e,i,s)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)}sameMarkup(t){return this.hasMarkup(t.type,t.attrs,t.marks)}hasMarkup(t,e,i){return this.type==t&&Zr(this.attrs,e||t.defaultAttrs||Eg)&&yt.sameSet(this.marks,i||yt.none)}copy(t=null){return t==this.content?this:new ke(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new ke(this.type,this.attrs,this.content,t)}cut(t,e=this.content.size){return t==0&&e==this.content.size?this:this.copy(this.content.cut(t,e))}slice(t,e=this.content.size,i=!1){if(t==e)return F.empty;let s=this.resolve(t),o=this.resolve(e),a=i?0:s.sharedDepth(e),c=s.start(a),f=s.node(a).content.cut(s.pos-c,o.pos-c);return new F(f,s.depth-a,o.depth-a)}replace(t,e,i){return Cg(this.resolve(t),this.resolve(e),i)}nodeAt(t){for(let e=this;;){let{index:i,offset:s}=e.content.findIndex(t);if(e=e.maybeChild(i),!e)return null;if(s==t||e.isText)return e;t-=s+1}}childAfter(t){let{index:e,offset:i}=this.content.findIndex(t);return{node:this.content.maybeChild(e),index:e,offset:i}}childBefore(t){if(t==0)return{node:null,index:0,offset:0};let{index:e,offset:i}=this.content.findIndex(t);if(i<t)return{node:this.content.child(e),index:e,offset:i};let s=this.content.child(e-1);return{node:s,index:e-1,offset:i-s.nodeSize}}resolve(t){return ji.resolveCached(this,t)}resolveNoCache(t){return ji.resolve(this,t)}rangeHasMark(t,e,i){let s=!1;return e>t&&this.nodesBetween(t,e,o=>(i.isInSet(o.marks)&&(s=!0),!s)),s}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),cd(this.marks,t)}contentMatchAt(t){let e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e}canReplace(t,e,i=z.empty,s=0,o=i.childCount){let a=this.contentMatchAt(t).matchFragment(i,s,o),c=a&&a.matchFragment(this.content,e);if(!c||!c.validEnd)return!1;for(let u=s;u<o;u++)if(!this.type.allowsMarks(i.child(u).marks))return!1;return!0}canReplaceWith(t,e,i,s){if(s&&!this.type.allowsMarks(s))return!1;let o=this.contentMatchAt(t).matchType(i),a=o&&o.matchFragment(this.content,e);return a?a.validEnd:!1}canAppend(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let t=yt.none;for(let e=0;e<this.marks.length;e++){let i=this.marks[e];i.type.checkAttrs(i.attrs),t=i.addToSet(t)}if(!yt.sameSet(t,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(e=>e.type.name)}`);this.content.forEach(e=>e.check())}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(e=>e.toJSON())),t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");let i;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");i=e.marks.map(t.markFromJSON)}if(e.type=="text"){if(typeof e.text!="string")throw new RangeError("Invalid text node in JSON");return t.text(e.text,i)}let s=z.fromJSON(t,e.content),o=t.nodeType(e.type).create(e.attrs,s,i);return o.type.checkAttrs(o.attrs),o}}ke.prototype.text=void 0;class qr extends ke{constructor(t,e,i,s){if(super(t,e,null,s),!i)throw new RangeError("Empty text nodes are not allowed");this.text=i}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):cd(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(t,e){return this.text.slice(t,e)}get nodeSize(){return this.text.length}mark(t){return t==this.marks?this:new qr(this.type,this.attrs,this.text,t)}withText(t){return t==this.text?this:new qr(this.type,this.attrs,t,this.marks)}cut(t=0,e=this.text.length){return t==0&&e==this.text.length?this:this.withText(this.text.slice(t,e))}eq(t){return this.sameMarkup(t)&&this.text==t.text}toJSON(){let t=super.toJSON();return t.text=this.text,t}}function cd(n,t){for(let e=n.length-1;e>=0;e--)t=n[e].type.name+"("+t+")";return t}class Bn{constructor(t){this.validEnd=t,this.next=[],this.wrapCache=[]}static parse(t,e){let i=new Og(t,e);if(i.next==null)return Bn.empty;let s=ud(i);i.next&&i.err("Unexpected trailing text");let o=Rg(zg(s));return Bg(o,i),o}matchType(t){for(let e=0;e<this.next.length;e++)if(this.next[e].type==t)return this.next[e].next;return null}matchFragment(t,e=0,i=t.childCount){let s=this;for(let o=e;s&&o<i;o++)s=s.matchType(t.child(o).type);return s}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let t=0;t<this.next.length;t++){let{type:e}=this.next[t];if(!(e.isText||e.hasRequiredAttrs()))return e}return null}compatible(t){for(let e=0;e<this.next.length;e++)for(let i=0;i<t.next.length;i++)if(this.next[e].type==t.next[i].type)return!0;return!1}fillBefore(t,e=!1,i=0){let s=[this];function o(a,c){let u=a.matchFragment(t,i);if(u&&(!e||u.validEnd))return z.from(c.map(f=>f.createAndFill()));for(let f=0;f<a.next.length;f++){let{type:h,next:m}=a.next[f];if(!(h.isText||h.hasRequiredAttrs())&&s.indexOf(m)==-1){s.push(m);let g=o(m,c.concat(h));if(g)return g}}return null}return o(this,[])}findWrapping(t){for(let i=0;i<this.wrapCache.length;i+=2)if(this.wrapCache[i]==t)return this.wrapCache[i+1];let e=this.computeWrapping(t);return this.wrapCache.push(t,e),e}computeWrapping(t){let e=Object.create(null),i=[{match:this,type:null,via:null}];for(;i.length;){let s=i.shift(),o=s.match;if(o.matchType(t)){let a=[];for(let c=s;c.type;c=c.via)a.push(c.type);return a.reverse()}for(let a=0;a<o.next.length;a++){let{type:c,next:u}=o.next[a];!c.isLeaf&&!c.hasRequiredAttrs()&&!(c.name in e)&&(!s.type||u.validEnd)&&(i.push({match:c.contentMatch,type:c,via:s}),e[c.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(t){if(t>=this.next.length)throw new RangeError(`There's no ${t}th edge in this content match`);return this.next[t]}toString(){let t=[];function e(i){t.push(i);for(let s=0;s<i.next.length;s++)t.indexOf(i.next[s].next)==-1&&e(i.next[s].next)}return e(this),t.map((i,s)=>{let o=s+(i.validEnd?"*":" ")+" ";for(let a=0;a<i.next.length;a++)o+=(a?", ":"")+i.next[a].type.name+"->"+t.indexOf(i.next[a].next);return o}).join(`
`)}}Bn.empty=new Bn(!0);class Og{constructor(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(t){return this.next==t&&(this.pos++||!0)}err(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")}}function ud(n){let t=[];do t.push(Ag(n));while(n.eat("|"));return t.length==1?t[0]:{type:"choice",exprs:t}}function Ag(n){let t=[];do t.push(Lg(n));while(n.next&&n.next!=")"&&n.next!="|");return t.length==1?t[0]:{type:"seq",exprs:t}}function Lg(n){let t=Dg(n);for(;;)if(n.eat("+"))t={type:"plus",expr:t};else if(n.eat("*"))t={type:"star",expr:t};else if(n.eat("?"))t={type:"opt",expr:t};else if(n.eat("{"))t=Ig(n,t);else break;return t}function xc(n){/\D/.test(n.next)&&n.err("Expected number, got '"+n.next+"'");let t=Number(n.next);return n.pos++,t}function Ig(n,t){let e=xc(n),i=e;return n.eat(",")&&(n.next!="}"?i=xc(n):i=-1),n.eat("}")||n.err("Unclosed braced range"),{type:"range",min:e,max:i,expr:t}}function Ng(n,t){let e=n.nodeTypes,i=e[t];if(i)return[i];let s=[];for(let o in e){let a=e[o];a.isInGroup(t)&&s.push(a)}return s.length==0&&n.err("No node type or group '"+t+"' found"),s}function Dg(n){if(n.eat("(")){let t=ud(n);return n.eat(")")||n.err("Missing closing paren"),t}else if(/\W/.test(n.next))n.err("Unexpected token '"+n.next+"'");else{let t=Ng(n,n.next).map(e=>(n.inline==null?n.inline=e.isInline:n.inline!=e.isInline&&n.err("Mixing inline and block content"),{type:"name",value:e}));return n.pos++,t.length==1?t[0]:{type:"choice",exprs:t}}}function zg(n){let t=[[]];return s(o(n,0),e()),t;function e(){return t.push([])-1}function i(a,c,u){let f={term:u,to:c};return t[a].push(f),f}function s(a,c){a.forEach(u=>u.to=c)}function o(a,c){if(a.type=="choice")return a.exprs.reduce((u,f)=>u.concat(o(f,c)),[]);if(a.type=="seq")for(let u=0;;u++){let f=o(a.exprs[u],c);if(u==a.exprs.length-1)return f;s(f,c=e())}else if(a.type=="star"){let u=e();return i(c,u),s(o(a.expr,u),u),[i(u)]}else if(a.type=="plus"){let u=e();return s(o(a.expr,c),u),s(o(a.expr,u),u),[i(u)]}else{if(a.type=="opt")return[i(c)].concat(o(a.expr,c));if(a.type=="range"){let u=c;for(let f=0;f<a.min;f++){let h=e();s(o(a.expr,u),h),u=h}if(a.max==-1)s(o(a.expr,u),u);else for(let f=a.min;f<a.max;f++){let h=e();i(u,h),s(o(a.expr,u),h),u=h}return[i(u)]}else{if(a.type=="name")return[i(c,void 0,a.value)];throw new Error("Unknown expr type")}}}}function dd(n,t){return t-n}function kc(n,t){let e=[];return i(t),e.sort(dd);function i(s){let o=n[s];if(o.length==1&&!o[0].term)return i(o[0].to);e.push(s);for(let a=0;a<o.length;a++){let{term:c,to:u}=o[a];!c&&e.indexOf(u)==-1&&i(u)}}}function Rg(n){let t=Object.create(null);return e(kc(n,0));function e(i){let s=[];i.forEach(a=>{n[a].forEach(({term:c,to:u})=>{if(!c)return;let f;for(let h=0;h<s.length;h++)s[h][0]==c&&(f=s[h][1]);kc(n,u).forEach(h=>{f||s.push([c,f=[]]),f.indexOf(h)==-1&&f.push(h)})})});let o=t[i.join(",")]=new Bn(i.indexOf(n.length-1)>-1);for(let a=0;a<s.length;a++){let c=s[a][1].sort(dd);o.next.push({type:s[a][0],next:t[c.join(",")]||e(c)})}return o}}function Bg(n,t){for(let e=0,i=[n];e<i.length;e++){let s=i[e],o=!s.validEnd,a=[];for(let c=0;c<s.next.length;c++){let{type:u,next:f}=s.next[c];a.push(u.name),o&&!(u.isText||u.hasRequiredAttrs())&&(o=!1),i.indexOf(f)==-1&&i.push(f)}o&&t.err("Only non-generatable nodes ("+a.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function fd(n){let t=Object.create(null);for(let e in n){let i=n[e];if(!i.hasDefault)return null;t[e]=i.default}return t}function hd(n,t){let e=Object.create(null);for(let i in n){let s=t&&t[i];if(s===void 0){let o=n[i];if(o.hasDefault)s=o.default;else throw new RangeError("No value supplied for attribute "+i)}e[i]=s}return e}function pd(n,t,e,i){for(let s in t)if(!(s in n))throw new RangeError(`Unsupported attribute ${s} for ${e} of type ${s}`);for(let s in n){let o=n[s];o.validate&&o.validate(t[s])}}function md(n,t){let e=Object.create(null);if(t)for(let i in t)e[i]=new Fg(n,i,t[i]);return e}let wc=class gd{constructor(t,e,i){this.name=t,this.schema=e,this.spec=i,this.markSet=null,this.groups=i.group?i.group.split(" "):[],this.attrs=md(t,i.attrs),this.defaultAttrs=fd(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(i.inline||t=="text"),this.isText=t=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Bn.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(t){return this.groups.indexOf(t)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1}compatibleContent(t){return this==t||this.contentMatch.compatible(t.contentMatch)}computeAttrs(t){return!t&&this.defaultAttrs?this.defaultAttrs:hd(this.attrs,t)}create(t=null,e,i){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new ke(this,this.computeAttrs(t),z.from(e),yt.setFrom(i))}createChecked(t=null,e,i){return e=z.from(e),this.checkContent(e),new ke(this,this.computeAttrs(t),e,yt.setFrom(i))}createAndFill(t=null,e,i){if(t=this.computeAttrs(t),e=z.from(e),e.size){let a=this.contentMatch.fillBefore(e);if(!a)return null;e=a.append(e)}let s=this.contentMatch.matchFragment(e),o=s&&s.fillBefore(z.empty,!0);return o?new ke(this,t,e.append(o),yt.setFrom(i)):null}validContent(t){let e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(let i=0;i<t.childCount;i++)if(!this.allowsMarks(t.child(i).marks))return!1;return!0}checkContent(t){if(!this.validContent(t))throw new RangeError(`Invalid content for node ${this.name}: ${t.toString().slice(0,50)}`)}checkAttrs(t){pd(this.attrs,t,"node",this.name)}allowsMarkType(t){return this.markSet==null||this.markSet.indexOf(t)>-1}allowsMarks(t){if(this.markSet==null)return!0;for(let e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0}allowedMarks(t){if(this.markSet==null)return t;let e;for(let i=0;i<t.length;i++)this.allowsMarkType(t[i].type)?e&&e.push(t[i]):e||(e=t.slice(0,i));return e?e.length?e:yt.none:t}static compile(t,e){let i=Object.create(null);t.forEach((o,a)=>i[o]=new gd(o,e,a));let s=e.spec.topNode||"doc";if(!i[s])throw new RangeError("Schema is missing its top node type ('"+s+"')");if(!i.text)throw new RangeError("Every schema needs a 'text' type");for(let o in i.text.attrs)throw new RangeError("The text node type should not have attributes");return i}};function $g(n,t,e){let i=e.split("|");return s=>{let o=s===null?"null":typeof s;if(i.indexOf(o)<0)throw new RangeError(`Expected value of type ${i} for attribute ${t} on type ${n}, got ${o}`)}}class Fg{constructor(t,e,i){this.hasDefault=Object.prototype.hasOwnProperty.call(i,"default"),this.default=i.default,this.validate=typeof i.validate=="string"?$g(t,e,i.validate):i.validate}get isRequired(){return!this.hasDefault}}class vs{constructor(t,e,i,s){this.name=t,this.rank=e,this.schema=i,this.spec=s,this.attrs=md(t,s.attrs),this.excluded=null;let o=fd(this.attrs);this.instance=o?new yt(this,o):null}create(t=null){return!t&&this.instance?this.instance:new yt(this,hd(this.attrs,t))}static compile(t,e){let i=Object.create(null),s=0;return t.forEach((o,a)=>i[o]=new vs(o,s++,e,a)),i}removeFromSet(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t}isInSet(t){for(let e=0;e<t.length;e++)if(t[e].type==this)return t[e]}checkAttrs(t){pd(this.attrs,t,"mark",this.name)}excludes(t){return this.excluded.indexOf(t)>-1}}class xa{constructor(t){this.linebreakReplacement=null,this.cached=Object.create(null);let e=this.spec={};for(let s in t)e[s]=t[s];e.nodes=Kt.from(t.nodes),e.marks=Kt.from(t.marks||{}),this.nodes=wc.compile(this.spec.nodes,this),this.marks=vs.compile(this.spec.marks,this);let i=Object.create(null);for(let s in this.nodes){if(s in this.marks)throw new RangeError(s+" can not be both a node and a mark");let o=this.nodes[s],a=o.spec.content||"",c=o.spec.marks;if(o.contentMatch=i[a]||(i[a]=Bn.parse(a,this.nodes)),o.inlineContent=o.contentMatch.inlineContent,o.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!o.isInline||!o.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=o}o.markSet=c=="_"?null:c?Sc(this,c.split(" ")):c==""||!o.inlineContent?[]:null}for(let s in this.marks){let o=this.marks[s],a=o.spec.excludes;o.excluded=a==null?[o]:a==""?[]:Sc(this,a.split(" "))}this.nodeFromJSON=s=>ke.fromJSON(this,s),this.markFromJSON=s=>yt.fromJSON(this,s),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(t,e=null,i,s){if(typeof t=="string")t=this.nodeType(t);else if(t instanceof wc){if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}else throw new RangeError("Invalid node type: "+t);return t.createChecked(e,i,s)}text(t,e){let i=this.nodes.text;return new qr(i,i.defaultAttrs,t,yt.setFrom(e))}mark(t,e){return typeof t=="string"&&(t=this.marks[t]),t.create(e)}nodeType(t){let e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e}}function Sc(n,t){let e=[];for(let i=0;i<t.length;i++){let s=t[i],o=n.marks[s],a=o;if(o)e.push(o);else for(let c in n.marks){let u=n.marks[c];(s=="_"||u.spec.group&&u.spec.group.split(" ").indexOf(s)>-1)&&e.push(a=u)}if(!a)throw new SyntaxError("Unknown mark type: '"+t[i]+"'")}return e}function Vg(n){return n.tag!=null}function Hg(n){return n.style!=null}class Ee{constructor(t,e){this.schema=t,this.rules=e,this.tags=[],this.styles=[];let i=this.matchedStyles=[];e.forEach(s=>{if(Vg(s))this.tags.push(s);else if(Hg(s)){let o=/[^=]*/.exec(s.style)[0];i.indexOf(o)<0&&i.push(o),this.styles.push(s)}}),this.normalizeLists=!this.tags.some(s=>{if(!/^(ul|ol)\b/.test(s.tag)||!s.node)return!1;let o=t.nodes[s.node];return o.contentMatch.matchType(o)})}parse(t,e={}){let i=new Mc(this,e,!1);return i.addAll(t,yt.none,e.from,e.to),i.finish()}parseSlice(t,e={}){let i=new Mc(this,e,!0);return i.addAll(t,yt.none,e.from,e.to),F.maxOpen(i.finish())}matchTag(t,e,i){for(let s=i?this.tags.indexOf(i)+1:0;s<this.tags.length;s++){let o=this.tags[s];if(jg(t,o.tag)&&(o.namespace===void 0||t.namespaceURI==o.namespace)&&(!o.context||e.matchesContext(o.context))){if(o.getAttrs){let a=o.getAttrs(t);if(a===!1)continue;o.attrs=a||void 0}return o}}}matchStyle(t,e,i,s){for(let o=s?this.styles.indexOf(s)+1:0;o<this.styles.length;o++){let a=this.styles[o],c=a.style;if(!(c.indexOf(t)!=0||a.context&&!i.matchesContext(a.context)||c.length>t.length&&(c.charCodeAt(t.length)!=61||c.slice(t.length+1)!=e))){if(a.getAttrs){let u=a.getAttrs(e);if(u===!1)continue;a.attrs=u||void 0}return a}}}static schemaRules(t){let e=[];function i(s){let o=s.priority==null?50:s.priority,a=0;for(;a<e.length;a++){let c=e[a];if((c.priority==null?50:c.priority)<o)break}e.splice(a,0,s)}for(let s in t.marks){let o=t.marks[s].spec.parseDOM;o&&o.forEach(a=>{i(a=Tc(a)),a.mark||a.ignore||a.clearMark||(a.mark=s)})}for(let s in t.nodes){let o=t.nodes[s].spec.parseDOM;o&&o.forEach(a=>{i(a=Tc(a)),a.node||a.ignore||a.mark||(a.node=s)})}return e}static fromSchema(t){return t.cached.domParser||(t.cached.domParser=new Ee(t,Ee.schemaRules(t)))}}const _d={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Zg={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},yd={ol:!0,ul:!0},Ui=1,Fo=2,Hi=4;function Cc(n,t,e){return t!=null?(t?Ui:0)|(t==="full"?Fo:0):n&&n.whitespace=="pre"?Ui|Fo:e&~Hi}class Er{constructor(t,e,i,s,o,a){this.type=t,this.attrs=e,this.marks=i,this.solid=s,this.options=a,this.content=[],this.activeMarks=yt.none,this.match=o||(a&Hi?null:t.contentMatch)}findWrapping(t){if(!this.match){if(!this.type)return[];let e=this.type.contentMatch.fillBefore(z.from(t));if(e)this.match=this.type.contentMatch.matchFragment(e);else{let i=this.type.contentMatch,s;return(s=i.findWrapping(t.type))?(this.match=i,s):null}}return this.match.findWrapping(t.type)}finish(t){if(!(this.options&Ui)){let i=this.content[this.content.length-1],s;if(i&&i.isText&&(s=/[ \t\r\n\u000c]+$/.exec(i.text))){let o=i;i.text.length==s[0].length?this.content.pop():this.content[this.content.length-1]=o.withText(o.text.slice(0,o.text.length-s[0].length))}}let e=z.from(this.content);return!t&&this.match&&(e=e.append(this.match.fillBefore(z.empty,!0))),this.type?this.type.create(this.attrs,e,this.marks):e}inlineContext(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!_d.hasOwnProperty(t.parentNode.nodeName.toLowerCase())}}class Mc{constructor(t,e,i){this.parser=t,this.options=e,this.isOpen=i,this.open=0,this.localPreserveWS=!1;let s=e.topNode,o,a=Cc(null,e.preserveWhitespace,0)|(i?Hi:0);s?o=new Er(s.type,s.attrs,yt.none,!0,e.topMatch||s.type.contentMatch,a):i?o=new Er(null,null,yt.none,!0,null,a):o=new Er(t.schema.topNodeType,null,yt.none,!0,null,a),this.nodes=[o],this.find=e.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(t,e){t.nodeType==3?this.addTextNode(t,e):t.nodeType==1&&this.addElement(t,e)}addTextNode(t,e){let i=t.nodeValue,s=this.top,o=s.options&Fo?"full":this.localPreserveWS||(s.options&Ui)>0;if(o==="full"||s.inlineContext(t)||/[^ \t\r\n\u000c]/.test(i)){if(o)o!=="full"?i=i.replace(/\r?\n|\r/g," "):i=i.replace(/\r\n?/g,`
`);else if(i=i.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(i)&&this.open==this.nodes.length-1){let a=s.content[s.content.length-1],c=t.previousSibling;(!a||c&&c.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(i=i.slice(1))}i&&this.insertNode(this.parser.schema.text(i),e,!/\S/.test(i)),this.findInText(t)}else this.findInside(t)}addElement(t,e,i){let s=this.localPreserveWS,o=this.top;(t.tagName=="PRE"||/pre/.test(t.style&&t.style.whiteSpace))&&(this.localPreserveWS=!0);let a=t.nodeName.toLowerCase(),c;yd.hasOwnProperty(a)&&this.parser.normalizeLists&&Wg(t);let u=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(c=this.parser.matchTag(t,this,i));t:if(u?u.ignore:Zg.hasOwnProperty(a))this.findInside(t),this.ignoreFallback(t,e);else if(!u||u.skip||u.closeParent){u&&u.closeParent?this.open=Math.max(0,this.open-1):u&&u.skip.nodeType&&(t=u.skip);let f,h=this.needsBlock;if(_d.hasOwnProperty(a))o.content.length&&o.content[0].isInline&&this.open&&(this.open--,o=this.top),f=!0,o.type||(this.needsBlock=!0);else if(!t.firstChild){this.leafFallback(t,e);break t}let m=u&&u.skip?e:this.readStyles(t,e);m&&this.addAll(t,m),f&&this.sync(o),this.needsBlock=h}else{let f=this.readStyles(t,e);f&&this.addElementByRule(t,u,f,u.consuming===!1?c:void 0)}this.localPreserveWS=s}leafFallback(t,e){t.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode(`
`),e)}ignoreFallback(t,e){t.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),e,!0)}readStyles(t,e){let i=t.style;if(i&&i.length)for(let s=0;s<this.parser.matchedStyles.length;s++){let o=this.parser.matchedStyles[s],a=i.getPropertyValue(o);if(a)for(let c=void 0;;){let u=this.parser.matchStyle(o,a,this,c);if(!u)break;if(u.ignore)return null;if(u.clearMark?e=e.filter(f=>!u.clearMark(f)):e=e.concat(this.parser.schema.marks[u.mark].create(u.attrs)),u.consuming===!1)c=u;else break}}return e}addElementByRule(t,e,i,s){let o,a;if(e.node)if(a=this.parser.schema.nodes[e.node],a.isLeaf)this.insertNode(a.create(e.attrs),i,t.nodeName=="BR")||this.leafFallback(t,i);else{let u=this.enter(a,e.attrs||null,i,e.preserveWhitespace);u&&(o=!0,i=u)}else{let u=this.parser.schema.marks[e.mark];i=i.concat(u.create(e.attrs))}let c=this.top;if(a&&a.isLeaf)this.findInside(t);else if(s)this.addElement(t,i,s);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach(u=>this.insertNode(u,i,!1));else{let u=t;typeof e.contentElement=="string"?u=t.querySelector(e.contentElement):typeof e.contentElement=="function"?u=e.contentElement(t):e.contentElement&&(u=e.contentElement),this.findAround(t,u,!0),this.addAll(u,i),this.findAround(t,u,!1)}o&&this.sync(c)&&this.open--}addAll(t,e,i,s){let o=i||0;for(let a=i?t.childNodes[i]:t.firstChild,c=s==null?null:t.childNodes[s];a!=c;a=a.nextSibling,++o)this.findAtPoint(t,o),this.addDOM(a,e);this.findAtPoint(t,o)}findPlace(t,e,i){let s,o;for(let a=this.open,c=0;a>=0;a--){let u=this.nodes[a],f=u.findWrapping(t);if(f&&(!s||s.length>f.length+c)&&(s=f,o=u,!f.length))break;if(u.solid){if(i)break;c+=2}}if(!s)return null;this.sync(o);for(let a=0;a<s.length;a++)e=this.enterInner(s[a],null,e,!1);return e}insertNode(t,e,i){if(t.isInline&&this.needsBlock&&!this.top.type){let o=this.textblockFromContext();o&&(e=this.enterInner(o,null,e))}let s=this.findPlace(t,e,i);if(s){this.closeExtra();let o=this.top;o.match&&(o.match=o.match.matchType(t.type));let a=yt.none;for(let c of s.concat(t.marks))(o.type?o.type.allowsMarkType(c.type):Pc(c.type,t.type))&&(a=c.addToSet(a));return o.content.push(t.mark(a)),!0}return!1}enter(t,e,i,s){let o=this.findPlace(t.create(e),i,!1);return o&&(o=this.enterInner(t,e,i,!0,s)),o}enterInner(t,e,i,s=!1,o){this.closeExtra();let a=this.top;a.match=a.match&&a.match.matchType(t);let c=Cc(t,o,a.options);a.options&Hi&&a.content.length==0&&(c|=Hi);let u=yt.none;return i=i.filter(f=>(a.type?a.type.allowsMarkType(f.type):Pc(f.type,t))?(u=f.addToSet(u),!1):!0),this.nodes.push(new Er(t,e,u,s,null,c)),this.open++,i}closeExtra(t=!1){let e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(t){for(let e=this.open;e>=0;e--){if(this.nodes[e]==t)return this.open=e,!0;this.localPreserveWS&&(this.nodes[e].options|=Ui)}return!1}get currentPos(){this.closeExtra();let t=0;for(let e=this.open;e>=0;e--){let i=this.nodes[e].content;for(let s=i.length-1;s>=0;s--)t+=i[s].nodeSize;e&&t++}return t}findAtPoint(t,e){if(this.find)for(let i=0;i<this.find.length;i++)this.find[i].node==t&&this.find[i].offset==e&&(this.find[i].pos=this.currentPos)}findInside(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].pos==null&&t.nodeType==1&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)}findAround(t,e,i){if(t!=e&&this.find)for(let s=0;s<this.find.length;s++)this.find[s].pos==null&&t.nodeType==1&&t.contains(this.find[s].node)&&e.compareDocumentPosition(this.find[s].node)&(i?2:4)&&(this.find[s].pos=this.currentPos)}findInText(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))}matchesContext(t){if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);let e=t.split("/"),i=this.options.context,s=!this.isOpen&&(!i||i.parent.type==this.nodes[0].type),o=-(i?i.depth+1:0)+(s?0:1),a=(c,u)=>{for(;c>=0;c--){let f=e[c];if(f==""){if(c==e.length-1||c==0)continue;for(;u>=o;u--)if(a(c-1,u))return!0;return!1}else{let h=u>0||u==0&&s?this.nodes[u].type:i&&u>=o?i.node(u-o).type:null;if(!h||h.name!=f&&!h.isInGroup(f))return!1;u--}}return!0};return a(e.length-1,this.open)}textblockFromContext(){let t=this.options.context;if(t)for(let e=t.depth;e>=0;e--){let i=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(i&&i.isTextblock&&i.defaultAttrs)return i}for(let e in this.parser.schema.nodes){let i=this.parser.schema.nodes[e];if(i.isTextblock&&i.defaultAttrs)return i}}}function Wg(n){for(let t=n.firstChild,e=null;t;t=t.nextSibling){let i=t.nodeType==1?t.nodeName.toLowerCase():null;i&&yd.hasOwnProperty(i)&&e?(e.appendChild(t),t=e):i=="li"?e=t:i&&(e=null)}}function jg(n,t){return(n.matches||n.msMatchesSelector||n.webkitMatchesSelector||n.mozMatchesSelector).call(n,t)}function Tc(n){let t={};for(let e in n)t[e]=n[e];return t}function Pc(n,t){let e=t.schema.nodes;for(let i in e){let s=e[i];if(!s.allowsMarkType(n))continue;let o=[],a=c=>{o.push(c);for(let u=0;u<c.edgeCount;u++){let{type:f,next:h}=c.edge(u);if(f==t||o.indexOf(h)<0&&a(h))return!0}};if(a(s.contentMatch))return!0}}class Hn{constructor(t,e){this.nodes=t,this.marks=e}serializeFragment(t,e={},i){i||(i=_o(e).createDocumentFragment());let s=i,o=[];return t.forEach(a=>{if(o.length||a.marks.length){let c=0,u=0;for(;c<o.length&&u<a.marks.length;){let f=a.marks[u];if(!this.marks[f.type.name]){u++;continue}if(!f.eq(o[c][0])||f.type.spec.spanning===!1)break;c++,u++}for(;c<o.length;)s=o.pop()[1];for(;u<a.marks.length;){let f=a.marks[u++],h=this.serializeMark(f,a.isInline,e);h&&(o.push([f,s]),s.appendChild(h.dom),s=h.contentDOM||h.dom)}}s.appendChild(this.serializeNodeInner(a,e))}),i}serializeNodeInner(t,e){let{dom:i,contentDOM:s}=Br(_o(e),this.nodes[t.type.name](t),null,t.attrs);if(s){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(t.content,e,s)}return i}serializeNode(t,e={}){let i=this.serializeNodeInner(t,e);for(let s=t.marks.length-1;s>=0;s--){let o=this.serializeMark(t.marks[s],t.isInline,e);o&&((o.contentDOM||o.dom).appendChild(i),i=o.dom)}return i}serializeMark(t,e,i={}){let s=this.marks[t.type.name];return s&&Br(_o(i),s(t,e),null,t.attrs)}static renderSpec(t,e,i=null,s){return Br(t,e,i,s)}static fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new Hn(this.nodesFromSchema(t),this.marksFromSchema(t)))}static nodesFromSchema(t){let e=Ec(t.nodes);return e.text||(e.text=i=>i.text),e}static marksFromSchema(t){return Ec(t.marks)}}function Ec(n){let t={};for(let e in n){let i=n[e].spec.toDOM;i&&(t[e]=i)}return t}function _o(n){return n.document||window.document}const Oc=new WeakMap;function Ug(n){let t=Oc.get(n);return t===void 0&&Oc.set(n,t=qg(n)),t}function qg(n){let t=null;function e(i){if(i&&typeof i=="object")if(Array.isArray(i))if(typeof i[0]=="string")t||(t=[]),t.push(i);else for(let s=0;s<i.length;s++)e(i[s]);else for(let s in i)e(i[s])}return e(n),t}function Br(n,t,e,i){if(typeof t=="string")return{dom:n.createTextNode(t)};if(t.nodeType!=null)return{dom:t};if(t.dom&&t.dom.nodeType!=null)return t;let s=t[0],o;if(typeof s!="string")throw new RangeError("Invalid array passed to renderSpec");if(i&&(o=Ug(i))&&o.indexOf(t)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let a=s.indexOf(" ");a>0&&(e=s.slice(0,a),s=s.slice(a+1));let c,u=e?n.createElementNS(e,s):n.createElement(s),f=t[1],h=1;if(f&&typeof f=="object"&&f.nodeType==null&&!Array.isArray(f)){h=2;for(let m in f)if(f[m]!=null){let g=m.indexOf(" ");g>0?u.setAttributeNS(m.slice(0,g),m.slice(g+1),f[m]):m=="style"&&u.style?u.style.cssText=f[m]:u.setAttribute(m,f[m])}}for(let m=h;m<t.length;m++){let g=t[m];if(g===0){if(m<t.length-1||m>h)throw new RangeError("Content hole must be the only child of its parent node");return{dom:u,contentDOM:u}}else{let{dom:y,contentDOM:v}=Br(n,g,e,i);if(u.appendChild(y),v){if(c)throw new RangeError("Multiple content holes");c=v}}}return{dom:u,contentDOM:c}}const vd=65535,bd=Math.pow(2,16);function Kg(n,t){return n+t*bd}function Ac(n){return n&vd}function Jg(n){return(n-(n&vd))/bd}const xd=1,kd=2,$r=4,wd=8;class Vo{constructor(t,e,i){this.pos=t,this.delInfo=e,this.recover=i}get deleted(){return(this.delInfo&wd)>0}get deletedBefore(){return(this.delInfo&(xd|$r))>0}get deletedAfter(){return(this.delInfo&(kd|$r))>0}get deletedAcross(){return(this.delInfo&$r)>0}}class pe{constructor(t,e=!1){if(this.ranges=t,this.inverted=e,!t.length&&pe.empty)return pe.empty}recover(t){let e=0,i=Ac(t);if(!this.inverted)for(let s=0;s<i;s++)e+=this.ranges[s*3+2]-this.ranges[s*3+1];return this.ranges[i*3]+e+Jg(t)}mapResult(t,e=1){return this._map(t,e,!1)}map(t,e=1){return this._map(t,e,!0)}_map(t,e,i){let s=0,o=this.inverted?2:1,a=this.inverted?1:2;for(let c=0;c<this.ranges.length;c+=3){let u=this.ranges[c]-(this.inverted?s:0);if(u>t)break;let f=this.ranges[c+o],h=this.ranges[c+a],m=u+f;if(t<=m){let g=f?t==u?-1:t==m?1:e:e,y=u+s+(g<0?0:h);if(i)return y;let v=t==(e<0?u:m)?null:Kg(c/3,t-u),b=t==u?kd:t==m?xd:$r;return(e<0?t!=u:t!=m)&&(b|=wd),new Vo(y,b,v)}s+=h-f}return i?t+s:new Vo(t+s,0,null)}touches(t,e){let i=0,s=Ac(e),o=this.inverted?2:1,a=this.inverted?1:2;for(let c=0;c<this.ranges.length;c+=3){let u=this.ranges[c]-(this.inverted?i:0);if(u>t)break;let f=this.ranges[c+o],h=u+f;if(t<=h&&c==s*3)return!0;i+=this.ranges[c+a]-f}return!1}forEach(t){let e=this.inverted?2:1,i=this.inverted?1:2;for(let s=0,o=0;s<this.ranges.length;s+=3){let a=this.ranges[s],c=a-(this.inverted?o:0),u=a+(this.inverted?0:o),f=this.ranges[s+e],h=this.ranges[s+i];t(c,c+f,u,u+h),o+=h-f}}invert(){return new pe(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return t==0?pe.empty:new pe(t<0?[0,-t,0]:[0,0,t])}}pe.empty=new pe([]);class qi{constructor(t,e,i=0,s=t?t.length:0){this.mirror=e,this.from=i,this.to=s,this._maps=t||[],this.ownData=!(t||e)}get maps(){return this._maps}slice(t=0,e=this.maps.length){return new qi(this._maps,this.mirror,t,e)}appendMap(t,e){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(t),e!=null&&this.setMirror(this._maps.length-1,e)}appendMapping(t){for(let e=0,i=this._maps.length;e<t._maps.length;e++){let s=t.getMirror(e);this.appendMap(t._maps[e],s!=null&&s<e?i+s:void 0)}}getMirror(t){if(this.mirror){for(let e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]}}setMirror(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)}appendMappingInverted(t){for(let e=t.maps.length-1,i=this._maps.length+t._maps.length;e>=0;e--){let s=t.getMirror(e);this.appendMap(t._maps[e].invert(),s!=null&&s>e?i-s-1:void 0)}}invert(){let t=new qi;return t.appendMappingInverted(this),t}map(t,e=1){if(this.mirror)return this._map(t,e,!0);for(let i=this.from;i<this.to;i++)t=this._maps[i].map(t,e);return t}mapResult(t,e=1){return this._map(t,e,!1)}_map(t,e,i){let s=0;for(let o=this.from;o<this.to;o++){let a=this._maps[o],c=a.mapResult(t,e);if(c.recover!=null){let u=this.getMirror(o);if(u!=null&&u>o&&u<this.to){o=u,t=this._maps[u].recover(c.recover);continue}}s|=c.delInfo,t=c.pos}return i?t:new Vo(t,s,null)}}const yo=Object.create(null);class ee{getMap(){return pe.empty}merge(t){return null}static fromJSON(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");let i=yo[e.stepType];if(!i)throw new RangeError(`No step type ${e.stepType} defined`);return i.fromJSON(t,e)}static jsonID(t,e){if(t in yo)throw new RangeError("Duplicate use of step JSON ID "+t);return yo[t]=e,e.prototype.jsonID=t,e}}class Rt{constructor(t,e){this.doc=t,this.failed=e}static ok(t){return new Rt(t,null)}static fail(t){return new Rt(null,t)}static fromReplace(t,e,i,s){try{return Rt.ok(t.replace(e,i,s))}catch(o){if(o instanceof Wr)return Rt.fail(o.message);throw o}}}function ka(n,t,e){let i=[];for(let s=0;s<n.childCount;s++){let o=n.child(s);o.content.size&&(o=o.copy(ka(o.content,t,o))),o.isInline&&(o=t(o,e,s)),i.push(o)}return z.fromArray(i)}class un extends ee{constructor(t,e,i){super(),this.from=t,this.to=e,this.mark=i}apply(t){let e=t.slice(this.from,this.to),i=t.resolve(this.from),s=i.node(i.sharedDepth(this.to)),o=new F(ka(e.content,(a,c)=>!a.isAtom||!c.type.allowsMarkType(this.mark.type)?a:a.mark(this.mark.addToSet(a.marks)),s),e.openStart,e.openEnd);return Rt.fromReplace(t,this.from,this.to,o)}invert(){return new Pe(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),i=t.mapResult(this.to,-1);return e.deleted&&i.deleted||e.pos>=i.pos?null:new un(e.pos,i.pos,this.mark)}merge(t){return t instanceof un&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new un(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new un(e.from,e.to,t.markFromJSON(e.mark))}}ee.jsonID("addMark",un);class Pe extends ee{constructor(t,e,i){super(),this.from=t,this.to=e,this.mark=i}apply(t){let e=t.slice(this.from,this.to),i=new F(ka(e.content,s=>s.mark(this.mark.removeFromSet(s.marks)),t),e.openStart,e.openEnd);return Rt.fromReplace(t,this.from,this.to,i)}invert(){return new un(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),i=t.mapResult(this.to,-1);return e.deleted&&i.deleted||e.pos>=i.pos?null:new Pe(e.pos,i.pos,this.mark)}merge(t){return t instanceof Pe&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new Pe(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Pe(e.from,e.to,t.markFromJSON(e.mark))}}ee.jsonID("removeMark",Pe);class dn extends ee{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return Rt.fail("No node at mark step's position");let i=e.type.create(e.attrs,null,this.mark.addToSet(e.marks));return Rt.fromReplace(t,this.pos,this.pos+1,new F(z.from(i),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);if(e){let i=this.mark.addToSet(e.marks);if(i.length==e.marks.length){for(let s=0;s<e.marks.length;s++)if(!e.marks[s].isInSet(i))return new dn(this.pos,e.marks[s]);return new dn(this.pos,this.mark)}}return new $n(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new dn(e.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new dn(e.pos,t.markFromJSON(e.mark))}}ee.jsonID("addNodeMark",dn);class $n extends ee{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return Rt.fail("No node at mark step's position");let i=e.type.create(e.attrs,null,this.mark.removeFromSet(e.marks));return Rt.fromReplace(t,this.pos,this.pos+1,new F(z.from(i),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);return!e||!this.mark.isInSet(e.marks)?this:new dn(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new $n(e.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new $n(e.pos,t.markFromJSON(e.mark))}}ee.jsonID("removeNodeMark",$n);class $t extends ee{constructor(t,e,i,s=!1){super(),this.from=t,this.to=e,this.slice=i,this.structure=s}apply(t){return this.structure&&Ho(t,this.from,this.to)?Rt.fail("Structure replace would overwrite content"):Rt.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new pe([this.from,this.to-this.from,this.slice.size])}invert(t){return new $t(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let e=t.mapResult(this.from,1),i=t.mapResult(this.to,-1);return e.deletedAcross&&i.deletedAcross?null:new $t(e.pos,Math.max(e.pos,i.pos),this.slice,this.structure)}merge(t){if(!(t instanceof $t)||t.structure||this.structure)return null;if(this.from+this.slice.size==t.from&&!this.slice.openEnd&&!t.slice.openStart){let e=this.slice.size+t.slice.size==0?F.empty:new F(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new $t(this.from,this.to+(t.to-t.from),e,this.structure)}else if(t.to==this.from&&!this.slice.openStart&&!t.slice.openEnd){let e=this.slice.size+t.slice.size==0?F.empty:new F(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new $t(t.from,this.to,e,this.structure)}else return null}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new $t(e.from,e.to,F.fromJSON(t,e.slice),!!e.structure)}}ee.jsonID("replace",$t);class Ft extends ee{constructor(t,e,i,s,o,a,c=!1){super(),this.from=t,this.to=e,this.gapFrom=i,this.gapTo=s,this.slice=o,this.insert=a,this.structure=c}apply(t){if(this.structure&&(Ho(t,this.from,this.gapFrom)||Ho(t,this.gapTo,this.to)))return Rt.fail("Structure gap-replace would overwrite content");let e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return Rt.fail("Gap is not a flat range");let i=this.slice.insertAt(this.insert,e.content);return i?Rt.fromReplace(t,this.from,this.to,i):Rt.fail("Content does not fit in gap")}getMap(){return new pe([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let e=this.gapTo-this.gapFrom;return new Ft(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let e=t.mapResult(this.from,1),i=t.mapResult(this.to,-1),s=this.from==this.gapFrom?e.pos:t.map(this.gapFrom,-1),o=this.to==this.gapTo?i.pos:t.map(this.gapTo,1);return e.deletedAcross&&i.deletedAcross||s<e.pos||o>i.pos?null:new Ft(e.pos,i.pos,s,o,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if(typeof e.from!="number"||typeof e.to!="number"||typeof e.gapFrom!="number"||typeof e.gapTo!="number"||typeof e.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Ft(e.from,e.to,e.gapFrom,e.gapTo,F.fromJSON(t,e.slice),e.insert,!!e.structure)}}ee.jsonID("replaceAround",Ft);function Ho(n,t,e){let i=n.resolve(t),s=e-t,o=i.depth;for(;s>0&&o>0&&i.indexAfter(o)==i.node(o).childCount;)o--,s--;if(s>0){let a=i.node(o).maybeChild(i.indexAfter(o));for(;s>0;){if(!a||a.isLeaf)return!0;a=a.firstChild,s--}}return!1}function Gg(n,t,e,i){let s=[],o=[],a,c;n.doc.nodesBetween(t,e,(u,f,h)=>{if(!u.isInline)return;let m=u.marks;if(!i.isInSet(m)&&h.type.allowsMarkType(i.type)){let g=Math.max(f,t),y=Math.min(f+u.nodeSize,e),v=i.addToSet(m);for(let b=0;b<m.length;b++)m[b].isInSet(v)||(a&&a.to==g&&a.mark.eq(m[b])?a.to=y:s.push(a=new Pe(g,y,m[b])));c&&c.to==g?c.to=y:o.push(c=new un(g,y,i))}}),s.forEach(u=>n.step(u)),o.forEach(u=>n.step(u))}function Yg(n,t,e,i){let s=[],o=0;n.doc.nodesBetween(t,e,(a,c)=>{if(!a.isInline)return;o++;let u=null;if(i instanceof vs){let f=a.marks,h;for(;h=i.isInSet(f);)(u||(u=[])).push(h),f=h.removeFromSet(f)}else i?i.isInSet(a.marks)&&(u=[i]):u=a.marks;if(u&&u.length){let f=Math.min(c+a.nodeSize,e);for(let h=0;h<u.length;h++){let m=u[h],g;for(let y=0;y<s.length;y++){let v=s[y];v.step==o-1&&m.eq(s[y].style)&&(g=v)}g?(g.to=f,g.step=o):s.push({style:m,from:Math.max(c,t),to:f,step:o})}}}),s.forEach(a=>n.step(new Pe(a.from,a.to,a.style)))}function wa(n,t,e,i=e.contentMatch,s=!0){let o=n.doc.nodeAt(t),a=[],c=t+1;for(let u=0;u<o.childCount;u++){let f=o.child(u),h=c+f.nodeSize,m=i.matchType(f.type);if(!m)a.push(new $t(c,h,F.empty));else{i=m;for(let g=0;g<f.marks.length;g++)e.allowsMarkType(f.marks[g].type)||n.step(new Pe(c,h,f.marks[g]));if(s&&f.isText&&e.whitespace!="pre"){let g,y=/\r?\n|\r/g,v;for(;g=y.exec(f.text);)v||(v=new F(z.from(e.schema.text(" ",e.allowedMarks(f.marks))),0,0)),a.push(new $t(c+g.index,c+g.index+g[0].length,v))}}c=h}if(!i.validEnd){let u=i.fillBefore(z.empty,!0);n.replace(c,c,new F(u,0,0))}for(let u=a.length-1;u>=0;u--)n.step(a[u])}function Xg(n,t,e){return(t==0||n.canReplace(t,n.childCount))&&(e==n.childCount||n.canReplace(0,e))}function Zn(n){let e=n.parent.content.cutByIndex(n.startIndex,n.endIndex);for(let i=n.depth;;--i){let s=n.$from.node(i),o=n.$from.index(i),a=n.$to.indexAfter(i);if(i<n.depth&&s.canReplace(o,a,e))return i;if(i==0||s.type.spec.isolating||!Xg(s,o,a))break}return null}function Qg(n,t,e){let{$from:i,$to:s,depth:o}=t,a=i.before(o+1),c=s.after(o+1),u=a,f=c,h=z.empty,m=0;for(let v=o,b=!1;v>e;v--)b||i.index(v)>0?(b=!0,h=z.from(i.node(v).copy(h)),m++):u--;let g=z.empty,y=0;for(let v=o,b=!1;v>e;v--)b||s.after(v+1)<s.end(v)?(b=!0,g=z.from(s.node(v).copy(g)),y++):f++;n.step(new Ft(u,f,a,c,new F(h.append(g),m,y),h.size-m,!0))}function Sa(n,t,e=null,i=n){let s=t_(n,t),o=s&&e_(i,t);return o?s.map(Lc).concat({type:t,attrs:e}).concat(o.map(Lc)):null}function Lc(n){return{type:n,attrs:null}}function t_(n,t){let{parent:e,startIndex:i,endIndex:s}=n,o=e.contentMatchAt(i).findWrapping(t);if(!o)return null;let a=o.length?o[0]:t;return e.canReplaceWith(i,s,a)?o:null}function e_(n,t){let{parent:e,startIndex:i,endIndex:s}=n,o=e.child(i),a=t.contentMatch.findWrapping(o.type);if(!a)return null;let u=(a.length?a[a.length-1]:t).contentMatch;for(let f=i;u&&f<s;f++)u=u.matchType(e.child(f).type);return!u||!u.validEnd?null:a}function n_(n,t,e){let i=z.empty;for(let a=e.length-1;a>=0;a--){if(i.size){let c=e[a].type.contentMatch.matchFragment(i);if(!c||!c.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}i=z.from(e[a].type.create(e[a].attrs,i))}let s=t.start,o=t.end;n.step(new Ft(s,o,s,o,new F(i,0,0),e.length,!0))}function i_(n,t,e,i,s){if(!i.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let o=n.steps.length;n.doc.nodesBetween(t,e,(a,c)=>{let u=typeof s=="function"?s(a):s;if(a.isTextblock&&!a.hasMarkup(i,u)&&r_(n.doc,n.mapping.slice(o).map(c),i)){let f=null;if(i.schema.linebreakReplacement){let y=i.whitespace=="pre",v=!!i.contentMatch.matchType(i.schema.linebreakReplacement);y&&!v?f=!1:!y&&v&&(f=!0)}f===!1&&Cd(n,a,c,o),wa(n,n.mapping.slice(o).map(c,1),i,void 0,f===null);let h=n.mapping.slice(o),m=h.map(c,1),g=h.map(c+a.nodeSize,1);return n.step(new Ft(m,g,m+1,g-1,new F(z.from(i.create(u,null,a.marks)),0,0),1,!0)),f===!0&&Sd(n,a,c,o),!1}})}function Sd(n,t,e,i){t.forEach((s,o)=>{if(s.isText){let a,c=/\r?\n|\r/g;for(;a=c.exec(s.text);){let u=n.mapping.slice(i).map(e+1+o+a.index);n.replaceWith(u,u+1,t.type.schema.linebreakReplacement.create())}}})}function Cd(n,t,e,i){t.forEach((s,o)=>{if(s.type==s.type.schema.linebreakReplacement){let a=n.mapping.slice(i).map(e+1+o);n.replaceWith(a,a+1,t.type.schema.text(`
`))}})}function r_(n,t,e){let i=n.resolve(t),s=i.index();return i.parent.canReplaceWith(s,s+1,e)}function s_(n,t,e,i,s){let o=n.doc.nodeAt(t);if(!o)throw new RangeError("No node at given position");e||(e=o.type);let a=e.create(i,null,s||o.marks);if(o.isLeaf)return n.replaceWith(t,t+o.nodeSize,a);if(!e.validContent(o.content))throw new RangeError("Invalid content for node type "+e.name);n.step(new Ft(t,t+o.nodeSize,t+1,t+o.nodeSize-1,new F(z.from(a),0,0),1,!0))}function me(n,t,e=1,i){let s=n.resolve(t),o=s.depth-e,a=i&&i[i.length-1]||s.parent;if(o<0||s.parent.type.spec.isolating||!s.parent.canReplace(s.index(),s.parent.childCount)||!a.type.validContent(s.parent.content.cutByIndex(s.index(),s.parent.childCount)))return!1;for(let f=s.depth-1,h=e-2;f>o;f--,h--){let m=s.node(f),g=s.index(f);if(m.type.spec.isolating)return!1;let y=m.content.cutByIndex(g,m.childCount),v=i&&i[h+1];v&&(y=y.replaceChild(0,v.type.create(v.attrs)));let b=i&&i[h]||m;if(!m.canReplace(g+1,m.childCount)||!b.type.validContent(y))return!1}let c=s.indexAfter(o),u=i&&i[0];return s.node(o).canReplaceWith(c,c,u?u.type:s.node(o+1).type)}function o_(n,t,e=1,i){let s=n.doc.resolve(t),o=z.empty,a=z.empty;for(let c=s.depth,u=s.depth-e,f=e-1;c>u;c--,f--){o=z.from(s.node(c).copy(o));let h=i&&i[f];a=z.from(h?h.type.create(h.attrs,a):s.node(c).copy(a))}n.step(new $t(t,t,new F(o.append(a),e,e),!0))}function Fe(n,t){let e=n.resolve(t),i=e.index();return Md(e.nodeBefore,e.nodeAfter)&&e.parent.canReplace(i,i+1)}function a_(n,t){t.content.size||n.type.compatibleContent(t.type);let e=n.contentMatchAt(n.childCount),{linebreakReplacement:i}=n.type.schema;for(let s=0;s<t.childCount;s++){let o=t.child(s),a=o.type==i?n.type.schema.nodes.text:o.type;if(e=e.matchType(a),!e||!n.type.allowsMarks(o.marks))return!1}return e.validEnd}function Md(n,t){return!!(n&&t&&!n.isLeaf&&a_(n,t))}function bi(n,t,e=-1){let i=n.resolve(t);for(let s=i.depth;;s--){let o,a,c=i.index(s);if(s==i.depth?(o=i.nodeBefore,a=i.nodeAfter):e>0?(o=i.node(s+1),c++,a=i.node(s).maybeChild(c)):(o=i.node(s).maybeChild(c-1),a=i.node(s+1)),o&&!o.isTextblock&&Md(o,a)&&i.node(s).canReplace(c,c+1))return t;if(s==0)break;t=e<0?i.before(s):i.after(s)}}function l_(n,t,e){let i=null,{linebreakReplacement:s}=n.doc.type.schema,o=n.doc.resolve(t-e),a=o.node().type;if(s&&a.inlineContent){let h=a.whitespace=="pre",m=!!a.contentMatch.matchType(s);h&&!m?i=!1:!h&&m&&(i=!0)}let c=n.steps.length;if(i===!1){let h=n.doc.resolve(t+e);Cd(n,h.node(),h.before(),c)}a.inlineContent&&wa(n,t+e-1,a,o.node().contentMatchAt(o.index()),i==null);let u=n.mapping.slice(c),f=u.map(t-e);if(n.step(new $t(f,u.map(t+e,-1),F.empty,!0)),i===!0){let h=n.doc.resolve(f);Sd(n,h.node(),h.before(),n.steps.length)}return n}function c_(n,t,e){let i=n.resolve(t);if(i.parent.canReplaceWith(i.index(),i.index(),e))return t;if(i.parentOffset==0)for(let s=i.depth-1;s>=0;s--){let o=i.index(s);if(i.node(s).canReplaceWith(o,o,e))return i.before(s+1);if(o>0)return null}if(i.parentOffset==i.parent.content.size)for(let s=i.depth-1;s>=0;s--){let o=i.indexAfter(s);if(i.node(s).canReplaceWith(o,o,e))return i.after(s+1);if(o<i.node(s).childCount)return null}return null}function Td(n,t,e){let i=n.resolve(t);if(!e.content.size)return t;let s=e.content;for(let o=0;o<e.openStart;o++)s=s.firstChild.content;for(let o=1;o<=(e.openStart==0&&e.size?2:1);o++)for(let a=i.depth;a>=0;a--){let c=a==i.depth?0:i.pos<=(i.start(a+1)+i.end(a+1))/2?-1:1,u=i.index(a)+(c>0?1:0),f=i.node(a),h=!1;if(o==1)h=f.canReplace(u,u,s);else{let m=f.contentMatchAt(u).findWrapping(s.firstChild.type);h=m&&f.canReplaceWith(u,u,m[0])}if(h)return c==0?i.pos:c<0?i.before(a+1):i.after(a+1)}return null}function bs(n,t,e=t,i=F.empty){if(t==e&&!i.size)return null;let s=n.resolve(t),o=n.resolve(e);return Pd(s,o,i)?new $t(t,e,i):new u_(s,o,i).fit()}function Pd(n,t,e){return!e.openStart&&!e.openEnd&&n.start()==t.start()&&n.parent.canReplace(n.index(),t.index(),e.content)}class u_{constructor(t,e,i){this.$from=t,this.$to=e,this.unplaced=i,this.frontier=[],this.placed=z.empty;for(let s=0;s<=t.depth;s++){let o=t.node(s);this.frontier.push({type:o.type,match:o.contentMatchAt(t.indexAfter(s))})}for(let s=t.depth;s>0;s--)this.placed=z.from(t.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let f=this.findFittable();f?this.placeNodes(f):this.openMore()||this.dropNode()}let t=this.mustMoveInline(),e=this.placed.size-this.depth-this.$from.depth,i=this.$from,s=this.close(t<0?this.$to:i.doc.resolve(t));if(!s)return null;let o=this.placed,a=i.depth,c=s.depth;for(;a&&c&&o.childCount==1;)o=o.firstChild.content,a--,c--;let u=new F(o,a,c);return t>-1?new Ft(i.pos,t,this.$to.pos,this.$to.end(),u,e):u.size||i.pos!=this.$to.pos?new $t(i.pos,s.pos,u):null}findFittable(){let t=this.unplaced.openStart;for(let e=this.unplaced.content,i=0,s=this.unplaced.openEnd;i<t;i++){let o=e.firstChild;if(e.childCount>1&&(s=0),o.type.spec.isolating&&s<=i){t=i;break}e=o.content}for(let e=1;e<=2;e++)for(let i=e==1?t:this.unplaced.openStart;i>=0;i--){let s,o=null;i?(o=vo(this.unplaced.content,i-1).firstChild,s=o.content):s=this.unplaced.content;let a=s.firstChild;for(let c=this.depth;c>=0;c--){let{type:u,match:f}=this.frontier[c],h,m=null;if(e==1&&(a?f.matchType(a.type)||(m=f.fillBefore(z.from(a),!1)):o&&u.compatibleContent(o.type)))return{sliceDepth:i,frontierDepth:c,parent:o,inject:m};if(e==2&&a&&(h=f.findWrapping(a.type)))return{sliceDepth:i,frontierDepth:c,parent:o,wrap:h};if(o&&f.matchType(o.type))break}}}openMore(){let{content:t,openStart:e,openEnd:i}=this.unplaced,s=vo(t,e);return!s.childCount||s.firstChild.isLeaf?!1:(this.unplaced=new F(t,e+1,Math.max(i,s.size+e>=t.size-i?e+1:0)),!0)}dropNode(){let{content:t,openStart:e,openEnd:i}=this.unplaced,s=vo(t,e);if(s.childCount<=1&&e>0){let o=t.size-e<=e+s.size;this.unplaced=new F(Ri(t,e-1,1),e-1,o?e-1:i)}else this.unplaced=new F(Ri(t,e,1),e,i)}placeNodes({sliceDepth:t,frontierDepth:e,parent:i,inject:s,wrap:o}){for(;this.depth>e;)this.closeFrontierNode();if(o)for(let b=0;b<o.length;b++)this.openFrontierNode(o[b]);let a=this.unplaced,c=i?i.content:a.content,u=a.openStart-t,f=0,h=[],{match:m,type:g}=this.frontier[e];if(s){for(let b=0;b<s.childCount;b++)h.push(s.child(b));m=m.matchFragment(s)}let y=c.size+t-(a.content.size-a.openEnd);for(;f<c.childCount;){let b=c.child(f),S=m.matchType(b.type);if(!S)break;f++,(f>1||u==0||b.content.size)&&(m=S,h.push(Ed(b.mark(g.allowedMarks(b.marks)),f==1?u:0,f==c.childCount?y:-1)))}let v=f==c.childCount;v||(y=-1),this.placed=Bi(this.placed,e,z.from(h)),this.frontier[e].match=m,v&&y<0&&i&&i.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let b=0,S=c;b<y;b++){let M=S.lastChild;this.frontier.push({type:M.type,match:M.contentMatchAt(M.childCount)}),S=M.content}this.unplaced=v?t==0?F.empty:new F(Ri(a.content,t-1,1),t-1,y<0?a.openEnd:t-1):new F(Ri(a.content,t,f),a.openStart,a.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let t=this.frontier[this.depth],e;if(!t.type.isTextblock||!bo(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;let{depth:i}=this.$to,s=this.$to.after(i);for(;i>1&&s==this.$to.end(--i);)++s;return s}findCloseLevel(t){t:for(let e=Math.min(this.depth,t.depth);e>=0;e--){let{match:i,type:s}=this.frontier[e],o=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),a=bo(t,e,s,i,o);if(a){for(let c=e-1;c>=0;c--){let{match:u,type:f}=this.frontier[c],h=bo(t,c,f,u,!0);if(!h||h.childCount)continue t}return{depth:e,fit:a,move:o?t.doc.resolve(t.after(e+1)):t}}}}close(t){let e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=Bi(this.placed,e.depth,e.fit)),t=e.move;for(let i=e.depth+1;i<=t.depth;i++){let s=t.node(i),o=s.type.contentMatch.fillBefore(s.content,!0,t.index(i));this.openFrontierNode(s.type,s.attrs,o)}return t}openFrontierNode(t,e=null,i){let s=this.frontier[this.depth];s.match=s.match.matchType(t),this.placed=Bi(this.placed,this.depth,z.from(t.create(e,i))),this.frontier.push({type:t,match:t.contentMatch})}closeFrontierNode(){let e=this.frontier.pop().match.fillBefore(z.empty,!0);e.childCount&&(this.placed=Bi(this.placed,this.frontier.length,e))}}function Ri(n,t,e){return t==0?n.cutByIndex(e,n.childCount):n.replaceChild(0,n.firstChild.copy(Ri(n.firstChild.content,t-1,e)))}function Bi(n,t,e){return t==0?n.append(e):n.replaceChild(n.childCount-1,n.lastChild.copy(Bi(n.lastChild.content,t-1,e)))}function vo(n,t){for(let e=0;e<t;e++)n=n.firstChild.content;return n}function Ed(n,t,e){if(t<=0)return n;let i=n.content;return t>1&&(i=i.replaceChild(0,Ed(i.firstChild,t-1,i.childCount==1?e-1:0))),t>0&&(i=n.type.contentMatch.fillBefore(i).append(i),e<=0&&(i=i.append(n.type.contentMatch.matchFragment(i).fillBefore(z.empty,!0)))),n.copy(i)}function bo(n,t,e,i,s){let o=n.node(t),a=s?n.indexAfter(t):n.index(t);if(a==o.childCount&&!e.compatibleContent(o.type))return null;let c=i.fillBefore(o.content,!0,a);return c&&!d_(e,o.content,a)?c:null}function d_(n,t,e){for(let i=e;i<t.childCount;i++)if(!n.allowsMarks(t.child(i).marks))return!0;return!1}function f_(n){return n.spec.defining||n.spec.definingForContent}function h_(n,t,e,i){if(!i.size)return n.deleteRange(t,e);let s=n.doc.resolve(t),o=n.doc.resolve(e);if(Pd(s,o,i))return n.step(new $t(t,e,i));let a=Ad(s,n.doc.resolve(e));a[a.length-1]==0&&a.pop();let c=-(s.depth+1);a.unshift(c);for(let g=s.depth,y=s.pos-1;g>0;g--,y--){let v=s.node(g).type.spec;if(v.defining||v.definingAsContext||v.isolating)break;a.indexOf(g)>-1?c=g:s.before(g)==y&&a.splice(1,0,-g)}let u=a.indexOf(c),f=[],h=i.openStart;for(let g=i.content,y=0;;y++){let v=g.firstChild;if(f.push(v),y==i.openStart)break;g=v.content}for(let g=h-1;g>=0;g--){let y=f[g],v=f_(y.type);if(v&&!y.sameMarkup(s.node(Math.abs(c)-1)))h=g;else if(v||!y.type.isTextblock)break}for(let g=i.openStart;g>=0;g--){let y=(g+h+1)%(i.openStart+1),v=f[y];if(v)for(let b=0;b<a.length;b++){let S=a[(b+u)%a.length],M=!0;S<0&&(M=!1,S=-S);let P=s.node(S-1),D=s.index(S-1);if(P.canReplaceWith(D,D,v.type,v.marks))return n.replace(s.before(S),M?o.after(S):e,new F(Od(i.content,0,i.openStart,y),y,i.openEnd))}}let m=n.steps.length;for(let g=a.length-1;g>=0&&(n.replace(t,e,i),!(n.steps.length>m));g--){let y=a[g];y<0||(t=s.before(y),e=o.after(y))}}function Od(n,t,e,i,s){if(t<e){let o=n.firstChild;n=n.replaceChild(0,o.copy(Od(o.content,t+1,e,i,o)))}if(t>i){let o=s.contentMatchAt(0),a=o.fillBefore(n).append(n);n=a.append(o.matchFragment(a).fillBefore(z.empty,!0))}return n}function p_(n,t,e,i){if(!i.isInline&&t==e&&n.doc.resolve(t).parent.content.size){let s=c_(n.doc,t,i.type);s!=null&&(t=e=s)}n.replaceRange(t,e,new F(z.from(i),0,0))}function m_(n,t,e){let i=n.doc.resolve(t),s=n.doc.resolve(e),o=Ad(i,s);for(let a=0;a<o.length;a++){let c=o[a],u=a==o.length-1;if(u&&c==0||i.node(c).type.contentMatch.validEnd)return n.delete(i.start(c),s.end(c));if(c>0&&(u||i.node(c-1).canReplace(i.index(c-1),s.indexAfter(c-1))))return n.delete(i.before(c),s.after(c))}for(let a=1;a<=i.depth&&a<=s.depth;a++)if(t-i.start(a)==i.depth-a&&e>i.end(a)&&s.end(a)-e!=s.depth-a&&i.start(a-1)==s.start(a-1)&&i.node(a-1).canReplace(i.index(a-1),s.index(a-1)))return n.delete(i.before(a),e);n.delete(t,e)}function Ad(n,t){let e=[],i=Math.min(n.depth,t.depth);for(let s=i;s>=0;s--){let o=n.start(s);if(o<n.pos-(n.depth-s)||t.end(s)>t.pos+(t.depth-s)||n.node(s).type.spec.isolating||t.node(s).type.spec.isolating)break;(o==t.start(s)||s==n.depth&&s==t.depth&&n.parent.inlineContent&&t.parent.inlineContent&&s&&t.start(s-1)==o-1)&&e.push(s)}return e}class ai extends ee{constructor(t,e,i){super(),this.pos=t,this.attr=e,this.value=i}apply(t){let e=t.nodeAt(this.pos);if(!e)return Rt.fail("No node at attribute step's position");let i=Object.create(null);for(let o in e.attrs)i[o]=e.attrs[o];i[this.attr]=this.value;let s=e.type.create(i,null,e.marks);return Rt.fromReplace(t,this.pos,this.pos+1,new F(z.from(s),0,e.isLeaf?0:1))}getMap(){return pe.empty}invert(t){return new ai(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new ai(e.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,e){if(typeof e.pos!="number"||typeof e.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new ai(e.pos,e.attr,e.value)}}ee.jsonID("attr",ai);class Ki extends ee{constructor(t,e){super(),this.attr=t,this.value=e}apply(t){let e=Object.create(null);for(let s in t.attrs)e[s]=t.attrs[s];e[this.attr]=this.value;let i=t.type.create(e,t.content,t.marks);return Rt.ok(i)}getMap(){return pe.empty}invert(t){return new Ki(this.attr,t.attrs[this.attr])}map(t){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(t,e){if(typeof e.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new Ki(e.attr,e.value)}}ee.jsonID("docAttr",Ki);let ci=class extends Error{};ci=function n(t){let e=Error.call(this,t);return e.__proto__=n.prototype,e};ci.prototype=Object.create(Error.prototype);ci.prototype.constructor=ci;ci.prototype.name="TransformError";class Ld{constructor(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new qi}get before(){return this.docs.length?this.docs[0]:this.doc}step(t){let e=this.maybeStep(t);if(e.failed)throw new ci(e.failed);return this}maybeStep(t){let e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e}get docChanged(){return this.steps.length>0}addStep(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e}replace(t,e=t,i=F.empty){let s=bs(this.doc,t,e,i);return s&&this.step(s),this}replaceWith(t,e,i){return this.replace(t,e,new F(z.from(i),0,0))}delete(t,e){return this.replace(t,e,F.empty)}insert(t,e){return this.replaceWith(t,t,e)}replaceRange(t,e,i){return h_(this,t,e,i),this}replaceRangeWith(t,e,i){return p_(this,t,e,i),this}deleteRange(t,e){return m_(this,t,e),this}lift(t,e){return Qg(this,t,e),this}join(t,e=1){return l_(this,t,e),this}wrap(t,e){return n_(this,t,e),this}setBlockType(t,e=t,i,s=null){return i_(this,t,e,i,s),this}setNodeMarkup(t,e,i=null,s){return s_(this,t,e,i,s),this}setNodeAttribute(t,e,i){return this.step(new ai(t,e,i)),this}setDocAttribute(t,e){return this.step(new Ki(t,e)),this}addNodeMark(t,e){return this.step(new dn(t,e)),this}removeNodeMark(t,e){let i=this.doc.nodeAt(t);if(!i)throw new RangeError("No node at position "+t);if(e instanceof yt)e.isInSet(i.marks)&&this.step(new $n(t,e));else{let s=i.marks,o,a=[];for(;o=e.isInSet(s);)a.push(new $n(t,o)),s=o.removeFromSet(s);for(let c=a.length-1;c>=0;c--)this.step(a[c])}return this}split(t,e=1,i){return o_(this,t,e,i),this}addMark(t,e,i){return Gg(this,t,e,i),this}removeMark(t,e,i){return Yg(this,t,e,i),this}clearIncompatible(t,e,i){return wa(this,t,e,i),this}}const xo=Object.create(null);class it{constructor(t,e,i){this.$anchor=t,this.$head=e,this.ranges=i||[new g_(t.min(e),t.max(e))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let t=this.ranges;for(let e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(t,e=F.empty){let i=e.content.lastChild,s=null;for(let c=0;c<e.openEnd;c++)s=i,i=i.lastChild;let o=t.steps.length,a=this.ranges;for(let c=0;c<a.length;c++){let{$from:u,$to:f}=a[c],h=t.mapping.slice(o);t.replaceRange(h.map(u.pos),h.map(f.pos),c?F.empty:e),c==0&&Dc(t,o,(i?i.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(t,e){let i=t.steps.length,s=this.ranges;for(let o=0;o<s.length;o++){let{$from:a,$to:c}=s[o],u=t.mapping.slice(i),f=u.map(a.pos),h=u.map(c.pos);o?t.deleteRange(f,h):(t.replaceRangeWith(f,h,e),Dc(t,i,e.isInline?-1:1))}}static findFrom(t,e,i=!1){let s=t.parent.inlineContent?new X(t):ii(t.node(0),t.parent,t.pos,t.index(),e,i);if(s)return s;for(let o=t.depth-1;o>=0;o--){let a=e<0?ii(t.node(0),t.node(o),t.before(o+1),t.index(o),e,i):ii(t.node(0),t.node(o),t.after(o+1),t.index(o)+1,e,i);if(a)return a}return null}static near(t,e=1){return this.findFrom(t,e)||this.findFrom(t,-e)||new ue(t.node(0))}static atStart(t){return ii(t,t,0,0,1)||new ue(t)}static atEnd(t){return ii(t,t,t.content.size,t.childCount,-1)||new ue(t)}static fromJSON(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");let i=xo[e.type];if(!i)throw new RangeError(`No selection type ${e.type} defined`);return i.fromJSON(t,e)}static jsonID(t,e){if(t in xo)throw new RangeError("Duplicate use of selection JSON ID "+t);return xo[t]=e,e.prototype.jsonID=t,e}getBookmark(){return X.between(this.$anchor,this.$head).getBookmark()}}it.prototype.visible=!0;class g_{constructor(t,e){this.$from=t,this.$to=e}}let Ic=!1;function Nc(n){!Ic&&!n.parent.inlineContent&&(Ic=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+n.parent.type.name+")"))}class X extends it{constructor(t,e=t){Nc(t),Nc(e),super(t,e)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(t,e){let i=t.resolve(e.map(this.head));if(!i.parent.inlineContent)return it.near(i);let s=t.resolve(e.map(this.anchor));return new X(s.parent.inlineContent?s:i,i)}replace(t,e=F.empty){if(super.replace(t,e),e==F.empty){let i=this.$from.marksAcross(this.$to);i&&t.ensureMarks(i)}}eq(t){return t instanceof X&&t.anchor==this.anchor&&t.head==this.head}getBookmark(){return new xs(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(t,e){if(typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new X(t.resolve(e.anchor),t.resolve(e.head))}static create(t,e,i=e){let s=t.resolve(e);return new this(s,i==e?s:t.resolve(i))}static between(t,e,i){let s=t.pos-e.pos;if((!i||s)&&(i=s>=0?1:-1),!e.parent.inlineContent){let o=it.findFrom(e,i,!0)||it.findFrom(e,-i,!0);if(o)e=o.$head;else return it.near(e,i)}return t.parent.inlineContent||(s==0?t=e:(t=(it.findFrom(t,-i,!0)||it.findFrom(t,i,!0)).$anchor,t.pos<e.pos!=s<0&&(t=e))),new X(t,e)}}it.jsonID("text",X);class xs{constructor(t,e){this.anchor=t,this.head=e}map(t){return new xs(t.map(this.anchor),t.map(this.head))}resolve(t){return X.between(t.resolve(this.anchor),t.resolve(this.head))}}class Y extends it{constructor(t){let e=t.nodeAfter,i=t.node(0).resolve(t.pos+e.nodeSize);super(t,i),this.node=e}map(t,e){let{deleted:i,pos:s}=e.mapResult(this.anchor),o=t.resolve(s);return i?it.near(o):new Y(o)}content(){return new F(z.from(this.node),0,0)}eq(t){return t instanceof Y&&t.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Ca(this.anchor)}static fromJSON(t,e){if(typeof e.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Y(t.resolve(e.anchor))}static create(t,e){return new Y(t.resolve(e))}static isSelectable(t){return!t.isText&&t.type.spec.selectable!==!1}}Y.prototype.visible=!1;it.jsonID("node",Y);class Ca{constructor(t){this.anchor=t}map(t){let{deleted:e,pos:i}=t.mapResult(this.anchor);return e?new xs(i,i):new Ca(i)}resolve(t){let e=t.resolve(this.anchor),i=e.nodeAfter;return i&&Y.isSelectable(i)?new Y(e):it.near(e)}}class ue extends it{constructor(t){super(t.resolve(0),t.resolve(t.content.size))}replace(t,e=F.empty){if(e==F.empty){t.delete(0,t.doc.content.size);let i=it.atStart(t.doc);i.eq(t.selection)||t.setSelection(i)}else super.replace(t,e)}toJSON(){return{type:"all"}}static fromJSON(t){return new ue(t)}map(t){return new ue(t)}eq(t){return t instanceof ue}getBookmark(){return __}}it.jsonID("all",ue);const __={map(){return this},resolve(n){return new ue(n)}};function ii(n,t,e,i,s,o=!1){if(t.inlineContent)return X.create(n,e);for(let a=i-(s>0?0:1);s>0?a<t.childCount:a>=0;a+=s){let c=t.child(a);if(c.isAtom){if(!o&&Y.isSelectable(c))return Y.create(n,e-(s<0?c.nodeSize:0))}else{let u=ii(n,c,e+s,s<0?c.childCount:0,s,o);if(u)return u}e+=c.nodeSize*s}return null}function Dc(n,t,e){let i=n.steps.length-1;if(i<t)return;let s=n.steps[i];if(!(s instanceof $t||s instanceof Ft))return;let o=n.mapping.maps[i],a;o.forEach((c,u,f,h)=>{a==null&&(a=h)}),n.setSelection(it.near(n.doc.resolve(a),e))}const zc=1,Or=2,Rc=4;class y_ extends Ld{constructor(t){super(t.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=t.selection,this.storedMarks=t.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=(this.updated|zc)&~Or,this.storedMarks=null,this}get selectionSet(){return(this.updated&zc)>0}setStoredMarks(t){return this.storedMarks=t,this.updated|=Or,this}ensureMarks(t){return yt.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this}addStoredMark(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Or)>0}addStep(t,e){super.addStep(t,e),this.updated=this.updated&~Or,this.storedMarks=null}setTime(t){return this.time=t,this}replaceSelection(t){return this.selection.replace(this,t),this}replaceSelectionWith(t,e=!0){let i=this.selection;return e&&(t=t.mark(this.storedMarks||(i.empty?i.$from.marks():i.$from.marksAcross(i.$to)||yt.none))),i.replaceWith(this,t),this}deleteSelection(){return this.selection.replace(this),this}insertText(t,e,i){let s=this.doc.type.schema;if(e==null)return t?this.replaceSelectionWith(s.text(t),!0):this.deleteSelection();{if(i==null&&(i=e),i=i??e,!t)return this.deleteRange(e,i);let o=this.storedMarks;if(!o){let a=this.doc.resolve(e);o=i==e?a.marks():a.marksAcross(this.doc.resolve(i))}return this.replaceRangeWith(e,i,s.text(t,o)),this.selection.empty||this.setSelection(it.near(this.selection.$to)),this}}setMeta(t,e){return this.meta[typeof t=="string"?t:t.key]=e,this}getMeta(t){return this.meta[typeof t=="string"?t:t.key]}get isGeneric(){for(let t in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=Rc,this}get scrolledIntoView(){return(this.updated&Rc)>0}}function Bc(n,t){return!t||!n?n:n.bind(t)}class $i{constructor(t,e,i){this.name=t,this.init=Bc(e.init,i),this.apply=Bc(e.apply,i)}}const v_=[new $i("doc",{init(n){return n.doc||n.schema.topNodeType.createAndFill()},apply(n){return n.doc}}),new $i("selection",{init(n,t){return n.selection||it.atStart(t.doc)},apply(n){return n.selection}}),new $i("storedMarks",{init(n){return n.storedMarks||null},apply(n,t,e,i){return i.selection.$cursor?n.storedMarks:null}}),new $i("scrollToSelection",{init(){return 0},apply(n,t){return n.scrolledIntoView?t+1:t}})];class ko{constructor(t,e){this.schema=t,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=v_.slice(),e&&e.forEach(i=>{if(this.pluginsByKey[i.key])throw new RangeError("Adding different instances of a keyed plugin ("+i.key+")");this.plugins.push(i),this.pluginsByKey[i.key]=i,i.spec.state&&this.fields.push(new $i(i.key,i.spec.state,i))})}}class si{constructor(t){this.config=t}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(t){return this.applyTransaction(t).state}filterTransaction(t,e=-1){for(let i=0;i<this.config.plugins.length;i++)if(i!=e){let s=this.config.plugins[i];if(s.spec.filterTransaction&&!s.spec.filterTransaction.call(s,t,this))return!1}return!0}applyTransaction(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};let e=[t],i=this.applyInner(t),s=null;for(;;){let o=!1;for(let a=0;a<this.config.plugins.length;a++){let c=this.config.plugins[a];if(c.spec.appendTransaction){let u=s?s[a].n:0,f=s?s[a].state:this,h=u<e.length&&c.spec.appendTransaction.call(c,u?e.slice(u):e,f,i);if(h&&i.filterTransaction(h,a)){if(h.setMeta("appendedTransaction",t),!s){s=[];for(let m=0;m<this.config.plugins.length;m++)s.push(m<a?{state:i,n:e.length}:{state:this,n:0})}e.push(h),i=i.applyInner(h),o=!0}s&&(s[a]={state:i,n:e.length})}}if(!o)return{state:i,transactions:e}}}applyInner(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let e=new si(this.config),i=this.config.fields;for(let s=0;s<i.length;s++){let o=i[s];e[o.name]=o.apply(t,this[o.name],this,e)}return e}get tr(){return new y_(this)}static create(t){let e=new ko(t.doc?t.doc.type.schema:t.schema,t.plugins),i=new si(e);for(let s=0;s<e.fields.length;s++)i[e.fields[s].name]=e.fields[s].init(t,i);return i}reconfigure(t){let e=new ko(this.schema,t.plugins),i=e.fields,s=new si(e);for(let o=0;o<i.length;o++){let a=i[o].name;s[a]=this.hasOwnProperty(a)?this[a]:i[o].init(t,s)}return s}toJSON(t){let e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(e.storedMarks=this.storedMarks.map(i=>i.toJSON())),t&&typeof t=="object")for(let i in t){if(i=="doc"||i=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let s=t[i],o=s.spec.state;o&&o.toJSON&&(e[i]=o.toJSON.call(s,this[s.key]))}return e}static fromJSON(t,e,i){if(!e)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");let s=new ko(t.schema,t.plugins),o=new si(s);return s.fields.forEach(a=>{if(a.name=="doc")o.doc=ke.fromJSON(t.schema,e.doc);else if(a.name=="selection")o.selection=it.fromJSON(o.doc,e.selection);else if(a.name=="storedMarks")e.storedMarks&&(o.storedMarks=e.storedMarks.map(t.schema.markFromJSON));else{if(i)for(let c in i){let u=i[c],f=u.spec.state;if(u.key==a.name&&f&&f.fromJSON&&Object.prototype.hasOwnProperty.call(e,c)){o[a.name]=f.fromJSON.call(u,t,e[c],o);return}}o[a.name]=a.init(t,o)}}),o}}function Id(n,t,e){for(let i in n){let s=n[i];s instanceof Function?s=s.bind(t):i=="handleDOMEvents"&&(s=Id(s,t,{})),e[i]=s}return e}class xt{constructor(t){this.spec=t,this.props={},t.props&&Id(t.props,this,this.props),this.key=t.key?t.key.key:Nd("plugin")}getState(t){return t[this.key]}}const wo=Object.create(null);function Nd(n){return n in wo?n+"$"+ ++wo[n]:(wo[n]=0,n+"$")}class It{constructor(t="key"){this.key=Nd(t)}get(t){return t.config.pluginsByKey[this.key]}getState(t){return t[this.key]}}const Jt=function(n){for(var t=0;;t++)if(n=n.previousSibling,!n)return t},ui=function(n){let t=n.assignedSlot||n.parentNode;return t&&t.nodeType==11?t.host:t};let Zo=null;const qe=function(n,t,e){let i=Zo||(Zo=document.createRange());return i.setEnd(n,e??n.nodeValue.length),i.setStart(n,t||0),i},b_=function(){Zo=null},Fn=function(n,t,e,i){return e&&($c(n,t,e,i,-1)||$c(n,t,e,i,1))},x_=/^(img|br|input|textarea|hr)$/i;function $c(n,t,e,i,s){for(var o;;){if(n==e&&t==i)return!0;if(t==(s<0?0:xe(n))){let a=n.parentNode;if(!a||a.nodeType!=1||rr(n)||x_.test(n.nodeName)||n.contentEditable=="false")return!1;t=Jt(n)+(s<0?0:1),n=a}else if(n.nodeType==1){let a=n.childNodes[t+(s<0?-1:0)];if(a.nodeType==1&&a.contentEditable=="false")if(!((o=a.pmViewDesc)===null||o===void 0)&&o.ignoreForSelection)t+=s;else return!1;else n=a,t=s<0?xe(n):0}else return!1}}function xe(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function k_(n,t){for(;;){if(n.nodeType==3&&t)return n;if(n.nodeType==1&&t>0){if(n.contentEditable=="false")return null;n=n.childNodes[t-1],t=xe(n)}else if(n.parentNode&&!rr(n))t=Jt(n),n=n.parentNode;else return null}}function w_(n,t){for(;;){if(n.nodeType==3&&t<n.nodeValue.length)return n;if(n.nodeType==1&&t<n.childNodes.length){if(n.contentEditable=="false")return null;n=n.childNodes[t],t=0}else if(n.parentNode&&!rr(n))t=Jt(n)+1,n=n.parentNode;else return null}}function S_(n,t,e){for(let i=t==0,s=t==xe(n);i||s;){if(n==e)return!0;let o=Jt(n);if(n=n.parentNode,!n)return!1;i=i&&o==0,s=s&&o==xe(n)}}function rr(n){let t;for(let e=n;e&&!(t=e.pmViewDesc);e=e.parentNode);return t&&t.node&&t.node.isBlock&&(t.dom==n||t.contentDOM==n)}const ks=function(n){return n.focusNode&&Fn(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)};function Tn(n,t){let e=document.createEvent("Event");return e.initEvent("keydown",!0,!0),e.keyCode=n,e.key=e.code=t,e}function C_(n){let t=n.activeElement;for(;t&&t.shadowRoot;)t=t.shadowRoot.activeElement;return t}function M_(n,t,e){if(n.caretPositionFromPoint)try{let i=n.caretPositionFromPoint(t,e);if(i)return{node:i.offsetNode,offset:Math.min(xe(i.offsetNode),i.offset)}}catch{}if(n.caretRangeFromPoint){let i=n.caretRangeFromPoint(t,e);if(i)return{node:i.startContainer,offset:Math.min(xe(i.startContainer),i.startOffset)}}}const Re=typeof navigator<"u"?navigator:null,Fc=typeof document<"u"?document:null,yn=Re&&Re.userAgent||"",Wo=/Edge\/(\d+)/.exec(yn),Dd=/MSIE \d/.exec(yn),jo=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(yn),de=!!(Dd||jo||Wo),hn=Dd?document.documentMode:jo?+jo[1]:Wo?+Wo[1]:0,Oe=!de&&/gecko\/(\d+)/i.test(yn);Oe&&+(/Firefox\/(\d+)/.exec(yn)||[0,0])[1];const Uo=!de&&/Chrome\/(\d+)/.exec(yn),Qt=!!Uo,zd=Uo?+Uo[1]:0,re=!de&&!!Re&&/Apple Computer/.test(Re.vendor),di=re&&(/Mobile\/\w+/.test(yn)||!!Re&&Re.maxTouchPoints>2),be=di||(Re?/Mac/.test(Re.platform):!1),T_=Re?/Win/.test(Re.platform):!1,Ke=/Android \d/.test(yn),sr=!!Fc&&"webkitFontSmoothing"in Fc.documentElement.style,P_=sr?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function E_(n){let t=n.defaultView&&n.defaultView.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:n.documentElement.clientWidth,top:0,bottom:n.documentElement.clientHeight}}function Ue(n,t){return typeof n=="number"?n:n[t]}function O_(n){let t=n.getBoundingClientRect(),e=t.width/n.offsetWidth||1,i=t.height/n.offsetHeight||1;return{left:t.left,right:t.left+n.clientWidth*e,top:t.top,bottom:t.top+n.clientHeight*i}}function Vc(n,t,e){let i=n.someProp("scrollThreshold")||0,s=n.someProp("scrollMargin")||5,o=n.dom.ownerDocument;for(let a=e||n.dom;a;){if(a.nodeType!=1){a=ui(a);continue}let c=a,u=c==o.body,f=u?E_(o):O_(c),h=0,m=0;if(t.top<f.top+Ue(i,"top")?m=-(f.top-t.top+Ue(s,"top")):t.bottom>f.bottom-Ue(i,"bottom")&&(m=t.bottom-t.top>f.bottom-f.top?t.top+Ue(s,"top")-f.top:t.bottom-f.bottom+Ue(s,"bottom")),t.left<f.left+Ue(i,"left")?h=-(f.left-t.left+Ue(s,"left")):t.right>f.right-Ue(i,"right")&&(h=t.right-f.right+Ue(s,"right")),h||m)if(u)o.defaultView.scrollBy(h,m);else{let y=c.scrollLeft,v=c.scrollTop;m&&(c.scrollTop+=m),h&&(c.scrollLeft+=h);let b=c.scrollLeft-y,S=c.scrollTop-v;t={left:t.left-b,top:t.top-S,right:t.right-b,bottom:t.bottom-S}}let g=u?"fixed":getComputedStyle(a).position;if(/^(fixed|sticky)$/.test(g))break;a=g=="absolute"?a.offsetParent:ui(a)}}function A_(n){let t=n.dom.getBoundingClientRect(),e=Math.max(0,t.top),i,s;for(let o=(t.left+t.right)/2,a=e+1;a<Math.min(innerHeight,t.bottom);a+=5){let c=n.root.elementFromPoint(o,a);if(!c||c==n.dom||!n.dom.contains(c))continue;let u=c.getBoundingClientRect();if(u.top>=e-20){i=c,s=u.top;break}}return{refDOM:i,refTop:s,stack:Rd(n.dom)}}function Rd(n){let t=[],e=n.ownerDocument;for(let i=n;i&&(t.push({dom:i,top:i.scrollTop,left:i.scrollLeft}),n!=e);i=ui(i));return t}function L_({refDOM:n,refTop:t,stack:e}){let i=n?n.getBoundingClientRect().top:0;Bd(e,i==0?0:i-t)}function Bd(n,t){for(let e=0;e<n.length;e++){let{dom:i,top:s,left:o}=n[e];i.scrollTop!=s+t&&(i.scrollTop=s+t),i.scrollLeft!=o&&(i.scrollLeft=o)}}let ti=null;function I_(n){if(n.setActive)return n.setActive();if(ti)return n.focus(ti);let t=Rd(n);n.focus(ti==null?{get preventScroll(){return ti={preventScroll:!0},!0}}:void 0),ti||(ti=!1,Bd(t,0))}function $d(n,t){let e,i=2e8,s,o=0,a=t.top,c=t.top,u,f;for(let h=n.firstChild,m=0;h;h=h.nextSibling,m++){let g;if(h.nodeType==1)g=h.getClientRects();else if(h.nodeType==3)g=qe(h).getClientRects();else continue;for(let y=0;y<g.length;y++){let v=g[y];if(v.top<=a&&v.bottom>=c){a=Math.max(v.bottom,a),c=Math.min(v.top,c);let b=v.left>t.left?v.left-t.left:v.right<t.left?t.left-v.right:0;if(b<i){e=h,i=b,s=b&&e.nodeType==3?{left:v.right<t.left?v.right:v.left,top:t.top}:t,h.nodeType==1&&b&&(o=m+(t.left>=(v.left+v.right)/2?1:0));continue}}else v.top>t.top&&!u&&v.left<=t.left&&v.right>=t.left&&(u=h,f={left:Math.max(v.left,Math.min(v.right,t.left)),top:v.top});!e&&(t.left>=v.right&&t.top>=v.top||t.left>=v.left&&t.top>=v.bottom)&&(o=m+1)}}return!e&&u&&(e=u,s=f,i=0),e&&e.nodeType==3?N_(e,s):!e||i&&e.nodeType==1?{node:n,offset:o}:$d(e,s)}function N_(n,t){let e=n.nodeValue.length,i=document.createRange();for(let s=0;s<e;s++){i.setEnd(n,s+1),i.setStart(n,s);let o=on(i,1);if(o.top!=o.bottom&&Ma(t,o))return{node:n,offset:s+(t.left>=(o.left+o.right)/2?1:0)}}return{node:n,offset:0}}function Ma(n,t){return n.left>=t.left-1&&n.left<=t.right+1&&n.top>=t.top-1&&n.top<=t.bottom+1}function D_(n,t){let e=n.parentNode;return e&&/^li$/i.test(e.nodeName)&&t.left<n.getBoundingClientRect().left?e:n}function z_(n,t,e){let{node:i,offset:s}=$d(t,e),o=-1;if(i.nodeType==1&&!i.firstChild){let a=i.getBoundingClientRect();o=a.left!=a.right&&e.left>(a.left+a.right)/2?1:-1}return n.docView.posFromDOM(i,s,o)}function R_(n,t,e,i){let s=-1;for(let o=t,a=!1;o!=n.dom;){let c=n.docView.nearestDesc(o,!0),u;if(!c)return null;if(c.dom.nodeType==1&&(c.node.isBlock&&c.parent||!c.contentDOM)&&((u=c.dom.getBoundingClientRect()).width||u.height)&&(c.node.isBlock&&c.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(c.dom.nodeName)&&(!a&&u.left>i.left||u.top>i.top?s=c.posBefore:(!a&&u.right<i.left||u.bottom<i.top)&&(s=c.posAfter),a=!0),!c.contentDOM&&s<0&&!c.node.isText))return(c.node.isBlock?i.top<(u.top+u.bottom)/2:i.left<(u.left+u.right)/2)?c.posBefore:c.posAfter;o=c.dom.parentNode}return s>-1?s:n.docView.posFromDOM(t,e,-1)}function Fd(n,t,e){let i=n.childNodes.length;if(i&&e.top<e.bottom)for(let s=Math.max(0,Math.min(i-1,Math.floor(i*(t.top-e.top)/(e.bottom-e.top))-2)),o=s;;){let a=n.childNodes[o];if(a.nodeType==1){let c=a.getClientRects();for(let u=0;u<c.length;u++){let f=c[u];if(Ma(t,f))return Fd(a,t,f)}}if((o=(o+1)%i)==s)break}return n}function B_(n,t){let e=n.dom.ownerDocument,i,s=0,o=M_(e,t.left,t.top);o&&({node:i,offset:s}=o);let a=(n.root.elementFromPoint?n.root:e).elementFromPoint(t.left,t.top),c;if(!a||!n.dom.contains(a.nodeType!=1?a.parentNode:a)){let f=n.dom.getBoundingClientRect();if(!Ma(t,f)||(a=Fd(n.dom,t,f),!a))return null}if(re)for(let f=a;i&&f;f=ui(f))f.draggable&&(i=void 0);if(a=D_(a,t),i){if(Oe&&i.nodeType==1&&(s=Math.min(s,i.childNodes.length),s<i.childNodes.length)){let h=i.childNodes[s],m;h.nodeName=="IMG"&&(m=h.getBoundingClientRect()).right<=t.left&&m.bottom>t.top&&s++}let f;sr&&s&&i.nodeType==1&&(f=i.childNodes[s-1]).nodeType==1&&f.contentEditable=="false"&&f.getBoundingClientRect().top>=t.top&&s--,i==n.dom&&s==i.childNodes.length-1&&i.lastChild.nodeType==1&&t.top>i.lastChild.getBoundingClientRect().bottom?c=n.state.doc.content.size:(s==0||i.nodeType!=1||i.childNodes[s-1].nodeName!="BR")&&(c=R_(n,i,s,t))}c==null&&(c=z_(n,a,t));let u=n.docView.nearestDesc(a,!0);return{pos:c,inside:u?u.posAtStart-u.border:-1}}function Hc(n){return n.top<n.bottom||n.left<n.right}function on(n,t){let e=n.getClientRects();if(e.length){let i=e[t<0?0:e.length-1];if(Hc(i))return i}return Array.prototype.find.call(e,Hc)||n.getBoundingClientRect()}const $_=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function Vd(n,t,e){let{node:i,offset:s,atom:o}=n.docView.domFromPos(t,e<0?-1:1),a=sr||Oe;if(i.nodeType==3)if(a&&($_.test(i.nodeValue)||(e<0?!s:s==i.nodeValue.length))){let u=on(qe(i,s,s),e);if(Oe&&s&&/\s/.test(i.nodeValue[s-1])&&s<i.nodeValue.length){let f=on(qe(i,s-1,s-1),-1);if(f.top==u.top){let h=on(qe(i,s,s+1),-1);if(h.top!=u.top)return zi(h,h.left<f.left)}}return u}else{let u=s,f=s,h=e<0?1:-1;return e<0&&!s?(f++,h=-1):e>=0&&s==i.nodeValue.length?(u--,h=1):e<0?u--:f++,zi(on(qe(i,u,f),h),h<0)}if(!n.state.doc.resolve(t-(o||0)).parent.inlineContent){if(o==null&&s&&(e<0||s==xe(i))){let u=i.childNodes[s-1];if(u.nodeType==1)return So(u.getBoundingClientRect(),!1)}if(o==null&&s<xe(i)){let u=i.childNodes[s];if(u.nodeType==1)return So(u.getBoundingClientRect(),!0)}return So(i.getBoundingClientRect(),e>=0)}if(o==null&&s&&(e<0||s==xe(i))){let u=i.childNodes[s-1],f=u.nodeType==3?qe(u,xe(u)-(a?0:1)):u.nodeType==1&&(u.nodeName!="BR"||!u.nextSibling)?u:null;if(f)return zi(on(f,1),!1)}if(o==null&&s<xe(i)){let u=i.childNodes[s];for(;u.pmViewDesc&&u.pmViewDesc.ignoreForCoords;)u=u.nextSibling;let f=u?u.nodeType==3?qe(u,0,a?0:1):u.nodeType==1?u:null:null;if(f)return zi(on(f,-1),!0)}return zi(on(i.nodeType==3?qe(i):i,-e),e>=0)}function zi(n,t){if(n.width==0)return n;let e=t?n.left:n.right;return{top:n.top,bottom:n.bottom,left:e,right:e}}function So(n,t){if(n.height==0)return n;let e=t?n.top:n.bottom;return{top:e,bottom:e,left:n.left,right:n.right}}function Hd(n,t,e){let i=n.state,s=n.root.activeElement;i!=t&&n.updateState(t),s!=n.dom&&n.focus();try{return e()}finally{i!=t&&n.updateState(i),s!=n.dom&&s&&s.focus()}}function F_(n,t,e){let i=t.selection,s=e=="up"?i.$from:i.$to;return Hd(n,t,()=>{let{node:o}=n.docView.domFromPos(s.pos,e=="up"?-1:1);for(;;){let c=n.docView.nearestDesc(o,!0);if(!c)break;if(c.node.isBlock){o=c.contentDOM||c.dom;break}o=c.dom.parentNode}let a=Vd(n,s.pos,1);for(let c=o.firstChild;c;c=c.nextSibling){let u;if(c.nodeType==1)u=c.getClientRects();else if(c.nodeType==3)u=qe(c,0,c.nodeValue.length).getClientRects();else continue;for(let f=0;f<u.length;f++){let h=u[f];if(h.bottom>h.top+1&&(e=="up"?a.top-h.top>(h.bottom-a.top)*2:h.bottom-a.bottom>(a.bottom-h.top)*2))return!1}}return!0})}const V_=/[\u0590-\u08ac]/;function H_(n,t,e){let{$head:i}=t.selection;if(!i.parent.isTextblock)return!1;let s=i.parentOffset,o=!s,a=s==i.parent.content.size,c=n.domSelection();return c?!V_.test(i.parent.textContent)||!c.modify?e=="left"||e=="backward"?o:a:Hd(n,t,()=>{let{focusNode:u,focusOffset:f,anchorNode:h,anchorOffset:m}=n.domSelectionRange(),g=c.caretBidiLevel;c.modify("move",e,"character");let y=i.depth?n.docView.domAfterPos(i.before()):n.dom,{focusNode:v,focusOffset:b}=n.domSelectionRange(),S=v&&!y.contains(v.nodeType==1?v:v.parentNode)||u==v&&f==b;try{c.collapse(h,m),u&&(u!=h||f!=m)&&c.extend&&c.extend(u,f)}catch{}return g!=null&&(c.caretBidiLevel=g),S}):i.pos==i.start()||i.pos==i.end()}let Zc=null,Wc=null,jc=!1;function Z_(n,t,e){return Zc==t&&Wc==e?jc:(Zc=t,Wc=e,jc=e=="up"||e=="down"?F_(n,t,e):H_(n,t,e))}const we=0,Uc=1,En=2,Be=3;class or{constructor(t,e,i,s){this.parent=t,this.children=e,this.dom=i,this.contentDOM=s,this.dirty=we,i.pmViewDesc=this}matchesWidget(t){return!1}matchesMark(t){return!1}matchesNode(t,e,i){return!1}matchesHack(t){return!1}parseRule(){return null}stopEvent(t){return!1}get size(){let t=0;for(let e=0;e<this.children.length;e++)t+=this.children[e].size;return t}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let t=0;t<this.children.length;t++)this.children[t].destroy()}posBeforeChild(t){for(let e=0,i=this.posAtStart;;e++){let s=this.children[e];if(s==t)return i;i+=s.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(t,e,i){if(this.contentDOM&&this.contentDOM.contains(t.nodeType==1?t:t.parentNode))if(i<0){let o,a;if(t==this.contentDOM)o=t.childNodes[e-1];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;o=t.previousSibling}for(;o&&!((a=o.pmViewDesc)&&a.parent==this);)o=o.previousSibling;return o?this.posBeforeChild(a)+a.size:this.posAtStart}else{let o,a;if(t==this.contentDOM)o=t.childNodes[e];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;o=t.nextSibling}for(;o&&!((a=o.pmViewDesc)&&a.parent==this);)o=o.nextSibling;return o?this.posBeforeChild(a):this.posAtEnd}let s;if(t==this.dom&&this.contentDOM)s=e>Jt(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))s=t.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(e==0)for(let o=t;;o=o.parentNode){if(o==this.dom){s=!1;break}if(o.previousSibling)break}if(s==null&&e==t.childNodes.length)for(let o=t;;o=o.parentNode){if(o==this.dom){s=!0;break}if(o.nextSibling)break}}return s??i>0?this.posAtEnd:this.posAtStart}nearestDesc(t,e=!1){for(let i=!0,s=t;s;s=s.parentNode){let o=this.getDesc(s),a;if(o&&(!e||o.node))if(i&&(a=o.nodeDOM)&&!(a.nodeType==1?a.contains(t.nodeType==1?t:t.parentNode):a==t))i=!1;else return o}}getDesc(t){let e=t.pmViewDesc;for(let i=e;i;i=i.parent)if(i==this)return e}posFromDOM(t,e,i){for(let s=t;s;s=s.parentNode){let o=this.getDesc(s);if(o)return o.localPosFromDOM(t,e,i)}return-1}descAt(t){for(let e=0,i=0;e<this.children.length;e++){let s=this.children[e],o=i+s.size;if(i==t&&o!=i){for(;!s.border&&s.children.length;)for(let a=0;a<s.children.length;a++){let c=s.children[a];if(c.size){s=c;break}}return s}if(t<o)return s.descAt(t-i-s.border);i=o}}domFromPos(t,e){if(!this.contentDOM)return{node:this.dom,offset:0,atom:t+1};let i=0,s=0;for(let o=0;i<this.children.length;i++){let a=this.children[i],c=o+a.size;if(c>t||a instanceof Wd){s=t-o;break}o=c}if(s)return this.children[i].domFromPos(s-this.children[i].border,e);for(let o;i&&!(o=this.children[i-1]).size&&o instanceof Zd&&o.side>=0;i--);if(e<=0){let o,a=!0;for(;o=i?this.children[i-1]:null,!(!o||o.dom.parentNode==this.contentDOM);i--,a=!1);return o&&e&&a&&!o.border&&!o.domAtom?o.domFromPos(o.size,e):{node:this.contentDOM,offset:o?Jt(o.dom)+1:0}}else{let o,a=!0;for(;o=i<this.children.length?this.children[i]:null,!(!o||o.dom.parentNode==this.contentDOM);i++,a=!1);return o&&a&&!o.border&&!o.domAtom?o.domFromPos(0,e):{node:this.contentDOM,offset:o?Jt(o.dom):this.contentDOM.childNodes.length}}}parseRange(t,e,i=0){if(this.children.length==0)return{node:this.contentDOM,from:t,to:e,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let s=-1,o=-1;for(let a=i,c=0;;c++){let u=this.children[c],f=a+u.size;if(s==-1&&t<=f){let h=a+u.border;if(t>=h&&e<=f-u.border&&u.node&&u.contentDOM&&this.contentDOM.contains(u.contentDOM))return u.parseRange(t,e,h);t=a;for(let m=c;m>0;m--){let g=this.children[m-1];if(g.size&&g.dom.parentNode==this.contentDOM&&!g.emptyChildAt(1)){s=Jt(g.dom)+1;break}t-=g.size}s==-1&&(s=0)}if(s>-1&&(f>e||c==this.children.length-1)){e=f;for(let h=c+1;h<this.children.length;h++){let m=this.children[h];if(m.size&&m.dom.parentNode==this.contentDOM&&!m.emptyChildAt(-1)){o=Jt(m.dom);break}e+=m.size}o==-1&&(o=this.contentDOM.childNodes.length);break}a=f}return{node:this.contentDOM,from:t,to:e,fromOffset:s,toOffset:o}}emptyChildAt(t){if(this.border||!this.contentDOM||!this.children.length)return!1;let e=this.children[t<0?0:this.children.length-1];return e.size==0||e.emptyChildAt(t)}domAfterPos(t){let{node:e,offset:i}=this.domFromPos(t,0);if(e.nodeType!=1||i==e.childNodes.length)throw new RangeError("No node after pos "+t);return e.childNodes[i]}setSelection(t,e,i,s=!1){let o=Math.min(t,e),a=Math.max(t,e);for(let y=0,v=0;y<this.children.length;y++){let b=this.children[y],S=v+b.size;if(o>v&&a<S)return b.setSelection(t-v-b.border,e-v-b.border,i,s);v=S}let c=this.domFromPos(t,t?-1:1),u=e==t?c:this.domFromPos(e,e?-1:1),f=i.root.getSelection(),h=i.domSelectionRange(),m=!1;if((Oe||re)&&t==e){let{node:y,offset:v}=c;if(y.nodeType==3){if(m=!!(v&&y.nodeValue[v-1]==`
`),m&&v==y.nodeValue.length)for(let b=y,S;b;b=b.parentNode){if(S=b.nextSibling){S.nodeName=="BR"&&(c=u={node:S.parentNode,offset:Jt(S)+1});break}let M=b.pmViewDesc;if(M&&M.node&&M.node.isBlock)break}}else{let b=y.childNodes[v-1];m=b&&(b.nodeName=="BR"||b.contentEditable=="false")}}if(Oe&&h.focusNode&&h.focusNode!=u.node&&h.focusNode.nodeType==1){let y=h.focusNode.childNodes[h.focusOffset];y&&y.contentEditable=="false"&&(s=!0)}if(!(s||m&&re)&&Fn(c.node,c.offset,h.anchorNode,h.anchorOffset)&&Fn(u.node,u.offset,h.focusNode,h.focusOffset))return;let g=!1;if((f.extend||t==e)&&!m){f.collapse(c.node,c.offset);try{t!=e&&f.extend(u.node,u.offset),g=!0}catch{}}if(!g){if(t>e){let v=c;c=u,u=v}let y=document.createRange();y.setEnd(u.node,u.offset),y.setStart(c.node,c.offset),f.removeAllRanges(),f.addRange(y)}}ignoreMutation(t){return!this.contentDOM&&t.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(t,e){for(let i=0,s=0;s<this.children.length;s++){let o=this.children[s],a=i+o.size;if(i==a?t<=a&&e>=i:t<a&&e>i){let c=i+o.border,u=a-o.border;if(t>=c&&e<=u){this.dirty=t==i||e==a?En:Uc,t==c&&e==u&&(o.contentLost||o.dom.parentNode!=this.contentDOM)?o.dirty=Be:o.markDirty(t-c,e-c);return}else o.dirty=o.dom==o.contentDOM&&o.dom.parentNode==this.contentDOM&&!o.children.length?En:Be}i=a}this.dirty=En}markParentsDirty(){let t=1;for(let e=this.parent;e;e=e.parent,t++){let i=t==1?En:Uc;e.dirty<i&&(e.dirty=i)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(t){return!1}}class Zd extends or{constructor(t,e,i,s){let o,a=e.type.toDOM;if(typeof a=="function"&&(a=a(i,()=>{if(!o)return s;if(o.parent)return o.parent.posBeforeChild(o)})),!e.type.spec.raw){if(a.nodeType!=1){let c=document.createElement("span");c.appendChild(a),a=c}a.contentEditable="false",a.classList.add("ProseMirror-widget")}super(t,[],a,null),this.widget=e,this.widget=e,o=this}matchesWidget(t){return this.dirty==we&&t.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(t){let e=this.widget.spec.stopEvent;return e?e(t):!1}ignoreMutation(t){return t.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class W_ extends or{constructor(t,e,i,s){super(t,[],e,null),this.textDOM=i,this.text=s}get size(){return this.text.length}localPosFromDOM(t,e){return t!=this.textDOM?this.posAtStart+(e?this.size:0):this.posAtStart+e}domFromPos(t){return{node:this.textDOM,offset:t}}ignoreMutation(t){return t.type==="characterData"&&t.target.nodeValue==t.oldValue}}class Vn extends or{constructor(t,e,i,s,o){super(t,[],i,s),this.mark=e,this.spec=o}static create(t,e,i,s){let o=s.nodeViews[e.type.name],a=o&&o(e,s,i);return(!a||!a.dom)&&(a=Hn.renderSpec(document,e.type.spec.toDOM(e,i),null,e.attrs)),new Vn(t,e,a.dom,a.contentDOM||a.dom,a)}parseRule(){return this.dirty&Be||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(t){return this.dirty!=Be&&this.mark.eq(t)}markDirty(t,e){if(super.markDirty(t,e),this.dirty!=we){let i=this.parent;for(;!i.node;)i=i.parent;i.dirty<this.dirty&&(i.dirty=this.dirty),this.dirty=we}}slice(t,e,i){let s=Vn.create(this.parent,this.mark,!0,i),o=this.children,a=this.size;e<a&&(o=Ko(o,e,a,i)),t>0&&(o=Ko(o,0,t,i));for(let c=0;c<o.length;c++)o[c].parent=s;return s.children=o,s}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class pn extends or{constructor(t,e,i,s,o,a,c,u,f){super(t,[],o,a),this.node=e,this.outerDeco=i,this.innerDeco=s,this.nodeDOM=c}static create(t,e,i,s,o,a){let c=o.nodeViews[e.type.name],u,f=c&&c(e,o,()=>{if(!u)return a;if(u.parent)return u.parent.posBeforeChild(u)},i,s),h=f&&f.dom,m=f&&f.contentDOM;if(e.isText){if(!h)h=document.createTextNode(e.text);else if(h.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else h||({dom:h,contentDOM:m}=Hn.renderSpec(document,e.type.spec.toDOM(e),null,e.attrs));!m&&!e.isText&&h.nodeName!="BR"&&(h.hasAttribute("contenteditable")||(h.contentEditable="false"),e.type.spec.draggable&&(h.draggable=!0));let g=h;return h=qd(h,i,e),f?u=new j_(t,e,i,s,h,m||null,g,f,o,a+1):e.isText?new ws(t,e,i,s,h,g,o):new pn(t,e,i,s,h,m||null,g,o,a+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let t={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(t.preserveWhitespace="full"),!this.contentDOM)t.getContent=()=>this.node.content;else if(!this.contentLost)t.contentElement=this.contentDOM;else{for(let e=this.children.length-1;e>=0;e--){let i=this.children[e];if(this.dom.contains(i.dom.parentNode)){t.contentElement=i.dom.parentNode;break}}t.contentElement||(t.getContent=()=>z.empty)}return t}matchesNode(t,e,i){return this.dirty==we&&t.eq(this.node)&&Kr(e,this.outerDeco)&&i.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(t,e){let i=this.node.inlineContent,s=e,o=t.composing?this.localCompositionInfo(t,e):null,a=o&&o.pos>-1?o:null,c=o&&o.pos<0,u=new q_(this,a&&a.node,t);G_(this.node,this.innerDeco,(f,h,m)=>{f.spec.marks?u.syncToMarks(f.spec.marks,i,t):f.type.side>=0&&!m&&u.syncToMarks(h==this.node.childCount?yt.none:this.node.child(h).marks,i,t),u.placeWidget(f,t,s)},(f,h,m,g)=>{u.syncToMarks(f.marks,i,t);let y;u.findNodeMatch(f,h,m,g)||c&&t.state.selection.from>s&&t.state.selection.to<s+f.nodeSize&&(y=u.findIndexWithChild(o.node))>-1&&u.updateNodeAt(f,h,m,y,t)||u.updateNextNode(f,h,m,t,g,s)||u.addNode(f,h,m,t,s),s+=f.nodeSize}),u.syncToMarks([],i,t),this.node.isTextblock&&u.addTextblockHacks(),u.destroyRest(),(u.changed||this.dirty==En)&&(a&&this.protectLocalComposition(t,a),jd(this.contentDOM,this.children,t),di&&Y_(this.dom))}localCompositionInfo(t,e){let{from:i,to:s}=t.state.selection;if(!(t.state.selection instanceof X)||i<e||s>e+this.node.content.size)return null;let o=t.input.compositionNode;if(!o||!this.dom.contains(o.parentNode))return null;if(this.node.inlineContent){let a=o.nodeValue,c=X_(this.node.content,a,i-e,s-e);return c<0?null:{node:o,pos:c,text:a}}else return{node:o,pos:-1,text:""}}protectLocalComposition(t,{node:e,pos:i,text:s}){if(this.getDesc(e))return;let o=e;for(;o.parentNode!=this.contentDOM;o=o.parentNode){for(;o.previousSibling;)o.parentNode.removeChild(o.previousSibling);for(;o.nextSibling;)o.parentNode.removeChild(o.nextSibling);o.pmViewDesc&&(o.pmViewDesc=void 0)}let a=new W_(this,o,e,s);t.input.compositionNodes.push(a),this.children=Ko(this.children,i,i+s.length,t,a)}update(t,e,i,s){return this.dirty==Be||!t.sameMarkup(this.node)?!1:(this.updateInner(t,e,i,s),!0)}updateInner(t,e,i,s){this.updateOuterDeco(e),this.node=t,this.innerDeco=i,this.contentDOM&&this.updateChildren(s,this.posAtStart),this.dirty=we}updateOuterDeco(t){if(Kr(t,this.outerDeco))return;let e=this.nodeDOM.nodeType!=1,i=this.dom;this.dom=Ud(this.dom,this.nodeDOM,qo(this.outerDeco,this.node,e),qo(t,this.node,e)),this.dom!=i&&(i.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=t}selectNode(){this.nodeDOM.nodeType==1&&this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function qc(n,t,e,i,s){qd(i,t,n);let o=new pn(void 0,n,t,e,i,i,i,s,0);return o.contentDOM&&o.updateChildren(s,0),o}class ws extends pn{constructor(t,e,i,s,o,a,c){super(t,e,i,s,o,null,a,c,0)}parseRule(){let t=this.nodeDOM.parentNode;for(;t&&t!=this.dom&&!t.pmIsDeco;)t=t.parentNode;return{skip:t||!0}}update(t,e,i,s){return this.dirty==Be||this.dirty!=we&&!this.inParent()||!t.sameMarkup(this.node)?!1:(this.updateOuterDeco(e),(this.dirty!=we||t.text!=this.node.text)&&t.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=t.text,s.trackWrites==this.nodeDOM&&(s.trackWrites=null)),this.node=t,this.dirty=we,!0)}inParent(){let t=this.parent.contentDOM;for(let e=this.nodeDOM;e;e=e.parentNode)if(e==t)return!0;return!1}domFromPos(t){return{node:this.nodeDOM,offset:t}}localPosFromDOM(t,e,i){return t==this.nodeDOM?this.posAtStart+Math.min(e,this.node.text.length):super.localPosFromDOM(t,e,i)}ignoreMutation(t){return t.type!="characterData"&&t.type!="selection"}slice(t,e,i){let s=this.node.cut(t,e),o=document.createTextNode(s.text);return new ws(this.parent,s,this.outerDeco,this.innerDeco,o,o,i)}markDirty(t,e){super.markDirty(t,e),this.dom!=this.nodeDOM&&(t==0||e==this.nodeDOM.nodeValue.length)&&(this.dirty=Be)}get domAtom(){return!1}isText(t){return this.node.text==t}}class Wd extends or{parseRule(){return{ignore:!0}}matchesHack(t){return this.dirty==we&&this.dom.nodeName==t}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class j_ extends pn{constructor(t,e,i,s,o,a,c,u,f,h){super(t,e,i,s,o,a,c,f,h),this.spec=u}update(t,e,i,s){if(this.dirty==Be)return!1;if(this.spec.update&&(this.node.type==t.type||this.spec.multiType)){let o=this.spec.update(t,e,i);return o&&this.updateInner(t,e,i,s),o}else return!this.contentDOM&&!t.isLeaf?!1:super.update(t,e,i,s)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(t,e,i,s){this.spec.setSelection?this.spec.setSelection(t,e,i.root):super.setSelection(t,e,i,s)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(t){return this.spec.stopEvent?this.spec.stopEvent(t):!1}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}}function jd(n,t,e){let i=n.firstChild,s=!1;for(let o=0;o<t.length;o++){let a=t[o],c=a.dom;if(c.parentNode==n){for(;c!=i;)i=Kc(i),s=!0;i=i.nextSibling}else s=!0,n.insertBefore(c,i);if(a instanceof Vn){let u=i?i.previousSibling:n.lastChild;jd(a.contentDOM,a.children,e),i=u?u.nextSibling:n.firstChild}}for(;i;)i=Kc(i),s=!0;s&&e.trackWrites==n&&(e.trackWrites=null)}const Zi=function(n){n&&(this.nodeName=n)};Zi.prototype=Object.create(null);const On=[new Zi];function qo(n,t,e){if(n.length==0)return On;let i=e?On[0]:new Zi,s=[i];for(let o=0;o<n.length;o++){let a=n[o].type.attrs;if(a){a.nodeName&&s.push(i=new Zi(a.nodeName));for(let c in a){let u=a[c];u!=null&&(e&&s.length==1&&s.push(i=new Zi(t.isInline?"span":"div")),c=="class"?i.class=(i.class?i.class+" ":"")+u:c=="style"?i.style=(i.style?i.style+";":"")+u:c!="nodeName"&&(i[c]=u))}}}return s}function Ud(n,t,e,i){if(e==On&&i==On)return t;let s=t;for(let o=0;o<i.length;o++){let a=i[o],c=e[o];if(o){let u;c&&c.nodeName==a.nodeName&&s!=n&&(u=s.parentNode)&&u.nodeName.toLowerCase()==a.nodeName||(u=document.createElement(a.nodeName),u.pmIsDeco=!0,u.appendChild(s),c=On[0]),s=u}U_(s,c||On[0],a)}return s}function U_(n,t,e){for(let i in t)i!="class"&&i!="style"&&i!="nodeName"&&!(i in e)&&n.removeAttribute(i);for(let i in e)i!="class"&&i!="style"&&i!="nodeName"&&e[i]!=t[i]&&n.setAttribute(i,e[i]);if(t.class!=e.class){let i=t.class?t.class.split(" ").filter(Boolean):[],s=e.class?e.class.split(" ").filter(Boolean):[];for(let o=0;o<i.length;o++)s.indexOf(i[o])==-1&&n.classList.remove(i[o]);for(let o=0;o<s.length;o++)i.indexOf(s[o])==-1&&n.classList.add(s[o]);n.classList.length==0&&n.removeAttribute("class")}if(t.style!=e.style){if(t.style){let i=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,s;for(;s=i.exec(t.style);)n.style.removeProperty(s[1])}e.style&&(n.style.cssText+=e.style)}}function qd(n,t,e){return Ud(n,n,On,qo(t,e,n.nodeType!=1))}function Kr(n,t){if(n.length!=t.length)return!1;for(let e=0;e<n.length;e++)if(!n[e].type.eq(t[e].type))return!1;return!0}function Kc(n){let t=n.nextSibling;return n.parentNode.removeChild(n),t}class q_{constructor(t,e,i){this.lock=e,this.view=i,this.index=0,this.stack=[],this.changed=!1,this.top=t,this.preMatch=K_(t.node.content,t)}destroyBetween(t,e){if(t!=e){for(let i=t;i<e;i++)this.top.children[i].destroy();this.top.children.splice(t,e-t),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(t,e,i){let s=0,o=this.stack.length>>1,a=Math.min(o,t.length);for(;s<a&&(s==o-1?this.top:this.stack[s+1<<1]).matchesMark(t[s])&&t[s].type.spec.spanning!==!1;)s++;for(;s<o;)this.destroyRest(),this.top.dirty=we,this.index=this.stack.pop(),this.top=this.stack.pop(),o--;for(;o<t.length;){this.stack.push(this.top,this.index+1);let c=-1;for(let u=this.index;u<Math.min(this.index+3,this.top.children.length);u++){let f=this.top.children[u];if(f.matchesMark(t[o])&&!this.isLocked(f.dom)){c=u;break}}if(c>-1)c>this.index&&(this.changed=!0,this.destroyBetween(this.index,c)),this.top=this.top.children[this.index];else{let u=Vn.create(this.top,t[o],e,i);this.top.children.splice(this.index,0,u),this.top=u,this.changed=!0}this.index=0,o++}}findNodeMatch(t,e,i,s){let o=-1,a;if(s>=this.preMatch.index&&(a=this.preMatch.matches[s-this.preMatch.index]).parent==this.top&&a.matchesNode(t,e,i))o=this.top.children.indexOf(a,this.index);else for(let c=this.index,u=Math.min(this.top.children.length,c+5);c<u;c++){let f=this.top.children[c];if(f.matchesNode(t,e,i)&&!this.preMatch.matched.has(f)){o=c;break}}return o<0?!1:(this.destroyBetween(this.index,o),this.index++,!0)}updateNodeAt(t,e,i,s,o){let a=this.top.children[s];return a.dirty==Be&&a.dom==a.contentDOM&&(a.dirty=En),a.update(t,e,i,o)?(this.destroyBetween(this.index,s),this.index++,!0):!1}findIndexWithChild(t){for(;;){let e=t.parentNode;if(!e)return-1;if(e==this.top.contentDOM){let i=t.pmViewDesc;if(i){for(let s=this.index;s<this.top.children.length;s++)if(this.top.children[s]==i)return s}return-1}t=e}}updateNextNode(t,e,i,s,o,a){for(let c=this.index;c<this.top.children.length;c++){let u=this.top.children[c];if(u instanceof pn){let f=this.preMatch.matched.get(u);if(f!=null&&f!=o)return!1;let h=u.dom,m,g=this.isLocked(h)&&!(t.isText&&u.node&&u.node.isText&&u.nodeDOM.nodeValue==t.text&&u.dirty!=Be&&Kr(e,u.outerDeco));if(!g&&u.update(t,e,i,s))return this.destroyBetween(this.index,c),u.dom!=h&&(this.changed=!0),this.index++,!0;if(!g&&(m=this.recreateWrapper(u,t,e,i,s,a)))return this.destroyBetween(this.index,c),this.top.children[this.index]=m,m.contentDOM&&(m.dirty=En,m.updateChildren(s,a+1),m.dirty=we),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(t,e,i,s,o,a){if(t.dirty||e.isAtom||!t.children.length||!t.node.content.eq(e.content)||!Kr(i,t.outerDeco)||!s.eq(t.innerDeco))return null;let c=pn.create(this.top,e,i,s,o,a);if(c.contentDOM){c.children=t.children,t.children=[];for(let u of c.children)u.parent=c}return t.destroy(),c}addNode(t,e,i,s,o){let a=pn.create(this.top,t,e,i,s,o);a.contentDOM&&a.updateChildren(s,o+1),this.top.children.splice(this.index++,0,a),this.changed=!0}placeWidget(t,e,i){let s=this.index<this.top.children.length?this.top.children[this.index]:null;if(s&&s.matchesWidget(t)&&(t==s.widget||!s.widget.type.toDOM.parentNode))this.index++;else{let o=new Zd(this.top,t,e,i);this.top.children.splice(this.index++,0,o),this.changed=!0}}addTextblockHacks(){let t=this.top.children[this.index-1],e=this.top;for(;t instanceof Vn;)e=t,t=e.children[e.children.length-1];(!t||!(t instanceof ws)||/\n$/.test(t.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(t.node.text))&&((re||Qt)&&t&&t.dom.contentEditable=="false"&&this.addHackNode("IMG",e),this.addHackNode("BR",this.top))}addHackNode(t,e){if(e==this.top&&this.index<e.children.length&&e.children[this.index].matchesHack(t))this.index++;else{let i=document.createElement(t);t=="IMG"&&(i.className="ProseMirror-separator",i.alt=""),t=="BR"&&(i.className="ProseMirror-trailingBreak");let s=new Wd(this.top,[],i,null);e!=this.top?e.children.push(s):e.children.splice(this.index++,0,s),this.changed=!0}}isLocked(t){return this.lock&&(t==this.lock||t.nodeType==1&&t.contains(this.lock.parentNode))}}function K_(n,t){let e=t,i=e.children.length,s=n.childCount,o=new Map,a=[];t:for(;s>0;){let c;for(;;)if(i){let f=e.children[i-1];if(f instanceof Vn)e=f,i=f.children.length;else{c=f,i--;break}}else{if(e==t)break t;i=e.parent.children.indexOf(e),e=e.parent}let u=c.node;if(u){if(u!=n.child(s-1))break;--s,o.set(c,s),a.push(c)}}return{index:s,matched:o,matches:a.reverse()}}function J_(n,t){return n.type.side-t.type.side}function G_(n,t,e,i){let s=t.locals(n),o=0;if(s.length==0){for(let f=0;f<n.childCount;f++){let h=n.child(f);i(h,s,t.forChild(o,h),f),o+=h.nodeSize}return}let a=0,c=[],u=null;for(let f=0;;){let h,m;for(;a<s.length&&s[a].to==o;){let S=s[a++];S.widget&&(h?(m||(m=[h])).push(S):h=S)}if(h)if(m){m.sort(J_);for(let S=0;S<m.length;S++)e(m[S],f,!!u)}else e(h,f,!!u);let g,y;if(u)y=-1,g=u,u=null;else if(f<n.childCount)y=f,g=n.child(f++);else break;for(let S=0;S<c.length;S++)c[S].to<=o&&c.splice(S--,1);for(;a<s.length&&s[a].from<=o&&s[a].to>o;)c.push(s[a++]);let v=o+g.nodeSize;if(g.isText){let S=v;a<s.length&&s[a].from<S&&(S=s[a].from);for(let M=0;M<c.length;M++)c[M].to<S&&(S=c[M].to);S<v&&(u=g.cut(S-o),g=g.cut(0,S-o),v=S,y=-1)}else for(;a<s.length&&s[a].to<v;)a++;let b=g.isInline&&!g.isLeaf?c.filter(S=>!S.inline):c.slice();i(g,b,t.forChild(o,g),y),o=v}}function Y_(n){if(n.nodeName=="UL"||n.nodeName=="OL"){let t=n.style.cssText;n.style.cssText=t+"; list-style: square !important",window.getComputedStyle(n).listStyle,n.style.cssText=t}}function X_(n,t,e,i){for(let s=0,o=0;s<n.childCount&&o<=i;){let a=n.child(s++),c=o;if(o+=a.nodeSize,!a.isText)continue;let u=a.text;for(;s<n.childCount;){let f=n.child(s++);if(o+=f.nodeSize,!f.isText)break;u+=f.text}if(o>=e){if(o>=i&&u.slice(i-t.length-c,i-c)==t)return i-t.length;let f=c<i?u.lastIndexOf(t,i-c-1):-1;if(f>=0&&f+t.length+c>=e)return c+f;if(e==i&&u.length>=i+t.length-c&&u.slice(i-c,i-c+t.length)==t)return i}}return-1}function Ko(n,t,e,i,s){let o=[];for(let a=0,c=0;a<n.length;a++){let u=n[a],f=c,h=c+=u.size;f>=e||h<=t?o.push(u):(f<t&&o.push(u.slice(0,t-f,i)),s&&(o.push(s),s=void 0),h>e&&o.push(u.slice(e-f,u.size,i)))}return o}function Ta(n,t=null){let e=n.domSelectionRange(),i=n.state.doc;if(!e.focusNode)return null;let s=n.docView.nearestDesc(e.focusNode),o=s&&s.size==0,a=n.docView.posFromDOM(e.focusNode,e.focusOffset,1);if(a<0)return null;let c=i.resolve(a),u,f;if(ks(e)){for(u=a;s&&!s.node;)s=s.parent;let m=s.node;if(s&&m.isAtom&&Y.isSelectable(m)&&s.parent&&!(m.isInline&&S_(e.focusNode,e.focusOffset,s.dom))){let g=s.posBefore;f=new Y(a==g?c:i.resolve(g))}}else{if(e instanceof n.dom.ownerDocument.defaultView.Selection&&e.rangeCount>1){let m=a,g=a;for(let y=0;y<e.rangeCount;y++){let v=e.getRangeAt(y);m=Math.min(m,n.docView.posFromDOM(v.startContainer,v.startOffset,1)),g=Math.max(g,n.docView.posFromDOM(v.endContainer,v.endOffset,-1))}if(m<0)return null;[u,a]=g==n.state.selection.anchor?[g,m]:[m,g],c=i.resolve(a)}else u=n.docView.posFromDOM(e.anchorNode,e.anchorOffset,1);if(u<0)return null}let h=i.resolve(u);if(!f){let m=t=="pointer"||n.state.selection.head<c.pos&&!o?1:-1;f=Pa(n,h,c,m)}return f}function Kd(n){return n.editable?n.hasFocus():Gd(n)&&document.activeElement&&document.activeElement.contains(n.dom)}function Je(n,t=!1){let e=n.state.selection;if(Jd(n,e),!!Kd(n)){if(!t&&n.input.mouseDown&&n.input.mouseDown.allowDefault&&Qt){let i=n.domSelectionRange(),s=n.domObserver.currentSelection;if(i.anchorNode&&s.anchorNode&&Fn(i.anchorNode,i.anchorOffset,s.anchorNode,s.anchorOffset)){n.input.mouseDown.delayedSelectionSync=!0,n.domObserver.setCurSelection();return}}if(n.domObserver.disconnectSelection(),n.cursorWrapper)ty(n);else{let{anchor:i,head:s}=e,o,a;Jc&&!(e instanceof X)&&(e.$from.parent.inlineContent||(o=Gc(n,e.from)),!e.empty&&!e.$from.parent.inlineContent&&(a=Gc(n,e.to))),n.docView.setSelection(i,s,n,t),Jc&&(o&&Yc(o),a&&Yc(a)),e.visible?n.dom.classList.remove("ProseMirror-hideselection"):(n.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&Q_(n))}n.domObserver.setCurSelection(),n.domObserver.connectSelection()}}const Jc=re||Qt&&zd<63;function Gc(n,t){let{node:e,offset:i}=n.docView.domFromPos(t,0),s=i<e.childNodes.length?e.childNodes[i]:null,o=i?e.childNodes[i-1]:null;if(re&&s&&s.contentEditable=="false")return Co(s);if((!s||s.contentEditable=="false")&&(!o||o.contentEditable=="false")){if(s)return Co(s);if(o)return Co(o)}}function Co(n){return n.contentEditable="true",re&&n.draggable&&(n.draggable=!1,n.wasDraggable=!0),n}function Yc(n){n.contentEditable="false",n.wasDraggable&&(n.draggable=!0,n.wasDraggable=null)}function Q_(n){let t=n.dom.ownerDocument;t.removeEventListener("selectionchange",n.input.hideSelectionGuard);let e=n.domSelectionRange(),i=e.anchorNode,s=e.anchorOffset;t.addEventListener("selectionchange",n.input.hideSelectionGuard=()=>{(e.anchorNode!=i||e.anchorOffset!=s)&&(t.removeEventListener("selectionchange",n.input.hideSelectionGuard),setTimeout(()=>{(!Kd(n)||n.state.selection.visible)&&n.dom.classList.remove("ProseMirror-hideselection")},20))})}function ty(n){let t=n.domSelection(),e=document.createRange();if(!t)return;let i=n.cursorWrapper.dom,s=i.nodeName=="IMG";s?e.setStart(i.parentNode,Jt(i)+1):e.setStart(i,0),e.collapse(!0),t.removeAllRanges(),t.addRange(e),!s&&!n.state.selection.visible&&de&&hn<=11&&(i.disabled=!0,i.disabled=!1)}function Jd(n,t){if(t instanceof Y){let e=n.docView.descAt(t.from);e!=n.lastSelectedViewDesc&&(Xc(n),e&&e.selectNode(),n.lastSelectedViewDesc=e)}else Xc(n)}function Xc(n){n.lastSelectedViewDesc&&(n.lastSelectedViewDesc.parent&&n.lastSelectedViewDesc.deselectNode(),n.lastSelectedViewDesc=void 0)}function Pa(n,t,e,i){return n.someProp("createSelectionBetween",s=>s(n,t,e))||X.between(t,e,i)}function Qc(n){return n.editable&&!n.hasFocus()?!1:Gd(n)}function Gd(n){let t=n.domSelectionRange();if(!t.anchorNode)return!1;try{return n.dom.contains(t.anchorNode.nodeType==3?t.anchorNode.parentNode:t.anchorNode)&&(n.editable||n.dom.contains(t.focusNode.nodeType==3?t.focusNode.parentNode:t.focusNode))}catch{return!1}}function ey(n){let t=n.docView.domFromPos(n.state.selection.anchor,0),e=n.domSelectionRange();return Fn(t.node,t.offset,e.anchorNode,e.anchorOffset)}function Jo(n,t){let{$anchor:e,$head:i}=n.selection,s=t>0?e.max(i):e.min(i),o=s.parent.inlineContent?s.depth?n.doc.resolve(t>0?s.after():s.before()):null:s;return o&&it.findFrom(o,t)}function an(n,t){return n.dispatch(n.state.tr.setSelection(t).scrollIntoView()),!0}function tu(n,t,e){let i=n.state.selection;if(i instanceof X)if(e.indexOf("s")>-1){let{$head:s}=i,o=s.textOffset?null:t<0?s.nodeBefore:s.nodeAfter;if(!o||o.isText||!o.isLeaf)return!1;let a=n.state.doc.resolve(s.pos+o.nodeSize*(t<0?-1:1));return an(n,new X(i.$anchor,a))}else if(i.empty){if(n.endOfTextblock(t>0?"forward":"backward")){let s=Jo(n.state,t);return s&&s instanceof Y?an(n,s):!1}else if(!(be&&e.indexOf("m")>-1)){let s=i.$head,o=s.textOffset?null:t<0?s.nodeBefore:s.nodeAfter,a;if(!o||o.isText)return!1;let c=t<0?s.pos-o.nodeSize:s.pos;return o.isAtom||(a=n.docView.descAt(c))&&!a.contentDOM?Y.isSelectable(o)?an(n,new Y(t<0?n.state.doc.resolve(s.pos-o.nodeSize):s)):sr?an(n,new X(n.state.doc.resolve(t<0?c:c+o.nodeSize))):!1:!1}}else return!1;else{if(i instanceof Y&&i.node.isInline)return an(n,new X(t>0?i.$to:i.$from));{let s=Jo(n.state,t);return s?an(n,s):!1}}}function Jr(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function Wi(n,t){let e=n.pmViewDesc;return e&&e.size==0&&(t<0||n.nextSibling||n.nodeName!="BR")}function ei(n,t){return t<0?ny(n):iy(n)}function ny(n){let t=n.domSelectionRange(),e=t.focusNode,i=t.focusOffset;if(!e)return;let s,o,a=!1;for(Oe&&e.nodeType==1&&i<Jr(e)&&Wi(e.childNodes[i],-1)&&(a=!0);;)if(i>0){if(e.nodeType!=1)break;{let c=e.childNodes[i-1];if(Wi(c,-1))s=e,o=--i;else if(c.nodeType==3)e=c,i=e.nodeValue.length;else break}}else{if(Yd(e))break;{let c=e.previousSibling;for(;c&&Wi(c,-1);)s=e.parentNode,o=Jt(c),c=c.previousSibling;if(c)e=c,i=Jr(e);else{if(e=e.parentNode,e==n.dom)break;i=0}}}a?Go(n,e,i):s&&Go(n,s,o)}function iy(n){let t=n.domSelectionRange(),e=t.focusNode,i=t.focusOffset;if(!e)return;let s=Jr(e),o,a;for(;;)if(i<s){if(e.nodeType!=1)break;let c=e.childNodes[i];if(Wi(c,1))o=e,a=++i;else break}else{if(Yd(e))break;{let c=e.nextSibling;for(;c&&Wi(c,1);)o=c.parentNode,a=Jt(c)+1,c=c.nextSibling;if(c)e=c,i=0,s=Jr(e);else{if(e=e.parentNode,e==n.dom)break;i=s=0}}}o&&Go(n,o,a)}function Yd(n){let t=n.pmViewDesc;return t&&t.node&&t.node.isBlock}function ry(n,t){for(;n&&t==n.childNodes.length&&!rr(n);)t=Jt(n)+1,n=n.parentNode;for(;n&&t<n.childNodes.length;){let e=n.childNodes[t];if(e.nodeType==3)return e;if(e.nodeType==1&&e.contentEditable=="false")break;n=e,t=0}}function sy(n,t){for(;n&&!t&&!rr(n);)t=Jt(n),n=n.parentNode;for(;n&&t;){let e=n.childNodes[t-1];if(e.nodeType==3)return e;if(e.nodeType==1&&e.contentEditable=="false")break;n=e,t=n.childNodes.length}}function Go(n,t,e){if(t.nodeType!=3){let o,a;(a=ry(t,e))?(t=a,e=0):(o=sy(t,e))&&(t=o,e=o.nodeValue.length)}let i=n.domSelection();if(!i)return;if(ks(i)){let o=document.createRange();o.setEnd(t,e),o.setStart(t,e),i.removeAllRanges(),i.addRange(o)}else i.extend&&i.extend(t,e);n.domObserver.setCurSelection();let{state:s}=n;setTimeout(()=>{n.state==s&&Je(n)},50)}function eu(n,t){let e=n.state.doc.resolve(t);if(!(Qt||T_)&&e.parent.inlineContent){let s=n.coordsAtPos(t);if(t>e.start()){let o=n.coordsAtPos(t-1),a=(o.top+o.bottom)/2;if(a>s.top&&a<s.bottom&&Math.abs(o.left-s.left)>1)return o.left<s.left?"ltr":"rtl"}if(t<e.end()){let o=n.coordsAtPos(t+1),a=(o.top+o.bottom)/2;if(a>s.top&&a<s.bottom&&Math.abs(o.left-s.left)>1)return o.left>s.left?"ltr":"rtl"}}return getComputedStyle(n.dom).direction=="rtl"?"rtl":"ltr"}function nu(n,t,e){let i=n.state.selection;if(i instanceof X&&!i.empty||e.indexOf("s")>-1||be&&e.indexOf("m")>-1)return!1;let{$from:s,$to:o}=i;if(!s.parent.inlineContent||n.endOfTextblock(t<0?"up":"down")){let a=Jo(n.state,t);if(a&&a instanceof Y)return an(n,a)}if(!s.parent.inlineContent){let a=t<0?s:o,c=i instanceof ue?it.near(a,t):it.findFrom(a,t);return c?an(n,c):!1}return!1}function iu(n,t){if(!(n.state.selection instanceof X))return!0;let{$head:e,$anchor:i,empty:s}=n.state.selection;if(!e.sameParent(i))return!0;if(!s)return!1;if(n.endOfTextblock(t>0?"forward":"backward"))return!0;let o=!e.textOffset&&(t<0?e.nodeBefore:e.nodeAfter);if(o&&!o.isText){let a=n.state.tr;return t<0?a.delete(e.pos-o.nodeSize,e.pos):a.delete(e.pos,e.pos+o.nodeSize),n.dispatch(a),!0}return!1}function ru(n,t,e){n.domObserver.stop(),t.contentEditable=e,n.domObserver.start()}function oy(n){if(!re||n.state.selection.$head.parentOffset>0)return!1;let{focusNode:t,focusOffset:e}=n.domSelectionRange();if(t&&t.nodeType==1&&e==0&&t.firstChild&&t.firstChild.contentEditable=="false"){let i=t.firstChild;ru(n,i,"true"),setTimeout(()=>ru(n,i,"false"),20)}return!1}function ay(n){let t="";return n.ctrlKey&&(t+="c"),n.metaKey&&(t+="m"),n.altKey&&(t+="a"),n.shiftKey&&(t+="s"),t}function ly(n,t){let e=t.keyCode,i=ay(t);if(e==8||be&&e==72&&i=="c")return iu(n,-1)||ei(n,-1);if(e==46&&!t.shiftKey||be&&e==68&&i=="c")return iu(n,1)||ei(n,1);if(e==13||e==27)return!0;if(e==37||be&&e==66&&i=="c"){let s=e==37?eu(n,n.state.selection.from)=="ltr"?-1:1:-1;return tu(n,s,i)||ei(n,s)}else if(e==39||be&&e==70&&i=="c"){let s=e==39?eu(n,n.state.selection.from)=="ltr"?1:-1:1;return tu(n,s,i)||ei(n,s)}else{if(e==38||be&&e==80&&i=="c")return nu(n,-1,i)||ei(n,-1);if(e==40||be&&e==78&&i=="c")return oy(n)||nu(n,1,i)||ei(n,1);if(i==(be?"m":"c")&&(e==66||e==73||e==89||e==90))return!0}return!1}function Ea(n,t){n.someProp("transformCopied",y=>{t=y(t,n)});let e=[],{content:i,openStart:s,openEnd:o}=t;for(;s>1&&o>1&&i.childCount==1&&i.firstChild.childCount==1;){s--,o--;let y=i.firstChild;e.push(y.type.name,y.attrs!=y.type.defaultAttrs?y.attrs:null),i=y.content}let a=n.someProp("clipboardSerializer")||Hn.fromSchema(n.state.schema),c=rf(),u=c.createElement("div");u.appendChild(a.serializeFragment(i,{document:c}));let f=u.firstChild,h,m=0;for(;f&&f.nodeType==1&&(h=nf[f.nodeName.toLowerCase()]);){for(let y=h.length-1;y>=0;y--){let v=c.createElement(h[y]);for(;u.firstChild;)v.appendChild(u.firstChild);u.appendChild(v),m++}f=u.firstChild}f&&f.nodeType==1&&f.setAttribute("data-pm-slice",`${s} ${o}${m?` -${m}`:""} ${JSON.stringify(e)}`);let g=n.someProp("clipboardTextSerializer",y=>y(t,n))||t.content.textBetween(0,t.content.size,`

`);return{dom:u,text:g,slice:t}}function Xd(n,t,e,i,s){let o=s.parent.type.spec.code,a,c;if(!e&&!t)return null;let u=t&&(i||o||!e);if(u){if(n.someProp("transformPastedText",g=>{t=g(t,o||i,n)}),o)return t?new F(z.from(n.state.schema.text(t.replace(/\r\n?/g,`
`))),0,0):F.empty;let m=n.someProp("clipboardTextParser",g=>g(t,s,i,n));if(m)c=m;else{let g=s.marks(),{schema:y}=n.state,v=Hn.fromSchema(y);a=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach(b=>{let S=a.appendChild(document.createElement("p"));b&&S.appendChild(v.serializeNode(y.text(b,g)))})}}else n.someProp("transformPastedHTML",m=>{e=m(e,n)}),a=fy(e),sr&&hy(a);let f=a&&a.querySelector("[data-pm-slice]"),h=f&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(f.getAttribute("data-pm-slice")||"");if(h&&h[3])for(let m=+h[3];m>0;m--){let g=a.firstChild;for(;g&&g.nodeType!=1;)g=g.nextSibling;if(!g)break;a=g}if(c||(c=(n.someProp("clipboardParser")||n.someProp("domParser")||Ee.fromSchema(n.state.schema)).parseSlice(a,{preserveWhitespace:!!(u||h),context:s,ruleFromNode(g){return g.nodeName=="BR"&&!g.nextSibling&&g.parentNode&&!cy.test(g.parentNode.nodeName)?{ignore:!0}:null}})),h)c=py(su(c,+h[1],+h[2]),h[4]);else if(c=F.maxOpen(uy(c.content,s),!0),c.openStart||c.openEnd){let m=0,g=0;for(let y=c.content.firstChild;m<c.openStart&&!y.type.spec.isolating;m++,y=y.firstChild);for(let y=c.content.lastChild;g<c.openEnd&&!y.type.spec.isolating;g++,y=y.lastChild);c=su(c,m,g)}return n.someProp("transformPasted",m=>{c=m(c,n)}),c}const cy=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function uy(n,t){if(n.childCount<2)return n;for(let e=t.depth;e>=0;e--){let s=t.node(e).contentMatchAt(t.index(e)),o,a=[];if(n.forEach(c=>{if(!a)return;let u=s.findWrapping(c.type),f;if(!u)return a=null;if(f=a.length&&o.length&&tf(u,o,c,a[a.length-1],0))a[a.length-1]=f;else{a.length&&(a[a.length-1]=ef(a[a.length-1],o.length));let h=Qd(c,u);a.push(h),s=s.matchType(h.type),o=u}}),a)return z.from(a)}return n}function Qd(n,t,e=0){for(let i=t.length-1;i>=e;i--)n=t[i].create(null,z.from(n));return n}function tf(n,t,e,i,s){if(s<n.length&&s<t.length&&n[s]==t[s]){let o=tf(n,t,e,i.lastChild,s+1);if(o)return i.copy(i.content.replaceChild(i.childCount-1,o));if(i.contentMatchAt(i.childCount).matchType(s==n.length-1?e.type:n[s+1]))return i.copy(i.content.append(z.from(Qd(e,n,s+1))))}}function ef(n,t){if(t==0)return n;let e=n.content.replaceChild(n.childCount-1,ef(n.lastChild,t-1)),i=n.contentMatchAt(n.childCount).fillBefore(z.empty,!0);return n.copy(e.append(i))}function Yo(n,t,e,i,s,o){let a=t<0?n.firstChild:n.lastChild,c=a.content;return n.childCount>1&&(o=0),s<i-1&&(c=Yo(c,t,e,i,s+1,o)),s>=e&&(c=t<0?a.contentMatchAt(0).fillBefore(c,o<=s).append(c):c.append(a.contentMatchAt(a.childCount).fillBefore(z.empty,!0))),n.replaceChild(t<0?0:n.childCount-1,a.copy(c))}function su(n,t,e){return t<n.openStart&&(n=new F(Yo(n.content,-1,t,n.openStart,0,n.openEnd),t,n.openEnd)),e<n.openEnd&&(n=new F(Yo(n.content,1,e,n.openEnd,0,0),n.openStart,e)),n}const nf={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let ou=null;function rf(){return ou||(ou=document.implementation.createHTMLDocument("title"))}let Mo=null;function dy(n){let t=window.trustedTypes;return t?(Mo||(Mo=t.defaultPolicy||t.createPolicy("ProseMirrorClipboard",{createHTML:e=>e})),Mo.createHTML(n)):n}function fy(n){let t=/^(\s*<meta [^>]*>)*/.exec(n);t&&(n=n.slice(t[0].length));let e=rf().createElement("div"),i=/<([a-z][^>\s]+)/i.exec(n),s;if((s=i&&nf[i[1].toLowerCase()])&&(n=s.map(o=>"<"+o+">").join("")+n+s.map(o=>"</"+o+">").reverse().join("")),e.innerHTML=dy(n),s)for(let o=0;o<s.length;o++)e=e.querySelector(s[o])||e;return e}function hy(n){let t=n.querySelectorAll(Qt?"span:not([class]):not([style])":"span.Apple-converted-space");for(let e=0;e<t.length;e++){let i=t[e];i.childNodes.length==1&&i.textContent==""&&i.parentNode&&i.parentNode.replaceChild(n.ownerDocument.createTextNode(" "),i)}}function py(n,t){if(!n.size)return n;let e=n.content.firstChild.type.schema,i;try{i=JSON.parse(t)}catch{return n}let{content:s,openStart:o,openEnd:a}=n;for(let c=i.length-2;c>=0;c-=2){let u=e.nodes[i[c]];if(!u||u.hasRequiredAttrs())break;s=z.from(u.create(i[c+1],s)),o++,a++}return new F(s,o,a)}const se={},oe={},my={touchstart:!0,touchmove:!0};class gy{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function _y(n){for(let t in se){let e=se[t];n.dom.addEventListener(t,n.input.eventHandlers[t]=i=>{vy(n,i)&&!Oa(n,i)&&(n.editable||!(i.type in oe))&&e(n,i)},my[t]?{passive:!0}:void 0)}re&&n.dom.addEventListener("input",()=>null),Xo(n)}function fn(n,t){n.input.lastSelectionOrigin=t,n.input.lastSelectionTime=Date.now()}function yy(n){n.domObserver.stop();for(let t in n.input.eventHandlers)n.dom.removeEventListener(t,n.input.eventHandlers[t]);clearTimeout(n.input.composingTimeout),clearTimeout(n.input.lastIOSEnterFallbackTimeout)}function Xo(n){n.someProp("handleDOMEvents",t=>{for(let e in t)n.input.eventHandlers[e]||n.dom.addEventListener(e,n.input.eventHandlers[e]=i=>Oa(n,i))})}function Oa(n,t){return n.someProp("handleDOMEvents",e=>{let i=e[t.type];return i?i(n,t)||t.defaultPrevented:!1})}function vy(n,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let e=t.target;e!=n.dom;e=e.parentNode)if(!e||e.nodeType==11||e.pmViewDesc&&e.pmViewDesc.stopEvent(t))return!1;return!0}function by(n,t){!Oa(n,t)&&se[t.type]&&(n.editable||!(t.type in oe))&&se[t.type](n,t)}oe.keydown=(n,t)=>{let e=t;if(n.input.shiftKey=e.keyCode==16||e.shiftKey,!of(n,e)&&(n.input.lastKeyCode=e.keyCode,n.input.lastKeyCodeTime=Date.now(),!(Ke&&Qt&&e.keyCode==13)))if(e.keyCode!=229&&n.domObserver.forceFlush(),di&&e.keyCode==13&&!e.ctrlKey&&!e.altKey&&!e.metaKey){let i=Date.now();n.input.lastIOSEnter=i,n.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{n.input.lastIOSEnter==i&&(n.someProp("handleKeyDown",s=>s(n,Tn(13,"Enter"))),n.input.lastIOSEnter=0)},200)}else n.someProp("handleKeyDown",i=>i(n,e))||ly(n,e)?e.preventDefault():fn(n,"key")};oe.keyup=(n,t)=>{t.keyCode==16&&(n.input.shiftKey=!1)};oe.keypress=(n,t)=>{let e=t;if(of(n,e)||!e.charCode||e.ctrlKey&&!e.altKey||be&&e.metaKey)return;if(n.someProp("handleKeyPress",s=>s(n,e))){e.preventDefault();return}let i=n.state.selection;if(!(i instanceof X)||!i.$from.sameParent(i.$to)){let s=String.fromCharCode(e.charCode),o=()=>n.state.tr.insertText(s).scrollIntoView();!/[\r\n]/.test(s)&&!n.someProp("handleTextInput",a=>a(n,i.$from.pos,i.$to.pos,s,o))&&n.dispatch(o()),e.preventDefault()}};function Ss(n){return{left:n.clientX,top:n.clientY}}function xy(n,t){let e=t.x-n.clientX,i=t.y-n.clientY;return e*e+i*i<100}function Aa(n,t,e,i,s){if(i==-1)return!1;let o=n.state.doc.resolve(i);for(let a=o.depth+1;a>0;a--)if(n.someProp(t,c=>a>o.depth?c(n,e,o.nodeAfter,o.before(a),s,!0):c(n,e,o.node(a),o.before(a),s,!1)))return!0;return!1}function li(n,t,e){if(n.focused||n.focus(),n.state.selection.eq(t))return;let i=n.state.tr.setSelection(t);i.setMeta("pointer",!0),n.dispatch(i)}function ky(n,t){if(t==-1)return!1;let e=n.state.doc.resolve(t),i=e.nodeAfter;return i&&i.isAtom&&Y.isSelectable(i)?(li(n,new Y(e)),!0):!1}function wy(n,t){if(t==-1)return!1;let e=n.state.selection,i,s;e instanceof Y&&(i=e.node);let o=n.state.doc.resolve(t);for(let a=o.depth+1;a>0;a--){let c=a>o.depth?o.nodeAfter:o.node(a);if(Y.isSelectable(c)){i&&e.$from.depth>0&&a>=e.$from.depth&&o.before(e.$from.depth+1)==e.$from.pos?s=o.before(e.$from.depth):s=o.before(a);break}}return s!=null?(li(n,Y.create(n.state.doc,s)),!0):!1}function Sy(n,t,e,i,s){return Aa(n,"handleClickOn",t,e,i)||n.someProp("handleClick",o=>o(n,t,i))||(s?wy(n,e):ky(n,e))}function Cy(n,t,e,i){return Aa(n,"handleDoubleClickOn",t,e,i)||n.someProp("handleDoubleClick",s=>s(n,t,i))}function My(n,t,e,i){return Aa(n,"handleTripleClickOn",t,e,i)||n.someProp("handleTripleClick",s=>s(n,t,i))||Ty(n,e,i)}function Ty(n,t,e){if(e.button!=0)return!1;let i=n.state.doc;if(t==-1)return i.inlineContent?(li(n,X.create(i,0,i.content.size)),!0):!1;let s=i.resolve(t);for(let o=s.depth+1;o>0;o--){let a=o>s.depth?s.nodeAfter:s.node(o),c=s.before(o);if(a.inlineContent)li(n,X.create(i,c+1,c+1+a.content.size));else if(Y.isSelectable(a))li(n,Y.create(i,c));else continue;return!0}}function La(n){return Gr(n)}const sf=be?"metaKey":"ctrlKey";se.mousedown=(n,t)=>{let e=t;n.input.shiftKey=e.shiftKey;let i=La(n),s=Date.now(),o="singleClick";s-n.input.lastClick.time<500&&xy(e,n.input.lastClick)&&!e[sf]&&n.input.lastClick.button==e.button&&(n.input.lastClick.type=="singleClick"?o="doubleClick":n.input.lastClick.type=="doubleClick"&&(o="tripleClick")),n.input.lastClick={time:s,x:e.clientX,y:e.clientY,type:o,button:e.button};let a=n.posAtCoords(Ss(e));a&&(o=="singleClick"?(n.input.mouseDown&&n.input.mouseDown.done(),n.input.mouseDown=new Py(n,a,e,!!i)):(o=="doubleClick"?Cy:My)(n,a.pos,a.inside,e)?e.preventDefault():fn(n,"pointer"))};class Py{constructor(t,e,i,s){this.view=t,this.pos=e,this.event=i,this.flushed=s,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=t.state.doc,this.selectNode=!!i[sf],this.allowDefault=i.shiftKey;let o,a;if(e.inside>-1)o=t.state.doc.nodeAt(e.inside),a=e.inside;else{let h=t.state.doc.resolve(e.pos);o=h.parent,a=h.depth?h.before():0}const c=s?null:i.target,u=c?t.docView.nearestDesc(c,!0):null;this.target=u&&u.dom.nodeType==1?u.dom:null;let{selection:f}=t.state;(i.button==0&&o.type.spec.draggable&&o.type.spec.selectable!==!1||f instanceof Y&&f.from<=a&&f.to>a)&&(this.mightDrag={node:o,pos:a,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Oe&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),fn(t,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Je(this.view)),this.view.input.mouseDown=null}up(t){if(this.done(),!this.view.dom.contains(t.target))return;let e=this.pos;this.view.state.doc!=this.startDoc&&(e=this.view.posAtCoords(Ss(t))),this.updateAllowDefault(t),this.allowDefault||!e?fn(this.view,"pointer"):Sy(this.view,e.pos,e.inside,t,this.selectNode)?t.preventDefault():t.button==0&&(this.flushed||re&&this.mightDrag&&!this.mightDrag.node.isAtom||Qt&&!this.view.state.selection.visible&&Math.min(Math.abs(e.pos-this.view.state.selection.from),Math.abs(e.pos-this.view.state.selection.to))<=2)?(li(this.view,it.near(this.view.state.doc.resolve(e.pos))),t.preventDefault()):fn(this.view,"pointer")}move(t){this.updateAllowDefault(t),fn(this.view,"pointer"),t.buttons==0&&this.done()}updateAllowDefault(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0)}}se.touchstart=n=>{n.input.lastTouch=Date.now(),La(n),fn(n,"pointer")};se.touchmove=n=>{n.input.lastTouch=Date.now(),fn(n,"pointer")};se.contextmenu=n=>La(n);function of(n,t){return n.composing?!0:re&&Math.abs(t.timeStamp-n.input.compositionEndedAt)<500?(n.input.compositionEndedAt=-2e8,!0):!1}const Ey=Ke?5e3:-1;oe.compositionstart=oe.compositionupdate=n=>{if(!n.composing){n.domObserver.flush();let{state:t}=n,e=t.selection.$to;if(t.selection instanceof X&&(t.storedMarks||!e.textOffset&&e.parentOffset&&e.nodeBefore.marks.some(i=>i.type.spec.inclusive===!1)))n.markCursor=n.state.storedMarks||e.marks(),Gr(n,!0),n.markCursor=null;else if(Gr(n,!t.selection.empty),Oe&&t.selection.empty&&e.parentOffset&&!e.textOffset&&e.nodeBefore.marks.length){let i=n.domSelectionRange();for(let s=i.focusNode,o=i.focusOffset;s&&s.nodeType==1&&o!=0;){let a=o<0?s.lastChild:s.childNodes[o-1];if(!a)break;if(a.nodeType==3){let c=n.domSelection();c&&c.collapse(a,a.nodeValue.length);break}else s=a,o=-1}}n.input.composing=!0}af(n,Ey)};oe.compositionend=(n,t)=>{n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=t.timeStamp,n.input.compositionPendingChanges=n.domObserver.pendingRecords().length?n.input.compositionID:0,n.input.compositionNode=null,n.input.compositionPendingChanges&&Promise.resolve().then(()=>n.domObserver.flush()),n.input.compositionID++,af(n,20))};function af(n,t){clearTimeout(n.input.composingTimeout),t>-1&&(n.input.composingTimeout=setTimeout(()=>Gr(n),t))}function lf(n){for(n.composing&&(n.input.composing=!1,n.input.compositionEndedAt=Ay());n.input.compositionNodes.length>0;)n.input.compositionNodes.pop().markParentsDirty()}function Oy(n){let t=n.domSelectionRange();if(!t.focusNode)return null;let e=k_(t.focusNode,t.focusOffset),i=w_(t.focusNode,t.focusOffset);if(e&&i&&e!=i){let s=i.pmViewDesc,o=n.domObserver.lastChangedTextNode;if(e==o||i==o)return o;if(!s||!s.isText(i.nodeValue))return i;if(n.input.compositionNode==i){let a=e.pmViewDesc;if(!(!a||!a.isText(e.nodeValue)))return i}}return e||i}function Ay(){let n=document.createEvent("Event");return n.initEvent("event",!0,!0),n.timeStamp}function Gr(n,t=!1){if(!(Ke&&n.domObserver.flushingSoon>=0)){if(n.domObserver.forceFlush(),lf(n),t||n.docView&&n.docView.dirty){let e=Ta(n),i=n.state.selection;return e&&!e.eq(i)?n.dispatch(n.state.tr.setSelection(e)):(n.markCursor||t)&&!i.$from.node(i.$from.sharedDepth(i.to)).inlineContent?n.dispatch(n.state.tr.deleteSelection()):n.updateState(n.state),!0}return!1}}function Ly(n,t){if(!n.dom.parentNode)return;let e=n.dom.parentNode.appendChild(document.createElement("div"));e.appendChild(t),e.style.cssText="position: fixed; left: -10000px; top: 10px";let i=getSelection(),s=document.createRange();s.selectNodeContents(t),n.dom.blur(),i.removeAllRanges(),i.addRange(s),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e),n.focus()},50)}const Ji=de&&hn<15||di&&P_<604;se.copy=oe.cut=(n,t)=>{let e=t,i=n.state.selection,s=e.type=="cut";if(i.empty)return;let o=Ji?null:e.clipboardData,a=i.content(),{dom:c,text:u}=Ea(n,a);o?(e.preventDefault(),o.clearData(),o.setData("text/html",c.innerHTML),o.setData("text/plain",u)):Ly(n,c),s&&n.dispatch(n.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function Iy(n){return n.openStart==0&&n.openEnd==0&&n.content.childCount==1?n.content.firstChild:null}function Ny(n,t){if(!n.dom.parentNode)return;let e=n.input.shiftKey||n.state.selection.$from.parent.type.spec.code,i=n.dom.parentNode.appendChild(document.createElement(e?"textarea":"div"));e||(i.contentEditable="true"),i.style.cssText="position: fixed; left: -10000px; top: 10px",i.focus();let s=n.input.shiftKey&&n.input.lastKeyCode!=45;setTimeout(()=>{n.focus(),i.parentNode&&i.parentNode.removeChild(i),e?Gi(n,i.value,null,s,t):Gi(n,i.textContent,i.innerHTML,s,t)},50)}function Gi(n,t,e,i,s){let o=Xd(n,t,e,i,n.state.selection.$from);if(n.someProp("handlePaste",u=>u(n,s,o||F.empty)))return!0;if(!o)return!1;let a=Iy(o),c=a?n.state.tr.replaceSelectionWith(a,i):n.state.tr.replaceSelection(o);return n.dispatch(c.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function cf(n){let t=n.getData("text/plain")||n.getData("Text");if(t)return t;let e=n.getData("text/uri-list");return e?e.replace(/\r?\n/g," "):""}oe.paste=(n,t)=>{let e=t;if(n.composing&&!Ke)return;let i=Ji?null:e.clipboardData,s=n.input.shiftKey&&n.input.lastKeyCode!=45;i&&Gi(n,cf(i),i.getData("text/html"),s,e)?e.preventDefault():Ny(n,e)};class uf{constructor(t,e,i){this.slice=t,this.move=e,this.node=i}}const Dy=be?"altKey":"ctrlKey";function df(n,t){let e=n.someProp("dragCopies",i=>!i(t));return e??!t[Dy]}se.dragstart=(n,t)=>{let e=t,i=n.input.mouseDown;if(i&&i.done(),!e.dataTransfer)return;let s=n.state.selection,o=s.empty?null:n.posAtCoords(Ss(e)),a;if(!(o&&o.pos>=s.from&&o.pos<=(s instanceof Y?s.to-1:s.to))){if(i&&i.mightDrag)a=Y.create(n.state.doc,i.mightDrag.pos);else if(e.target&&e.target.nodeType==1){let m=n.docView.nearestDesc(e.target,!0);m&&m.node.type.spec.draggable&&m!=n.docView&&(a=Y.create(n.state.doc,m.posBefore))}}let c=(a||n.state.selection).content(),{dom:u,text:f,slice:h}=Ea(n,c);(!e.dataTransfer.files.length||!Qt||zd>120)&&e.dataTransfer.clearData(),e.dataTransfer.setData(Ji?"Text":"text/html",u.innerHTML),e.dataTransfer.effectAllowed="copyMove",Ji||e.dataTransfer.setData("text/plain",f),n.dragging=new uf(h,df(n,e),a)};se.dragend=n=>{let t=n.dragging;window.setTimeout(()=>{n.dragging==t&&(n.dragging=null)},50)};oe.dragover=oe.dragenter=(n,t)=>t.preventDefault();oe.drop=(n,t)=>{let e=t,i=n.dragging;if(n.dragging=null,!e.dataTransfer)return;let s=n.posAtCoords(Ss(e));if(!s)return;let o=n.state.doc.resolve(s.pos),a=i&&i.slice;a?n.someProp("transformPasted",v=>{a=v(a,n)}):a=Xd(n,cf(e.dataTransfer),Ji?null:e.dataTransfer.getData("text/html"),!1,o);let c=!!(i&&df(n,e));if(n.someProp("handleDrop",v=>v(n,e,a||F.empty,c))){e.preventDefault();return}if(!a)return;e.preventDefault();let u=a?Td(n.state.doc,o.pos,a):o.pos;u==null&&(u=o.pos);let f=n.state.tr;if(c){let{node:v}=i;v?v.replace(f):f.deleteSelection()}let h=f.mapping.map(u),m=a.openStart==0&&a.openEnd==0&&a.content.childCount==1,g=f.doc;if(m?f.replaceRangeWith(h,h,a.content.firstChild):f.replaceRange(h,h,a),f.doc.eq(g))return;let y=f.doc.resolve(h);if(m&&Y.isSelectable(a.content.firstChild)&&y.nodeAfter&&y.nodeAfter.sameMarkup(a.content.firstChild))f.setSelection(new Y(y));else{let v=f.mapping.map(u);f.mapping.maps[f.mapping.maps.length-1].forEach((b,S,M,P)=>v=P),f.setSelection(Pa(n,y,f.doc.resolve(v)))}n.focus(),n.dispatch(f.setMeta("uiEvent","drop"))};se.focus=n=>{n.input.lastFocus=Date.now(),n.focused||(n.domObserver.stop(),n.dom.classList.add("ProseMirror-focused"),n.domObserver.start(),n.focused=!0,setTimeout(()=>{n.docView&&n.hasFocus()&&!n.domObserver.currentSelection.eq(n.domSelectionRange())&&Je(n)},20))};se.blur=(n,t)=>{let e=t;n.focused&&(n.domObserver.stop(),n.dom.classList.remove("ProseMirror-focused"),n.domObserver.start(),e.relatedTarget&&n.dom.contains(e.relatedTarget)&&n.domObserver.currentSelection.clear(),n.focused=!1)};se.beforeinput=(n,t)=>{if(Qt&&Ke&&t.inputType=="deleteContentBackward"){n.domObserver.flushSoon();let{domChangeCount:i}=n.input;setTimeout(()=>{if(n.input.domChangeCount!=i||(n.dom.blur(),n.focus(),n.someProp("handleKeyDown",o=>o(n,Tn(8,"Backspace")))))return;let{$cursor:s}=n.state.selection;s&&s.pos>0&&n.dispatch(n.state.tr.delete(s.pos-1,s.pos).scrollIntoView())},50)}};for(let n in oe)se[n]=oe[n];function Yi(n,t){if(n==t)return!0;for(let e in n)if(n[e]!==t[e])return!1;for(let e in t)if(!(e in n))return!1;return!0}class Yr{constructor(t,e){this.toDOM=t,this.spec=e||Dn,this.side=this.spec.side||0}map(t,e,i,s){let{pos:o,deleted:a}=t.mapResult(e.from+s,this.side<0?-1:1);return a?null:new ie(o-i,o-i,this)}valid(){return!0}eq(t){return this==t||t instanceof Yr&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&Yi(this.spec,t.spec))}destroy(t){this.spec.destroy&&this.spec.destroy(t)}}class mn{constructor(t,e){this.attrs=t,this.spec=e||Dn}map(t,e,i,s){let o=t.map(e.from+s,this.spec.inclusiveStart?-1:1)-i,a=t.map(e.to+s,this.spec.inclusiveEnd?1:-1)-i;return o>=a?null:new ie(o,a,this)}valid(t,e){return e.from<e.to}eq(t){return this==t||t instanceof mn&&Yi(this.attrs,t.attrs)&&Yi(this.spec,t.spec)}static is(t){return t.type instanceof mn}destroy(){}}class Ia{constructor(t,e){this.attrs=t,this.spec=e||Dn}map(t,e,i,s){let o=t.mapResult(e.from+s,1);if(o.deleted)return null;let a=t.mapResult(e.to+s,-1);return a.deleted||a.pos<=o.pos?null:new ie(o.pos-i,a.pos-i,this)}valid(t,e){let{index:i,offset:s}=t.content.findIndex(e.from),o;return s==e.from&&!(o=t.child(i)).isText&&s+o.nodeSize==e.to}eq(t){return this==t||t instanceof Ia&&Yi(this.attrs,t.attrs)&&Yi(this.spec,t.spec)}destroy(){}}class ie{constructor(t,e,i){this.from=t,this.to=e,this.type=i}copy(t,e){return new ie(t,e,this.type)}eq(t,e=0){return this.type.eq(t.type)&&this.from+e==t.from&&this.to+e==t.to}map(t,e,i){return this.type.map(t,this,e,i)}static widget(t,e,i){return new ie(t,t,new Yr(e,i))}static inline(t,e,i,s){return new ie(t,e,new mn(i,s))}static node(t,e,i,s){return new ie(t,e,new Ia(i,s))}get spec(){return this.type.spec}get inline(){return this.type instanceof mn}get widget(){return this.type instanceof Yr}}const ri=[],Dn={};class St{constructor(t,e){this.local=t.length?t:ri,this.children=e.length?e:ri}static create(t,e){return e.length?Xr(e,t,0,Dn):Xt}find(t,e,i){let s=[];return this.findInner(t??0,e??1e9,s,0,i),s}findInner(t,e,i,s,o){for(let a=0;a<this.local.length;a++){let c=this.local[a];c.from<=e&&c.to>=t&&(!o||o(c.spec))&&i.push(c.copy(c.from+s,c.to+s))}for(let a=0;a<this.children.length;a+=3)if(this.children[a]<e&&this.children[a+1]>t){let c=this.children[a]+1;this.children[a+2].findInner(t-c,e-c,i,s+c,o)}}map(t,e,i){return this==Xt||t.maps.length==0?this:this.mapInner(t,e,0,0,i||Dn)}mapInner(t,e,i,s,o){let a;for(let c=0;c<this.local.length;c++){let u=this.local[c].map(t,i,s);u&&u.type.valid(e,u)?(a||(a=[])).push(u):o.onRemove&&o.onRemove(this.local[c].spec)}return this.children.length?zy(this.children,a||[],t,e,i,s,o):a?new St(a.sort(zn),ri):Xt}add(t,e){return e.length?this==Xt?St.create(t,e):this.addInner(t,e,0):this}addInner(t,e,i){let s,o=0;t.forEach((c,u)=>{let f=u+i,h;if(h=hf(e,c,f)){for(s||(s=this.children.slice());o<s.length&&s[o]<u;)o+=3;s[o]==u?s[o+2]=s[o+2].addInner(c,h,f+1):s.splice(o,0,u,u+c.nodeSize,Xr(h,c,f+1,Dn)),o+=3}});let a=ff(o?pf(e):e,-i);for(let c=0;c<a.length;c++)a[c].type.valid(t,a[c])||a.splice(c--,1);return new St(a.length?this.local.concat(a).sort(zn):this.local,s||this.children)}remove(t){return t.length==0||this==Xt?this:this.removeInner(t,0)}removeInner(t,e){let i=this.children,s=this.local;for(let o=0;o<i.length;o+=3){let a,c=i[o]+e,u=i[o+1]+e;for(let h=0,m;h<t.length;h++)(m=t[h])&&m.from>c&&m.to<u&&(t[h]=null,(a||(a=[])).push(m));if(!a)continue;i==this.children&&(i=this.children.slice());let f=i[o+2].removeInner(a,c+1);f!=Xt?i[o+2]=f:(i.splice(o,3),o-=3)}if(s.length){for(let o=0,a;o<t.length;o++)if(a=t[o])for(let c=0;c<s.length;c++)s[c].eq(a,e)&&(s==this.local&&(s=this.local.slice()),s.splice(c--,1))}return i==this.children&&s==this.local?this:s.length||i.length?new St(s,i):Xt}forChild(t,e){if(this==Xt)return this;if(e.isLeaf)return St.empty;let i,s;for(let c=0;c<this.children.length;c+=3)if(this.children[c]>=t){this.children[c]==t&&(i=this.children[c+2]);break}let o=t+1,a=o+e.content.size;for(let c=0;c<this.local.length;c++){let u=this.local[c];if(u.from<a&&u.to>o&&u.type instanceof mn){let f=Math.max(o,u.from)-o,h=Math.min(a,u.to)-o;f<h&&(s||(s=[])).push(u.copy(f,h))}}if(s){let c=new St(s.sort(zn),ri);return i?new cn([c,i]):c}return i||Xt}eq(t){if(this==t)return!0;if(!(t instanceof St)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(let e=0;e<this.local.length;e++)if(!this.local[e].eq(t.local[e]))return!1;for(let e=0;e<this.children.length;e+=3)if(this.children[e]!=t.children[e]||this.children[e+1]!=t.children[e+1]||!this.children[e+2].eq(t.children[e+2]))return!1;return!0}locals(t){return Na(this.localsInner(t))}localsInner(t){if(this==Xt)return ri;if(t.inlineContent||!this.local.some(mn.is))return this.local;let e=[];for(let i=0;i<this.local.length;i++)this.local[i].type instanceof mn||e.push(this.local[i]);return e}forEachSet(t){t(this)}}St.empty=new St([],[]);St.removeOverlap=Na;const Xt=St.empty;class cn{constructor(t){this.members=t}map(t,e){const i=this.members.map(s=>s.map(t,e,Dn));return cn.from(i)}forChild(t,e){if(e.isLeaf)return St.empty;let i=[];for(let s=0;s<this.members.length;s++){let o=this.members[s].forChild(t,e);o!=Xt&&(o instanceof cn?i=i.concat(o.members):i.push(o))}return cn.from(i)}eq(t){if(!(t instanceof cn)||t.members.length!=this.members.length)return!1;for(let e=0;e<this.members.length;e++)if(!this.members[e].eq(t.members[e]))return!1;return!0}locals(t){let e,i=!0;for(let s=0;s<this.members.length;s++){let o=this.members[s].localsInner(t);if(o.length)if(!e)e=o;else{i&&(e=e.slice(),i=!1);for(let a=0;a<o.length;a++)e.push(o[a])}}return e?Na(i?e:e.sort(zn)):ri}static from(t){switch(t.length){case 0:return Xt;case 1:return t[0];default:return new cn(t.every(e=>e instanceof St)?t:t.reduce((e,i)=>e.concat(i instanceof St?i:i.members),[]))}}forEachSet(t){for(let e=0;e<this.members.length;e++)this.members[e].forEachSet(t)}}function zy(n,t,e,i,s,o,a){let c=n.slice();for(let f=0,h=o;f<e.maps.length;f++){let m=0;e.maps[f].forEach((g,y,v,b)=>{let S=b-v-(y-g);for(let M=0;M<c.length;M+=3){let P=c[M+1];if(P<0||g>P+h-m)continue;let D=c[M]+h-m;y>=D?c[M+1]=g<=D?-2:-1:g>=h&&S&&(c[M]+=S,c[M+1]+=S)}m+=S}),h=e.maps[f].map(h,-1)}let u=!1;for(let f=0;f<c.length;f+=3)if(c[f+1]<0){if(c[f+1]==-2){u=!0,c[f+1]=-1;continue}let h=e.map(n[f]+o),m=h-s;if(m<0||m>=i.content.size){u=!0;continue}let g=e.map(n[f+1]+o,-1),y=g-s,{index:v,offset:b}=i.content.findIndex(m),S=i.maybeChild(v);if(S&&b==m&&b+S.nodeSize==y){let M=c[f+2].mapInner(e,S,h+1,n[f]+o+1,a);M!=Xt?(c[f]=m,c[f+1]=y,c[f+2]=M):(c[f+1]=-2,u=!0)}else u=!0}if(u){let f=Ry(c,n,t,e,s,o,a),h=Xr(f,i,0,a);t=h.local;for(let m=0;m<c.length;m+=3)c[m+1]<0&&(c.splice(m,3),m-=3);for(let m=0,g=0;m<h.children.length;m+=3){let y=h.children[m];for(;g<c.length&&c[g]<y;)g+=3;c.splice(g,0,h.children[m],h.children[m+1],h.children[m+2])}}return new St(t.sort(zn),c)}function ff(n,t){if(!t||!n.length)return n;let e=[];for(let i=0;i<n.length;i++){let s=n[i];e.push(new ie(s.from+t,s.to+t,s.type))}return e}function Ry(n,t,e,i,s,o,a){function c(u,f){for(let h=0;h<u.local.length;h++){let m=u.local[h].map(i,s,f);m?e.push(m):a.onRemove&&a.onRemove(u.local[h].spec)}for(let h=0;h<u.children.length;h+=3)c(u.children[h+2],u.children[h]+f+1)}for(let u=0;u<n.length;u+=3)n[u+1]==-1&&c(n[u+2],t[u]+o+1);return e}function hf(n,t,e){if(t.isLeaf)return null;let i=e+t.nodeSize,s=null;for(let o=0,a;o<n.length;o++)(a=n[o])&&a.from>e&&a.to<i&&((s||(s=[])).push(a),n[o]=null);return s}function pf(n){let t=[];for(let e=0;e<n.length;e++)n[e]!=null&&t.push(n[e]);return t}function Xr(n,t,e,i){let s=[],o=!1;t.forEach((c,u)=>{let f=hf(n,c,u+e);if(f){o=!0;let h=Xr(f,c,e+u+1,i);h!=Xt&&s.push(u,u+c.nodeSize,h)}});let a=ff(o?pf(n):n,-e).sort(zn);for(let c=0;c<a.length;c++)a[c].type.valid(t,a[c])||(i.onRemove&&i.onRemove(a[c].spec),a.splice(c--,1));return a.length||s.length?new St(a,s):Xt}function zn(n,t){return n.from-t.from||n.to-t.to}function Na(n){let t=n;for(let e=0;e<t.length-1;e++){let i=t[e];if(i.from!=i.to)for(let s=e+1;s<t.length;s++){let o=t[s];if(o.from==i.from){o.to!=i.to&&(t==n&&(t=n.slice()),t[s]=o.copy(o.from,i.to),au(t,s+1,o.copy(i.to,o.to)));continue}else{o.from<i.to&&(t==n&&(t=n.slice()),t[e]=i.copy(i.from,o.from),au(t,s,i.copy(o.from,i.to)));break}}}return t}function au(n,t,e){for(;t<n.length&&zn(e,n[t])>0;)t++;n.splice(t,0,e)}function To(n){let t=[];return n.someProp("decorations",e=>{let i=e(n.state);i&&i!=Xt&&t.push(i)}),n.cursorWrapper&&t.push(St.create(n.state.doc,[n.cursorWrapper.deco])),cn.from(t)}const By={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},$y=de&&hn<=11;class Fy{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset}}class Vy{constructor(t,e){this.view=t,this.handleDOMChange=e,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new Fy,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(i=>{for(let s=0;s<i.length;s++)this.queue.push(i[s]);de&&hn<=11&&i.some(s=>s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length)?this.flushSoon():this.flush()}),$y&&(this.onCharData=i=>{this.queue.push({target:i.target,type:"characterData",oldValue:i.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,By)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let t=this.observer.takeRecords();if(t.length){for(let e=0;e<t.length;e++)this.queue.push(t[e]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(Qc(this.view)){if(this.suppressingSelectionUpdates)return Je(this.view);if(de&&hn<=11&&!this.view.state.selection.empty){let t=this.view.domSelectionRange();if(t.focusNode&&Fn(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(t){if(!t.focusNode)return!0;let e=new Set,i;for(let o=t.focusNode;o;o=ui(o))e.add(o);for(let o=t.anchorNode;o;o=ui(o))if(e.has(o)){i=o;break}let s=i&&this.view.docView.nearestDesc(i);if(s&&s.ignoreMutation({type:"selection",target:i.nodeType==3?i.parentNode:i}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let t of this.observer.takeRecords())this.queue.push(t);return this.queue}flush(){let{view:t}=this;if(!t.docView||this.flushingSoon>-1)return;let e=this.pendingRecords();e.length&&(this.queue=[]);let i=t.domSelectionRange(),s=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(i)&&Qc(t)&&!this.ignoreSelectionChange(i),o=-1,a=-1,c=!1,u=[];if(t.editable)for(let h=0;h<e.length;h++){let m=this.registerMutation(e[h],u);m&&(o=o<0?m.from:Math.min(m.from,o),a=a<0?m.to:Math.max(m.to,a),m.typeOver&&(c=!0))}if(Oe&&u.length){let h=u.filter(m=>m.nodeName=="BR");if(h.length==2){let[m,g]=h;m.parentNode&&m.parentNode.parentNode==g.parentNode?g.remove():m.remove()}else{let{focusNode:m}=this.currentSelection;for(let g of h){let y=g.parentNode;y&&y.nodeName=="LI"&&(!m||Wy(t,m)!=y)&&g.remove()}}}let f=null;o<0&&s&&t.input.lastFocus>Date.now()-200&&Math.max(t.input.lastTouch,t.input.lastClick.time)<Date.now()-300&&ks(i)&&(f=Ta(t))&&f.eq(it.near(t.state.doc.resolve(0),1))?(t.input.lastFocus=0,Je(t),this.currentSelection.set(i),t.scrollToSelection()):(o>-1||s)&&(o>-1&&(t.docView.markDirty(o,a),Hy(t)),this.handleDOMChange(o,a,c,u),t.docView&&t.docView.dirty?t.updateState(t.state):this.currentSelection.eq(i)||Je(t),this.currentSelection.set(i))}registerMutation(t,e){if(e.indexOf(t.target)>-1)return null;let i=this.view.docView.nearestDesc(t.target);if(t.type=="attributes"&&(i==this.view.docView||t.attributeName=="contenteditable"||t.attributeName=="style"&&!t.oldValue&&!t.target.getAttribute("style"))||!i||i.ignoreMutation(t))return null;if(t.type=="childList"){for(let h=0;h<t.addedNodes.length;h++){let m=t.addedNodes[h];e.push(m),m.nodeType==3&&(this.lastChangedTextNode=m)}if(i.contentDOM&&i.contentDOM!=i.dom&&!i.contentDOM.contains(t.target))return{from:i.posBefore,to:i.posAfter};let s=t.previousSibling,o=t.nextSibling;if(de&&hn<=11&&t.addedNodes.length)for(let h=0;h<t.addedNodes.length;h++){let{previousSibling:m,nextSibling:g}=t.addedNodes[h];(!m||Array.prototype.indexOf.call(t.addedNodes,m)<0)&&(s=m),(!g||Array.prototype.indexOf.call(t.addedNodes,g)<0)&&(o=g)}let a=s&&s.parentNode==t.target?Jt(s)+1:0,c=i.localPosFromDOM(t.target,a,-1),u=o&&o.parentNode==t.target?Jt(o):t.target.childNodes.length,f=i.localPosFromDOM(t.target,u,1);return{from:c,to:f}}else return t.type=="attributes"?{from:i.posAtStart-i.border,to:i.posAtEnd+i.border}:(this.lastChangedTextNode=t.target,{from:i.posAtStart,to:i.posAtEnd,typeOver:t.target.nodeValue==t.oldValue})}}let lu=new WeakMap,cu=!1;function Hy(n){if(!lu.has(n)&&(lu.set(n,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(n.dom).whiteSpace)!==-1)){if(n.requiresGeckoHackNode=Oe,cu)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),cu=!0}}function uu(n,t){let e=t.startContainer,i=t.startOffset,s=t.endContainer,o=t.endOffset,a=n.domAtPos(n.state.selection.anchor);return Fn(a.node,a.offset,s,o)&&([e,i,s,o]=[s,o,e,i]),{anchorNode:e,anchorOffset:i,focusNode:s,focusOffset:o}}function Zy(n,t){if(t.getComposedRanges){let s=t.getComposedRanges(n.root)[0];if(s)return uu(n,s)}let e;function i(s){s.preventDefault(),s.stopImmediatePropagation(),e=s.getTargetRanges()[0]}return n.dom.addEventListener("beforeinput",i,!0),document.execCommand("indent"),n.dom.removeEventListener("beforeinput",i,!0),e?uu(n,e):null}function Wy(n,t){for(let e=t.parentNode;e&&e!=n.dom;e=e.parentNode){let i=n.docView.nearestDesc(e,!0);if(i&&i.node.isBlock)return e}return null}function jy(n,t,e){let{node:i,fromOffset:s,toOffset:o,from:a,to:c}=n.docView.parseRange(t,e),u=n.domSelectionRange(),f,h=u.anchorNode;if(h&&n.dom.contains(h.nodeType==1?h:h.parentNode)&&(f=[{node:h,offset:u.anchorOffset}],ks(u)||f.push({node:u.focusNode,offset:u.focusOffset})),Qt&&n.input.lastKeyCode===8)for(let S=o;S>s;S--){let M=i.childNodes[S-1],P=M.pmViewDesc;if(M.nodeName=="BR"&&!P){o=S;break}if(!P||P.size)break}let m=n.state.doc,g=n.someProp("domParser")||Ee.fromSchema(n.state.schema),y=m.resolve(a),v=null,b=g.parse(i,{topNode:y.parent,topMatch:y.parent.contentMatchAt(y.index()),topOpen:!0,from:s,to:o,preserveWhitespace:y.parent.type.whitespace=="pre"?"full":!0,findPositions:f,ruleFromNode:Uy,context:y});if(f&&f[0].pos!=null){let S=f[0].pos,M=f[1]&&f[1].pos;M==null&&(M=S),v={anchor:S+a,head:M+a}}return{doc:b,sel:v,from:a,to:c}}function Uy(n){let t=n.pmViewDesc;if(t)return t.parseRule();if(n.nodeName=="BR"&&n.parentNode){if(re&&/^(ul|ol)$/i.test(n.parentNode.nodeName)){let e=document.createElement("div");return e.appendChild(document.createElement("li")),{skip:e}}else if(n.parentNode.lastChild==n||re&&/^(tr|table)$/i.test(n.parentNode.nodeName))return{ignore:!0}}else if(n.nodeName=="IMG"&&n.getAttribute("mark-placeholder"))return{ignore:!0};return null}const qy=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function Ky(n,t,e,i,s){let o=n.input.compositionPendingChanges||(n.composing?n.input.compositionID:0);if(n.input.compositionPendingChanges=0,t<0){let B=n.input.lastSelectionTime>Date.now()-50?n.input.lastSelectionOrigin:null,ft=Ta(n,B);if(ft&&!n.state.selection.eq(ft)){if(Qt&&Ke&&n.input.lastKeyCode===13&&Date.now()-100<n.input.lastKeyCodeTime&&n.someProp("handleKeyDown",Nt=>Nt(n,Tn(13,"Enter"))))return;let kt=n.state.tr.setSelection(ft);B=="pointer"?kt.setMeta("pointer",!0):B=="key"&&kt.scrollIntoView(),o&&kt.setMeta("composition",o),n.dispatch(kt)}return}let a=n.state.doc.resolve(t),c=a.sharedDepth(e);t=a.before(c+1),e=n.state.doc.resolve(e).after(c+1);let u=n.state.selection,f=jy(n,t,e),h=n.state.doc,m=h.slice(f.from,f.to),g,y;n.input.lastKeyCode===8&&Date.now()-100<n.input.lastKeyCodeTime?(g=n.state.selection.to,y="end"):(g=n.state.selection.from,y="start"),n.input.lastKeyCode=null;let v=Yy(m.content,f.doc.content,f.from,g,y);if(v&&n.input.domChangeCount++,(di&&n.input.lastIOSEnter>Date.now()-225||Ke)&&s.some(B=>B.nodeType==1&&!qy.test(B.nodeName))&&(!v||v.endA>=v.endB)&&n.someProp("handleKeyDown",B=>B(n,Tn(13,"Enter")))){n.input.lastIOSEnter=0;return}if(!v)if(i&&u instanceof X&&!u.empty&&u.$head.sameParent(u.$anchor)&&!n.composing&&!(f.sel&&f.sel.anchor!=f.sel.head))v={start:u.from,endA:u.to,endB:u.to};else{if(f.sel){let B=du(n,n.state.doc,f.sel);if(B&&!B.eq(n.state.selection)){let ft=n.state.tr.setSelection(B);o&&ft.setMeta("composition",o),n.dispatch(ft)}}return}n.state.selection.from<n.state.selection.to&&v.start==v.endB&&n.state.selection instanceof X&&(v.start>n.state.selection.from&&v.start<=n.state.selection.from+2&&n.state.selection.from>=f.from?v.start=n.state.selection.from:v.endA<n.state.selection.to&&v.endA>=n.state.selection.to-2&&n.state.selection.to<=f.to&&(v.endB+=n.state.selection.to-v.endA,v.endA=n.state.selection.to)),de&&hn<=11&&v.endB==v.start+1&&v.endA==v.start&&v.start>f.from&&f.doc.textBetween(v.start-f.from-1,v.start-f.from+1)==" "&&(v.start--,v.endA--,v.endB--);let b=f.doc.resolveNoCache(v.start-f.from),S=f.doc.resolveNoCache(v.endB-f.from),M=h.resolve(v.start),P=b.sameParent(S)&&b.parent.inlineContent&&M.end()>=v.endA,D;if((di&&n.input.lastIOSEnter>Date.now()-225&&(!P||s.some(B=>B.nodeName=="DIV"||B.nodeName=="P"))||!P&&b.pos<f.doc.content.size&&(!b.sameParent(S)||!b.parent.inlineContent)&&!/\S/.test(f.doc.textBetween(b.pos,S.pos,"",""))&&(D=it.findFrom(f.doc.resolve(b.pos+1),1,!0))&&D.head>b.pos)&&n.someProp("handleKeyDown",B=>B(n,Tn(13,"Enter")))){n.input.lastIOSEnter=0;return}if(n.state.selection.anchor>v.start&&Gy(h,v.start,v.endA,b,S)&&n.someProp("handleKeyDown",B=>B(n,Tn(8,"Backspace")))){Ke&&Qt&&n.domObserver.suppressSelectionUpdates();return}Qt&&v.endB==v.start&&(n.input.lastChromeDelete=Date.now()),Ke&&!P&&b.start()!=S.start()&&S.parentOffset==0&&b.depth==S.depth&&f.sel&&f.sel.anchor==f.sel.head&&f.sel.head==v.endA&&(v.endB-=2,S=f.doc.resolveNoCache(v.endB-f.from),setTimeout(()=>{n.someProp("handleKeyDown",function(B){return B(n,Tn(13,"Enter"))})},20));let V=v.start,$=v.endA,U=B=>{let ft=B||n.state.tr.replace(V,$,f.doc.slice(v.start-f.from,v.endB-f.from));if(f.sel){let kt=du(n,ft.doc,f.sel);kt&&!(Qt&&n.composing&&kt.empty&&(v.start!=v.endB||n.input.lastChromeDelete<Date.now()-100)&&(kt.head==V||kt.head==ft.mapping.map($)-1)||de&&kt.empty&&kt.head==V)&&ft.setSelection(kt)}return o&&ft.setMeta("composition",o),ft.scrollIntoView()},K;if(P){if(b.pos==S.pos){de&&hn<=11&&b.parentOffset==0&&(n.domObserver.suppressSelectionUpdates(),setTimeout(()=>Je(n),20));let B=U(n.state.tr.delete(V,$)),ft=h.resolve(v.start).marksAcross(h.resolve(v.endA));ft&&B.ensureMarks(ft),n.dispatch(B)}else if(v.endA==v.endB&&(K=Jy(b.parent.content.cut(b.parentOffset,S.parentOffset),M.parent.content.cut(M.parentOffset,v.endA-M.start())))){let B=U(n.state.tr);K.type=="add"?B.addMark(V,$,K.mark):B.removeMark(V,$,K.mark),n.dispatch(B)}else if(b.parent.child(b.index()).isText&&b.index()==S.index()-(S.textOffset?0:1)){let B=b.parent.textBetween(b.parentOffset,S.parentOffset),ft=()=>U(n.state.tr.insertText(B,V,$));n.someProp("handleTextInput",kt=>kt(n,V,$,B,ft))||n.dispatch(ft())}}else n.dispatch(U())}function du(n,t,e){return Math.max(e.anchor,e.head)>t.content.size?null:Pa(n,t.resolve(e.anchor),t.resolve(e.head))}function Jy(n,t){let e=n.firstChild.marks,i=t.firstChild.marks,s=e,o=i,a,c,u;for(let h=0;h<i.length;h++)s=i[h].removeFromSet(s);for(let h=0;h<e.length;h++)o=e[h].removeFromSet(o);if(s.length==1&&o.length==0)c=s[0],a="add",u=h=>h.mark(c.addToSet(h.marks));else if(s.length==0&&o.length==1)c=o[0],a="remove",u=h=>h.mark(c.removeFromSet(h.marks));else return null;let f=[];for(let h=0;h<t.childCount;h++)f.push(u(t.child(h)));if(z.from(f).eq(n))return{mark:c,type:a}}function Gy(n,t,e,i,s){if(e-t<=s.pos-i.pos||Po(i,!0,!1)<s.pos)return!1;let o=n.resolve(t);if(!i.parent.isTextblock){let c=o.nodeAfter;return c!=null&&e==t+c.nodeSize}if(o.parentOffset<o.parent.content.size||!o.parent.isTextblock)return!1;let a=n.resolve(Po(o,!0,!0));return!a.parent.isTextblock||a.pos>e||Po(a,!0,!1)<e?!1:i.parent.content.cut(i.parentOffset).eq(a.parent.content)}function Po(n,t,e){let i=n.depth,s=t?n.end():n.pos;for(;i>0&&(t||n.indexAfter(i)==n.node(i).childCount);)i--,s++,t=!1;if(e){let o=n.node(i).maybeChild(n.indexAfter(i));for(;o&&!o.isLeaf;)o=o.firstChild,s++}return s}function Yy(n,t,e,i,s){let o=n.findDiffStart(t,e);if(o==null)return null;let{a,b:c}=n.findDiffEnd(t,e+n.size,e+t.size);if(s=="end"){let u=Math.max(0,o-Math.min(a,c));i-=a+u-o}if(a<o&&n.size<t.size){let u=i<=o&&i>=a?o-i:0;o-=u,o&&o<t.size&&fu(t.textBetween(o-1,o+1))&&(o+=u?1:-1),c=o+(c-a),a=o}else if(c<o){let u=i<=o&&i>=c?o-i:0;o-=u,o&&o<n.size&&fu(n.textBetween(o-1,o+1))&&(o+=u?1:-1),a=o+(a-c),c=o}return{start:o,endA:a,endB:c}}function fu(n){if(n.length!=2)return!1;let t=n.charCodeAt(0),e=n.charCodeAt(1);return t>=56320&&t<=57343&&e>=55296&&e<=56319}class mf{constructor(t,e){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new gy,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=e,this.state=e.state,this.directPlugins=e.plugins||[],this.directPlugins.forEach(_u),this.dispatch=this.dispatch.bind(this),this.dom=t&&t.mount||document.createElement("div"),t&&(t.appendChild?t.appendChild(this.dom):typeof t=="function"?t(this.dom):t.mount&&(this.mounted=!0)),this.editable=mu(this),pu(this),this.nodeViews=gu(this),this.docView=qc(this.state.doc,hu(this),To(this),this.dom,this),this.domObserver=new Vy(this,(i,s,o,a)=>Ky(this,i,s,o,a)),this.domObserver.start(),_y(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let t=this._props;this._props={};for(let e in t)this._props[e]=t[e];this._props.state=this.state}return this._props}update(t){t.handleDOMEvents!=this._props.handleDOMEvents&&Xo(this);let e=this._props;this._props=t,t.plugins&&(t.plugins.forEach(_u),this.directPlugins=t.plugins),this.updateStateInner(t.state,e)}setProps(t){let e={};for(let i in this._props)e[i]=this._props[i];e.state=this.state;for(let i in t)e[i]=t[i];this.update(e)}updateState(t){this.updateStateInner(t,this._props)}updateStateInner(t,e){var i;let s=this.state,o=!1,a=!1;t.storedMarks&&this.composing&&(lf(this),a=!0),this.state=t;let c=s.plugins!=t.plugins||this._props.plugins!=e.plugins;if(c||this._props.plugins!=e.plugins||this._props.nodeViews!=e.nodeViews){let y=gu(this);Qy(y,this.nodeViews)&&(this.nodeViews=y,o=!0)}(c||e.handleDOMEvents!=this._props.handleDOMEvents)&&Xo(this),this.editable=mu(this),pu(this);let u=To(this),f=hu(this),h=s.plugins!=t.plugins&&!s.doc.eq(t.doc)?"reset":t.scrollToSelection>s.scrollToSelection?"to selection":"preserve",m=o||!this.docView.matchesNode(t.doc,f,u);(m||!t.selection.eq(s.selection))&&(a=!0);let g=h=="preserve"&&a&&this.dom.style.overflowAnchor==null&&A_(this);if(a){this.domObserver.stop();let y=m&&(de||Qt)&&!this.composing&&!s.selection.empty&&!t.selection.empty&&Xy(s.selection,t.selection);if(m){let v=Qt?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=Oy(this)),(o||!this.docView.update(t.doc,f,u,this))&&(this.docView.updateOuterDeco(f),this.docView.destroy(),this.docView=qc(t.doc,f,u,this.dom,this)),v&&!this.trackWrites&&(y=!0)}y||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&ey(this))?Je(this,y):(Jd(this,t.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(s),!((i=this.dragging)===null||i===void 0)&&i.node&&!s.doc.eq(t.doc)&&this.updateDraggedNode(this.dragging,s),h=="reset"?this.dom.scrollTop=0:h=="to selection"?this.scrollToSelection():g&&L_(g)}scrollToSelection(){let t=this.domSelectionRange().focusNode;if(!(!t||!this.dom.contains(t.nodeType==1?t:t.parentNode))){if(!this.someProp("handleScrollToSelection",e=>e(this)))if(this.state.selection instanceof Y){let e=this.docView.domAfterPos(this.state.selection.from);e.nodeType==1&&Vc(this,e.getBoundingClientRect(),t)}else Vc(this,this.coordsAtPos(this.state.selection.head,1),t)}}destroyPluginViews(){let t;for(;t=this.pluginViews.pop();)t.destroy&&t.destroy()}updatePluginViews(t){if(!t||t.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let e=0;e<this.directPlugins.length;e++){let i=this.directPlugins[e];i.spec.view&&this.pluginViews.push(i.spec.view(this))}for(let e=0;e<this.state.plugins.length;e++){let i=this.state.plugins[e];i.spec.view&&this.pluginViews.push(i.spec.view(this))}}else for(let e=0;e<this.pluginViews.length;e++){let i=this.pluginViews[e];i.update&&i.update(this,t)}}updateDraggedNode(t,e){let i=t.node,s=-1;if(this.state.doc.nodeAt(i.from)==i.node)s=i.from;else{let o=i.from+(this.state.doc.content.size-e.doc.content.size);(o>0&&this.state.doc.nodeAt(o))==i.node&&(s=o)}this.dragging=new uf(t.slice,t.move,s<0?void 0:Y.create(this.state.doc,s))}someProp(t,e){let i=this._props&&this._props[t],s;if(i!=null&&(s=e?e(i):i))return s;for(let a=0;a<this.directPlugins.length;a++){let c=this.directPlugins[a].props[t];if(c!=null&&(s=e?e(c):c))return s}let o=this.state.plugins;if(o)for(let a=0;a<o.length;a++){let c=o[a].props[t];if(c!=null&&(s=e?e(c):c))return s}}hasFocus(){if(de){let t=this.root.activeElement;if(t==this.dom)return!0;if(!t||!this.dom.contains(t))return!1;for(;t&&this.dom!=t&&this.dom.contains(t);){if(t.contentEditable=="false")return!1;t=t.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&I_(this.dom),Je(this),this.domObserver.start()}get root(){let t=this._root;if(t==null){for(let e=this.dom.parentNode;e;e=e.parentNode)if(e.nodeType==9||e.nodeType==11&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=()=>e.ownerDocument.getSelection()),this._root=e}return t||document}updateRoot(){this._root=null}posAtCoords(t){return B_(this,t)}coordsAtPos(t,e=1){return Vd(this,t,e)}domAtPos(t,e=0){return this.docView.domFromPos(t,e)}nodeDOM(t){let e=this.docView.descAt(t);return e?e.nodeDOM:null}posAtDOM(t,e,i=-1){let s=this.docView.posFromDOM(t,e,i);if(s==null)throw new RangeError("DOM position not inside the editor");return s}endOfTextblock(t,e){return Z_(this,e||this.state,t)}pasteHTML(t,e){return Gi(this,"",t,!1,e||new ClipboardEvent("paste"))}pasteText(t,e){return Gi(this,t,null,!0,e||new ClipboardEvent("paste"))}serializeForClipboard(t){return Ea(this,t)}destroy(){this.docView&&(yy(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],To(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,b_())}get isDestroyed(){return this.docView==null}dispatchEvent(t){return by(this,t)}domSelectionRange(){let t=this.domSelection();return t?re&&this.root.nodeType===11&&C_(this.dom.ownerDocument)==this.dom&&Zy(this,t)||t:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}mf.prototype.dispatch=function(n){let t=this._props.dispatchTransaction;t?t.call(this,n):this.updateState(this.state.apply(n))};function hu(n){let t=Object.create(null);return t.class="ProseMirror",t.contenteditable=String(n.editable),n.someProp("attributes",e=>{if(typeof e=="function"&&(e=e(n.state)),e)for(let i in e)i=="class"?t.class+=" "+e[i]:i=="style"?t.style=(t.style?t.style+";":"")+e[i]:!t[i]&&i!="contenteditable"&&i!="nodeName"&&(t[i]=String(e[i]))}),t.translate||(t.translate="no"),[ie.node(0,n.state.doc.content.size,t)]}function pu(n){if(n.markCursor){let t=document.createElement("img");t.className="ProseMirror-separator",t.setAttribute("mark-placeholder","true"),t.setAttribute("alt",""),n.cursorWrapper={dom:t,deco:ie.widget(n.state.selection.from,t,{raw:!0,marks:n.markCursor})}}else n.cursorWrapper=null}function mu(n){return!n.someProp("editable",t=>t(n.state)===!1)}function Xy(n,t){let e=Math.min(n.$anchor.sharedDepth(n.head),t.$anchor.sharedDepth(t.head));return n.$anchor.start(e)!=t.$anchor.start(e)}function gu(n){let t=Object.create(null);function e(i){for(let s in i)Object.prototype.hasOwnProperty.call(t,s)||(t[s]=i[s])}return n.someProp("nodeViews",e),n.someProp("markViews",e),t}function Qy(n,t){let e=0,i=0;for(let s in n){if(n[s]!=t[s])return!0;e++}for(let s in t)i++;return e!=i}function _u(n){if(n.spec.state||n.spec.filterTransaction||n.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var gn={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Qr={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},tv=typeof navigator<"u"&&/Mac/.test(navigator.platform),ev=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Gt=0;Gt<10;Gt++)gn[48+Gt]=gn[96+Gt]=String(Gt);for(var Gt=1;Gt<=24;Gt++)gn[Gt+111]="F"+Gt;for(var Gt=65;Gt<=90;Gt++)gn[Gt]=String.fromCharCode(Gt+32),Qr[Gt]=String.fromCharCode(Gt);for(var Eo in gn)Qr.hasOwnProperty(Eo)||(Qr[Eo]=gn[Eo]);function nv(n){var t=tv&&n.metaKey&&n.shiftKey&&!n.ctrlKey&&!n.altKey||ev&&n.shiftKey&&n.key&&n.key.length==1||n.key=="Unidentified",e=!t&&n.key||(n.shiftKey?Qr:gn)[n.keyCode]||n.key||"Unidentified";return e=="Esc"&&(e="Escape"),e=="Del"&&(e="Delete"),e=="Left"&&(e="ArrowLeft"),e=="Up"&&(e="ArrowUp"),e=="Right"&&(e="ArrowRight"),e=="Down"&&(e="ArrowDown"),e}const iv=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),rv=typeof navigator<"u"&&/Win/.test(navigator.platform);function sv(n){let t=n.split(/-(?!$)/),e=t[t.length-1];e=="Space"&&(e=" ");let i,s,o,a;for(let c=0;c<t.length-1;c++){let u=t[c];if(/^(cmd|meta|m)$/i.test(u))a=!0;else if(/^a(lt)?$/i.test(u))i=!0;else if(/^(c|ctrl|control)$/i.test(u))s=!0;else if(/^s(hift)?$/i.test(u))o=!0;else if(/^mod$/i.test(u))iv?a=!0:s=!0;else throw new Error("Unrecognized modifier name: "+u)}return i&&(e="Alt-"+e),s&&(e="Ctrl-"+e),a&&(e="Meta-"+e),o&&(e="Shift-"+e),e}function ov(n){let t=Object.create(null);for(let e in n)t[sv(e)]=n[e];return t}function Oo(n,t,e=!0){return t.altKey&&(n="Alt-"+n),t.ctrlKey&&(n="Ctrl-"+n),t.metaKey&&(n="Meta-"+n),e&&t.shiftKey&&(n="Shift-"+n),n}function av(n){return new xt({props:{handleKeyDown:gf(n)}})}function gf(n){let t=ov(n);return function(e,i){let s=nv(i),o,a=t[Oo(s,i)];if(a&&a(e.state,e.dispatch,e))return!0;if(s.length==1&&s!=" "){if(i.shiftKey){let c=t[Oo(s,i,!1)];if(c&&c(e.state,e.dispatch,e))return!0}if((i.altKey||i.metaKey||i.ctrlKey)&&!(rv&&i.ctrlKey&&i.altKey)&&(o=gn[i.keyCode])&&o!=s){let c=t[Oo(o,i)];if(c&&c(e.state,e.dispatch,e))return!0}}return!1}}const Cs=(n,t)=>n.selection.empty?!1:(t&&t(n.tr.deleteSelection().scrollIntoView()),!0);function _f(n,t){let{$cursor:e}=n.selection;return!e||(t?!t.endOfTextblock("backward",n):e.parentOffset>0)?null:e}const Da=(n,t,e)=>{let i=_f(n,e);if(!i)return!1;let s=Ra(i);if(!s){let a=i.blockRange(),c=a&&Zn(a);return c==null?!1:(t&&t(n.tr.lift(a,c).scrollIntoView()),!0)}let o=s.nodeBefore;if(Tf(n,s,t,-1))return!0;if(i.parent.content.size==0&&(fi(o,"end")||Y.isSelectable(o)))for(let a=i.depth;;a--){let c=bs(n.doc,i.before(a),i.after(a),F.empty);if(c&&c.slice.size<c.to-c.from){if(t){let u=n.tr.step(c);u.setSelection(fi(o,"end")?it.findFrom(u.doc.resolve(u.mapping.map(s.pos,-1)),-1):Y.create(u.doc,s.pos-o.nodeSize)),t(u.scrollIntoView())}return!0}if(a==1||i.node(a-1).childCount>1)break}return o.isAtom&&s.depth==i.depth-1?(t&&t(n.tr.delete(s.pos-o.nodeSize,s.pos).scrollIntoView()),!0):!1},yf=(n,t,e)=>{let i=_f(n,e);if(!i)return!1;let s=Ra(i);return s?bf(n,s,t):!1},vf=(n,t,e)=>{let i=xf(n,e);if(!i)return!1;let s=Fa(i);return s?bf(n,s,t):!1};function bf(n,t,e){let i=t.nodeBefore,s=i,o=t.pos-1;for(;!s.isTextblock;o--){if(s.type.spec.isolating)return!1;let h=s.lastChild;if(!h)return!1;s=h}let a=t.nodeAfter,c=a,u=t.pos+1;for(;!c.isTextblock;u++){if(c.type.spec.isolating)return!1;let h=c.firstChild;if(!h)return!1;c=h}let f=bs(n.doc,o,u,F.empty);if(!f||f.from!=o||f instanceof $t&&f.slice.size>=u-o)return!1;if(e){let h=n.tr.step(f);h.setSelection(X.create(h.doc,o)),e(h.scrollIntoView())}return!0}function fi(n,t,e=!1){for(let i=n;i;i=t=="start"?i.firstChild:i.lastChild){if(i.isTextblock)return!0;if(e&&i.childCount!=1)return!1}return!1}const za=(n,t,e)=>{let{$head:i,empty:s}=n.selection,o=i;if(!s)return!1;if(i.parent.isTextblock){if(e?!e.endOfTextblock("backward",n):i.parentOffset>0)return!1;o=Ra(i)}let a=o&&o.nodeBefore;return!a||!Y.isSelectable(a)?!1:(t&&t(n.tr.setSelection(Y.create(n.doc,o.pos-a.nodeSize)).scrollIntoView()),!0)};function Ra(n){if(!n.parent.type.spec.isolating)for(let t=n.depth-1;t>=0;t--){if(n.index(t)>0)return n.doc.resolve(n.before(t+1));if(n.node(t).type.spec.isolating)break}return null}function xf(n,t){let{$cursor:e}=n.selection;return!e||(t?!t.endOfTextblock("forward",n):e.parentOffset<e.parent.content.size)?null:e}const Ba=(n,t,e)=>{let i=xf(n,e);if(!i)return!1;let s=Fa(i);if(!s)return!1;let o=s.nodeAfter;if(Tf(n,s,t,1))return!0;if(i.parent.content.size==0&&(fi(o,"start")||Y.isSelectable(o))){let a=bs(n.doc,i.before(),i.after(),F.empty);if(a&&a.slice.size<a.to-a.from){if(t){let c=n.tr.step(a);c.setSelection(fi(o,"start")?it.findFrom(c.doc.resolve(c.mapping.map(s.pos)),1):Y.create(c.doc,c.mapping.map(s.pos))),t(c.scrollIntoView())}return!0}}return o.isAtom&&s.depth==i.depth-1?(t&&t(n.tr.delete(s.pos,s.pos+o.nodeSize).scrollIntoView()),!0):!1},$a=(n,t,e)=>{let{$head:i,empty:s}=n.selection,o=i;if(!s)return!1;if(i.parent.isTextblock){if(e?!e.endOfTextblock("forward",n):i.parentOffset<i.parent.content.size)return!1;o=Fa(i)}let a=o&&o.nodeAfter;return!a||!Y.isSelectable(a)?!1:(t&&t(n.tr.setSelection(Y.create(n.doc,o.pos)).scrollIntoView()),!0)};function Fa(n){if(!n.parent.type.spec.isolating)for(let t=n.depth-1;t>=0;t--){let e=n.node(t);if(n.index(t)+1<e.childCount)return n.doc.resolve(n.after(t+1));if(e.type.spec.isolating)break}return null}const kf=(n,t)=>{let e=n.selection,i=e instanceof Y,s;if(i){if(e.node.isTextblock||!Fe(n.doc,e.from))return!1;s=e.from}else if(s=bi(n.doc,e.from,-1),s==null)return!1;if(t){let o=n.tr.join(s);i&&o.setSelection(Y.create(o.doc,s-n.doc.resolve(s).nodeBefore.nodeSize)),t(o.scrollIntoView())}return!0},wf=(n,t)=>{let e=n.selection,i;if(e instanceof Y){if(e.node.isTextblock||!Fe(n.doc,e.to))return!1;i=e.to}else if(i=bi(n.doc,e.to,1),i==null)return!1;return t&&t(n.tr.join(i).scrollIntoView()),!0},Sf=(n,t)=>{let{$from:e,$to:i}=n.selection,s=e.blockRange(i),o=s&&Zn(s);return o==null?!1:(t&&t(n.tr.lift(s,o).scrollIntoView()),!0)},Va=(n,t)=>{let{$head:e,$anchor:i}=n.selection;return!e.parent.type.spec.code||!e.sameParent(i)?!1:(t&&t(n.tr.insertText(`
`).scrollIntoView()),!0)};function Ha(n){for(let t=0;t<n.edgeCount;t++){let{type:e}=n.edge(t);if(e.isTextblock&&!e.hasRequiredAttrs())return e}return null}const Cf=(n,t)=>{let{$head:e,$anchor:i}=n.selection;if(!e.parent.type.spec.code||!e.sameParent(i))return!1;let s=e.node(-1),o=e.indexAfter(-1),a=Ha(s.contentMatchAt(o));if(!a||!s.canReplaceWith(o,o,a))return!1;if(t){let c=e.after(),u=n.tr.replaceWith(c,c,a.createAndFill());u.setSelection(it.near(u.doc.resolve(c),1)),t(u.scrollIntoView())}return!0},Za=(n,t)=>{let e=n.selection,{$from:i,$to:s}=e;if(e instanceof ue||i.parent.inlineContent||s.parent.inlineContent)return!1;let o=Ha(s.parent.contentMatchAt(s.indexAfter()));if(!o||!o.isTextblock)return!1;if(t){let a=(!i.parentOffset&&s.index()<s.parent.childCount?i:s).pos,c=n.tr.insert(a,o.createAndFill());c.setSelection(X.create(c.doc,a+1)),t(c.scrollIntoView())}return!0},Wa=(n,t)=>{let{$cursor:e}=n.selection;if(!e||e.parent.content.size)return!1;if(e.depth>1&&e.after()!=e.end(-1)){let o=e.before();if(me(n.doc,o))return t&&t(n.tr.split(o).scrollIntoView()),!0}let i=e.blockRange(),s=i&&Zn(i);return s==null?!1:(t&&t(n.tr.lift(i,s).scrollIntoView()),!0)};function lv(n){return(t,e)=>{let{$from:i,$to:s}=t.selection;if(t.selection instanceof Y&&t.selection.node.isBlock)return!i.parentOffset||!me(t.doc,i.pos)?!1:(e&&e(t.tr.split(i.pos).scrollIntoView()),!0);if(!i.depth)return!1;let o=[],a,c,u=!1,f=!1;for(let y=i.depth;;y--)if(i.node(y).isBlock){u=i.end(y)==i.pos+(i.depth-y),f=i.start(y)==i.pos-(i.depth-y),c=Ha(i.node(y-1).contentMatchAt(i.indexAfter(y-1))),o.unshift(u&&c?{type:c}:null),a=y;break}else{if(y==1)return!1;o.unshift(null)}let h=t.tr;(t.selection instanceof X||t.selection instanceof ue)&&h.deleteSelection();let m=h.mapping.map(i.pos),g=me(h.doc,m,o.length,o);if(g||(o[0]=c?{type:c}:null,g=me(h.doc,m,o.length,o)),!g)return!1;if(h.split(m,o.length,o),!u&&f&&i.node(a).type!=c){let y=h.mapping.map(i.before(a)),v=h.doc.resolve(y);c&&i.node(a-1).canReplaceWith(v.index(),v.index()+1,c)&&h.setNodeMarkup(h.mapping.map(i.before(a)),c)}return e&&e(h.scrollIntoView()),!0}}const cv=lv(),Mf=(n,t)=>{let{$from:e,to:i}=n.selection,s,o=e.sharedDepth(i);return o==0?!1:(s=e.before(o),t&&t(n.tr.setSelection(Y.create(n.doc,s))),!0)};function uv(n,t,e){let i=t.nodeBefore,s=t.nodeAfter,o=t.index();return!i||!s||!i.type.compatibleContent(s.type)?!1:!i.content.size&&t.parent.canReplace(o-1,o)?(e&&e(n.tr.delete(t.pos-i.nodeSize,t.pos).scrollIntoView()),!0):!t.parent.canReplace(o,o+1)||!(s.isTextblock||Fe(n.doc,t.pos))?!1:(e&&e(n.tr.join(t.pos).scrollIntoView()),!0)}function Tf(n,t,e,i){let s=t.nodeBefore,o=t.nodeAfter,a,c,u=s.type.spec.isolating||o.type.spec.isolating;if(!u&&uv(n,t,e))return!0;let f=!u&&t.parent.canReplace(t.index(),t.index()+1);if(f&&(a=(c=s.contentMatchAt(s.childCount)).findWrapping(o.type))&&c.matchType(a[0]||o.type).validEnd){if(e){let y=t.pos+o.nodeSize,v=z.empty;for(let M=a.length-1;M>=0;M--)v=z.from(a[M].create(null,v));v=z.from(s.copy(v));let b=n.tr.step(new Ft(t.pos-1,y,t.pos,y,new F(v,1,0),a.length,!0)),S=b.doc.resolve(y+2*a.length);S.nodeAfter&&S.nodeAfter.type==s.type&&Fe(b.doc,S.pos)&&b.join(S.pos),e(b.scrollIntoView())}return!0}let h=o.type.spec.isolating||i>0&&u?null:it.findFrom(t,1),m=h&&h.$from.blockRange(h.$to),g=m&&Zn(m);if(g!=null&&g>=t.depth)return e&&e(n.tr.lift(m,g).scrollIntoView()),!0;if(f&&fi(o,"start",!0)&&fi(s,"end")){let y=s,v=[];for(;v.push(y),!y.isTextblock;)y=y.lastChild;let b=o,S=1;for(;!b.isTextblock;b=b.firstChild)S++;if(y.canReplace(y.childCount,y.childCount,b.content)){if(e){let M=z.empty;for(let D=v.length-1;D>=0;D--)M=z.from(v[D].copy(M));let P=n.tr.step(new Ft(t.pos-v.length,t.pos+o.nodeSize,t.pos+S,t.pos+o.nodeSize-S,new F(M,v.length,0),0,!0));e(P.scrollIntoView())}return!0}}return!1}function Pf(n){return function(t,e){let i=t.selection,s=n<0?i.$from:i.$to,o=s.depth;for(;s.node(o).isInline;){if(!o)return!1;o--}return s.node(o).isTextblock?(e&&e(t.tr.setSelection(X.create(t.doc,n<0?s.start(o):s.end(o)))),!0):!1}}const Ef=Pf(-1),Of=Pf(1);function Af(n,t=null){return function(e,i){let{$from:s,$to:o}=e.selection,a=s.blockRange(o),c=a&&Sa(a,n,t);return c?(i&&i(e.tr.wrap(a,c).scrollIntoView()),!0):!1}}function ts(n,t=null){return function(e,i){let s=!1;for(let o=0;o<e.selection.ranges.length&&!s;o++){let{$from:{pos:a},$to:{pos:c}}=e.selection.ranges[o];e.doc.nodesBetween(a,c,(u,f)=>{if(s)return!1;if(!(!u.isTextblock||u.hasMarkup(n,t)))if(u.type==n)s=!0;else{let h=e.doc.resolve(f),m=h.index();s=h.parent.canReplaceWith(m,m+1,n)}})}if(!s)return!1;if(i){let o=e.tr;for(let a=0;a<e.selection.ranges.length;a++){let{$from:{pos:c},$to:{pos:u}}=e.selection.ranges[a];o.setBlockType(c,u,n,t)}i(o.scrollIntoView())}return!0}}function ja(...n){return function(t,e,i){for(let s=0;s<n.length;s++)if(n[s](t,e,i))return!0;return!1}}ja(Cs,Da,za);ja(Cs,Ba,$a);ja(Va,Za,Wa,cv);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function Lf(n,t=null){return function(e,i){let{$from:s,$to:o}=e.selection,a=s.blockRange(o);if(!a)return!1;let c=i?e.tr:null;return dv(c,a,n,t)?(i&&i(c.scrollIntoView()),!0):!1}}function dv(n,t,e,i=null){let s=!1,o=t,a=t.$from.doc;if(t.depth>=2&&t.$from.node(t.depth-1).type.compatibleContent(e)&&t.startIndex==0){if(t.$from.index(t.depth-1)==0)return!1;let u=a.resolve(t.start-2);o=new Ur(u,u,t.depth),t.endIndex<t.parent.childCount&&(t=new Ur(t.$from,a.resolve(t.$to.end(t.depth)),t.depth)),s=!0}let c=Sa(o,e,i,t);return c?(n&&fv(n,t,c,s,e),!0):!1}function fv(n,t,e,i,s){let o=z.empty;for(let h=e.length-1;h>=0;h--)o=z.from(e[h].type.create(e[h].attrs,o));n.step(new Ft(t.start-(i?2:0),t.end,t.start,t.end,new F(o,0,0),e.length,!0));let a=0;for(let h=0;h<e.length;h++)e[h].type==s&&(a=h+1);let c=e.length-a,u=t.start+e.length-(i?2:0),f=t.parent;for(let h=t.startIndex,m=t.endIndex,g=!0;h<m;h++,g=!1)!g&&me(n.doc,u,c)&&(n.split(u,c),u+=2*c),u+=f.child(h).nodeSize;return n}function If(n){return function(t,e){let{$from:i,$to:s}=t.selection,o=i.blockRange(s,a=>a.childCount>0&&a.firstChild.type==n);return o?e?i.node(o.depth-1).type==n?hv(t,e,n,o):pv(t,e,o):!0:!1}}function hv(n,t,e,i){let s=n.tr,o=i.end,a=i.$to.end(i.depth);o<a&&(s.step(new Ft(o-1,a,o,a,new F(z.from(e.create(null,i.parent.copy())),1,0),1,!0)),i=new Ur(s.doc.resolve(i.$from.pos),s.doc.resolve(a),i.depth));const c=Zn(i);if(c==null)return!1;s.lift(i,c);let u=s.doc.resolve(s.mapping.map(o,-1)-1);return Fe(s.doc,u.pos)&&u.nodeBefore.type==u.nodeAfter.type&&s.join(u.pos),t(s.scrollIntoView()),!0}function pv(n,t,e){let i=n.tr,s=e.parent;for(let y=e.end,v=e.endIndex-1,b=e.startIndex;v>b;v--)y-=s.child(v).nodeSize,i.delete(y-1,y+1);let o=i.doc.resolve(e.start),a=o.nodeAfter;if(i.mapping.map(e.end)!=e.start+o.nodeAfter.nodeSize)return!1;let c=e.startIndex==0,u=e.endIndex==s.childCount,f=o.node(-1),h=o.index(-1);if(!f.canReplace(h+(c?0:1),h+1,a.content.append(u?z.empty:z.from(s))))return!1;let m=o.pos,g=m+a.nodeSize;return i.step(new Ft(m-(c?1:0),g+(u?1:0),m+1,g-1,new F((c?z.empty:z.from(s.copy(z.empty))).append(u?z.empty:z.from(s.copy(z.empty))),c?0:1,u?0:1),c?0:1)),t(i.scrollIntoView()),!0}function Nf(n){return function(t,e){let{$from:i,$to:s}=t.selection,o=i.blockRange(s,f=>f.childCount>0&&f.firstChild.type==n);if(!o)return!1;let a=o.startIndex;if(a==0)return!1;let c=o.parent,u=c.child(a-1);if(u.type!=n)return!1;if(e){let f=u.lastChild&&u.lastChild.type==c.type,h=z.from(f?n.create():null),m=new F(z.from(n.create(null,z.from(c.type.create(null,h)))),f?3:1,0),g=o.start,y=o.end;e(t.tr.step(new Ft(g-(f?3:1),y,g,y,m,1,!0)).scrollIntoView())}return!0}}function Ms(n){const{state:t,transaction:e}=n;let{selection:i}=e,{doc:s}=e,{storedMarks:o}=e;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return o},get selection(){return i},get doc(){return s},get tr(){return i=e.selection,s=e.doc,o=e.storedMarks,e}}}let Ts=class{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:e,state:i}=this,{view:s}=e,{tr:o}=i,a=this.buildProps(o);return Object.fromEntries(Object.entries(t).map(([c,u])=>[c,(...h)=>{const m=u(...h)(a);return!o.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(o),m}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){const{rawCommands:i,editor:s,state:o}=this,{view:a}=s,c=[],u=!!t,f=t||o.tr,h=()=>(!u&&e&&!f.getMeta("preventDispatch")&&!this.hasCustomState&&a.dispatch(f),c.every(g=>g===!0)),m={...Object.fromEntries(Object.entries(i).map(([g,y])=>[g,(...b)=>{const S=this.buildProps(f,e),M=y(...b)(S);return c.push(M),m}])),run:h};return m}createCan(t){const{rawCommands:e,state:i}=this,s=!1,o=t||i.tr,a=this.buildProps(o,s);return{...Object.fromEntries(Object.entries(e).map(([u,f])=>[u,(...h)=>f(...h)({...a,dispatch:void 0})])),chain:()=>this.createChain(o,s)}}buildProps(t,e=!0){const{rawCommands:i,editor:s,state:o}=this,{view:a}=s,c={tr:t,editor:s,view:a,state:Ms({state:o,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t,e),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(i).map(([u,f])=>[u,(...h)=>f(...h)(c)]))}};return c}};class mv{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const i=this.callbacks[t];return i&&i.forEach(s=>s.apply(this,e)),this}off(t,e){const i=this.callbacks[t];return i&&(e?this.callbacks[t]=i.filter(s=>s!==e):delete this.callbacks[t]),this}once(t,e){const i=(...s)=>{this.off(t,i),e.apply(this,s)};return this.on(t,i)}removeAllListeners(){this.callbacks={}}}function J(n,t,e){return n.config[t]===void 0&&n.parent?J(n.parent,t,e):typeof n.config[t]=="function"?n.config[t].bind({...e,parent:n.parent?J(n.parent,t,e):null}):n.config[t]}function Ps(n){const t=n.filter(s=>s.type==="extension"),e=n.filter(s=>s.type==="node"),i=n.filter(s=>s.type==="mark");return{baseExtensions:t,nodeExtensions:e,markExtensions:i}}function Df(n){const t=[],{nodeExtensions:e,markExtensions:i}=Ps(n),s=[...e,...i],o={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return n.forEach(a=>{const c={name:a.name,options:a.options,storage:a.storage,extensions:s},u=J(a,"addGlobalAttributes",c);if(!u)return;u().forEach(h=>{h.types.forEach(m=>{Object.entries(h.attributes).forEach(([g,y])=>{t.push({type:m,name:g,attribute:{...o,...y}})})})})}),s.forEach(a=>{const c={name:a.name,options:a.options,storage:a.storage},u=J(a,"addAttributes",c);if(!u)return;const f=u();Object.entries(f).forEach(([h,m])=>{const g={...o,...m};typeof g?.default=="function"&&(g.default=g.default()),g?.isRequired&&g?.default===void 0&&delete g.default,t.push({type:a.name,name:h,attribute:g})})}),t}function Wt(n,t){if(typeof n=="string"){if(!t.nodes[n])throw Error(`There is no node type named '${n}'. Maybe you forgot to add the extension?`);return t.nodes[n]}return n}function gv(...n){return n.filter(t=>!!t).reduce((t,e)=>{const i={...t};return Object.entries(e).forEach(([s,o])=>{if(!i[s]){i[s]=o;return}if(s==="class"){const c=o?String(o).split(" "):[],u=i[s]?i[s].split(" "):[],f=c.filter(h=>!u.includes(h));i[s]=[...u,...f].join(" ")}else if(s==="style"){const c=o?o.split(";").map(h=>h.trim()).filter(Boolean):[],u=i[s]?i[s].split(";").map(h=>h.trim()).filter(Boolean):[],f=new Map;u.forEach(h=>{const[m,g]=h.split(":").map(y=>y.trim());f.set(m,g)}),c.forEach(h=>{const[m,g]=h.split(":").map(y=>y.trim());f.set(m,g)}),i[s]=Array.from(f.entries()).map(([h,m])=>`${h}: ${m}`).join("; ")}else i[s]=o}),i},{})}function Qo(n,t){return t.filter(e=>e.type===n.type.name).filter(e=>e.attribute.rendered).map(e=>e.attribute.renderHTML?e.attribute.renderHTML(n.attrs)||{}:{[e.name]:n.attrs[e.name]}).reduce((e,i)=>gv(e,i),{})}function zf(n){return typeof n=="function"}function mt(n,t=void 0,...e){return zf(n)?t?n.bind(t)(...e):n(...e):n}function _v(n={}){return Object.keys(n).length===0&&n.constructor===Object}function yv(n){return typeof n!="string"?n:n.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(n):n==="true"?!0:n==="false"?!1:n}function yu(n,t){return"style"in n?n:{...n,getAttrs:e=>{const i=n.getAttrs?n.getAttrs(e):n.attrs;if(i===!1)return!1;const s=t.reduce((o,a)=>{const c=a.attribute.parseHTML?a.attribute.parseHTML(e):yv(e.getAttribute(a.name));return c==null?o:{...o,[a.name]:c}},{});return{...i,...s}}}}function vu(n){return Object.fromEntries(Object.entries(n).filter(([t,e])=>t==="attrs"&&_v(e)?!1:e!=null))}function vv(n,t){var e;const i=Df(n),{nodeExtensions:s,markExtensions:o}=Ps(n),a=(e=s.find(f=>J(f,"topNode")))===null||e===void 0?void 0:e.name,c=Object.fromEntries(s.map(f=>{const h=i.filter(M=>M.type===f.name),m={name:f.name,options:f.options,storage:f.storage,editor:t},g=n.reduce((M,P)=>{const D=J(P,"extendNodeSchema",m);return{...M,...D?D(f):{}}},{}),y=vu({...g,content:mt(J(f,"content",m)),marks:mt(J(f,"marks",m)),group:mt(J(f,"group",m)),inline:mt(J(f,"inline",m)),atom:mt(J(f,"atom",m)),selectable:mt(J(f,"selectable",m)),draggable:mt(J(f,"draggable",m)),code:mt(J(f,"code",m)),whitespace:mt(J(f,"whitespace",m)),linebreakReplacement:mt(J(f,"linebreakReplacement",m)),defining:mt(J(f,"defining",m)),isolating:mt(J(f,"isolating",m)),attrs:Object.fromEntries(h.map(M=>{var P;return[M.name,{default:(P=M?.attribute)===null||P===void 0?void 0:P.default}]}))}),v=mt(J(f,"parseHTML",m));v&&(y.parseDOM=v.map(M=>yu(M,h)));const b=J(f,"renderHTML",m);b&&(y.toDOM=M=>b({node:M,HTMLAttributes:Qo(M,h)}));const S=J(f,"renderText",m);return S&&(y.toText=S),[f.name,y]})),u=Object.fromEntries(o.map(f=>{const h=i.filter(S=>S.type===f.name),m={name:f.name,options:f.options,storage:f.storage,editor:t},g=n.reduce((S,M)=>{const P=J(M,"extendMarkSchema",m);return{...S,...P?P(f):{}}},{}),y=vu({...g,inclusive:mt(J(f,"inclusive",m)),excludes:mt(J(f,"excludes",m)),group:mt(J(f,"group",m)),spanning:mt(J(f,"spanning",m)),code:mt(J(f,"code",m)),attrs:Object.fromEntries(h.map(S=>{var M;return[S.name,{default:(M=S?.attribute)===null||M===void 0?void 0:M.default}]}))}),v=mt(J(f,"parseHTML",m));v&&(y.parseDOM=v.map(S=>yu(S,h)));const b=J(f,"renderHTML",m);return b&&(y.toDOM=S=>b({mark:S,HTMLAttributes:Qo(S,h)})),[f.name,y]}));return new xa({topNode:a,nodes:c,marks:u})}function Ao(n,t){return t.nodes[n]||t.marks[n]||null}function bu(n,t){return Array.isArray(t)?t.some(e=>(typeof e=="string"?e:e.name)===n.name):t}function Ua(n,t){const e=Hn.fromSchema(t).serializeFragment(n),s=document.implementation.createHTMLDocument().createElement("div");return s.appendChild(e),s.innerHTML}const bv=(n,t=500)=>{let e="";const i=n.parentOffset;return n.parent.nodesBetween(Math.max(0,i-t),i,(s,o,a,c)=>{var u,f;const h=((f=(u=s.type.spec).toText)===null||f===void 0?void 0:f.call(u,{node:s,pos:o,parent:a,index:c}))||s.textContent||"%leaf%";e+=s.isAtom&&!s.isText?h:h.slice(0,Math.max(0,i-o))}),e};function qa(n){return Object.prototype.toString.call(n)==="[object RegExp]"}const xv=(n,t)=>{if(qa(t))return t.exec(n);const e=t(n);if(!e)return null;const i=[e.text];return i.index=e.index,i.input=n,i.data=e.data,e.replaceWith&&(e.text.includes(e.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),i.push(e.replaceWith)),i};function Ar(n){var t;const{editor:e,from:i,to:s,text:o,rules:a,plugin:c}=n,{view:u}=e;if(u.composing)return!1;const f=u.state.doc.resolve(i);if(f.parent.type.spec.code||!((t=f.nodeBefore||f.nodeAfter)===null||t===void 0)&&t.marks.find(g=>g.type.spec.code))return!1;let h=!1;const m=bv(f)+o;return a.forEach(g=>{if(h)return;const y=xv(m,g.find);if(!y)return;const v=u.state.tr,b=Ms({state:u.state,transaction:v}),S={from:i-(y[0].length-o.length),to:s},{commands:M,chain:P,can:D}=new Ts({editor:e,state:b});g.handler({state:b,range:S,match:y,commands:M,chain:P,can:D})===null||!v.steps.length||(v.setMeta(c,{transform:v,from:i,to:s,text:o}),u.dispatch(v),h=!0)}),h}function kv(n){const{editor:t,rules:e}=n,i=new xt({state:{init(){return null},apply(s,o,a){const c=s.getMeta(i);if(c)return c;const u=s.getMeta("applyInputRules");return u&&setTimeout(()=>{let{text:h}=u;typeof h=="string"?h=h:h=Ua(z.from(h),a.schema);const{from:m}=u,g=m+h.length;Ar({editor:t,from:m,to:g,text:h,rules:e,plugin:i})}),s.selectionSet||s.docChanged?null:o}},props:{handleTextInput(s,o,a,c){return Ar({editor:t,from:o,to:a,text:c,rules:e,plugin:i})},handleDOMEvents:{compositionend:s=>(setTimeout(()=>{const{$cursor:o}=s.state.selection;o&&Ar({editor:t,from:o.pos,to:o.pos,text:"",rules:e,plugin:i})}),!1)},handleKeyDown(s,o){if(o.key!=="Enter")return!1;const{$cursor:a}=s.state.selection;return a?Ar({editor:t,from:a.pos,to:a.pos,text:`
`,rules:e,plugin:i}):!1}},isInputRules:!0});return i}function wv(n){return Object.prototype.toString.call(n).slice(8,-1)}function Lr(n){return wv(n)!=="Object"?!1:n.constructor===Object&&Object.getPrototypeOf(n)===Object.prototype}function Ka(n,t){const e={...n};return Lr(n)&&Lr(t)&&Object.keys(t).forEach(i=>{Lr(t[i])&&Lr(n[i])?e[i]=Ka(n[i],t[i]):e[i]=t[i]}),e}let Sv=class ta{constructor(t={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=mt(J(this,"addOptions",{name:this.name}))),this.storage=mt(J(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new ta(t)}configure(t={}){const e=this.extend({...this.config,addOptions:()=>Ka(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){const e=new ta(t);return e.parent=this,this.child=e,e.name=t.name?t.name:e.parent.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${e.name}".`),e.options=mt(J(e,"addOptions",{name:e.name})),e.storage=mt(J(e,"addStorage",{name:e.name,options:e.options})),e}static handleExit({editor:t,mark:e}){const{tr:i}=t.state,s=t.state.selection.$from;if(s.pos===s.end()){const a=s.marks();if(!!!a.find(f=>f?.type.name===e.name))return!1;const u=a.find(f=>f?.type.name===e.name);return u&&i.removeStoredMark(u),i.insertText(" ",s.pos),t.view.dispatch(i),!0}return!1}};function Cv(n){return typeof n=="number"}const Mv=(n,t,e)=>{if(qa(t))return[...n.matchAll(t)];const i=t(n,e);return i?i.map(s=>{const o=[s.text];return o.index=s.index,o.input=n,o.data=s.data,s.replaceWith&&(s.text.includes(s.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),o.push(s.replaceWith)),o}):[]};function Tv(n){const{editor:t,state:e,from:i,to:s,rule:o,pasteEvent:a,dropEvent:c}=n,{commands:u,chain:f,can:h}=new Ts({editor:t,state:e}),m=[];return e.doc.nodesBetween(i,s,(y,v)=>{if(!y.isTextblock||y.type.spec.code)return;const b=Math.max(i,v),S=Math.min(s,v+y.content.size),M=y.textBetween(b-v,S-v,void 0,"");Mv(M,o.find,a).forEach(D=>{if(D.index===void 0)return;const V=b+D.index+1,$=V+D[0].length,U={from:e.tr.mapping.map(V),to:e.tr.mapping.map($)},K=o.handler({state:e,range:U,match:D,commands:u,chain:f,can:h,pasteEvent:a,dropEvent:c});m.push(K)})}),m.every(y=>y!==null)}let Ir=null;const Pv=n=>{var t;const e=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(t=e.clipboardData)===null||t===void 0||t.setData("text/html",n),e};function Ev(n){const{editor:t,rules:e}=n;let i=null,s=!1,o=!1,a=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,c;try{c=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{c=null}const u=({state:h,from:m,to:g,rule:y,pasteEvt:v})=>{const b=h.tr,S=Ms({state:h,transaction:b});if(!(!Tv({editor:t,state:S,from:Math.max(m-1,0),to:g.b-1,rule:y,pasteEvent:v,dropEvent:c})||!b.steps.length)){try{c=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{c=null}return a=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,b}};return e.map(h=>new xt({view(m){const g=v=>{var b;i=!((b=m.dom.parentElement)===null||b===void 0)&&b.contains(v.target)?m.dom.parentElement:null,i&&(Ir=t)},y=()=>{Ir&&(Ir=null)};return window.addEventListener("dragstart",g),window.addEventListener("dragend",y),{destroy(){window.removeEventListener("dragstart",g),window.removeEventListener("dragend",y)}}},props:{handleDOMEvents:{drop:(m,g)=>{if(o=i===m.dom.parentElement,c=g,!o){const y=Ir;y?.isEditable&&setTimeout(()=>{const v=y.state.selection;v&&y.commands.deleteRange({from:v.from,to:v.to})},10)}return!1},paste:(m,g)=>{var y;const v=(y=g.clipboardData)===null||y===void 0?void 0:y.getData("text/html");return a=g,s=!!v?.includes("data-pm-slice"),!1}}},appendTransaction:(m,g,y)=>{const v=m[0],b=v.getMeta("uiEvent")==="paste"&&!s,S=v.getMeta("uiEvent")==="drop"&&!o,M=v.getMeta("applyPasteRules"),P=!!M;if(!b&&!S&&!P)return;if(P){let{text:$}=M;typeof $=="string"?$=$:$=Ua(z.from($),y.schema);const{from:U}=M,K=U+$.length,B=Pv($);return u({rule:h,state:y,from:U,to:{b:K},pasteEvt:B})}const D=g.doc.content.findDiffStart(y.doc.content),V=g.doc.content.findDiffEnd(y.doc.content);if(!(!Cv(D)||!V||D===V.b))return u({rule:h,state:y,from:D,to:V,pasteEvt:a})}}))}function Ov(n){const t=n.filter((e,i)=>n.indexOf(e)!==i);return Array.from(new Set(t))}class oi{constructor(t,e){this.splittableMarks=[],this.editor=e,this.extensions=oi.resolve(t),this.schema=vv(this.extensions,e),this.setupExtensions()}static resolve(t){const e=oi.sort(oi.flatten(t)),i=Ov(e.map(s=>s.name));return i.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${i.map(s=>`'${s}'`).join(", ")}]. This can lead to issues.`),e}static flatten(t){return t.map(e=>{const i={name:e.name,options:e.options,storage:e.storage},s=J(e,"addExtensions",i);return s?[e,...this.flatten(s())]:e}).flat(10)}static sort(t){return t.sort((i,s)=>{const o=J(i,"priority")||100,a=J(s,"priority")||100;return o>a?-1:o<a?1:0})}get commands(){return this.extensions.reduce((t,e)=>{const i={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:Ao(e.name,this.schema)},s=J(e,"addCommands",i);return s?{...t,...s()}:t},{})}get plugins(){const{editor:t}=this,e=oi.sort([...this.extensions].reverse()),i=[],s=[],o=e.map(a=>{const c={name:a.name,options:a.options,storage:a.storage,editor:t,type:Ao(a.name,this.schema)},u=[],f=J(a,"addKeyboardShortcuts",c);let h={};if(a.type==="mark"&&J(a,"exitable",c)&&(h.ArrowRight=()=>Sv.handleExit({editor:t,mark:a})),f){const b=Object.fromEntries(Object.entries(f()).map(([S,M])=>[S,()=>M({editor:t})]));h={...h,...b}}const m=av(h);u.push(m);const g=J(a,"addInputRules",c);bu(a,t.options.enableInputRules)&&g&&i.push(...g());const y=J(a,"addPasteRules",c);bu(a,t.options.enablePasteRules)&&y&&s.push(...y());const v=J(a,"addProseMirrorPlugins",c);if(v){const b=v();u.push(...b)}return u}).flat();return[kv({editor:t,rules:i}),...Ev({editor:t,rules:s}),...o]}get attributes(){return Df(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:e}=Ps(this.extensions);return Object.fromEntries(e.filter(i=>!!J(i,"addNodeView")).map(i=>{const s=this.attributes.filter(u=>u.type===i.name),o={name:i.name,options:i.options,storage:i.storage,editor:t,type:Wt(i.name,this.schema)},a=J(i,"addNodeView",o);if(!a)return[];const c=(u,f,h,m,g)=>{const y=Qo(u,s);return a()({node:u,view:f,getPos:h,decorations:m,innerDecorations:g,editor:t,extension:i,HTMLAttributes:y})};return[i.name,c]}))}setupExtensions(){this.extensions.forEach(t=>{var e;this.editor.extensionStorage[t.name]=t.storage;const i={name:t.name,options:t.options,storage:t.storage,editor:this.editor,type:Ao(t.name,this.schema)};t.type==="mark"&&(!((e=mt(J(t,"keepOnSplit",i)))!==null&&e!==void 0)||e)&&this.splittableMarks.push(t.name);const s=J(t,"onBeforeCreate",i),o=J(t,"onCreate",i),a=J(t,"onUpdate",i),c=J(t,"onSelectionUpdate",i),u=J(t,"onTransaction",i),f=J(t,"onFocus",i),h=J(t,"onBlur",i),m=J(t,"onDestroy",i);s&&this.editor.on("beforeCreate",s),o&&this.editor.on("create",o),a&&this.editor.on("update",a),c&&this.editor.on("selectionUpdate",c),u&&this.editor.on("transaction",u),f&&this.editor.on("focus",f),h&&this.editor.on("blur",h),m&&this.editor.on("destroy",m)})}}let vn=class ea{constructor(t={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=mt(J(this,"addOptions",{name:this.name}))),this.storage=mt(J(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new ea(t)}configure(t={}){const e=this.extend({...this.config,addOptions:()=>Ka(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){const e=new ea({...this.config,...t});return e.parent=this,this.child=e,e.name=t.name?t.name:e.parent.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${e.name}".`),e.options=mt(J(e,"addOptions",{name:e.name})),e.storage=mt(J(e,"addStorage",{name:e.name,options:e.options})),e}};function Rf(n,t,e){const{from:i,to:s}=t,{blockSeparator:o=`

`,textSerializers:a={}}=e||{};let c="";return n.nodesBetween(i,s,(u,f,h,m)=>{var g;u.isBlock&&f>i&&(c+=o);const y=a?.[u.type.name];if(y)return h&&(c+=y({node:u,pos:f,parent:h,index:m,range:t})),!1;u.isText&&(c+=(g=u?.text)===null||g===void 0?void 0:g.slice(Math.max(i,f)-f,s-f))}),c}function Bf(n){return Object.fromEntries(Object.entries(n.nodes).filter(([,t])=>t.spec.toText).map(([t,e])=>[t,e.spec.toText]))}const Av=vn.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new xt({key:new It("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:n}=this,{state:t,schema:e}=n,{doc:i,selection:s}=t,{ranges:o}=s,a=Math.min(...o.map(h=>h.$from.pos)),c=Math.max(...o.map(h=>h.$to.pos)),u=Bf(e);return Rf(i,{from:a,to:c},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:u})}}})]}}),Lv=()=>({editor:n,view:t})=>(requestAnimationFrame(()=>{var e;n.isDestroyed||(t.dom.blur(),(e=window?.getSelection())===null||e===void 0||e.removeAllRanges())}),!0),Iv=(n=!1)=>({commands:t})=>t.setContent("",n),Nv=()=>({state:n,tr:t,dispatch:e})=>{const{selection:i}=t,{ranges:s}=i;return e&&s.forEach(({$from:o,$to:a})=>{n.doc.nodesBetween(o.pos,a.pos,(c,u)=>{if(c.type.isText)return;const{doc:f,mapping:h}=t,m=f.resolve(h.map(u)),g=f.resolve(h.map(u+c.nodeSize)),y=m.blockRange(g);if(!y)return;const v=Zn(y);if(c.type.isTextblock){const{defaultType:b}=m.parent.contentMatchAt(m.index());t.setNodeMarkup(y.start,b)}(v||v===0)&&t.lift(y,v)})}),!0},Dv=n=>t=>n(t),zv=()=>({state:n,dispatch:t})=>Za(n,t),Rv=(n,t)=>({editor:e,tr:i})=>{const{state:s}=e,o=s.doc.slice(n.from,n.to);i.deleteRange(n.from,n.to);const a=i.mapping.map(t);return i.insert(a,o.content),i.setSelection(new X(i.doc.resolve(Math.max(a-1,0)))),!0},Bv=()=>({tr:n,dispatch:t})=>{const{selection:e}=n,i=e.$anchor.node();if(i.content.size>0)return!1;const s=n.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i.type){if(t){const c=s.before(o),u=s.after(o);n.delete(c,u).scrollIntoView()}return!0}return!1},$v=n=>({tr:t,state:e,dispatch:i})=>{const s=Wt(n,e.schema),o=t.selection.$anchor;for(let a=o.depth;a>0;a-=1)if(o.node(a).type===s){if(i){const u=o.before(a),f=o.after(a);t.delete(u,f).scrollIntoView()}return!0}return!1},Fv=n=>({tr:t,dispatch:e})=>{const{from:i,to:s}=n;return e&&t.delete(i,s),!0},Vv=()=>({state:n,dispatch:t})=>Cs(n,t),Hv=()=>({commands:n})=>n.keyboardShortcut("Enter"),Zv=()=>({state:n,dispatch:t})=>Cf(n,t);function es(n,t,e={strict:!0}){const i=Object.keys(t);return i.length?i.every(s=>e.strict?t[s]===n[s]:qa(t[s])?t[s].test(n[s]):t[s]===n[s]):!0}function $f(n,t,e={}){return n.find(i=>i.type===t&&es(Object.fromEntries(Object.keys(e).map(s=>[s,i.attrs[s]])),e))}function xu(n,t,e={}){return!!$f(n,t,e)}function Ff(n,t,e){var i;if(!n||!t)return;let s=n.parent.childAfter(n.parentOffset);if((!s.node||!s.node.marks.some(h=>h.type===t))&&(s=n.parent.childBefore(n.parentOffset)),!s.node||!s.node.marks.some(h=>h.type===t)||(e=e||((i=s.node.marks[0])===null||i===void 0?void 0:i.attrs),!$f([...s.node.marks],t,e)))return;let a=s.index,c=n.start()+s.offset,u=a+1,f=c+s.node.nodeSize;for(;a>0&&xu([...n.parent.child(a-1).marks],t,e);)a-=1,c-=n.parent.child(a).nodeSize;for(;u<n.parent.childCount&&xu([...n.parent.child(u).marks],t,e);)f+=n.parent.child(u).nodeSize,u+=1;return{from:c,to:f}}function bn(n,t){if(typeof n=="string"){if(!t.marks[n])throw Error(`There is no mark type named '${n}'. Maybe you forgot to add the extension?`);return t.marks[n]}return n}const Wv=(n,t={})=>({tr:e,state:i,dispatch:s})=>{const o=bn(n,i.schema),{doc:a,selection:c}=e,{$from:u,from:f,to:h}=c;if(s){const m=Ff(u,o,t);if(m&&m.from<=f&&m.to>=h){const g=X.create(a,m.from,m.to);e.setSelection(g)}}return!0},jv=n=>t=>{const e=typeof n=="function"?n(t):n;for(let i=0;i<e.length;i+=1)if(e[i](t))return!0;return!1};function Vf(n){return n instanceof X}function An(n=0,t=0,e=0){return Math.min(Math.max(n,t),e)}function Hf(n,t=null){if(!t)return null;const e=it.atStart(n),i=it.atEnd(n);if(t==="start"||t===!0)return e;if(t==="end")return i;const s=e.from,o=i.to;return t==="all"?X.create(n,An(0,s,o),An(n.content.size,s,o)):X.create(n,An(t,s,o),An(t,s,o))}function Uv(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function Ja(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const qv=(n=null,t={})=>({editor:e,view:i,tr:s,dispatch:o})=>{t={scrollIntoView:!0,...t};const a=()=>{(Ja()||Uv())&&i.dom.focus(),requestAnimationFrame(()=>{e.isDestroyed||(i.focus(),t?.scrollIntoView&&e.commands.scrollIntoView())})};if(i.hasFocus()&&n===null||n===!1)return!0;if(o&&n===null&&!Vf(e.state.selection))return a(),!0;const c=Hf(s.doc,n)||e.state.selection,u=e.state.selection.eq(c);return o&&(u||s.setSelection(c),u&&s.storedMarks&&s.setStoredMarks(s.storedMarks),a()),!0},Kv=(n,t)=>e=>n.every((i,s)=>t(i,{...e,index:s})),Jv=(n,t)=>({tr:e,commands:i})=>i.insertContentAt({from:e.selection.from,to:e.selection.to},n,t),Zf=n=>{const t=n.childNodes;for(let e=t.length-1;e>=0;e-=1){const i=t[e];i.nodeType===3&&i.nodeValue&&/^(\n\s\s|\n)$/.test(i.nodeValue)?n.removeChild(i):i.nodeType===1&&Zf(i)}return n};function Nr(n){const t=`<body>${n}</body>`,e=new window.DOMParser().parseFromString(t,"text/html").body;return Zf(e)}function Xi(n,t,e){if(n instanceof ke||n instanceof z)return n;e={slice:!0,parseOptions:{},...e};const i=typeof n=="object"&&n!==null,s=typeof n=="string";if(i)try{if(Array.isArray(n)&&n.length>0)return z.fromArray(n.map(c=>t.nodeFromJSON(c)));const a=t.nodeFromJSON(n);return e.errorOnInvalidContent&&a.check(),a}catch(o){if(e.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:o});return console.warn("[tiptap warn]: Invalid content.","Passed value:",n,"Error:",o),Xi("",t,e)}if(s){if(e.errorOnInvalidContent){let a=!1,c="";const u=new xa({topNode:t.spec.topNode,marks:t.spec.marks,nodes:t.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:f=>(a=!0,c=typeof f=="string"?f:f.outerHTML,null)}]}})});if(e.slice?Ee.fromSchema(u).parseSlice(Nr(n),e.parseOptions):Ee.fromSchema(u).parse(Nr(n),e.parseOptions),e.errorOnInvalidContent&&a)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${c}`)})}const o=Ee.fromSchema(t);return e.slice?o.parseSlice(Nr(n),e.parseOptions).content:o.parse(Nr(n),e.parseOptions)}return Xi("",t,e)}function Gv(n,t,e){const i=n.steps.length-1;if(i<t)return;const s=n.steps[i];if(!(s instanceof $t||s instanceof Ft))return;const o=n.mapping.maps[i];let a=0;o.forEach((c,u,f,h)=>{a===0&&(a=h)}),n.setSelection(it.near(n.doc.resolve(a),e))}const Yv=n=>!("type"in n),Xv=(n,t,e)=>({tr:i,dispatch:s,editor:o})=>{var a;if(s){e={parseOptions:o.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...e};let c;const u=S=>{o.emit("contentError",{editor:o,error:S,disableCollaboration:()=>{o.storage.collaboration&&(o.storage.collaboration.isDisabled=!0)}})},f={preserveWhitespace:"full",...e.parseOptions};if(!e.errorOnInvalidContent&&!o.options.enableContentCheck&&o.options.emitContentError)try{Xi(t,o.schema,{parseOptions:f,errorOnInvalidContent:!0})}catch(S){u(S)}try{c=Xi(t,o.schema,{parseOptions:f,errorOnInvalidContent:(a=e.errorOnInvalidContent)!==null&&a!==void 0?a:o.options.enableContentCheck})}catch(S){return u(S),!1}let{from:h,to:m}=typeof n=="number"?{from:n,to:n}:{from:n.from,to:n.to},g=!0,y=!0;if((Yv(c)?c:[c]).forEach(S=>{S.check(),g=g?S.isText&&S.marks.length===0:!1,y=y?S.isBlock:!1}),h===m&&y){const{parent:S}=i.doc.resolve(h);S.isTextblock&&!S.type.spec.code&&!S.childCount&&(h-=1,m+=1)}let b;if(g){if(Array.isArray(t))b=t.map(S=>S.text||"").join("");else if(t instanceof z){let S="";t.forEach(M=>{M.text&&(S+=M.text)}),b=S}else typeof t=="object"&&t&&t.text?b=t.text:b=t;i.insertText(b,h,m)}else b=c,i.replaceWith(h,m,b);e.updateSelection&&Gv(i,i.steps.length-1,-1),e.applyInputRules&&i.setMeta("applyInputRules",{from:h,text:b}),e.applyPasteRules&&i.setMeta("applyPasteRules",{from:h,text:b})}return!0},Qv=()=>({state:n,dispatch:t})=>kf(n,t),tb=()=>({state:n,dispatch:t})=>wf(n,t),eb=()=>({state:n,dispatch:t})=>Da(n,t),nb=()=>({state:n,dispatch:t})=>Ba(n,t),ib=()=>({state:n,dispatch:t,tr:e})=>{try{const i=bi(n.doc,n.selection.$from.pos,-1);return i==null?!1:(e.join(i,2),t&&t(e),!0)}catch{return!1}},rb=()=>({state:n,dispatch:t,tr:e})=>{try{const i=bi(n.doc,n.selection.$from.pos,1);return i==null?!1:(e.join(i,2),t&&t(e),!0)}catch{return!1}},sb=()=>({state:n,dispatch:t})=>yf(n,t),ob=()=>({state:n,dispatch:t})=>vf(n,t);function Wf(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function ab(n){const t=n.split(/-(?!$)/);let e=t[t.length-1];e==="Space"&&(e=" ");let i,s,o,a;for(let c=0;c<t.length-1;c+=1){const u=t[c];if(/^(cmd|meta|m)$/i.test(u))a=!0;else if(/^a(lt)?$/i.test(u))i=!0;else if(/^(c|ctrl|control)$/i.test(u))s=!0;else if(/^s(hift)?$/i.test(u))o=!0;else if(/^mod$/i.test(u))Ja()||Wf()?a=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${u}`)}return i&&(e=`Alt-${e}`),s&&(e=`Ctrl-${e}`),a&&(e=`Meta-${e}`),o&&(e=`Shift-${e}`),e}const lb=n=>({editor:t,view:e,tr:i,dispatch:s})=>{const o=ab(n).split(/-(?!$)/),a=o.find(f=>!["Alt","Ctrl","Meta","Shift"].includes(f)),c=new KeyboardEvent("keydown",{key:a==="Space"?" ":a,altKey:o.includes("Alt"),ctrlKey:o.includes("Ctrl"),metaKey:o.includes("Meta"),shiftKey:o.includes("Shift"),bubbles:!0,cancelable:!0}),u=t.captureTransaction(()=>{e.someProp("handleKeyDown",f=>f(e,c))});return u?.steps.forEach(f=>{const h=f.map(i.mapping);h&&s&&i.maybeStep(h)}),!0};function Qi(n,t,e={}){const{from:i,to:s,empty:o}=n.selection,a=t?Wt(t,n.schema):null,c=[];n.doc.nodesBetween(i,s,(m,g)=>{if(m.isText)return;const y=Math.max(i,g),v=Math.min(s,g+m.nodeSize);c.push({node:m,from:y,to:v})});const u=s-i,f=c.filter(m=>a?a.name===m.node.type.name:!0).filter(m=>es(m.node.attrs,e,{strict:!1}));return o?!!f.length:f.reduce((m,g)=>m+g.to-g.from,0)>=u}const cb=(n,t={})=>({state:e,dispatch:i})=>{const s=Wt(n,e.schema);return Qi(e,s,t)?Sf(e,i):!1},ub=()=>({state:n,dispatch:t})=>Wa(n,t),db=n=>({state:t,dispatch:e})=>{const i=Wt(n,t.schema);return If(i)(t,e)},fb=()=>({state:n,dispatch:t})=>Va(n,t);function Es(n,t){return t.nodes[n]?"node":t.marks[n]?"mark":null}function ku(n,t){const e=typeof t=="string"?[t]:t;return Object.keys(n).reduce((i,s)=>(e.includes(s)||(i[s]=n[s]),i),{})}const hb=(n,t)=>({tr:e,state:i,dispatch:s})=>{let o=null,a=null;const c=Es(typeof n=="string"?n:n.name,i.schema);return c?(c==="node"&&(o=Wt(n,i.schema)),c==="mark"&&(a=bn(n,i.schema)),s&&e.selection.ranges.forEach(u=>{i.doc.nodesBetween(u.$from.pos,u.$to.pos,(f,h)=>{o&&o===f.type&&e.setNodeMarkup(h,void 0,ku(f.attrs,t)),a&&f.marks.length&&f.marks.forEach(m=>{a===m.type&&e.addMark(h,h+f.nodeSize,a.create(ku(m.attrs,t)))})})}),!0):!1},pb=()=>({tr:n,dispatch:t})=>(t&&n.scrollIntoView(),!0),mb=()=>({tr:n,dispatch:t})=>{if(t){const e=new ue(n.doc);n.setSelection(e)}return!0},gb=()=>({state:n,dispatch:t})=>za(n,t),_b=()=>({state:n,dispatch:t})=>$a(n,t),yb=()=>({state:n,dispatch:t})=>Mf(n,t),vb=()=>({state:n,dispatch:t})=>Of(n,t),bb=()=>({state:n,dispatch:t})=>Ef(n,t);function na(n,t,e={},i={}){return Xi(n,t,{slice:!1,parseOptions:e,errorOnInvalidContent:i.errorOnInvalidContent})}const xb=(n,t=!1,e={},i={})=>({editor:s,tr:o,dispatch:a,commands:c})=>{var u,f;const{doc:h}=o;if(e.preserveWhitespace!=="full"){const m=na(n,s.schema,e,{errorOnInvalidContent:(u=i.errorOnInvalidContent)!==null&&u!==void 0?u:s.options.enableContentCheck});return a&&o.replaceWith(0,h.content.size,m).setMeta("preventUpdate",!t),!0}return a&&o.setMeta("preventUpdate",!t),c.insertContentAt({from:0,to:h.content.size},n,{parseOptions:e,errorOnInvalidContent:(f=i.errorOnInvalidContent)!==null&&f!==void 0?f:s.options.enableContentCheck})};function jf(n,t){const e=bn(t,n.schema),{from:i,to:s,empty:o}=n.selection,a=[];o?(n.storedMarks&&a.push(...n.storedMarks),a.push(...n.selection.$head.marks())):n.doc.nodesBetween(i,s,u=>{a.push(...u.marks)});const c=a.find(u=>u.type.name===e.name);return c?{...c.attrs}:{}}function kb(n){for(let t=0;t<n.edgeCount;t+=1){const{type:e}=n.edge(t);if(e.isTextblock&&!e.hasRequiredAttrs())return e}return null}function wb(n,t){for(let e=n.depth;e>0;e-=1){const i=n.node(e);if(t(i))return{pos:e>0?n.before(e):0,start:n.start(e),depth:e,node:i}}}function Ga(n){return t=>wb(t.$from,n)}function Sb(n,t){const e={from:0,to:n.content.size};return Rf(n,e,t)}function Cb(n,t){const e=Wt(t,n.schema),{from:i,to:s}=n.selection,o=[];n.doc.nodesBetween(i,s,c=>{o.push(c)});const a=o.reverse().find(c=>c.type.name===e.name);return a?{...a.attrs}:{}}function Mb(n,t){const e=Es(typeof t=="string"?t:t.name,n.schema);return e==="node"?Cb(n,t):e==="mark"?jf(n,t):{}}function Fr(n,t,e){return Object.fromEntries(Object.entries(e).filter(([i])=>{const s=n.find(o=>o.type===t&&o.name===i);return s?s.attribute.keepOnSplit:!1}))}function ia(n,t,e={}){const{empty:i,ranges:s}=n.selection,o=t?bn(t,n.schema):null;if(i)return!!(n.storedMarks||n.selection.$from.marks()).filter(m=>o?o.name===m.type.name:!0).find(m=>es(m.attrs,e,{strict:!1}));let a=0;const c=[];if(s.forEach(({$from:m,$to:g})=>{const y=m.pos,v=g.pos;n.doc.nodesBetween(y,v,(b,S)=>{if(!b.isText&&!b.marks.length)return;const M=Math.max(y,S),P=Math.min(v,S+b.nodeSize),D=P-M;a+=D,c.push(...b.marks.map(V=>({mark:V,from:M,to:P})))})}),a===0)return!1;const u=c.filter(m=>o?o.name===m.mark.type.name:!0).filter(m=>es(m.mark.attrs,e,{strict:!1})).reduce((m,g)=>m+g.to-g.from,0),f=c.filter(m=>o?m.mark.type!==o&&m.mark.type.excludes(o):!0).reduce((m,g)=>m+g.to-g.from,0);return(u>0?u+f:u)>=a}function Tb(n,t,e={}){if(!t)return Qi(n,null,e)||ia(n,null,e);const i=Es(t,n.schema);return i==="node"?Qi(n,t,e):i==="mark"?ia(n,t,e):!1}function wu(n,t){const{nodeExtensions:e}=Ps(t),i=e.find(a=>a.name===n);if(!i)return!1;const s={name:i.name,options:i.options,storage:i.storage},o=mt(J(i,"group",s));return typeof o!="string"?!1:o.split(" ").includes("list")}function Ya(n,{checkChildren:t=!0,ignoreWhitespace:e=!1}={}){var i;if(e){if(n.type.name==="hardBreak")return!0;if(n.isText)return/^\s*$/m.test((i=n.text)!==null&&i!==void 0?i:"")}if(n.isText)return!n.text;if(n.isAtom||n.isLeaf)return!1;if(n.content.childCount===0)return!0;if(t){let s=!0;return n.content.forEach(o=>{s!==!1&&(Ya(o,{ignoreWhitespace:e,checkChildren:t})||(s=!1))}),s}return!1}function Pb(n,t,e){var i;const{selection:s}=t;let o=null;if(Vf(s)&&(o=s.$cursor),o){const c=(i=n.storedMarks)!==null&&i!==void 0?i:o.marks();return!!e.isInSet(c)||!c.some(u=>u.type.excludes(e))}const{ranges:a}=s;return a.some(({$from:c,$to:u})=>{let f=c.depth===0?n.doc.inlineContent&&n.doc.type.allowsMarkType(e):!1;return n.doc.nodesBetween(c.pos,u.pos,(h,m,g)=>{if(f)return!1;if(h.isInline){const y=!g||g.type.allowsMarkType(e),v=!!e.isInSet(h.marks)||!h.marks.some(b=>b.type.excludes(e));f=y&&v}return!f}),f})}const Eb=(n,t={})=>({tr:e,state:i,dispatch:s})=>{const{selection:o}=e,{empty:a,ranges:c}=o,u=bn(n,i.schema);if(s)if(a){const f=jf(i,u);e.addStoredMark(u.create({...f,...t}))}else c.forEach(f=>{const h=f.$from.pos,m=f.$to.pos;i.doc.nodesBetween(h,m,(g,y)=>{const v=Math.max(y,h),b=Math.min(y+g.nodeSize,m);g.marks.find(M=>M.type===u)?g.marks.forEach(M=>{u===M.type&&e.addMark(v,b,u.create({...M.attrs,...t}))}):e.addMark(v,b,u.create(t))})});return Pb(i,e,u)},Ob=(n,t)=>({tr:e})=>(e.setMeta(n,t),!0),Ab=(n,t={})=>({state:e,dispatch:i,chain:s})=>{const o=Wt(n,e.schema);let a;return e.selection.$anchor.sameParent(e.selection.$head)&&(a=e.selection.$anchor.parent.attrs),o.isTextblock?s().command(({commands:c})=>ts(o,{...a,...t})(e)?!0:c.clearNodes()).command(({state:c})=>ts(o,{...a,...t})(c,i)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},Lb=n=>({tr:t,dispatch:e})=>{if(e){const{doc:i}=t,s=An(n,0,i.content.size),o=Y.create(i,s);t.setSelection(o)}return!0},Ib=n=>({tr:t,dispatch:e})=>{if(e){const{doc:i}=t,{from:s,to:o}=typeof n=="number"?{from:n,to:n}:n,a=X.atStart(i).from,c=X.atEnd(i).to,u=An(s,a,c),f=An(o,a,c),h=X.create(i,u,f);t.setSelection(h)}return!0},Nb=n=>({state:t,dispatch:e})=>{const i=Wt(n,t.schema);return Nf(i)(t,e)};function Su(n,t){const e=n.storedMarks||n.selection.$to.parentOffset&&n.selection.$from.marks();if(e){const i=e.filter(s=>t?.includes(s.type.name));n.tr.ensureMarks(i)}}const Db=({keepMarks:n=!0}={})=>({tr:t,state:e,dispatch:i,editor:s})=>{const{selection:o,doc:a}=t,{$from:c,$to:u}=o,f=s.extensionManager.attributes,h=Fr(f,c.node().type.name,c.node().attrs);if(o instanceof Y&&o.node.isBlock)return!c.parentOffset||!me(a,c.pos)?!1:(i&&(n&&Su(e,s.extensionManager.splittableMarks),t.split(c.pos).scrollIntoView()),!0);if(!c.parent.isBlock)return!1;const m=u.parentOffset===u.parent.content.size,g=c.depth===0?void 0:kb(c.node(-1).contentMatchAt(c.indexAfter(-1)));let y=m&&g?[{type:g,attrs:h}]:void 0,v=me(t.doc,t.mapping.map(c.pos),1,y);if(!y&&!v&&me(t.doc,t.mapping.map(c.pos),1,g?[{type:g}]:void 0)&&(v=!0,y=g?[{type:g,attrs:h}]:void 0),i){if(v&&(o instanceof X&&t.deleteSelection(),t.split(t.mapping.map(c.pos),1,y),g&&!m&&!c.parentOffset&&c.parent.type!==g)){const b=t.mapping.map(c.before()),S=t.doc.resolve(b);c.node(-1).canReplaceWith(S.index(),S.index()+1,g)&&t.setNodeMarkup(t.mapping.map(c.before()),g)}n&&Su(e,s.extensionManager.splittableMarks),t.scrollIntoView()}return v},zb=(n,t={})=>({tr:e,state:i,dispatch:s,editor:o})=>{var a;const c=Wt(n,i.schema),{$from:u,$to:f}=i.selection,h=i.selection.node;if(h&&h.isBlock||u.depth<2||!u.sameParent(f))return!1;const m=u.node(-1);if(m.type!==c)return!1;const g=o.extensionManager.attributes;if(u.parent.content.size===0&&u.node(-1).childCount===u.indexAfter(-1)){if(u.depth===2||u.node(-3).type!==c||u.index(-2)!==u.node(-2).childCount-1)return!1;if(s){let M=z.empty;const P=u.index(-1)?1:u.index(-2)?2:3;for(let B=u.depth-P;B>=u.depth-3;B-=1)M=z.from(u.node(B).copy(M));const D=u.indexAfter(-1)<u.node(-2).childCount?1:u.indexAfter(-2)<u.node(-3).childCount?2:3,V={...Fr(g,u.node().type.name,u.node().attrs),...t},$=((a=c.contentMatch.defaultType)===null||a===void 0?void 0:a.createAndFill(V))||void 0;M=M.append(z.from(c.createAndFill(null,$)||void 0));const U=u.before(u.depth-(P-1));e.replace(U,u.after(-D),new F(M,4-P,0));let K=-1;e.doc.nodesBetween(U,e.doc.content.size,(B,ft)=>{if(K>-1)return!1;B.isTextblock&&B.content.size===0&&(K=ft+1)}),K>-1&&e.setSelection(X.near(e.doc.resolve(K))),e.scrollIntoView()}return!0}const y=f.pos===u.end()?m.contentMatchAt(0).defaultType:null,v={...Fr(g,m.type.name,m.attrs),...t},b={...Fr(g,u.node().type.name,u.node().attrs),...t};e.delete(u.pos,f.pos);const S=y?[{type:c,attrs:v},{type:y,attrs:b}]:[{type:c,attrs:v}];if(!me(e.doc,u.pos,2))return!1;if(s){const{selection:M,storedMarks:P}=i,{splittableMarks:D}=o.extensionManager,V=P||M.$to.parentOffset&&M.$from.marks();if(e.split(u.pos,2,S).scrollIntoView(),!V||!s)return!0;const $=V.filter(U=>D.includes(U.type.name));e.ensureMarks($)}return!0},Lo=(n,t)=>{const e=Ga(a=>a.type===t)(n.selection);if(!e)return!0;const i=n.doc.resolve(Math.max(0,e.pos-1)).before(e.depth);if(i===void 0)return!0;const s=n.doc.nodeAt(i);return e.node.type===s?.type&&Fe(n.doc,e.pos)&&n.join(e.pos),!0},Io=(n,t)=>{const e=Ga(a=>a.type===t)(n.selection);if(!e)return!0;const i=n.doc.resolve(e.start).after(e.depth);if(i===void 0)return!0;const s=n.doc.nodeAt(i);return e.node.type===s?.type&&Fe(n.doc,i)&&n.join(i),!0},Rb=(n,t,e,i={})=>({editor:s,tr:o,state:a,dispatch:c,chain:u,commands:f,can:h})=>{const{extensions:m,splittableMarks:g}=s.extensionManager,y=Wt(n,a.schema),v=Wt(t,a.schema),{selection:b,storedMarks:S}=a,{$from:M,$to:P}=b,D=M.blockRange(P),V=S||b.$to.parentOffset&&b.$from.marks();if(!D)return!1;const $=Ga(U=>wu(U.type.name,m))(b);if(D.depth>=1&&$&&D.depth-$.depth<=1){if($.node.type===y)return f.liftListItem(v);if(wu($.node.type.name,m)&&y.validContent($.node.content)&&c)return u().command(()=>(o.setNodeMarkup($.pos,y),!0)).command(()=>Lo(o,y)).command(()=>Io(o,y)).run()}return!e||!V||!c?u().command(()=>h().wrapInList(y,i)?!0:f.clearNodes()).wrapInList(y,i).command(()=>Lo(o,y)).command(()=>Io(o,y)).run():u().command(()=>{const U=h().wrapInList(y,i),K=V.filter(B=>g.includes(B.type.name));return o.ensureMarks(K),U?!0:f.clearNodes()}).wrapInList(y,i).command(()=>Lo(o,y)).command(()=>Io(o,y)).run()},Bb=(n,t={},e={})=>({state:i,commands:s})=>{const{extendEmptyMarkRange:o=!1}=e,a=bn(n,i.schema);return ia(i,a,t)?s.unsetMark(a,{extendEmptyMarkRange:o}):s.setMark(a,t)},$b=(n,t,e={})=>({state:i,commands:s})=>{const o=Wt(n,i.schema),a=Wt(t,i.schema),c=Qi(i,o,e);let u;return i.selection.$anchor.sameParent(i.selection.$head)&&(u=i.selection.$anchor.parent.attrs),c?s.setNode(a,u):s.setNode(o,{...u,...e})},Fb=(n,t={})=>({state:e,commands:i})=>{const s=Wt(n,e.schema);return Qi(e,s,t)?i.lift(s):i.wrapIn(s,t)},Vb=()=>({state:n,dispatch:t})=>{const e=n.plugins;for(let i=0;i<e.length;i+=1){const s=e[i];let o;if(s.spec.isInputRules&&(o=s.getState(n))){if(t){const a=n.tr,c=o.transform;for(let u=c.steps.length-1;u>=0;u-=1)a.step(c.steps[u].invert(c.docs[u]));if(o.text){const u=a.doc.resolve(o.from).marks();a.replaceWith(o.from,o.to,n.schema.text(o.text,u))}else a.delete(o.from,o.to)}return!0}}return!1},Hb=()=>({tr:n,dispatch:t})=>{const{selection:e}=n,{empty:i,ranges:s}=e;return i||t&&s.forEach(o=>{n.removeMark(o.$from.pos,o.$to.pos)}),!0},Zb=(n,t={})=>({tr:e,state:i,dispatch:s})=>{var o;const{extendEmptyMarkRange:a=!1}=t,{selection:c}=e,u=bn(n,i.schema),{$from:f,empty:h,ranges:m}=c;if(!s)return!0;if(h&&a){let{from:g,to:y}=c;const v=(o=f.marks().find(S=>S.type===u))===null||o===void 0?void 0:o.attrs,b=Ff(f,u,v);b&&(g=b.from,y=b.to),e.removeMark(g,y,u)}else m.forEach(g=>{e.removeMark(g.$from.pos,g.$to.pos,u)});return e.removeStoredMark(u),!0},Wb=(n,t={})=>({tr:e,state:i,dispatch:s})=>{let o=null,a=null;const c=Es(typeof n=="string"?n:n.name,i.schema);return c?(c==="node"&&(o=Wt(n,i.schema)),c==="mark"&&(a=bn(n,i.schema)),s&&e.selection.ranges.forEach(u=>{const f=u.$from.pos,h=u.$to.pos;let m,g,y,v;e.selection.empty?i.doc.nodesBetween(f,h,(b,S)=>{o&&o===b.type&&(y=Math.max(S,f),v=Math.min(S+b.nodeSize,h),m=S,g=b)}):i.doc.nodesBetween(f,h,(b,S)=>{S<f&&o&&o===b.type&&(y=Math.max(S,f),v=Math.min(S+b.nodeSize,h),m=S,g=b),S>=f&&S<=h&&(o&&o===b.type&&e.setNodeMarkup(S,void 0,{...b.attrs,...t}),a&&b.marks.length&&b.marks.forEach(M=>{if(a===M.type){const P=Math.max(S,f),D=Math.min(S+b.nodeSize,h);e.addMark(P,D,a.create({...M.attrs,...t}))}}))}),g&&(m!==void 0&&e.setNodeMarkup(m,void 0,{...g.attrs,...t}),a&&g.marks.length&&g.marks.forEach(b=>{a===b.type&&e.addMark(y,v,a.create({...b.attrs,...t}))}))}),!0):!1},jb=(n,t={})=>({state:e,dispatch:i})=>{const s=Wt(n,e.schema);return Af(s,t)(e,i)},Ub=(n,t={})=>({state:e,dispatch:i})=>{const s=Wt(n,e.schema);return Lf(s,t)(e,i)};var qb=Object.freeze({__proto__:null,blur:Lv,clearContent:Iv,clearNodes:Nv,command:Dv,createParagraphNear:zv,cut:Rv,deleteCurrentNode:Bv,deleteNode:$v,deleteRange:Fv,deleteSelection:Vv,enter:Hv,exitCode:Zv,extendMarkRange:Wv,first:jv,focus:qv,forEach:Kv,insertContent:Jv,insertContentAt:Xv,joinBackward:eb,joinDown:tb,joinForward:nb,joinItemBackward:ib,joinItemForward:rb,joinTextblockBackward:sb,joinTextblockForward:ob,joinUp:Qv,keyboardShortcut:lb,lift:cb,liftEmptyBlock:ub,liftListItem:db,newlineInCode:fb,resetAttributes:hb,scrollIntoView:pb,selectAll:mb,selectNodeBackward:gb,selectNodeForward:_b,selectParentNode:yb,selectTextblockEnd:vb,selectTextblockStart:bb,setContent:xb,setMark:Eb,setMeta:Ob,setNode:Ab,setNodeSelection:Lb,setTextSelection:Ib,sinkListItem:Nb,splitBlock:Db,splitListItem:zb,toggleList:Rb,toggleMark:Bb,toggleNode:$b,toggleWrap:Fb,undoInputRule:Vb,unsetAllMarks:Hb,unsetMark:Zb,updateAttributes:Wb,wrapIn:jb,wrapInList:Ub});const Kb=vn.create({name:"commands",addCommands(){return{...qb}}}),Jb=vn.create({name:"drop",addProseMirrorPlugins(){return[new xt({key:new It("tiptapDrop"),props:{handleDrop:(n,t,e,i)=>{this.editor.emit("drop",{editor:this.editor,event:t,slice:e,moved:i})}}})]}}),Gb=vn.create({name:"editable",addProseMirrorPlugins(){return[new xt({key:new It("editable"),props:{editable:()=>this.editor.options.editable}})]}}),Yb=new It("focusEvents"),Xb=vn.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:n}=this;return[new xt({key:Yb,props:{handleDOMEvents:{focus:(t,e)=>{n.isFocused=!0;const i=n.state.tr.setMeta("focus",{event:e}).setMeta("addToHistory",!1);return t.dispatch(i),!1},blur:(t,e)=>{n.isFocused=!1;const i=n.state.tr.setMeta("blur",{event:e}).setMeta("addToHistory",!1);return t.dispatch(i),!1}}}})]}}),Qb=vn.create({name:"keymap",addKeyboardShortcuts(){const n=()=>this.editor.commands.first(({commands:a})=>[()=>a.undoInputRule(),()=>a.command(({tr:c})=>{const{selection:u,doc:f}=c,{empty:h,$anchor:m}=u,{pos:g,parent:y}=m,v=m.parent.isTextblock&&g>0?c.doc.resolve(g-1):m,b=v.parent.type.spec.isolating,S=m.pos-m.parentOffset,M=b&&v.parent.childCount===1?S===m.pos:it.atStart(f).from===g;return!h||!y.type.isTextblock||y.textContent.length||!M||M&&m.parent.type.name==="paragraph"?!1:a.clearNodes()}),()=>a.deleteSelection(),()=>a.joinBackward(),()=>a.selectNodeBackward()]),t=()=>this.editor.commands.first(({commands:a})=>[()=>a.deleteSelection(),()=>a.deleteCurrentNode(),()=>a.joinForward(),()=>a.selectNodeForward()]),i={Enter:()=>this.editor.commands.first(({commands:a})=>[()=>a.newlineInCode(),()=>a.createParagraphNear(),()=>a.liftEmptyBlock(),()=>a.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:n,"Mod-Backspace":n,"Shift-Backspace":n,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},s={...i},o={...i,"Ctrl-h":n,"Alt-Backspace":n,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Ja()||Wf()?o:s},addProseMirrorPlugins(){return[new xt({key:new It("clearDocument"),appendTransaction:(n,t,e)=>{if(n.some(b=>b.getMeta("composition")))return;const i=n.some(b=>b.docChanged)&&!t.doc.eq(e.doc),s=n.some(b=>b.getMeta("preventClearDocument"));if(!i||s)return;const{empty:o,from:a,to:c}=t.selection,u=it.atStart(t.doc).from,f=it.atEnd(t.doc).to;if(o||!(a===u&&c===f)||!Ya(e.doc))return;const g=e.tr,y=Ms({state:e,transaction:g}),{commands:v}=new Ts({editor:this.editor,state:y});if(v.clearNodes(),!!g.steps.length)return g}})]}}),tx=vn.create({name:"paste",addProseMirrorPlugins(){return[new xt({key:new It("tiptapPaste"),props:{handlePaste:(n,t,e)=>{this.editor.emit("paste",{editor:this.editor,event:t,slice:e})}}})]}}),ex=vn.create({name:"tabindex",addProseMirrorPlugins(){return[new xt({key:new It("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class Pn{get name(){return this.node.type.name}constructor(t,e,i=!1,s=null){this.currentNode=null,this.actualDepth=null,this.isBlock=i,this.resolvedPos=t,this.editor=e,this.currentNode=s}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var t;return(t=this.actualDepth)!==null&&t!==void 0?t:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(t){let e=this.from,i=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}e=this.from+1,i=this.to-1}this.editor.commands.insertContentAt({from:e,to:i},t)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const t=this.resolvedPos.start(this.resolvedPos.depth-1),e=this.resolvedPos.doc.resolve(t);return new Pn(e,this.editor)}get before(){let t=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return t.depth!==this.depth&&(t=this.resolvedPos.doc.resolve(this.from-3)),new Pn(t,this.editor)}get after(){let t=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return t.depth!==this.depth&&(t=this.resolvedPos.doc.resolve(this.to+3)),new Pn(t,this.editor)}get children(){const t=[];return this.node.content.forEach((e,i)=>{const s=e.isBlock&&!e.isTextblock,o=e.isAtom&&!e.isText,a=this.pos+i+(o?0:1);if(a<0||a>this.resolvedPos.doc.nodeSize-2)return;const c=this.resolvedPos.doc.resolve(a);if(!s&&c.depth<=this.depth)return;const u=new Pn(c,this.editor,s,s?e:null);s&&(u.actualDepth=this.depth+1),t.push(new Pn(c,this.editor,s,s?e:null))}),t}get firstChild(){return this.children[0]||null}get lastChild(){const t=this.children;return t[t.length-1]||null}closest(t,e={}){let i=null,s=this.parent;for(;s&&!i;){if(s.node.type.name===t)if(Object.keys(e).length>0){const o=s.node.attrs,a=Object.keys(e);for(let c=0;c<a.length;c+=1){const u=a[c];if(o[u]!==e[u])break}}else i=s;s=s.parent}return i}querySelector(t,e={}){return this.querySelectorAll(t,e,!0)[0]||null}querySelectorAll(t,e={},i=!1){let s=[];if(!this.children||this.children.length===0)return s;const o=Object.keys(e);return this.children.forEach(a=>{i&&s.length>0||(a.node.type.name===t&&o.every(u=>e[u]===a.node.attrs[u])&&s.push(a),!(i&&s.length>0)&&(s=s.concat(a.querySelectorAll(t,e,i))))}),s}setAttribute(t){const{tr:e}=this.editor.state;e.setNodeMarkup(this.from,void 0,{...this.node.attrs,...t}),this.editor.view.dispatch(e)}}const nx=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function ix(n,t,e){const i=document.querySelector("style[data-tiptap-style]");if(i!==null)return i;const s=document.createElement("style");return t&&s.setAttribute("nonce",t),s.setAttribute("data-tiptap-style",""),s.innerHTML=n,document.getElementsByTagName("head")[0].appendChild(s),s}let rx=class extends mv{constructor(t={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:e})=>{throw e},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(t),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:e,slice:i,moved:s})=>this.options.onDrop(e,i,s)),this.on("paste",({event:e,slice:i})=>this.options.onPaste(e,i)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=ix(nx,this.options.injectNonce))}setOptions(t={}){this.options={...this.options,...t},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(t,e=!0){this.setOptions({editable:t}),e&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(t,e){const i=zf(e)?e(t,[...this.state.plugins]):[...this.state.plugins,t],s=this.state.reconfigure({plugins:i});return this.view.updateState(s),s}unregisterPlugin(t){if(this.isDestroyed)return;const e=this.state.plugins;let i=e;if([].concat(t).forEach(o=>{const a=typeof o=="string"?`${o}$`:o.key;i=i.filter(c=>!c.key.startsWith(a))}),e.length===i.length)return;const s=this.state.reconfigure({plugins:i});return this.view.updateState(s),s}createExtensionManager(){var t,e;const s=[...this.options.enableCoreExtensions?[Gb,Av.configure({blockSeparator:(e=(t=this.options.coreExtensionOptions)===null||t===void 0?void 0:t.clipboardTextSerializer)===null||e===void 0?void 0:e.blockSeparator}),Kb,Xb,Qb,ex,Jb,tx].filter(o=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[o.name]!==!1:!0):[],...this.options.extensions].filter(o=>["extension","node","mark"].includes(o?.type));this.extensionManager=new oi(s,this)}createCommandManager(){this.commandManager=new Ts({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var t;let e;try{e=na(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(a){if(!(a instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(a.message))throw a;this.emit("contentError",{editor:this,error:a,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(c=>c.name!=="collaboration"),this.createExtensionManager()}}),e=na(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const i=Hf(e,this.options.autofocus);this.view=new mf(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(t=this.options.editorProps)===null||t===void 0?void 0:t.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:si.create({doc:e,selection:i||void 0})});const s=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(s),this.createNodeViews(),this.prependClass();const o=this.view.dom;o.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;const e=this.capturedTransaction;return this.capturedTransaction=null,e}dispatchTransaction(t){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=t;return}t.steps.forEach(a=>{var c;return(c=this.capturedTransaction)===null||c===void 0?void 0:c.step(a)});return}const e=this.state.apply(t),i=!this.state.selection.eq(e.selection);this.emit("beforeTransaction",{editor:this,transaction:t,nextState:e}),this.view.updateState(e),this.emit("transaction",{editor:this,transaction:t}),i&&this.emit("selectionUpdate",{editor:this,transaction:t});const s=t.getMeta("focus"),o=t.getMeta("blur");s&&this.emit("focus",{editor:this,event:s.event,transaction:t}),o&&this.emit("blur",{editor:this,event:o.event,transaction:t}),!(!t.docChanged||t.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:t})}getAttributes(t){return Mb(this.state,t)}isActive(t,e){const i=typeof t=="string"?t:null,s=typeof t=="string"?e:t;return Tb(this.state,i,s)}getJSON(){return this.state.doc.toJSON()}getHTML(){return Ua(this.state.doc.content,this.schema)}getText(t){const{blockSeparator:e=`

`,textSerializers:i={}}=t||{};return Sb(this.state.doc,{blockSeparator:e,textSerializers:{...Bf(this.schema),...i}})}get isEmpty(){return Ya(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const t=this.view.dom;t&&t.editor&&delete t.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var t;return!(!((t=this.view)===null||t===void 0)&&t.docView)}$node(t,e){var i;return((i=this.$doc)===null||i===void 0?void 0:i.querySelector(t,e))||null}$nodes(t,e){var i;return((i=this.$doc)===null||i===void 0?void 0:i.querySelectorAll(t,e))||null}$pos(t){const e=this.state.doc.resolve(t);return new Pn(e,this)}get $doc(){return this.$pos(0)}};function Cu(n){return om((t,e)=>({get(){return t(),n},set(i){n=i,requestAnimationFrame(()=>{requestAnimationFrame(()=>{e()})})}}))}class sx extends rx{constructor(t={}){return super(t),this.contentComponent=null,this.appContext=null,this.reactiveState=Cu(this.view.state),this.reactiveExtensionStorage=Cu(this.extensionStorage),this.on("beforeTransaction",({nextState:e})=>{this.reactiveState.value=e,this.reactiveExtensionStorage.value=this.extensionStorage}),sm(this)}get state(){return this.reactiveState?this.reactiveState.value:this.view.state}get storage(){return this.reactiveExtensionStorage?this.reactiveExtensionStorage.value:super.storage}registerPlugin(t,e){const i=super.registerPlugin(t,e);return this.reactiveState&&(this.reactiveState.value=i),i}unregisterPlugin(t){const e=super.unregisterPlugin(t);return this.reactiveState&&e&&(this.reactiveState.value=e),e}}const ox=ct({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(n){const t=Z(),e=am();return rm(()=>{const i=n.editor;i&&i.options.element&&t.value&&Hu(()=>{if(!t.value||!i.options.element.firstChild)return;const s=w(t.value);t.value.append(...i.options.element.childNodes),i.contentComponent=e.ctx._,e&&(i.appContext={...e.appContext,provides:e.provides}),i.setOptions({element:s}),i.createNodeViews()})}),aa(()=>{const i=n.editor;i&&(i.contentComponent=null,i.appContext=null)}),{rootEl:t}},render(){return im("div",{ref:n=>{this.rootEl=n}})}}),ax=(n={})=>{const t=Vu();return te(()=>{t.value=new sx(n)}),aa(()=>{var e,i,s;const o=(e=t.value)===null||e===void 0?void 0:e.options.element,a=o?.cloneNode(!0);(i=o?.parentNode)===null||i===void 0||i.replaceChild(a,o),(s=t.value)===null||s===void 0||s.destroy()}),t};var lx=Object.defineProperty,Uf=(n,t)=>{for(var e in t)lx(n,e,{get:t[e],enumerable:!0})};function qf(n){const{state:t,transaction:e}=n;let{selection:i}=e,{doc:s}=e,{storedMarks:o}=e;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return o},get selection(){return i},get doc(){return s},get tr(){return i=e.selection,s=e.doc,o=e.storedMarks,e}}}var cx=class{constructor(n){this.editor=n.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=n.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:n,editor:t,state:e}=this,{view:i}=t,{tr:s}=e,o=this.buildProps(s);return Object.fromEntries(Object.entries(n).map(([a,c])=>[a,(...f)=>{const h=c(...f)(o);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(s),h}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(n,t=!0){const{rawCommands:e,editor:i,state:s}=this,{view:o}=i,a=[],c=!!n,u=n||s.tr,f=()=>(!c&&t&&!u.getMeta("preventDispatch")&&!this.hasCustomState&&o.dispatch(u),a.every(m=>m===!0)),h={...Object.fromEntries(Object.entries(e).map(([m,g])=>[m,(...v)=>{const b=this.buildProps(u,t),S=g(...v)(b);return a.push(S),h}])),run:f};return h}createCan(n){const{rawCommands:t,state:e}=this,i=!1,s=n||e.tr,o=this.buildProps(s,i);return{...Object.fromEntries(Object.entries(t).map(([c,u])=>[c,(...f)=>u(...f)({...o,dispatch:void 0})])),chain:()=>this.createChain(s,i)}}buildProps(n,t=!0){const{rawCommands:e,editor:i,state:s}=this,{view:o}=i,a={tr:n,editor:i,view:o,state:qf({state:s,transaction:n}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(n,t),can:()=>this.createCan(n),get commands(){return Object.fromEntries(Object.entries(e).map(([c,u])=>[c,(...f)=>u(...f)(a)]))}};return a}};function ux(n,t){const e=new Ld(n);return t.forEach(i=>{i.steps.forEach(s=>{e.step(s)})}),e}var Kf=n=>{const t=n.childNodes;for(let e=t.length-1;e>=0;e-=1){const i=t[e];i.nodeType===3&&i.nodeValue&&/^(\n\s\s|\n)$/.test(i.nodeValue)?n.removeChild(i):i.nodeType===1&&Kf(i)}return n};function Dr(n){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const t=`<body>${n}</body>`,e=new window.DOMParser().parseFromString(t,"text/html").body;return Kf(e)}function tr(n,t,e){if(n instanceof ke||n instanceof z)return n;e={slice:!0,parseOptions:{},...e};const i=typeof n=="object"&&n!==null,s=typeof n=="string";if(i)try{if(Array.isArray(n)&&n.length>0)return z.fromArray(n.map(c=>t.nodeFromJSON(c)));const a=t.nodeFromJSON(n);return e.errorOnInvalidContent&&a.check(),a}catch(o){if(e.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:o});return console.warn("[tiptap warn]: Invalid content.","Passed value:",n,"Error:",o),tr("",t,e)}if(s){if(e.errorOnInvalidContent){let a=!1,c="";const u=new xa({topNode:t.spec.topNode,marks:t.spec.marks,nodes:t.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:f=>(a=!0,c=typeof f=="string"?f:f.outerHTML,null)}]}})});if(e.slice?Ee.fromSchema(u).parseSlice(Dr(n),e.parseOptions):Ee.fromSchema(u).parse(Dr(n),e.parseOptions),e.errorOnInvalidContent&&a)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${c}`)})}const o=Ee.fromSchema(t);return e.slice?o.parseSlice(Dr(n),e.parseOptions).content:o.parse(Dr(n),e.parseOptions)}return tr("",t,e)}function dx(n,t,e={},i={}){return tr(n,t,{slice:!1,parseOptions:e,errorOnInvalidContent:i.errorOnInvalidContent})}function fx(n){for(let t=0;t<n.edgeCount;t+=1){const{type:e}=n.edge(t);if(e.isTextblock&&!e.hasRequiredAttrs())return e}return null}function hx(n,t){for(let e=n.depth;e>0;e-=1){const i=n.node(e);if(t(i))return{pos:e>0?n.before(e):0,start:n.start(e),depth:e,node:i}}}function Os(n){return t=>hx(t.$from,n)}function hi(n,t,e){return n.config[t]===void 0&&n.parent?hi(n.parent,t,e):typeof n.config[t]=="function"?n.config[t].bind({...e,parent:n.parent?hi(n.parent,t,e):null}):n.config[t]}function px(n){return typeof n=="function"}function Ge(n,t=void 0,...e){return px(n)?t?n.bind(t)(...e):n(...e):n}function mx(n){const t=n.filter(s=>s.type==="extension"),e=n.filter(s=>s.type==="node"),i=n.filter(s=>s.type==="mark");return{baseExtensions:t,nodeExtensions:e,markExtensions:i}}function fe(...n){return n.filter(t=>!!t).reduce((t,e)=>{const i={...t};return Object.entries(e).forEach(([s,o])=>{if(!i[s]){i[s]=o;return}if(s==="class"){const c=o?String(o).split(" "):[],u=i[s]?i[s].split(" "):[],f=c.filter(h=>!u.includes(h));i[s]=[...u,...f].join(" ")}else if(s==="style"){const c=o?o.split(";").map(h=>h.trim()).filter(Boolean):[],u=i[s]?i[s].split(";").map(h=>h.trim()).filter(Boolean):[],f=new Map;u.forEach(h=>{const[m,g]=h.split(":").map(y=>y.trim());f.set(m,g)}),c.forEach(h=>{const[m,g]=h.split(":").map(y=>y.trim());f.set(m,g)}),i[s]=Array.from(f.entries()).map(([h,m])=>`${h}: ${m}`).join("; ")}else i[s]=o}),i},{})}function gx(n,t,e){const{from:i,to:s}=t,{blockSeparator:o=`

`,textSerializers:a={}}=e||{};let c="";return n.nodesBetween(i,s,(u,f,h,m)=>{var g;u.isBlock&&f>i&&(c+=o);const y=a?.[u.type.name];if(y)return h&&(c+=y({node:u,pos:f,parent:h,index:m,range:t})),!1;u.isText&&(c+=(g=u?.text)==null?void 0:g.slice(Math.max(i,f)-f,s-f))}),c}function _x(n){return Object.fromEntries(Object.entries(n.nodes).filter(([,t])=>t.spec.toText).map(([t,e])=>[t,e.spec.toText]))}function xn(n,t){if(typeof n=="string"){if(!t.marks[n])throw Error(`There is no mark type named '${n}'. Maybe you forgot to add the extension?`);return t.marks[n]}return n}function yx(n,t){const e=xn(t,n.schema),{from:i,to:s,empty:o}=n.selection,a=[];o?(n.storedMarks&&a.push(...n.storedMarks),a.push(...n.selection.$head.marks())):n.doc.nodesBetween(i,s,u=>{a.push(...u.marks)});const c=a.find(u=>u.type.name===e.name);return c?{...c.attrs}:{}}function jt(n,t){if(typeof n=="string"){if(!t.nodes[n])throw Error(`There is no node type named '${n}'. Maybe you forgot to add the extension?`);return t.nodes[n]}return n}function Jf(n,t){return t.nodes[n]?"node":t.marks[n]?"mark":null}function vx(n,t=JSON.stringify){const e={};return n.filter(i=>{const s=t(i);return Object.prototype.hasOwnProperty.call(e,s)?!1:e[s]=!0})}function bx(n){const t=vx(n);return t.length===1?t:t.filter((e,i)=>!t.filter((o,a)=>a!==i).some(o=>e.oldRange.from>=o.oldRange.from&&e.oldRange.to<=o.oldRange.to&&e.newRange.from>=o.newRange.from&&e.newRange.to<=o.newRange.to))}function xx(n){const{mapping:t,steps:e}=n,i=[];return t.maps.forEach((s,o)=>{const a=[];if(s.ranges.length)s.forEach((c,u)=>{a.push({from:c,to:u})});else{const{from:c,to:u}=e[o];if(c===void 0||u===void 0)return;a.push({from:c,to:u})}a.forEach(({from:c,to:u})=>{const f=t.slice(o).map(c,-1),h=t.slice(o).map(u),m=t.invert().map(f,-1),g=t.invert().map(h);i.push({oldRange:{from:m,to:g},newRange:{from:f,to:h}})})}),bx(i)}function kx(n){return Object.prototype.toString.call(n)==="[object RegExp]"}function ns(n,t,e={strict:!0}){const i=Object.keys(t);return i.length?i.every(s=>e.strict?t[s]===n[s]:kx(t[s])?t[s].test(n[s]):t[s]===n[s]):!0}function Gf(n,t,e={}){return n.find(i=>i.type===t&&ns(Object.fromEntries(Object.keys(e).map(s=>[s,i.attrs[s]])),e))}function Mu(n,t,e={}){return!!Gf(n,t,e)}function Xa(n,t,e){var i;if(!n||!t)return;let s=n.parent.childAfter(n.parentOffset);if((!s.node||!s.node.marks.some(h=>h.type===t))&&(s=n.parent.childBefore(n.parentOffset)),!s.node||!s.node.marks.some(h=>h.type===t)||(e=e||((i=s.node.marks[0])==null?void 0:i.attrs),!Gf([...s.node.marks],t,e)))return;let a=s.index,c=n.start()+s.offset,u=a+1,f=c+s.node.nodeSize;for(;a>0&&Mu([...n.parent.child(a-1).marks],t,e);)a-=1,c-=n.parent.child(a).nodeSize;for(;u<n.parent.childCount&&Mu([...n.parent.child(u).marks],t,e);)f+=n.parent.child(u).nodeSize,u+=1;return{from:c,to:f}}function Yf(n,t,e){const i=[];return n===t?e.resolve(n).marks().forEach(s=>{const o=e.resolve(n),a=Xa(o,s.type);a&&i.push({mark:s,...a})}):e.nodesBetween(n,t,(s,o)=>{!s||s?.nodeSize===void 0||i.push(...s.marks.map(a=>({from:o,to:o+s.nodeSize,mark:a})))}),i}var wx=(n,t,e,i=20)=>{const s=n.doc.resolve(e);let o=i,a=null;for(;o>0&&a===null;){const c=s.node(o);c?.type.name===t?a=c:o-=1}return[a,o]};function Vr(n,t,e){return Object.fromEntries(Object.entries(e).filter(([i])=>{const s=n.find(o=>o.type===t&&o.name===i);return s?s.attribute.keepOnSplit:!1}))}function Sx(n,t,e={}){const{empty:i,ranges:s}=n.selection,o=t?xn(t,n.schema):null;if(i)return!!(n.storedMarks||n.selection.$from.marks()).filter(m=>o?o.name===m.type.name:!0).find(m=>ns(m.attrs,e,{strict:!1}));let a=0;const c=[];if(s.forEach(({$from:m,$to:g})=>{const y=m.pos,v=g.pos;n.doc.nodesBetween(y,v,(b,S)=>{if(!b.isText&&!b.marks.length)return;const M=Math.max(y,S),P=Math.min(v,S+b.nodeSize),D=P-M;a+=D,c.push(...b.marks.map(V=>({mark:V,from:M,to:P})))})}),a===0)return!1;const u=c.filter(m=>o?o.name===m.mark.type.name:!0).filter(m=>ns(m.mark.attrs,e,{strict:!1})).reduce((m,g)=>m+g.to-g.from,0),f=c.filter(m=>o?m.mark.type!==o&&m.mark.type.excludes(o):!0).reduce((m,g)=>m+g.to-g.from,0);return(u>0?u+f:u)>=a}function pi(n,t,e={}){const{from:i,to:s,empty:o}=n.selection,a=t?jt(t,n.schema):null,c=[];n.doc.nodesBetween(i,s,(m,g)=>{if(m.isText)return;const y=Math.max(i,g),v=Math.min(s,g+m.nodeSize);c.push({node:m,from:y,to:v})});const u=s-i,f=c.filter(m=>a?a.name===m.node.type.name:!0).filter(m=>ns(m.node.attrs,e,{strict:!1}));return o?!!f.length:f.reduce((m,g)=>m+g.to-g.from,0)>=u}var Cx=(n,t)=>{const{$from:e,$to:i,$anchor:s}=n.selection;if(t){const o=Os(c=>c.type.name===t)(n.selection);if(!o)return!1;const a=n.doc.resolve(o.pos+1);return s.pos+1===a.end()}return!(i.parentOffset<i.parent.nodeSize-2||e.pos!==i.pos)},Mx=n=>{const{$from:t,$to:e}=n.selection;return!(t.parentOffset>0||t.pos!==e.pos)};function Tu(n,t){const{nodeExtensions:e}=mx(t),i=e.find(a=>a.name===n);if(!i)return!1;const s={name:i.name,options:i.options,storage:i.storage},o=Ge(hi(i,"group",s));return typeof o!="string"?!1:o.split(" ").includes("list")}function Qa(n,{checkChildren:t=!0,ignoreWhitespace:e=!1}={}){var i;if(e){if(n.type.name==="hardBreak")return!0;if(n.isText)return/^\s*$/m.test((i=n.text)!=null?i:"")}if(n.isText)return!n.text;if(n.isAtom||n.isLeaf)return!1;if(n.content.childCount===0)return!0;if(t){let s=!0;return n.content.forEach(o=>{s!==!1&&(Qa(o,{ignoreWhitespace:e,checkChildren:t})||(s=!1))}),s}return!1}function Xf(n){return n instanceof Y}function Qf(n){return n instanceof X}function Ln(n=0,t=0,e=0){return Math.min(Math.max(n,t),e)}function Tx(n,t=null){if(!t)return null;const e=it.atStart(n),i=it.atEnd(n);if(t==="start"||t===!0)return e;if(t==="end")return i;const s=e.from,o=i.to;return t==="all"?X.create(n,Ln(0,s,o),Ln(n.content.size,s,o)):X.create(n,Ln(t,s,o),Ln(t,s,o))}function Px(n,t,e){const i=n.steps.length-1;if(i<t)return;const s=n.steps[i];if(!(s instanceof $t||s instanceof Ft))return;const o=n.mapping.maps[i];let a=0;o.forEach((c,u,f,h)=>{a===0&&(a=h)}),n.setSelection(it.near(n.doc.resolve(a),e))}var As=class{constructor(n){this.find=n.find,this.handler=n.handler}};function Ex(n){return Object.prototype.toString.call(n).slice(8,-1)}function zr(n){return Ex(n)!=="Object"?!1:n.constructor===Object&&Object.getPrototypeOf(n)===Object.prototype}function th(n,t){const e={...n};return zr(n)&&zr(t)&&Object.keys(t).forEach(i=>{zr(t[i])&&zr(n[i])?e[i]=th(n[i],t[i]):e[i]=t[i]}),e}var tl=class{constructor(n={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...n},this.name=this.config.name}get options(){return{...Ge(hi(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...Ge(hi(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(n={}){const t=this.extend({...this.config,addOptions:()=>th(this.options,n)});return t.name=this.name,t.parent=this.parent,t}extend(n={}){const t=new this.constructor({...this.config,...n});return t.parent=this,this.child=t,t.name="name"in n?n.name:t.parent.name,t}},Ls=class eh extends tl{constructor(){super(...arguments),this.type="mark"}static create(t={}){const e=typeof t=="function"?t():t;return new eh(e)}static handleExit({editor:t,mark:e}){const{tr:i}=t.state,s=t.state.selection.$from;if(s.pos===s.end()){const a=s.marks();if(!!!a.find(f=>f?.type.name===e.name))return!1;const u=a.find(f=>f?.type.name===e.name);return u&&i.removeStoredMark(u),i.insertText(" ",s.pos),t.view.dispatch(i),!0}return!1}configure(t){return super.configure(t)}extend(t){const e=typeof t=="function"?t():t;return super.extend(e)}},Ox=class{constructor(n){this.find=n.find,this.handler=n.handler}},Ax={};Uf(Ax,{ClipboardTextSerializer:()=>Lx,Commands:()=>V0,Delete:()=>H0,Drop:()=>Z0,Editable:()=>W0,FocusEvents:()=>j0,Keymap:()=>U0,Paste:()=>q0,Tabindex:()=>K0,focusEventsPluginKey:()=>sh});var Vt=class nh extends tl{constructor(){super(...arguments),this.type="extension"}static create(t={}){const e=typeof t=="function"?t():t;return new nh(e)}configure(t){return super.configure(t)}extend(t){const e=typeof t=="function"?t():t;return super.extend(e)}},Lx=Vt.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new xt({key:new It("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:n}=this,{state:t,schema:e}=n,{doc:i,selection:s}=t,{ranges:o}=s,a=Math.min(...o.map(h=>h.$from.pos)),c=Math.max(...o.map(h=>h.$to.pos)),u=_x(e);return gx(i,{from:a,to:c},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:u})}}})]}}),ih={};Uf(ih,{blur:()=>Ix,clearContent:()=>Nx,clearNodes:()=>Dx,command:()=>zx,createParagraphNear:()=>Rx,cut:()=>Bx,deleteCurrentNode:()=>$x,deleteNode:()=>Fx,deleteRange:()=>Vx,deleteSelection:()=>Hx,enter:()=>Zx,exitCode:()=>Wx,extendMarkRange:()=>jx,first:()=>Ux,focus:()=>Kx,forEach:()=>Jx,insertContent:()=>Gx,insertContentAt:()=>Xx,joinBackward:()=>e0,joinDown:()=>t0,joinForward:()=>n0,joinItemBackward:()=>i0,joinItemForward:()=>r0,joinTextblockBackward:()=>s0,joinTextblockForward:()=>o0,joinUp:()=>Qx,keyboardShortcut:()=>l0,lift:()=>c0,liftEmptyBlock:()=>u0,liftListItem:()=>d0,newlineInCode:()=>f0,resetAttributes:()=>h0,scrollIntoView:()=>p0,selectAll:()=>m0,selectNodeBackward:()=>g0,selectNodeForward:()=>_0,selectParentNode:()=>y0,selectTextblockEnd:()=>v0,selectTextblockStart:()=>b0,setContent:()=>x0,setMark:()=>w0,setMeta:()=>S0,setNode:()=>C0,setNodeSelection:()=>M0,setTextSelection:()=>T0,sinkListItem:()=>P0,splitBlock:()=>E0,splitListItem:()=>O0,toggleList:()=>A0,toggleMark:()=>L0,toggleNode:()=>I0,toggleWrap:()=>N0,undoInputRule:()=>D0,unsetAllMarks:()=>z0,unsetMark:()=>R0,updateAttributes:()=>B0,wrapIn:()=>$0,wrapInList:()=>F0});var Ix=()=>({editor:n,view:t})=>(requestAnimationFrame(()=>{var e;n.isDestroyed||(t.dom.blur(),(e=window?.getSelection())==null||e.removeAllRanges())}),!0),Nx=(n=!0)=>({commands:t})=>t.setContent("",{emitUpdate:n}),Dx=()=>({state:n,tr:t,dispatch:e})=>{const{selection:i}=t,{ranges:s}=i;return e&&s.forEach(({$from:o,$to:a})=>{n.doc.nodesBetween(o.pos,a.pos,(c,u)=>{if(c.type.isText)return;const{doc:f,mapping:h}=t,m=f.resolve(h.map(u)),g=f.resolve(h.map(u+c.nodeSize)),y=m.blockRange(g);if(!y)return;const v=Zn(y);if(c.type.isTextblock){const{defaultType:b}=m.parent.contentMatchAt(m.index());t.setNodeMarkup(y.start,b)}(v||v===0)&&t.lift(y,v)})}),!0},zx=n=>t=>n(t),Rx=()=>({state:n,dispatch:t})=>Za(n,t),Bx=(n,t)=>({editor:e,tr:i})=>{const{state:s}=e,o=s.doc.slice(n.from,n.to);i.deleteRange(n.from,n.to);const a=i.mapping.map(t);return i.insert(a,o.content),i.setSelection(new X(i.doc.resolve(Math.max(a-1,0)))),!0},$x=()=>({tr:n,dispatch:t})=>{const{selection:e}=n,i=e.$anchor.node();if(i.content.size>0)return!1;const s=n.selection.$anchor;for(let o=s.depth;o>0;o-=1)if(s.node(o).type===i.type){if(t){const c=s.before(o),u=s.after(o);n.delete(c,u).scrollIntoView()}return!0}return!1},Fx=n=>({tr:t,state:e,dispatch:i})=>{const s=jt(n,e.schema),o=t.selection.$anchor;for(let a=o.depth;a>0;a-=1)if(o.node(a).type===s){if(i){const u=o.before(a),f=o.after(a);t.delete(u,f).scrollIntoView()}return!0}return!1},Vx=n=>({tr:t,dispatch:e})=>{const{from:i,to:s}=n;return e&&t.delete(i,s),!0},Hx=()=>({state:n,dispatch:t})=>Cs(n,t),Zx=()=>({commands:n})=>n.keyboardShortcut("Enter"),Wx=()=>({state:n,dispatch:t})=>Cf(n,t),jx=(n,t={})=>({tr:e,state:i,dispatch:s})=>{const o=xn(n,i.schema),{doc:a,selection:c}=e,{$from:u,from:f,to:h}=c;if(s){const m=Xa(u,o,t);if(m&&m.from<=f&&m.to>=h){const g=X.create(a,m.from,m.to);e.setSelection(g)}}return!0},Ux=n=>t=>{const e=typeof n=="function"?n(t):n;for(let i=0;i<e.length;i+=1)if(e[i](t))return!0;return!1};function qx(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function el(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var Kx=(n=null,t={})=>({editor:e,view:i,tr:s,dispatch:o})=>{t={scrollIntoView:!0,...t};const a=()=>{(el()||qx())&&i.dom.focus(),requestAnimationFrame(()=>{e.isDestroyed||(i.focus(),t?.scrollIntoView&&e.commands.scrollIntoView())})};if(i.hasFocus()&&n===null||n===!1)return!0;if(o&&n===null&&!Qf(e.state.selection))return a(),!0;const c=Tx(s.doc,n)||e.state.selection,u=e.state.selection.eq(c);return o&&(u||s.setSelection(c),u&&s.storedMarks&&s.setStoredMarks(s.storedMarks),a()),!0},Jx=(n,t)=>e=>n.every((i,s)=>t(i,{...e,index:s})),Gx=(n,t)=>({tr:e,commands:i})=>i.insertContentAt({from:e.selection.from,to:e.selection.to},n,t),Yx=n=>!("type"in n),Xx=(n,t,e)=>({tr:i,dispatch:s,editor:o})=>{var a;if(s){e={parseOptions:o.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...e};let c;const{selection:u}=o.state,f=M=>{o.emit("contentError",{editor:o,error:M,disableCollaboration:()=>{"collaboration"in o.storage&&typeof o.storage.collaboration=="object"&&o.storage.collaboration&&(o.storage.collaboration.isDisabled=!0)}})},h={preserveWhitespace:"full",...e.parseOptions};if(!e.errorOnInvalidContent&&!o.options.enableContentCheck&&o.options.emitContentError)try{tr(t,o.schema,{parseOptions:h,errorOnInvalidContent:!0})}catch(M){f(M)}try{c=tr(t,o.schema,{parseOptions:h,errorOnInvalidContent:(a=e.errorOnInvalidContent)!=null?a:o.options.enableContentCheck})}catch(M){return f(M),!1}let{from:m,to:g}=typeof n=="number"?{from:n,to:n}:{from:n.from,to:n.to},y=!0,v=!0;if((Yx(c)?c:[c]).forEach(M=>{M.check(),y=y?M.isText&&M.marks.length===0:!1,v=v?M.isBlock:!1}),m===g&&v){const{parent:M}=i.doc.resolve(m);M.isTextblock&&!M.type.spec.code&&!M.childCount&&(m-=1,g+=1)}let S;if(y){if(Array.isArray(t))S=t.map(M=>M.text||"").join("");else if(t instanceof z){let M="";t.forEach(P=>{P.text&&(M+=P.text)}),S=M}else typeof t=="object"&&t&&t.text?S=t.text:S=t;i.insertText(S,m,g)}else{S=c;const M=u.$from.parentOffset===0,P=u.$from.node().isText||u.$from.node().isTextblock,D=u.$from.node().content.size>0;M&&P&&D&&(m=Math.max(0,m-1)),i.replaceWith(m,g,S)}e.updateSelection&&Px(i,i.steps.length-1,-1),e.applyInputRules&&i.setMeta("applyInputRules",{from:m,text:S}),e.applyPasteRules&&i.setMeta("applyPasteRules",{from:m,text:S})}return!0},Qx=()=>({state:n,dispatch:t})=>kf(n,t),t0=()=>({state:n,dispatch:t})=>wf(n,t),e0=()=>({state:n,dispatch:t})=>Da(n,t),n0=()=>({state:n,dispatch:t})=>Ba(n,t),i0=()=>({state:n,dispatch:t,tr:e})=>{try{const i=bi(n.doc,n.selection.$from.pos,-1);return i==null?!1:(e.join(i,2),t&&t(e),!0)}catch{return!1}},r0=()=>({state:n,dispatch:t,tr:e})=>{try{const i=bi(n.doc,n.selection.$from.pos,1);return i==null?!1:(e.join(i,2),t&&t(e),!0)}catch{return!1}},s0=()=>({state:n,dispatch:t})=>yf(n,t),o0=()=>({state:n,dispatch:t})=>vf(n,t);function rh(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function a0(n){const t=n.split(/-(?!$)/);let e=t[t.length-1];e==="Space"&&(e=" ");let i,s,o,a;for(let c=0;c<t.length-1;c+=1){const u=t[c];if(/^(cmd|meta|m)$/i.test(u))a=!0;else if(/^a(lt)?$/i.test(u))i=!0;else if(/^(c|ctrl|control)$/i.test(u))s=!0;else if(/^s(hift)?$/i.test(u))o=!0;else if(/^mod$/i.test(u))el()||rh()?a=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${u}`)}return i&&(e=`Alt-${e}`),s&&(e=`Ctrl-${e}`),a&&(e=`Meta-${e}`),o&&(e=`Shift-${e}`),e}var l0=n=>({editor:t,view:e,tr:i,dispatch:s})=>{const o=a0(n).split(/-(?!$)/),a=o.find(f=>!["Alt","Ctrl","Meta","Shift"].includes(f)),c=new KeyboardEvent("keydown",{key:a==="Space"?" ":a,altKey:o.includes("Alt"),ctrlKey:o.includes("Ctrl"),metaKey:o.includes("Meta"),shiftKey:o.includes("Shift"),bubbles:!0,cancelable:!0}),u=t.captureTransaction(()=>{e.someProp("handleKeyDown",f=>f(e,c))});return u?.steps.forEach(f=>{const h=f.map(i.mapping);h&&s&&i.maybeStep(h)}),!0},c0=(n,t={})=>({state:e,dispatch:i})=>{const s=jt(n,e.schema);return pi(e,s,t)?Sf(e,i):!1},u0=()=>({state:n,dispatch:t})=>Wa(n,t),d0=n=>({state:t,dispatch:e})=>{const i=jt(n,t.schema);return If(i)(t,e)},f0=()=>({state:n,dispatch:t})=>Va(n,t);function Pu(n,t){const e=typeof t=="string"?[t]:t;return Object.keys(n).reduce((i,s)=>(e.includes(s)||(i[s]=n[s]),i),{})}var h0=(n,t)=>({tr:e,state:i,dispatch:s})=>{let o=null,a=null;const c=Jf(typeof n=="string"?n:n.name,i.schema);return c?(c==="node"&&(o=jt(n,i.schema)),c==="mark"&&(a=xn(n,i.schema)),s&&e.selection.ranges.forEach(u=>{i.doc.nodesBetween(u.$from.pos,u.$to.pos,(f,h)=>{o&&o===f.type&&e.setNodeMarkup(h,void 0,Pu(f.attrs,t)),a&&f.marks.length&&f.marks.forEach(m=>{a===m.type&&e.addMark(h,h+f.nodeSize,a.create(Pu(m.attrs,t)))})})}),!0):!1},p0=()=>({tr:n,dispatch:t})=>(t&&n.scrollIntoView(),!0),m0=()=>({tr:n,dispatch:t})=>{if(t){const e=new ue(n.doc);n.setSelection(e)}return!0},g0=()=>({state:n,dispatch:t})=>za(n,t),_0=()=>({state:n,dispatch:t})=>$a(n,t),y0=()=>({state:n,dispatch:t})=>Mf(n,t),v0=()=>({state:n,dispatch:t})=>Of(n,t),b0=()=>({state:n,dispatch:t})=>Ef(n,t),x0=(n,{errorOnInvalidContent:t,emitUpdate:e=!0,parseOptions:i={}}={})=>({editor:s,tr:o,dispatch:a,commands:c})=>{const{doc:u}=o;if(i.preserveWhitespace!=="full"){const f=dx(n,s.schema,i,{errorOnInvalidContent:t??s.options.enableContentCheck});return a&&o.replaceWith(0,u.content.size,f).setMeta("preventUpdate",!e),!0}return a&&o.setMeta("preventUpdate",!e),c.insertContentAt({from:0,to:u.content.size},n,{parseOptions:i,errorOnInvalidContent:t??s.options.enableContentCheck})};function k0(n,t,e){var i;const{selection:s}=t;let o=null;if(Qf(s)&&(o=s.$cursor),o){const c=(i=n.storedMarks)!=null?i:o.marks();return!!e.isInSet(c)||!c.some(u=>u.type.excludes(e))}const{ranges:a}=s;return a.some(({$from:c,$to:u})=>{let f=c.depth===0?n.doc.inlineContent&&n.doc.type.allowsMarkType(e):!1;return n.doc.nodesBetween(c.pos,u.pos,(h,m,g)=>{if(f)return!1;if(h.isInline){const y=!g||g.type.allowsMarkType(e),v=!!e.isInSet(h.marks)||!h.marks.some(b=>b.type.excludes(e));f=y&&v}return!f}),f})}var w0=(n,t={})=>({tr:e,state:i,dispatch:s})=>{const{selection:o}=e,{empty:a,ranges:c}=o,u=xn(n,i.schema);if(s)if(a){const f=yx(i,u);e.addStoredMark(u.create({...f,...t}))}else c.forEach(f=>{const h=f.$from.pos,m=f.$to.pos;i.doc.nodesBetween(h,m,(g,y)=>{const v=Math.max(y,h),b=Math.min(y+g.nodeSize,m);g.marks.find(M=>M.type===u)?g.marks.forEach(M=>{u===M.type&&e.addMark(v,b,u.create({...M.attrs,...t}))}):e.addMark(v,b,u.create(t))})});return k0(i,e,u)},S0=(n,t)=>({tr:e})=>(e.setMeta(n,t),!0),C0=(n,t={})=>({state:e,dispatch:i,chain:s})=>{const o=jt(n,e.schema);let a;return e.selection.$anchor.sameParent(e.selection.$head)&&(a=e.selection.$anchor.parent.attrs),o.isTextblock?s().command(({commands:c})=>ts(o,{...a,...t})(e)?!0:c.clearNodes()).command(({state:c})=>ts(o,{...a,...t})(c,i)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},M0=n=>({tr:t,dispatch:e})=>{if(e){const{doc:i}=t,s=Ln(n,0,i.content.size),o=Y.create(i,s);t.setSelection(o)}return!0},T0=n=>({tr:t,dispatch:e})=>{if(e){const{doc:i}=t,{from:s,to:o}=typeof n=="number"?{from:n,to:n}:n,a=X.atStart(i).from,c=X.atEnd(i).to,u=Ln(s,a,c),f=Ln(o,a,c),h=X.create(i,u,f);t.setSelection(h)}return!0},P0=n=>({state:t,dispatch:e})=>{const i=jt(n,t.schema);return Nf(i)(t,e)};function Eu(n,t){const e=n.storedMarks||n.selection.$to.parentOffset&&n.selection.$from.marks();if(e){const i=e.filter(s=>t?.includes(s.type.name));n.tr.ensureMarks(i)}}var E0=({keepMarks:n=!0}={})=>({tr:t,state:e,dispatch:i,editor:s})=>{const{selection:o,doc:a}=t,{$from:c,$to:u}=o,f=s.extensionManager.attributes,h=Vr(f,c.node().type.name,c.node().attrs);if(o instanceof Y&&o.node.isBlock)return!c.parentOffset||!me(a,c.pos)?!1:(i&&(n&&Eu(e,s.extensionManager.splittableMarks),t.split(c.pos).scrollIntoView()),!0);if(!c.parent.isBlock)return!1;const m=u.parentOffset===u.parent.content.size,g=c.depth===0?void 0:fx(c.node(-1).contentMatchAt(c.indexAfter(-1)));let y=m&&g?[{type:g,attrs:h}]:void 0,v=me(t.doc,t.mapping.map(c.pos),1,y);if(!y&&!v&&me(t.doc,t.mapping.map(c.pos),1,g?[{type:g}]:void 0)&&(v=!0,y=g?[{type:g,attrs:h}]:void 0),i){if(v&&(o instanceof X&&t.deleteSelection(),t.split(t.mapping.map(c.pos),1,y),g&&!m&&!c.parentOffset&&c.parent.type!==g)){const b=t.mapping.map(c.before()),S=t.doc.resolve(b);c.node(-1).canReplaceWith(S.index(),S.index()+1,g)&&t.setNodeMarkup(t.mapping.map(c.before()),g)}n&&Eu(e,s.extensionManager.splittableMarks),t.scrollIntoView()}return v},O0=(n,t={})=>({tr:e,state:i,dispatch:s,editor:o})=>{var a;const c=jt(n,i.schema),{$from:u,$to:f}=i.selection,h=i.selection.node;if(h&&h.isBlock||u.depth<2||!u.sameParent(f))return!1;const m=u.node(-1);if(m.type!==c)return!1;const g=o.extensionManager.attributes;if(u.parent.content.size===0&&u.node(-1).childCount===u.indexAfter(-1)){if(u.depth===2||u.node(-3).type!==c||u.index(-2)!==u.node(-2).childCount-1)return!1;if(s){let M=z.empty;const P=u.index(-1)?1:u.index(-2)?2:3;for(let B=u.depth-P;B>=u.depth-3;B-=1)M=z.from(u.node(B).copy(M));const D=u.indexAfter(-1)<u.node(-2).childCount?1:u.indexAfter(-2)<u.node(-3).childCount?2:3,V={...Vr(g,u.node().type.name,u.node().attrs),...t},$=((a=c.contentMatch.defaultType)==null?void 0:a.createAndFill(V))||void 0;M=M.append(z.from(c.createAndFill(null,$)||void 0));const U=u.before(u.depth-(P-1));e.replace(U,u.after(-D),new F(M,4-P,0));let K=-1;e.doc.nodesBetween(U,e.doc.content.size,(B,ft)=>{if(K>-1)return!1;B.isTextblock&&B.content.size===0&&(K=ft+1)}),K>-1&&e.setSelection(X.near(e.doc.resolve(K))),e.scrollIntoView()}return!0}const y=f.pos===u.end()?m.contentMatchAt(0).defaultType:null,v={...Vr(g,m.type.name,m.attrs),...t},b={...Vr(g,u.node().type.name,u.node().attrs),...t};e.delete(u.pos,f.pos);const S=y?[{type:c,attrs:v},{type:y,attrs:b}]:[{type:c,attrs:v}];if(!me(e.doc,u.pos,2))return!1;if(s){const{selection:M,storedMarks:P}=i,{splittableMarks:D}=o.extensionManager,V=P||M.$to.parentOffset&&M.$from.marks();if(e.split(u.pos,2,S).scrollIntoView(),!V||!s)return!0;const $=V.filter(U=>D.includes(U.type.name));e.ensureMarks($)}return!0},No=(n,t)=>{const e=Os(a=>a.type===t)(n.selection);if(!e)return!0;const i=n.doc.resolve(Math.max(0,e.pos-1)).before(e.depth);if(i===void 0)return!0;const s=n.doc.nodeAt(i);return e.node.type===s?.type&&Fe(n.doc,e.pos)&&n.join(e.pos),!0},Do=(n,t)=>{const e=Os(a=>a.type===t)(n.selection);if(!e)return!0;const i=n.doc.resolve(e.start).after(e.depth);if(i===void 0)return!0;const s=n.doc.nodeAt(i);return e.node.type===s?.type&&Fe(n.doc,i)&&n.join(i),!0},A0=(n,t,e,i={})=>({editor:s,tr:o,state:a,dispatch:c,chain:u,commands:f,can:h})=>{const{extensions:m,splittableMarks:g}=s.extensionManager,y=jt(n,a.schema),v=jt(t,a.schema),{selection:b,storedMarks:S}=a,{$from:M,$to:P}=b,D=M.blockRange(P),V=S||b.$to.parentOffset&&b.$from.marks();if(!D)return!1;const $=Os(U=>Tu(U.type.name,m))(b);if(D.depth>=1&&$&&D.depth-$.depth<=1){if($.node.type===y)return f.liftListItem(v);if(Tu($.node.type.name,m)&&y.validContent($.node.content)&&c)return u().command(()=>(o.setNodeMarkup($.pos,y),!0)).command(()=>No(o,y)).command(()=>Do(o,y)).run()}return!e||!V||!c?u().command(()=>h().wrapInList(y,i)?!0:f.clearNodes()).wrapInList(y,i).command(()=>No(o,y)).command(()=>Do(o,y)).run():u().command(()=>{const U=h().wrapInList(y,i),K=V.filter(B=>g.includes(B.type.name));return o.ensureMarks(K),U?!0:f.clearNodes()}).wrapInList(y,i).command(()=>No(o,y)).command(()=>Do(o,y)).run()},L0=(n,t={},e={})=>({state:i,commands:s})=>{const{extendEmptyMarkRange:o=!1}=e,a=xn(n,i.schema);return Sx(i,a,t)?s.unsetMark(a,{extendEmptyMarkRange:o}):s.setMark(a,t)},I0=(n,t,e={})=>({state:i,commands:s})=>{const o=jt(n,i.schema),a=jt(t,i.schema),c=pi(i,o,e);let u;return i.selection.$anchor.sameParent(i.selection.$head)&&(u=i.selection.$anchor.parent.attrs),c?s.setNode(a,u):s.setNode(o,{...u,...e})},N0=(n,t={})=>({state:e,commands:i})=>{const s=jt(n,e.schema);return pi(e,s,t)?i.lift(s):i.wrapIn(s,t)},D0=()=>({state:n,dispatch:t})=>{const e=n.plugins;for(let i=0;i<e.length;i+=1){const s=e[i];let o;if(s.spec.isInputRules&&(o=s.getState(n))){if(t){const a=n.tr,c=o.transform;for(let u=c.steps.length-1;u>=0;u-=1)a.step(c.steps[u].invert(c.docs[u]));if(o.text){const u=a.doc.resolve(o.from).marks();a.replaceWith(o.from,o.to,n.schema.text(o.text,u))}else a.delete(o.from,o.to)}return!0}}return!1},z0=()=>({tr:n,dispatch:t})=>{const{selection:e}=n,{empty:i,ranges:s}=e;return i||t&&s.forEach(o=>{n.removeMark(o.$from.pos,o.$to.pos)}),!0},R0=(n,t={})=>({tr:e,state:i,dispatch:s})=>{var o;const{extendEmptyMarkRange:a=!1}=t,{selection:c}=e,u=xn(n,i.schema),{$from:f,empty:h,ranges:m}=c;if(!s)return!0;if(h&&a){let{from:g,to:y}=c;const v=(o=f.marks().find(S=>S.type===u))==null?void 0:o.attrs,b=Xa(f,u,v);b&&(g=b.from,y=b.to),e.removeMark(g,y,u)}else m.forEach(g=>{e.removeMark(g.$from.pos,g.$to.pos,u)});return e.removeStoredMark(u),!0},B0=(n,t={})=>({tr:e,state:i,dispatch:s})=>{let o=null,a=null;const c=Jf(typeof n=="string"?n:n.name,i.schema);return c?(c==="node"&&(o=jt(n,i.schema)),c==="mark"&&(a=xn(n,i.schema)),s&&e.selection.ranges.forEach(u=>{const f=u.$from.pos,h=u.$to.pos;let m,g,y,v;e.selection.empty?i.doc.nodesBetween(f,h,(b,S)=>{o&&o===b.type&&(y=Math.max(S,f),v=Math.min(S+b.nodeSize,h),m=S,g=b)}):i.doc.nodesBetween(f,h,(b,S)=>{S<f&&o&&o===b.type&&(y=Math.max(S,f),v=Math.min(S+b.nodeSize,h),m=S,g=b),S>=f&&S<=h&&(o&&o===b.type&&e.setNodeMarkup(S,void 0,{...b.attrs,...t}),a&&b.marks.length&&b.marks.forEach(M=>{if(a===M.type){const P=Math.max(S,f),D=Math.min(S+b.nodeSize,h);e.addMark(P,D,a.create({...M.attrs,...t}))}}))}),g&&(m!==void 0&&e.setNodeMarkup(m,void 0,{...g.attrs,...t}),a&&g.marks.length&&g.marks.forEach(b=>{a===b.type&&e.addMark(y,v,a.create({...b.attrs,...t}))}))}),!0):!1},$0=(n,t={})=>({state:e,dispatch:i})=>{const s=jt(n,e.schema);return Af(s,t)(e,i)},F0=(n,t={})=>({state:e,dispatch:i})=>{const s=jt(n,e.schema);return Lf(s,t)(e,i)},V0=Vt.create({name:"commands",addCommands(){return{...ih}}}),H0=Vt.create({name:"delete",onUpdate({transaction:n,appendedTransactions:t}){var e,i,s;const o=()=>{var a,c,u,f;if((f=(u=(c=(a=this.editor.options.coreExtensionOptions)==null?void 0:a.delete)==null?void 0:c.filterTransaction)==null?void 0:u.call(c,n))!=null?f:n.getMeta("y-sync$"))return;const h=ux(n.before,[n,...t]);xx(h).forEach(y=>{h.mapping.mapResult(y.oldRange.from).deletedAfter&&h.mapping.mapResult(y.oldRange.to).deletedBefore&&h.before.nodesBetween(y.oldRange.from,y.oldRange.to,(v,b)=>{const S=b+v.nodeSize-2,M=y.oldRange.from<=b&&S<=y.oldRange.to;this.editor.emit("delete",{type:"node",node:v,from:b,to:S,newFrom:h.mapping.map(b),newTo:h.mapping.map(S),deletedRange:y.oldRange,newRange:y.newRange,partial:!M,editor:this.editor,transaction:n,combinedTransform:h})})});const g=h.mapping;h.steps.forEach((y,v)=>{var b,S;if(y instanceof Pe){const M=g.slice(v).map(y.from,-1),P=g.slice(v).map(y.to),D=g.invert().map(M,-1),V=g.invert().map(P),$=(b=h.doc.nodeAt(M-1))==null?void 0:b.marks.some(K=>K.eq(y.mark)),U=(S=h.doc.nodeAt(P))==null?void 0:S.marks.some(K=>K.eq(y.mark));this.editor.emit("delete",{type:"mark",mark:y.mark,from:y.from,to:y.to,deletedRange:{from:D,to:V},newRange:{from:M,to:P},partial:!!(U||$),editor:this.editor,transaction:n,combinedTransform:h})}})};(s=(i=(e=this.editor.options.coreExtensionOptions)==null?void 0:e.delete)==null?void 0:i.async)==null||s?setTimeout(o,0):o()}}),Z0=Vt.create({name:"drop",addProseMirrorPlugins(){return[new xt({key:new It("tiptapDrop"),props:{handleDrop:(n,t,e,i)=>{this.editor.emit("drop",{editor:this.editor,event:t,slice:e,moved:i})}}})]}}),W0=Vt.create({name:"editable",addProseMirrorPlugins(){return[new xt({key:new It("editable"),props:{editable:()=>this.editor.options.editable}})]}}),sh=new It("focusEvents"),j0=Vt.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:n}=this;return[new xt({key:sh,props:{handleDOMEvents:{focus:(t,e)=>{n.isFocused=!0;const i=n.state.tr.setMeta("focus",{event:e}).setMeta("addToHistory",!1);return t.dispatch(i),!1},blur:(t,e)=>{n.isFocused=!1;const i=n.state.tr.setMeta("blur",{event:e}).setMeta("addToHistory",!1);return t.dispatch(i),!1}}}})]}}),U0=Vt.create({name:"keymap",addKeyboardShortcuts(){const n=()=>this.editor.commands.first(({commands:a})=>[()=>a.undoInputRule(),()=>a.command(({tr:c})=>{const{selection:u,doc:f}=c,{empty:h,$anchor:m}=u,{pos:g,parent:y}=m,v=m.parent.isTextblock&&g>0?c.doc.resolve(g-1):m,b=v.parent.type.spec.isolating,S=m.pos-m.parentOffset,M=b&&v.parent.childCount===1?S===m.pos:it.atStart(f).from===g;return!h||!y.type.isTextblock||y.textContent.length||!M||M&&m.parent.type.name==="paragraph"?!1:a.clearNodes()}),()=>a.deleteSelection(),()=>a.joinBackward(),()=>a.selectNodeBackward()]),t=()=>this.editor.commands.first(({commands:a})=>[()=>a.deleteSelection(),()=>a.deleteCurrentNode(),()=>a.joinForward(),()=>a.selectNodeForward()]),i={Enter:()=>this.editor.commands.first(({commands:a})=>[()=>a.newlineInCode(),()=>a.createParagraphNear(),()=>a.liftEmptyBlock(),()=>a.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:n,"Mod-Backspace":n,"Shift-Backspace":n,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},s={...i},o={...i,"Ctrl-h":n,"Alt-Backspace":n,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return el()||rh()?o:s},addProseMirrorPlugins(){return[new xt({key:new It("clearDocument"),appendTransaction:(n,t,e)=>{if(n.some(b=>b.getMeta("composition")))return;const i=n.some(b=>b.docChanged)&&!t.doc.eq(e.doc),s=n.some(b=>b.getMeta("preventClearDocument"));if(!i||s)return;const{empty:o,from:a,to:c}=t.selection,u=it.atStart(t.doc).from,f=it.atEnd(t.doc).to;if(o||!(a===u&&c===f)||!Qa(e.doc))return;const g=e.tr,y=qf({state:e,transaction:g}),{commands:v}=new cx({editor:this.editor,state:y});if(v.clearNodes(),!!g.steps.length)return g}})]}}),q0=Vt.create({name:"paste",addProseMirrorPlugins(){return[new xt({key:new It("tiptapPaste"),props:{handlePaste:(n,t,e)=>{this.editor.emit("paste",{editor:this.editor,event:t,slice:e})}}})]}}),K0=Vt.create({name:"tabindex",addProseMirrorPlugins(){return[new xt({key:new It("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});function er(n){return new As({find:n.find,handler:({state:t,range:e,match:i})=>{const s=Ge(n.getAttributes,void 0,i);if(s===!1||s===null)return null;const{tr:o}=t,a=i[i.length-1],c=i[0];if(a){const u=c.search(/\S/),f=e.from+c.indexOf(a),h=f+a.length;if(Yf(e.from,e.to,t.doc).filter(y=>y.mark.type.excluded.find(b=>b===n.type&&b!==y.mark.type)).filter(y=>y.to>f).length)return null;h<e.to&&o.delete(h,e.to),f>e.from&&o.delete(e.from+u,f);const g=e.from+u+a.length;o.addMark(e.from+u,g,n.type.create(s||{})),o.removeStoredMark(n.type)}}})}function J0(n){return new As({find:n.find,handler:({state:t,range:e,match:i})=>{const s=Ge(n.getAttributes,void 0,i)||{},{tr:o}=t,a=e.from;let c=e.to;const u=n.type.create(s);if(i[1]){const f=i[0].lastIndexOf(i[1]);let h=a+f;h>c?h=c:c=h+i[1].length;const m=i[0][i[0].length-1];o.insertText(m,a+i[0].length-1),o.replaceWith(h,c,u)}else if(i[0]){const f=n.type.isInline?a:a-1;o.insert(f,n.type.create(s)).delete(o.mapping.map(a),o.mapping.map(c))}o.scrollIntoView()}})}function G0(n){return new As({find:n.find,handler:({state:t,range:e,match:i})=>{const s=t.doc.resolve(e.from),o=Ge(n.getAttributes,void 0,i)||{};if(!s.node(-1).canReplaceWith(s.index(-1),s.indexAfter(-1),n.type))return null;t.tr.delete(e.from,e.to).setBlockType(e.from,e.from,n.type,o)}})}function mi(n){return new As({find:n.find,handler:({state:t,range:e,match:i,chain:s})=>{const o=Ge(n.getAttributes,void 0,i)||{},a=t.tr.delete(e.from,e.to),u=a.doc.resolve(e.from).blockRange(),f=u&&Sa(u,n.type,o);if(!f)return null;if(a.wrap(u,f),n.keepMarks&&n.editor){const{selection:m,storedMarks:g}=t,{splittableMarks:y}=n.editor.extensionManager,v=g||m.$to.parentOffset&&m.$from.marks();if(v){const b=v.filter(S=>y.includes(S.type.name));a.ensureMarks(b)}}if(n.keepAttributes){const m=n.type.name==="bulletList"||n.type.name==="orderedList"?"listItem":"taskList";s().updateAttributes(m,o).run()}const h=a.doc.resolve(e.from-1).nodeBefore;h&&h.type===n.type&&Fe(a.doc,e.from-1)&&(!n.joinPredicate||n.joinPredicate(i,h))&&a.join(e.from-1)}})}function Y0(n,t){const{selection:e}=n,{$from:i}=e;if(e instanceof Y){const o=i.index();return i.parent.canReplaceWith(o,o+1,t)}let s=i.depth;for(;s>=0;){const o=i.index(s);if(i.node(s).contentMatchAt(o).matchType(t))return!0;s-=1}return!1}var Ae=class oh extends tl{constructor(){super(...arguments),this.type="node"}static create(t={}){const e=typeof t=="function"?t():t;return new oh(e)}configure(t){return super.configure(t)}extend(t){const e=typeof t=="function"?t():t;return super.extend(e)}};function nr(n){return new Ox({find:n.find,handler:({state:t,range:e,match:i,pasteEvent:s})=>{const o=Ge(n.getAttributes,void 0,i,s);if(o===!1||o===null)return null;const{tr:a}=t,c=i[i.length-1],u=i[0];let f=e.to;if(c){const h=u.search(/\S/),m=e.from+u.indexOf(c),g=m+c.length;if(Yf(e.from,e.to,t.doc).filter(v=>v.mark.type.excluded.find(S=>S===n.type&&S!==v.mark.type)).filter(v=>v.to>m).length)return null;g<e.to&&a.delete(g,e.to),m>e.from&&a.delete(e.from+h,m),f=e.from+h+c.length,a.addMark(e.from+h,f,n.type.create(o||{})),a.removeStoredMark(n.type)}}})}var X0=Ls.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:n=>n.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:n}){return["u",fe(this.options.HTMLAttributes,n),0]},addCommands(){return{setUnderline:()=>({commands:n})=>n.setMark(this.name),toggleUnderline:()=>({commands:n})=>n.toggleMark(this.name),unsetUnderline:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),Q0=X0,t1=Ae.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:n}){return["hr",fe(this.options.HTMLAttributes,n)]},addCommands(){return{setHorizontalRule:()=>({chain:n,state:t})=>{if(!Y0(t,t.schema.nodes[this.name]))return!1;const{selection:e}=t,{$to:i}=e,s=n();return Xf(e)?s.insertContentAt(i.pos,{type:this.name}):s.insertContent({type:this.name}),s.command(({tr:o,dispatch:a})=>{var c;if(a){const{$to:u}=o.selection,f=u.end();if(u.nodeAfter)u.nodeAfter.isTextblock?o.setSelection(X.create(o.doc,u.pos+1)):u.nodeAfter.isBlock?o.setSelection(Y.create(o.doc,u.pos)):o.setSelection(X.create(o.doc,u.pos));else{const h=(c=u.parent.type.contentMatch.defaultType)==null?void 0:c.create();h&&(o.insert(f,h),o.setSelection(X.create(o.doc,f+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[J0({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),e1=t1,n1=Ae.create({name:"doc",topNode:!0,content:"block+"}),i1=Ae.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:n}){return["p",fe(this.options.HTMLAttributes,n),0]},addCommands(){return{setParagraph:()=>({commands:n})=>n.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),r1=Ae.create({name:"text",group:"inline"}),is=(n,t)=>{if(n==="slot")return 0;if(n instanceof Function)return n(t);const{children:e,...i}=t??{};if(n==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[n,i,e]},s1=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,o1=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,a1=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,l1=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,c1=Ls.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:n=>n.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:n=>n.type.name===this.name},{style:"font-weight",getAttrs:n=>/^(bold(er)?|[5-9]\d{2,})$/.test(n)&&null}]},renderHTML({HTMLAttributes:n}){return is("strong",{...fe(this.options.HTMLAttributes,n),children:is("slot",{})})},addCommands(){return{setBold:()=>({commands:n})=>n.setMark(this.name),toggleBold:()=>({commands:n})=>n.toggleMark(this.name),unsetBold:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[er({find:s1,type:this.type}),er({find:a1,type:this.type})]},addPasteRules(){return[nr({find:o1,type:this.type}),nr({find:l1,type:this.type})]}}),u1=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,d1=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,f1=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,h1=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,p1=Ls.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:n=>n.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:n=>n.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:n}){return["em",fe(this.options.HTMLAttributes,n),0]},addCommands(){return{setItalic:()=>({commands:n})=>n.setMark(this.name),toggleItalic:()=>({commands:n})=>n.toggleMark(this.name),unsetItalic:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[er({find:u1,type:this.type}),er({find:f1,type:this.type})]},addPasteRules(){return[nr({find:d1,type:this.type}),nr({find:h1,type:this.type})]}}),m1=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,g1=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,_1=Ls.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:n=>n.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:n}){return["s",fe(this.options.HTMLAttributes,n),0]},addCommands(){return{setStrike:()=>({commands:n})=>n.setMark(this.name),toggleStrike:()=>({commands:n})=>n.toggleMark(this.name),unsetStrike:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[er({find:m1,type:this.type})]},addPasteRules(){return[nr({find:g1,type:this.type})]}}),y1=/^\s*>\s$/,v1=Ae.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:n}){return is("blockquote",{...fe(this.options.HTMLAttributes,n),children:is("slot",{})})},addCommands(){return{setBlockquote:()=>({commands:n})=>n.wrapIn(this.name),toggleBlockquote:()=>({commands:n})=>n.toggleWrap(this.name),unsetBlockquote:()=>({commands:n})=>n.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[mi({find:y1,type:this.type})]}}),b1=Object.defineProperty,x1=(n,t)=>{for(var e in t)b1(n,e,{get:t[e],enumerable:!0})},k1="listItem",Ou="textStyle",Au=/^\s*([-+*])\s$/,ah=Ae.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:n}){return["ul",fe(this.options.HTMLAttributes,n),0]},addCommands(){return{toggleBulletList:()=>({commands:n,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(k1,this.editor.getAttributes(Ou)).run():n.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let n=mi({find:Au,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(n=mi({find:Au,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(Ou),editor:this.editor})),[n]}}),lh=Ae.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:n}){return["li",fe(this.options.HTMLAttributes,n),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),w1={};x1(w1,{findListItemPos:()=>ar,getNextListDepth:()=>nl,handleBackspace:()=>ra,handleDelete:()=>sa,hasListBefore:()=>ch,hasListItemAfter:()=>S1,hasListItemBefore:()=>uh,listItemHasSubList:()=>dh,nextListIsDeeper:()=>fh,nextListIsHigher:()=>hh});var ar=(n,t)=>{const{$from:e}=t.selection,i=jt(n,t.schema);let s=null,o=e.depth,a=e.pos,c=null;for(;o>0&&c===null;)s=e.node(o),s.type===i?c=o:(o-=1,a-=1);return c===null?null:{$pos:t.doc.resolve(a),depth:c}},nl=(n,t)=>{const e=ar(n,t);if(!e)return!1;const[,i]=wx(t,n,e.$pos.pos+4);return i},ch=(n,t,e)=>{const{$anchor:i}=n.selection,s=Math.max(0,i.pos-2),o=n.doc.resolve(s).node();return!(!o||!e.includes(o.type.name))},uh=(n,t)=>{var e;const{$anchor:i}=t.selection,s=t.doc.resolve(i.pos-2);return!(s.index()===0||((e=s.nodeBefore)==null?void 0:e.type.name)!==n)},dh=(n,t,e)=>{if(!e)return!1;const i=jt(n,t.schema);let s=!1;return e.descendants(o=>{o.type===i&&(s=!0)}),s},ra=(n,t,e)=>{if(n.commands.undoInputRule())return!0;if(n.state.selection.from!==n.state.selection.to)return!1;if(!pi(n.state,t)&&ch(n.state,t,e)){const{$anchor:c}=n.state.selection,u=n.state.doc.resolve(c.before()-1),f=[];u.node().descendants((g,y)=>{g.type.name===t&&f.push({node:g,pos:y})});const h=f.at(-1);if(!h)return!1;const m=n.state.doc.resolve(u.start()+h.pos+1);return n.chain().cut({from:c.start()-1,to:c.end()+1},m.end()).joinForward().run()}if(!pi(n.state,t)||!Mx(n.state))return!1;const i=ar(t,n.state);if(!i)return!1;const o=n.state.doc.resolve(i.$pos.pos-2).node(i.depth),a=dh(t,n.state,o);return uh(t,n.state)&&!a?n.commands.joinItemBackward():n.chain().liftListItem(t).run()},fh=(n,t)=>{const e=nl(n,t),i=ar(n,t);return!i||!e?!1:e>i.depth},hh=(n,t)=>{const e=nl(n,t),i=ar(n,t);return!i||!e?!1:e<i.depth},sa=(n,t)=>{if(!pi(n.state,t)||!Cx(n.state,t))return!1;const{selection:e}=n.state,{$from:i,$to:s}=e;return!e.empty&&i.sameParent(s)?!1:fh(t,n.state)?n.chain().focus(n.state.selection.from+4).lift(t).joinBackward().run():hh(t,n.state)?n.chain().joinForward().joinBackward().run():n.commands.joinItemForward()},S1=(n,t)=>{var e;const{$anchor:i}=t.selection,s=t.doc.resolve(i.pos-i.parentOffset-2);return!(s.index()===s.parent.childCount-1||((e=s.nodeAfter)==null?void 0:e.type.name)!==n)},C1=Vt.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:n})=>{let t=!1;return this.options.listTypes.forEach(({itemName:e})=>{n.state.schema.nodes[e]!==void 0&&sa(n,e)&&(t=!0)}),t},"Mod-Delete":({editor:n})=>{let t=!1;return this.options.listTypes.forEach(({itemName:e})=>{n.state.schema.nodes[e]!==void 0&&sa(n,e)&&(t=!0)}),t},Backspace:({editor:n})=>{let t=!1;return this.options.listTypes.forEach(({itemName:e,wrapperNames:i})=>{n.state.schema.nodes[e]!==void 0&&ra(n,e,i)&&(t=!0)}),t},"Mod-Backspace":({editor:n})=>{let t=!1;return this.options.listTypes.forEach(({itemName:e,wrapperNames:i})=>{n.state.schema.nodes[e]!==void 0&&ra(n,e,i)&&(t=!0)}),t}}}}),M1="listItem",Lu="textStyle",Iu=/^(\d+)\.\s$/,ph=Ae.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:n=>n.hasAttribute("start")?parseInt(n.getAttribute("start")||"",10):1},type:{default:null,parseHTML:n=>n.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:n}){const{start:t,...e}=n;return t===1?["ol",fe(this.options.HTMLAttributes,e),0]:["ol",fe(this.options.HTMLAttributes,n),0]},addCommands(){return{toggleOrderedList:()=>({commands:n,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(M1,this.editor.getAttributes(Lu)).run():n.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let n=mi({find:Iu,type:this.type,getAttributes:t=>({start:+t[1]}),joinPredicate:(t,e)=>e.childCount+e.attrs.start===+t[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(n=mi({find:Iu,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:t=>({start:+t[1],...this.editor.getAttributes(Lu)}),joinPredicate:(t,e)=>e.childCount+e.attrs.start===+t[1],editor:this.editor})),[n]}}),T1=/^\s*(\[([( |x])?\])\s$/,P1=Ae.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:n=>{const t=n.getAttribute("data-checked");return t===""||t==="true"},renderHTML:n=>({"data-checked":n.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:n,HTMLAttributes:t}){return["li",fe(this.options.HTMLAttributes,t,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:n.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){const n={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...n,Tab:()=>this.editor.commands.sinkListItem(this.name)}:n},addNodeView(){return({node:n,HTMLAttributes:t,getPos:e,editor:i})=>{const s=document.createElement("li"),o=document.createElement("label"),a=document.createElement("span"),c=document.createElement("input"),u=document.createElement("div"),f=h=>{var m,g;c.ariaLabel=((g=(m=this.options.a11y)==null?void 0:m.checkboxLabel)==null?void 0:g.call(m,h,c.checked))||`Task item checkbox for ${h.textContent||"empty task item"}`};return f(n),o.contentEditable="false",c.type="checkbox",c.addEventListener("mousedown",h=>h.preventDefault()),c.addEventListener("change",h=>{if(!i.isEditable&&!this.options.onReadOnlyChecked){c.checked=!c.checked;return}const{checked:m}=h.target;i.isEditable&&typeof e=="function"&&i.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:g})=>{const y=e();if(typeof y!="number")return!1;const v=g.doc.nodeAt(y);return g.setNodeMarkup(y,void 0,{...v?.attrs,checked:m}),!0}).run(),!i.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(n,m)||(c.checked=!c.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([h,m])=>{s.setAttribute(h,m)}),s.dataset.checked=n.attrs.checked,c.checked=n.attrs.checked,o.append(c,a),s.append(o,u),Object.entries(t).forEach(([h,m])=>{s.setAttribute(h,m)}),{dom:s,contentDOM:u,update:h=>h.type!==this.type?!1:(s.dataset.checked=h.attrs.checked,c.checked=h.attrs.checked,f(h),!0)}}},addInputRules(){return[mi({find:T1,type:this.type,getAttributes:n=>({checked:n[n.length-1]==="x"})})]}}),E1=Ae.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:n}){return["ul",fe(this.options.HTMLAttributes,n,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands:n})=>n.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});Vt.create({name:"listKit",addExtensions(){const n=[];return this.options.bulletList!==!1&&n.push(ah.configure(this.options.bulletList)),this.options.listItem!==!1&&n.push(lh.configure(this.options.listItem)),this.options.listKeymap!==!1&&n.push(C1.configure(this.options.listKeymap)),this.options.orderedList!==!1&&n.push(ph.configure(this.options.orderedList)),this.options.taskItem!==!1&&n.push(P1.configure(this.options.taskItem)),this.options.taskList!==!1&&n.push(E1.configure(this.options.taskList)),n}});var O1=Ae.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(n=>({tag:`h${n}`,attrs:{level:n}}))},renderHTML({node:n,HTMLAttributes:t}){return[`h${this.options.levels.includes(n.attrs.level)?n.attrs.level:this.options.levels[0]}`,fe(this.options.HTMLAttributes,t),0]},addCommands(){return{setHeading:n=>({commands:t})=>this.options.levels.includes(n.level)?t.setNode(this.name,n):!1,toggleHeading:n=>({commands:t})=>this.options.levels.includes(n.level)?t.toggleNode(this.name,"paragraph",n):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((n,t)=>({...n,[`Mod-Alt-${t}`]:()=>this.editor.commands.toggleHeading({level:t})}),{})},addInputRules(){return this.options.levels.map(n=>G0({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${n}})\\s$`),type:this.type,getAttributes:{level:n}}))}});function A1(n={}){return new xt({view(t){return new L1(t,n)}})}class L1{constructor(t,e){var i;this.editorView=t,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(i=e.width)!==null&&i!==void 0?i:1,this.color=e.color===!1?void 0:e.color||"black",this.class=e.class,this.handlers=["dragover","dragend","drop","dragleave"].map(s=>{let o=a=>{this[s](a)};return t.dom.addEventListener(s,o),{name:s,handler:o}})}destroy(){this.handlers.forEach(({name:t,handler:e})=>this.editorView.dom.removeEventListener(t,e))}update(t,e){this.cursorPos!=null&&e.doc!=t.state.doc&&(this.cursorPos>t.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(t){t!=this.cursorPos&&(this.cursorPos=t,t==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let t=this.editorView.state.doc.resolve(this.cursorPos),e=!t.parent.inlineContent,i,s=this.editorView.dom,o=s.getBoundingClientRect(),a=o.width/s.offsetWidth,c=o.height/s.offsetHeight;if(e){let m=t.nodeBefore,g=t.nodeAfter;if(m||g){let y=this.editorView.nodeDOM(this.cursorPos-(m?m.nodeSize:0));if(y){let v=y.getBoundingClientRect(),b=m?v.bottom:v.top;m&&g&&(b=(b+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let S=this.width/2*c;i={left:v.left,right:v.right,top:b-S,bottom:b+S}}}}if(!i){let m=this.editorView.coordsAtPos(this.cursorPos),g=this.width/2*a;i={left:m.left-g,right:m.left+g,top:m.top,bottom:m.bottom}}let u=this.editorView.dom.offsetParent;this.element||(this.element=u.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",e),this.element.classList.toggle("prosemirror-dropcursor-inline",!e);let f,h;if(!u||u==document.body&&getComputedStyle(u).position=="static")f=-pageXOffset,h=-pageYOffset;else{let m=u.getBoundingClientRect(),g=m.width/u.offsetWidth,y=m.height/u.offsetHeight;f=m.left-u.scrollLeft*g,h=m.top-u.scrollTop*y}this.element.style.left=(i.left-f)/a+"px",this.element.style.top=(i.top-h)/c+"px",this.element.style.width=(i.right-i.left)/a+"px",this.element.style.height=(i.bottom-i.top)/c+"px"}scheduleRemoval(t){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),t)}dragover(t){if(!this.editorView.editable)return;let e=this.editorView.posAtCoords({left:t.clientX,top:t.clientY}),i=e&&e.inside>=0&&this.editorView.state.doc.nodeAt(e.inside),s=i&&i.type.spec.disableDropCursor,o=typeof s=="function"?s(this.editorView,e,t):s;if(e&&!o){let a=e.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let c=Td(this.editorView.state.doc,a,this.editorView.dragging.slice);c!=null&&(a=c)}this.setCursor(a),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(t){this.editorView.dom.contains(t.relatedTarget)||this.setCursor(null)}}class Tt extends it{constructor(t){super(t,t)}map(t,e){let i=t.resolve(e.map(this.head));return Tt.valid(i)?new Tt(i):it.near(i)}content(){return F.empty}eq(t){return t instanceof Tt&&t.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(t,e){if(typeof e.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new Tt(t.resolve(e.pos))}getBookmark(){return new il(this.anchor)}static valid(t){let e=t.parent;if(e.isTextblock||!I1(t)||!N1(t))return!1;let i=e.type.spec.allowGapCursor;if(i!=null)return i;let s=e.contentMatchAt(t.index()).defaultType;return s&&s.isTextblock}static findGapCursorFrom(t,e,i=!1){t:for(;;){if(!i&&Tt.valid(t))return t;let s=t.pos,o=null;for(let a=t.depth;;a--){let c=t.node(a);if(e>0?t.indexAfter(a)<c.childCount:t.index(a)>0){o=c.child(e>0?t.indexAfter(a):t.index(a)-1);break}else if(a==0)return null;s+=e;let u=t.doc.resolve(s);if(Tt.valid(u))return u}for(;;){let a=e>0?o.firstChild:o.lastChild;if(!a){if(o.isAtom&&!o.isText&&!Y.isSelectable(o)){t=t.doc.resolve(s+o.nodeSize*e),i=!1;continue t}break}o=a,s+=e;let c=t.doc.resolve(s);if(Tt.valid(c))return c}return null}}}Tt.prototype.visible=!1;Tt.findFrom=Tt.findGapCursorFrom;it.jsonID("gapcursor",Tt);class il{constructor(t){this.pos=t}map(t){return new il(t.map(this.pos))}resolve(t){let e=t.resolve(this.pos);return Tt.valid(e)?new Tt(e):it.near(e)}}function I1(n){for(let t=n.depth;t>=0;t--){let e=n.index(t),i=n.node(t);if(e==0){if(i.type.spec.isolating)return!0;continue}for(let s=i.child(e-1);;s=s.lastChild){if(s.childCount==0&&!s.inlineContent||s.isAtom||s.type.spec.isolating)return!0;if(s.inlineContent)return!1}}return!0}function N1(n){for(let t=n.depth;t>=0;t--){let e=n.indexAfter(t),i=n.node(t);if(e==i.childCount){if(i.type.spec.isolating)return!0;continue}for(let s=i.child(e);;s=s.firstChild){if(s.childCount==0&&!s.inlineContent||s.isAtom||s.type.spec.isolating)return!0;if(s.inlineContent)return!1}}return!0}function D1(){return new xt({props:{decorations:$1,createSelectionBetween(n,t,e){return t.pos==e.pos&&Tt.valid(e)?new Tt(e):null},handleClick:R1,handleKeyDown:z1,handleDOMEvents:{beforeinput:B1}}})}const z1=gf({ArrowLeft:Rr("horiz",-1),ArrowRight:Rr("horiz",1),ArrowUp:Rr("vert",-1),ArrowDown:Rr("vert",1)});function Rr(n,t){const e=n=="vert"?t>0?"down":"up":t>0?"right":"left";return function(i,s,o){let a=i.selection,c=t>0?a.$to:a.$from,u=a.empty;if(a instanceof X){if(!o.endOfTextblock(e)||c.depth==0)return!1;u=!1,c=i.doc.resolve(t>0?c.after():c.before())}let f=Tt.findGapCursorFrom(c,t,u);return f?(s&&s(i.tr.setSelection(new Tt(f))),!0):!1}}function R1(n,t,e){if(!n||!n.editable)return!1;let i=n.state.doc.resolve(t);if(!Tt.valid(i))return!1;let s=n.posAtCoords({left:e.clientX,top:e.clientY});return s&&s.inside>-1&&Y.isSelectable(n.state.doc.nodeAt(s.inside))?!1:(n.dispatch(n.state.tr.setSelection(new Tt(i))),!0)}function B1(n,t){if(t.inputType!="insertCompositionText"||!(n.state.selection instanceof Tt))return!1;let{$from:e}=n.state.selection,i=e.parent.contentMatchAt(e.index()).findWrapping(n.state.schema.nodes.text);if(!i)return!1;let s=z.empty;for(let a=i.length-1;a>=0;a--)s=z.from(i[a].createAndFill(null,s));let o=n.state.tr.replace(e.pos,e.pos,new F(s,0,0));return o.setSelection(X.near(o.doc.resolve(e.pos+1))),n.dispatch(o),!1}function $1(n){if(!(n.selection instanceof Tt))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",St.create(n.doc,[ie.widget(n.selection.head,t,{key:"gapcursor"})])}var rs=200,Zt=function(){};Zt.prototype.append=function(t){return t.length?(t=Zt.from(t),!this.length&&t||t.length<rs&&this.leafAppend(t)||this.length<rs&&t.leafPrepend(this)||this.appendInner(t)):this};Zt.prototype.prepend=function(t){return t.length?Zt.from(t).append(this):this};Zt.prototype.appendInner=function(t){return new F1(this,t)};Zt.prototype.slice=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=this.length),t>=e?Zt.empty:this.sliceInner(Math.max(0,t),Math.min(this.length,e))};Zt.prototype.get=function(t){if(!(t<0||t>=this.length))return this.getInner(t)};Zt.prototype.forEach=function(t,e,i){e===void 0&&(e=0),i===void 0&&(i=this.length),e<=i?this.forEachInner(t,e,i,0):this.forEachInvertedInner(t,e,i,0)};Zt.prototype.map=function(t,e,i){e===void 0&&(e=0),i===void 0&&(i=this.length);var s=[];return this.forEach(function(o,a){return s.push(t(o,a))},e,i),s};Zt.from=function(t){return t instanceof Zt?t:t&&t.length?new mh(t):Zt.empty};var mh=(function(n){function t(i){n.call(this),this.values=i}n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t;var e={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(s,o){return s==0&&o==this.length?this:new t(this.values.slice(s,o))},t.prototype.getInner=function(s){return this.values[s]},t.prototype.forEachInner=function(s,o,a,c){for(var u=o;u<a;u++)if(s(this.values[u],c+u)===!1)return!1},t.prototype.forEachInvertedInner=function(s,o,a,c){for(var u=o-1;u>=a;u--)if(s(this.values[u],c+u)===!1)return!1},t.prototype.leafAppend=function(s){if(this.length+s.length<=rs)return new t(this.values.concat(s.flatten()))},t.prototype.leafPrepend=function(s){if(this.length+s.length<=rs)return new t(s.flatten().concat(this.values))},e.length.get=function(){return this.values.length},e.depth.get=function(){return 0},Object.defineProperties(t.prototype,e),t})(Zt);Zt.empty=new mh([]);var F1=(function(n){function t(e,i){n.call(this),this.left=e,this.right=i,this.length=e.length+i.length,this.depth=Math.max(e.depth,i.depth)+1}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(i){return i<this.left.length?this.left.get(i):this.right.get(i-this.left.length)},t.prototype.forEachInner=function(i,s,o,a){var c=this.left.length;if(s<c&&this.left.forEachInner(i,s,Math.min(o,c),a)===!1||o>c&&this.right.forEachInner(i,Math.max(s-c,0),Math.min(this.length,o)-c,a+c)===!1)return!1},t.prototype.forEachInvertedInner=function(i,s,o,a){var c=this.left.length;if(s>c&&this.right.forEachInvertedInner(i,s-c,Math.max(o,c)-c,a+c)===!1||o<c&&this.left.forEachInvertedInner(i,Math.min(s,c),o,a)===!1)return!1},t.prototype.sliceInner=function(i,s){if(i==0&&s==this.length)return this;var o=this.left.length;return s<=o?this.left.slice(i,s):i>=o?this.right.slice(i-o,s-o):this.left.slice(i,o).append(this.right.slice(0,s-o))},t.prototype.leafAppend=function(i){var s=this.right.leafAppend(i);if(s)return new t(this.left,s)},t.prototype.leafPrepend=function(i){var s=this.left.leafPrepend(i);if(s)return new t(s,this.right)},t.prototype.appendInner=function(i){return this.left.depth>=Math.max(this.right.depth,i.depth)+1?new t(this.left,new t(this.right,i)):new t(this,i)},t})(Zt);const V1=500;class Te{constructor(t,e){this.items=t,this.eventCount=e}popEvent(t,e){if(this.eventCount==0)return null;let i=this.items.length;for(;;i--)if(this.items.get(i-1).selection){--i;break}let s,o;e&&(s=this.remapping(i,this.items.length),o=s.maps.length);let a=t.tr,c,u,f=[],h=[];return this.items.forEach((m,g)=>{if(!m.step){s||(s=this.remapping(i,g+1),o=s.maps.length),o--,h.push(m);return}if(s){h.push(new ze(m.map));let y=m.step.map(s.slice(o)),v;y&&a.maybeStep(y).doc&&(v=a.mapping.maps[a.mapping.maps.length-1],f.push(new ze(v,void 0,void 0,f.length+h.length))),o--,v&&s.appendMap(v,o)}else a.maybeStep(m.step);if(m.selection)return c=s?m.selection.map(s.slice(o)):m.selection,u=new Te(this.items.slice(0,i).append(h.reverse().concat(f)),this.eventCount-1),!1},this.items.length,0),{remaining:u,transform:a,selection:c}}addTransform(t,e,i,s){let o=[],a=this.eventCount,c=this.items,u=!s&&c.length?c.get(c.length-1):null;for(let h=0;h<t.steps.length;h++){let m=t.steps[h].invert(t.docs[h]),g=new ze(t.mapping.maps[h],m,e),y;(y=u&&u.merge(g))&&(g=y,h?o.pop():c=c.slice(0,c.length-1)),o.push(g),e&&(a++,e=void 0),s||(u=g)}let f=a-i.depth;return f>Z1&&(c=H1(c,f),a-=f),new Te(c.append(o),a)}remapping(t,e){let i=new qi;return this.items.forEach((s,o)=>{let a=s.mirrorOffset!=null&&o-s.mirrorOffset>=t?i.maps.length-s.mirrorOffset:void 0;i.appendMap(s.map,a)},t,e),i}addMaps(t){return this.eventCount==0?this:new Te(this.items.append(t.map(e=>new ze(e))),this.eventCount)}rebased(t,e){if(!this.eventCount)return this;let i=[],s=Math.max(0,this.items.length-e),o=t.mapping,a=t.steps.length,c=this.eventCount;this.items.forEach(g=>{g.selection&&c--},s);let u=e;this.items.forEach(g=>{let y=o.getMirror(--u);if(y==null)return;a=Math.min(a,y);let v=o.maps[y];if(g.step){let b=t.steps[y].invert(t.docs[y]),S=g.selection&&g.selection.map(o.slice(u+1,y));S&&c++,i.push(new ze(v,b,S))}else i.push(new ze(v))},s);let f=[];for(let g=e;g<a;g++)f.push(new ze(o.maps[g]));let h=this.items.slice(0,s).append(f).append(i),m=new Te(h,c);return m.emptyItemCount()>V1&&(m=m.compress(this.items.length-i.length)),m}emptyItemCount(){let t=0;return this.items.forEach(e=>{e.step||t++}),t}compress(t=this.items.length){let e=this.remapping(0,t),i=e.maps.length,s=[],o=0;return this.items.forEach((a,c)=>{if(c>=t)s.push(a),a.selection&&o++;else if(a.step){let u=a.step.map(e.slice(i)),f=u&&u.getMap();if(i--,f&&e.appendMap(f,i),u){let h=a.selection&&a.selection.map(e.slice(i));h&&o++;let m=new ze(f.invert(),u,h),g,y=s.length-1;(g=s.length&&s[y].merge(m))?s[y]=g:s.push(m)}}else a.map&&i--},this.items.length,0),new Te(Zt.from(s.reverse()),o)}}Te.empty=new Te(Zt.empty,0);function H1(n,t){let e;return n.forEach((i,s)=>{if(i.selection&&t--==0)return e=s,!1}),n.slice(e)}class ze{constructor(t,e,i,s){this.map=t,this.step=e,this.selection=i,this.mirrorOffset=s}merge(t){if(this.step&&t.step&&!t.selection){let e=t.step.merge(this.step);if(e)return new ze(e.getMap().invert(),e,this.selection)}}}class ln{constructor(t,e,i,s,o){this.done=t,this.undone=e,this.prevRanges=i,this.prevTime=s,this.prevComposition=o}}const Z1=20;function W1(n,t,e,i){let s=e.getMeta(Rn),o;if(s)return s.historyState;e.getMeta(q1)&&(n=new ln(n.done,n.undone,null,0,-1));let a=e.getMeta("appendedTransaction");if(e.steps.length==0)return n;if(a&&a.getMeta(Rn))return a.getMeta(Rn).redo?new ln(n.done.addTransform(e,void 0,i,Hr(t)),n.undone,Nu(e.mapping.maps),n.prevTime,n.prevComposition):new ln(n.done,n.undone.addTransform(e,void 0,i,Hr(t)),null,n.prevTime,n.prevComposition);if(e.getMeta("addToHistory")!==!1&&!(a&&a.getMeta("addToHistory")===!1)){let c=e.getMeta("composition"),u=n.prevTime==0||!a&&n.prevComposition!=c&&(n.prevTime<(e.time||0)-i.newGroupDelay||!j1(e,n.prevRanges)),f=a?zo(n.prevRanges,e.mapping):Nu(e.mapping.maps);return new ln(n.done.addTransform(e,u?t.selection.getBookmark():void 0,i,Hr(t)),Te.empty,f,e.time,c??n.prevComposition)}else return(o=e.getMeta("rebased"))?new ln(n.done.rebased(e,o),n.undone.rebased(e,o),zo(n.prevRanges,e.mapping),n.prevTime,n.prevComposition):new ln(n.done.addMaps(e.mapping.maps),n.undone.addMaps(e.mapping.maps),zo(n.prevRanges,e.mapping),n.prevTime,n.prevComposition)}function j1(n,t){if(!t)return!1;if(!n.docChanged)return!0;let e=!1;return n.mapping.maps[0].forEach((i,s)=>{for(let o=0;o<t.length;o+=2)i<=t[o+1]&&s>=t[o]&&(e=!0)}),e}function Nu(n){let t=[];for(let e=n.length-1;e>=0&&t.length==0;e--)n[e].forEach((i,s,o,a)=>t.push(o,a));return t}function zo(n,t){if(!n)return null;let e=[];for(let i=0;i<n.length;i+=2){let s=t.map(n[i],1),o=t.map(n[i+1],-1);s<=o&&e.push(s,o)}return e}function U1(n,t,e){let i=Hr(t),s=Rn.get(t).spec.config,o=(e?n.undone:n.done).popEvent(t,i);if(!o)return null;let a=o.selection.resolve(o.transform.doc),c=(e?n.done:n.undone).addTransform(o.transform,t.selection.getBookmark(),s,i),u=new ln(e?c:o.remaining,e?o.remaining:c,null,0,-1);return o.transform.setSelection(a).setMeta(Rn,{redo:e,historyState:u})}let Ro=!1,Du=null;function Hr(n){let t=n.plugins;if(Du!=t){Ro=!1,Du=t;for(let e=0;e<t.length;e++)if(t[e].spec.historyPreserveItems){Ro=!0;break}}return Ro}const Rn=new It("history"),q1=new It("closeHistory");function K1(n={}){return n={depth:n.depth||100,newGroupDelay:n.newGroupDelay||500},new xt({key:Rn,state:{init(){return new ln(Te.empty,Te.empty,null,0,-1)},apply(t,e,i){return W1(e,i,t,n)}},config:n,props:{handleDOMEvents:{beforeinput(t,e){let i=e.inputType,s=i=="historyUndo"?_h:i=="historyRedo"?yh:null;return s?(e.preventDefault(),s(t.state,t.dispatch)):!1}}}})}function gh(n,t){return(e,i)=>{let s=Rn.getState(e);if(!s||(n?s.undone:s.done).eventCount==0)return!1;if(i){let o=U1(s,e,n);o&&i(t?o.scrollIntoView():o)}return!0}}const _h=gh(!1,!0),yh=gh(!0,!0);Vt.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:n=>n.length,wordCounter:n=>n.split(" ").filter(t=>t!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=n=>{const t=n?.node||this.editor.state.doc;if((n?.mode||this.options.mode)==="textSize"){const i=t.textBetween(0,t.content.size,void 0," ");return this.options.textCounter(i)}return t.nodeSize},this.storage.words=n=>{const t=n?.node||this.editor.state.doc,e=t.textBetween(0,t.content.size," "," ");return this.options.wordCounter(e)}},addProseMirrorPlugins(){let n=!1;return[new xt({key:new It("characterCount"),appendTransaction:(t,e,i)=>{if(n)return;const s=this.options.limit;if(s==null||s===0){n=!0;return}const o=this.storage.characters({node:i.doc});if(o>s){const a=o-s,c=0,u=a;console.warn(`[CharacterCount] Initial content exceeded limit of ${s} characters. Content was automatically trimmed.`);const f=i.tr.deleteRange(c,u);return n=!0,f}n=!0},filterTransaction:(t,e)=>{const i=this.options.limit;if(!t.docChanged||i===0||i===null||i===void 0)return!0;const s=this.storage.characters({node:e.doc}),o=this.storage.characters({node:t.doc});if(o<=i||s>i&&o>i&&o<=s)return!0;if(s>i&&o>i&&o>s||!t.getMeta("paste"))return!1;const c=t.selection.$head.pos,u=o-i,f=c-u,h=c;return t.deleteRange(f,h),!(this.storage.characters({node:t.doc})>i)}})]}});Vt.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[A1(this.options)]}});Vt.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new xt({key:new It("focus"),props:{decorations:({doc:n,selection:t})=>{const{isEditable:e,isFocused:i}=this.editor,{anchor:s}=t,o=[];if(!e||!i)return St.create(n,[]);let a=0;this.options.mode==="deepest"&&n.descendants((u,f)=>{if(u.isText)return;if(!(s>=f&&s<=f+u.nodeSize-1))return!1;a+=1});let c=0;return n.descendants((u,f)=>{if(u.isText||!(s>=f&&s<=f+u.nodeSize-1))return!1;if(c+=1,this.options.mode==="deepest"&&a-c>0||this.options.mode==="shallowest"&&c>1)return this.options.mode==="deepest";o.push(ie.node(f,f+u.nodeSize,{class:this.options.className}))}),St.create(n,o)}}})]}});Vt.create({name:"gapCursor",addProseMirrorPlugins(){return[D1()]},extendNodeSchema(n){var t;const e={name:n.name,options:n.options,storage:n.storage};return{allowGapCursor:(t=Ge(hi(n,"allowGapCursor",e)))!=null?t:null}}});Vt.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new xt({key:new It("placeholder"),props:{decorations:({doc:n,selection:t})=>{const e=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:i}=t,s=[];if(!e)return null;const o=this.editor.isEmpty;return n.descendants((a,c)=>{const u=i>=c&&i<=c+a.nodeSize,f=!a.isLeaf&&Qa(a);if((u||!this.options.showOnlyCurrent)&&f){const h=[this.options.emptyNodeClass];o&&h.push(this.options.emptyEditorClass);const m=ie.node(c,c+a.nodeSize,{class:h.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:a,pos:c,hasAnchor:u}):this.options.placeholder});s.push(m)}return this.options.includeChildren}),St.create(n,s)}}})]}});Vt.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:n,options:t}=this;return[new xt({key:new It("selection"),props:{decorations(e){return e.selection.empty||n.isFocused||!n.isEditable||Xf(e.selection)||n.view.dragging?null:St.create(e.doc,[ie.inline(e.selection.from,e.selection.to,{class:t.className})])}}})]}});function zu({types:n,node:t}){return t&&Array.isArray(n)&&n.includes(t.type)||t?.type===n}Vt.create({name:"trailingNode",addOptions(){return{node:"paragraph",notAfter:[]}},addProseMirrorPlugins(){const n=new It(this.name),t=Object.entries(this.editor.schema.nodes).map(([,e])=>e).filter(e=>(this.options.notAfter||[]).concat(this.options.node).includes(e.name));return[new xt({key:n,appendTransaction:(e,i,s)=>{const{doc:o,tr:a,schema:c}=s,u=n.getState(s),f=o.content.size,h=c.nodes[this.options.node];if(u)return a.insert(f,h.create())},state:{init:(e,i)=>{const s=i.tr.doc.lastChild;return!zu({node:s,types:t})},apply:(e,i)=>{if(!e.docChanged)return i;const s=e.doc.lastChild;return!zu({node:s,types:t})}}})]}});var J1=Vt.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:n,dispatch:t})=>_h(n,t),redo:()=>({state:n,dispatch:t})=>yh(n,t)}},addProseMirrorPlugins(){return[K1(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}});const G1={key:0,class:"editor"},Y1={key:0,class:"flex items-center gap-0.5 rounded-sm mb-2"},X1={class:"bg-gray-300 p-0.5 rounded"},Q1={class:"bg-gray-300 p-0.5 rounded"},tk={class:"bg-gray-300 p-0.5 rounded"},ek={class:"bg-gray-300 p-0.5 rounded"},nk={class:"bg-gray-300 p-0.5 rounded"},ik={class:"bg-gray-300 p-0.5 rounded"},rl=ct({__name:"TiptapEditor",props:{modelValue:{},disabled:{type:Boolean},timer:{default:1e4}},emits:["update:modelValue"],setup(n,{emit:t}){const e=n,i=t,s=Z(!1),o=ax({content:e.modelValue,extensions:[n1,i1,r1,c1,p1,_1,v1,ah,O1,lh,J1,ph,Q0,e1],onUpdate:({editor:a})=>{s.value=!0,Wm(()=>{s.value=!1,i("update:modelValue",a.getHTML())},e.timer)}});return aa(()=>{w(o).destroy()}),ce(()=>e.modelValue,()=>{o.value?.commands.setContent(e.modelValue),o.value?.setEditable(!e.disabled)}),ce(()=>e.disabled,()=>{o.value?.setEditable(!e.disabled)}),te(()=>{e.modelValue&&(o.value?.commands.setContent(e.modelValue),o.value?.setEditable(!e.disabled))}),(a,c)=>{const u=Lt,f=ox;return w(o)?(I(),W("div",G1,[n.disabled?lt("",!0):(I(),W("div",Y1,[A("div",X1,[x(u,{type:"button",size:"sm",variant:"ghost",onClick:c[0]||(c[0]=h=>w(o).chain().focus().toggleBold().run()),disabled:!w(o).can().chain().focus().toggleBold().run(),class:Bt({"is-active":w(o).isActive("bold")})},{default:C(()=>[x(w(Sm))]),_:1},8,["disabled","class"]),x(u,{type:"button",size:"sm",variant:"ghost",onClick:c[1]||(c[1]=h=>w(o).chain().focus().toggleItalic().run()),disabled:!w(o).can().chain().focus().toggleItalic().run(),class:Bt({"is-active":w(o).isActive("italic")})},{default:C(()=>[x(w(Cm))]),_:1},8,["disabled","class"]),x(u,{type:"button",size:"sm",variant:"ghost",onClick:c[2]||(c[2]=h=>w(o).chain().focus().toggleUnderline().run()),disabled:!w(o).can().chain().focus().toggleUnderline().run(),class:Bt({"is-active":w(o).isActive("underline")})},{default:C(()=>[x(w(Mm))]),_:1},8,["disabled","class"]),x(u,{type:"button",size:"sm",variant:"ghost",onClick:c[3]||(c[3]=h=>w(o).chain().focus().toggleStrike().run()),disabled:!w(o).can().chain().focus().toggleStrike().run(),class:Bt({"is-active":w(o).isActive("strike")})},{default:C(()=>[x(w(Tm))]),_:1},8,["disabled","class"])]),A("div",Q1,[x(u,{type:"button",size:"sm",variant:"ghost",onClick:c[4]||(c[4]=h=>w(o).chain().focus().unsetAllMarks().run())},{default:C(()=>[x(w(us))]),_:1}),x(u,{type:"button",size:"sm",variant:"ghost",onClick:c[5]||(c[5]=h=>w(o).chain().focus().clearNodes().run())},{default:C(()=>[x(w(Pm))]),_:1}),x(u,{type:"button",size:"sm",variant:"ghost",onClick:c[6]||(c[6]=h=>w(o).chain().focus().setParagraph().run()),class:Bt({"is-active":w(o).isActive("paragraph")})},{default:C(()=>[x(w(Em))]),_:1},8,["class"])]),A("div",tk,[x(u,{type:"button",size:"sm",variant:"ghost",onClick:c[7]||(c[7]=h=>w(o).chain().focus().toggleHeading({level:1}).run()),class:Bt({"is-active":w(o).isActive("heading",{level:1})})},{default:C(()=>[x(w(Om))]),_:1},8,["class"]),x(u,{type:"button",size:"sm",variant:"ghost",onClick:c[8]||(c[8]=h=>w(o).chain().focus().toggleHeading({level:2}).run()),class:Bt({"is-active":w(o).isActive("heading",{level:2})})},{default:C(()=>[x(w(Am))]),_:1},8,["class"]),x(u,{type:"button",size:"sm",variant:"ghost",onClick:c[9]||(c[9]=h=>w(o).chain().focus().toggleHeading({level:3}).run()),class:Bt({"is-active":w(o).isActive("heading",{level:3})})},{default:C(()=>[x(w(Lm))]),_:1},8,["class"]),x(u,{type:"button",size:"sm",variant:"ghost",onClick:c[10]||(c[10]=h=>w(o).chain().focus().toggleHeading({level:4}).run()),class:Bt({"is-active":w(o).isActive("heading",{level:4})})},{default:C(()=>[x(w(Im))]),_:1},8,["class"]),x(u,{type:"button",size:"sm",variant:"ghost",onClick:c[11]||(c[11]=h=>w(o).chain().focus().toggleHeading({level:5}).run()),class:Bt({"is-active":w(o).isActive("heading",{level:5})})},{default:C(()=>[x(w(Nm))]),_:1},8,["class"]),x(u,{type:"button",size:"sm",variant:"ghost",onClick:c[12]||(c[12]=h=>w(o).chain().focus().toggleHeading({level:6}).run()),class:Bt({"is-active":w(o).isActive("heading",{level:6})})},{default:C(()=>[x(w(Dm))]),_:1},8,["class"])]),A("div",ek,[x(u,{type:"button",size:"sm",variant:"ghost",onClick:c[13]||(c[13]=h=>w(o).chain().focus().toggleBulletList().run()),class:Bt({"is-active":w(o).isActive("bulletList")})},{default:C(()=>[x(w(zm))]),_:1},8,["class"]),x(u,{type:"button",size:"sm",variant:"ghost",onClick:c[14]||(c[14]=h=>w(o).chain().focus().toggleOrderedList().run()),class:Bt({"is-active":w(o).isActive("orderedList")})},{default:C(()=>[x(w(Rm))]),_:1},8,["class"])]),A("div",nk,[x(u,{type:"button",size:"sm",variant:"ghost",onClick:c[15]||(c[15]=h=>w(o).chain().focus().toggleBlockquote().run()),class:Bt({"is-active":w(o).isActive("blockquote")})},{default:C(()=>[x(w(Bm))]),_:1},8,["class"]),x(u,{type:"button",size:"sm",variant:"ghost",onClick:c[16]||(c[16]=h=>w(o).chain().focus().setHorizontalRule().run())},{default:C(()=>[x(w(qu))]),_:1})]),A("div",ik,[x(u,{type:"button",size:"sm",variant:"ghost",onClick:c[17]||(c[17]=h=>w(o).chain().focus().undo().run()),disabled:!w(o).can().chain().focus().undo().run()},{default:C(()=>[x(w($m))]),_:1},8,["disabled"]),x(u,{type:"button",size:"sm",variant:"ghost",onClick:c[18]||(c[18]=h=>w(o).chain().focus().redo().run()),disabled:!w(o).can().chain().focus().redo().run()},{default:C(()=>[x(w(Fm))]),_:1},8,["disabled"])]),w(s)?(I(),j(w(jm),{key:0,class:"text-green-600 animate-spin",size:16})):lt("",!0)])),x(f,{class:"content_editor p-3 bg-gray-100 text-gray-600 rounded-sm focus:outline-0",editor:w(o)},null,8,["editor"])])):lt("",!0)}}}),rk={class:"mb-2"},sk={class:"flex"},ok={class:"flex gap-1 text-sm items-center"},ak={key:1,class:"text-green-700 flex gap-0.5 items-center"},lk=ct({__name:"description",props:{trailRace:{}},emits:["update"],setup(n,{emit:t}){const e=n,i=t,s=Zu(),{saveDescription:o}=Wu(),{can:a}=$u(),c=Z(""),u=Z(!1),f=Z(!1);return ce(c,async h=>{h!==e.trailRace?.description&&(u.value=!0,await o(s.params.id,c.value),i("update"),u.value=!1,f.value=!0)}),ce(()=>e.trailRace,()=>{e.trailRace&&(c.value=e.trailRace.description||"")}),ce(f,()=>{f.value&&setTimeout(()=>{f.value=!1},2e3)}),te(()=>{e.trailRace&&(c.value=e.trailRace.description||"")}),(h,m)=>{const g=rl;return I(),W("div",rk,[A("div",sk,[m[2]||(m[2]=A("h2",{class:"text-xs uppercase grow mb-2"},"Description",-1)),A("div",ok,[w(u)?(I(),j(w(Ye),{key:0,class:"loading",size:16})):lt("",!0),w(f)?(I(),W("span",ak,[x(w(_i),{size:16}),m[1]||(m[1]=N(" saved ",-1))])):lt("",!0)])]),x(g,{modelValue:w(c),"onUpdate:modelValue":m[0]||(m[0]=y=>ni(c)?c.value=y:null),disabled:w(u)||!w(a)("event_edit")},null,8,["modelValue","disabled"])])}}});var Fi={exports:{}};var ck=Fi.exports,Ru;function uk(){return Ru||(Ru=1,(function(n,t){(function(e,i){i(t)})(ck,(function(e){var i="1.9.4";function s(r){var l,d,p,_;for(d=1,p=arguments.length;d<p;d++){_=arguments[d];for(l in _)r[l]=_[l]}return r}var o=Object.create||(function(){function r(){}return function(l){return r.prototype=l,new r}})();function a(r,l){var d=Array.prototype.slice;if(r.bind)return r.bind.apply(r,d.call(arguments,1));var p=d.call(arguments,2);return function(){return r.apply(l,p.length?p.concat(d.call(arguments)):arguments)}}var c=0;function u(r){return"_leaflet_id"in r||(r._leaflet_id=++c),r._leaflet_id}function f(r,l,d){var p,_,k,T;return T=function(){p=!1,_&&(k.apply(d,_),_=!1)},k=function(){p?_=arguments:(r.apply(d,arguments),setTimeout(T,l),p=!0)},k}function h(r,l,d){var p=l[1],_=l[0],k=p-_;return r===p&&d?r:((r-_)%k+k)%k+_}function m(){return!1}function g(r,l){if(l===!1)return r;var d=Math.pow(10,l===void 0?6:l);return Math.round(r*d)/d}function y(r){return r.trim?r.trim():r.replace(/^\s+|\s+$/g,"")}function v(r){return y(r).split(/\s+/)}function b(r,l){Object.prototype.hasOwnProperty.call(r,"options")||(r.options=r.options?o(r.options):{});for(var d in l)r.options[d]=l[d];return r.options}function S(r,l,d){var p=[];for(var _ in r)p.push(encodeURIComponent(d?_.toUpperCase():_)+"="+encodeURIComponent(r[_]));return(!l||l.indexOf("?")===-1?"?":"&")+p.join("&")}var M=/\{ *([\w_ -]+) *\}/g;function P(r,l){return r.replace(M,function(d,p){var _=l[p];if(_===void 0)throw new Error("No value provided for variable "+d);return typeof _=="function"&&(_=_(l)),_})}var D=Array.isArray||function(r){return Object.prototype.toString.call(r)==="[object Array]"};function V(r,l){for(var d=0;d<r.length;d++)if(r[d]===l)return d;return-1}var $="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function U(r){return window["webkit"+r]||window["moz"+r]||window["ms"+r]}var K=0;function B(r){var l=+new Date,d=Math.max(0,16-(l-K));return K=l+d,window.setTimeout(r,d)}var ft=window.requestAnimationFrame||U("RequestAnimationFrame")||B,kt=window.cancelAnimationFrame||U("CancelAnimationFrame")||U("CancelRequestAnimationFrame")||function(r){window.clearTimeout(r)};function Nt(r,l,d){if(d&&ft===B)r.call(l);else return ft.call(window,a(r,l))}function Pt(r){r&&kt.call(window,r)}var Wn={__proto__:null,extend:s,create:o,bind:a,get lastId(){return c},stamp:u,throttle:f,wrapNum:h,falseFn:m,formatNum:g,trim:y,splitWords:v,setOptions:b,getParamString:S,template:P,isArray:D,indexOf:V,emptyImageUrl:$,requestFn:ft,cancelFn:kt,requestAnimFrame:Nt,cancelAnimFrame:Pt};function he(){}he.extend=function(r){var l=function(){b(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},d=l.__super__=this.prototype,p=o(d);p.constructor=l,l.prototype=p;for(var _ in this)Object.prototype.hasOwnProperty.call(this,_)&&_!=="prototype"&&_!=="__super__"&&(l[_]=this[_]);return r.statics&&s(l,r.statics),r.includes&&(xi(r.includes),s.apply(null,[p].concat(r.includes))),s(p,r),delete p.statics,delete p.includes,p.options&&(p.options=d.options?o(d.options):{},s(p.options,r.options)),p._initHooks=[],p.callInitHooks=function(){if(!this._initHooksCalled){d.callInitHooks&&d.callInitHooks.call(this),this._initHooksCalled=!0;for(var k=0,T=p._initHooks.length;k<T;k++)p._initHooks[k].call(this)}},l},he.include=function(r){var l=this.prototype.options;return s(this.prototype,r),r.options&&(this.prototype.options=l,this.mergeOptions(r.options)),this},he.mergeOptions=function(r){return s(this.prototype.options,r),this},he.addInitHook=function(r){var l=Array.prototype.slice.call(arguments,1),d=typeof r=="function"?r:function(){this[r].apply(this,l)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(d),this};function xi(r){if(!(typeof L>"u"||!L||!L.Mixin)){r=D(r)?r:[r];for(var l=0;l<r.length;l++)r[l]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var Ut={on:function(r,l,d){if(typeof r=="object")for(var p in r)this._on(p,r[p],l);else{r=v(r);for(var _=0,k=r.length;_<k;_++)this._on(r[_],l,d)}return this},off:function(r,l,d){if(!arguments.length)delete this._events;else if(typeof r=="object")for(var p in r)this._off(p,r[p],l);else{r=v(r);for(var _=arguments.length===1,k=0,T=r.length;k<T;k++)_?this._off(r[k]):this._off(r[k],l,d)}return this},_on:function(r,l,d,p){if(typeof l!="function"){console.warn("wrong listener type: "+typeof l);return}if(this._listens(r,l,d)===!1){d===this&&(d=void 0);var _={fn:l,ctx:d};p&&(_.once=!0),this._events=this._events||{},this._events[r]=this._events[r]||[],this._events[r].push(_)}},_off:function(r,l,d){var p,_,k;if(this._events&&(p=this._events[r],!!p)){if(arguments.length===1){if(this._firingCount)for(_=0,k=p.length;_<k;_++)p[_].fn=m;delete this._events[r];return}if(typeof l!="function"){console.warn("wrong listener type: "+typeof l);return}var T=this._listens(r,l,d);if(T!==!1){var E=p[T];this._firingCount&&(E.fn=m,this._events[r]=p=p.slice()),p.splice(T,1)}}},fire:function(r,l,d){if(!this.listens(r,d))return this;var p=s({},l,{type:r,target:this,sourceTarget:l&&l.sourceTarget||this});if(this._events){var _=this._events[r];if(_){this._firingCount=this._firingCount+1||1;for(var k=0,T=_.length;k<T;k++){var E=_[k],O=E.fn;E.once&&this.off(r,O,E.ctx),O.call(E.ctx||this,p)}this._firingCount--}}return d&&this._propagateEvent(p),this},listens:function(r,l,d,p){typeof r!="string"&&console.warn('"string" type argument expected');var _=l;typeof l!="function"&&(p=!!l,_=void 0,d=void 0);var k=this._events&&this._events[r];if(k&&k.length&&this._listens(r,_,d)!==!1)return!0;if(p){for(var T in this._eventParents)if(this._eventParents[T].listens(r,l,d,p))return!0}return!1},_listens:function(r,l,d){if(!this._events)return!1;var p=this._events[r]||[];if(!l)return!!p.length;d===this&&(d=void 0);for(var _=0,k=p.length;_<k;_++)if(p[_].fn===l&&p[_].ctx===d)return _;return!1},once:function(r,l,d){if(typeof r=="object")for(var p in r)this._on(p,r[p],l,!0);else{r=v(r);for(var _=0,k=r.length;_<k;_++)this._on(r[_],l,d,!0)}return this},addEventParent:function(r){return this._eventParents=this._eventParents||{},this._eventParents[u(r)]=r,this},removeEventParent:function(r){return this._eventParents&&delete this._eventParents[u(r)],this},_propagateEvent:function(r){for(var l in this._eventParents)this._eventParents[l].fire(r.type,s({layer:r.target,propagatedFrom:r.target},r),!0)}};Ut.addEventListener=Ut.on,Ut.removeEventListener=Ut.clearAllEventListeners=Ut.off,Ut.addOneTimeEventListener=Ut.once,Ut.fireEvent=Ut.fire,Ut.hasEventListeners=Ut.listens;var pt=he.extend(Ut);function tt(r,l,d){this.x=d?Math.round(r):r,this.y=d?Math.round(l):l}var lr=Math.trunc||function(r){return r>0?Math.floor(r):Math.ceil(r)};tt.prototype={clone:function(){return new tt(this.x,this.y)},add:function(r){return this.clone()._add(nt(r))},_add:function(r){return this.x+=r.x,this.y+=r.y,this},subtract:function(r){return this.clone()._subtract(nt(r))},_subtract:function(r){return this.x-=r.x,this.y-=r.y,this},divideBy:function(r){return this.clone()._divideBy(r)},_divideBy:function(r){return this.x/=r,this.y/=r,this},multiplyBy:function(r){return this.clone()._multiplyBy(r)},_multiplyBy:function(r){return this.x*=r,this.y*=r,this},scaleBy:function(r){return new tt(this.x*r.x,this.y*r.y)},unscaleBy:function(r){return new tt(this.x/r.x,this.y/r.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=lr(this.x),this.y=lr(this.y),this},distanceTo:function(r){r=nt(r);var l=r.x-this.x,d=r.y-this.y;return Math.sqrt(l*l+d*d)},equals:function(r){return r=nt(r),r.x===this.x&&r.y===this.y},contains:function(r){return r=nt(r),Math.abs(r.x)<=Math.abs(this.x)&&Math.abs(r.y)<=Math.abs(this.y)},toString:function(){return"Point("+g(this.x)+", "+g(this.y)+")"}};function nt(r,l,d){return r instanceof tt?r:D(r)?new tt(r[0],r[1]):r==null?r:typeof r=="object"&&"x"in r&&"y"in r?new tt(r.x,r.y):new tt(r,l,d)}function bt(r,l){if(r)for(var d=l?[r,l]:r,p=0,_=d.length;p<_;p++)this.extend(d[p])}bt.prototype={extend:function(r){var l,d;if(!r)return this;if(r instanceof tt||typeof r[0]=="number"||"x"in r)l=d=nt(r);else if(r=Yt(r),l=r.min,d=r.max,!l||!d)return this;return!this.min&&!this.max?(this.min=l.clone(),this.max=d.clone()):(this.min.x=Math.min(l.x,this.min.x),this.max.x=Math.max(d.x,this.max.x),this.min.y=Math.min(l.y,this.min.y),this.max.y=Math.max(d.y,this.max.y)),this},getCenter:function(r){return nt((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,r)},getBottomLeft:function(){return nt(this.min.x,this.max.y)},getTopRight:function(){return nt(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(r){var l,d;return typeof r[0]=="number"||r instanceof tt?r=nt(r):r=Yt(r),r instanceof bt?(l=r.min,d=r.max):l=d=r,l.x>=this.min.x&&d.x<=this.max.x&&l.y>=this.min.y&&d.y<=this.max.y},intersects:function(r){r=Yt(r);var l=this.min,d=this.max,p=r.min,_=r.max,k=_.x>=l.x&&p.x<=d.x,T=_.y>=l.y&&p.y<=d.y;return k&&T},overlaps:function(r){r=Yt(r);var l=this.min,d=this.max,p=r.min,_=r.max,k=_.x>l.x&&p.x<d.x,T=_.y>l.y&&p.y<d.y;return k&&T},isValid:function(){return!!(this.min&&this.max)},pad:function(r){var l=this.min,d=this.max,p=Math.abs(l.x-d.x)*r,_=Math.abs(l.y-d.y)*r;return Yt(nt(l.x-p,l.y-_),nt(d.x+p,d.y+_))},equals:function(r){return r?(r=Yt(r),this.min.equals(r.getTopLeft())&&this.max.equals(r.getBottomRight())):!1}};function Yt(r,l){return!r||r instanceof bt?r:new bt(r,l)}function Q(r,l){if(r)for(var d=l?[r,l]:r,p=0,_=d.length;p<_;p++)this.extend(d[p])}Q.prototype={extend:function(r){var l=this._southWest,d=this._northEast,p,_;if(r instanceof _t)p=r,_=r;else if(r instanceof Q){if(p=r._southWest,_=r._northEast,!p||!_)return this}else return r?this.extend(ut(r)||Et(r)):this;return!l&&!d?(this._southWest=new _t(p.lat,p.lng),this._northEast=new _t(_.lat,_.lng)):(l.lat=Math.min(p.lat,l.lat),l.lng=Math.min(p.lng,l.lng),d.lat=Math.max(_.lat,d.lat),d.lng=Math.max(_.lng,d.lng)),this},pad:function(r){var l=this._southWest,d=this._northEast,p=Math.abs(l.lat-d.lat)*r,_=Math.abs(l.lng-d.lng)*r;return new Q(new _t(l.lat-p,l.lng-_),new _t(d.lat+p,d.lng+_))},getCenter:function(){return new _t((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new _t(this.getNorth(),this.getWest())},getSouthEast:function(){return new _t(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(r){typeof r[0]=="number"||r instanceof _t||"lat"in r?r=ut(r):r=Et(r);var l=this._southWest,d=this._northEast,p,_;return r instanceof Q?(p=r.getSouthWest(),_=r.getNorthEast()):p=_=r,p.lat>=l.lat&&_.lat<=d.lat&&p.lng>=l.lng&&_.lng<=d.lng},intersects:function(r){r=Et(r);var l=this._southWest,d=this._northEast,p=r.getSouthWest(),_=r.getNorthEast(),k=_.lat>=l.lat&&p.lat<=d.lat,T=_.lng>=l.lng&&p.lng<=d.lng;return k&&T},overlaps:function(r){r=Et(r);var l=this._southWest,d=this._northEast,p=r.getSouthWest(),_=r.getNorthEast(),k=_.lat>l.lat&&p.lat<d.lat,T=_.lng>l.lng&&p.lng<d.lng;return k&&T},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(r,l){return r?(r=Et(r),this._southWest.equals(r.getSouthWest(),l)&&this._northEast.equals(r.getNorthEast(),l)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function Et(r,l){return r instanceof Q?r:new Q(r,l)}function _t(r,l,d){if(isNaN(r)||isNaN(l))throw new Error("Invalid LatLng object: ("+r+", "+l+")");this.lat=+r,this.lng=+l,d!==void 0&&(this.alt=+d)}_t.prototype={equals:function(r,l){if(!r)return!1;r=ut(r);var d=Math.max(Math.abs(this.lat-r.lat),Math.abs(this.lng-r.lng));return d<=(l===void 0?1e-9:l)},toString:function(r){return"LatLng("+g(this.lat,r)+", "+g(this.lng,r)+")"},distanceTo:function(r){return nn.distance(this,ut(r))},wrap:function(){return nn.wrapLatLng(this)},toBounds:function(r){var l=180*r/40075017,d=l/Math.cos(Math.PI/180*this.lat);return Et([this.lat-l,this.lng-d],[this.lat+l,this.lng+d])},clone:function(){return new _t(this.lat,this.lng,this.alt)}};function ut(r,l,d){return r instanceof _t?r:D(r)&&typeof r[0]!="object"?r.length===3?new _t(r[0],r[1],r[2]):r.length===2?new _t(r[0],r[1]):null:r==null?r:typeof r=="object"&&"lat"in r?new _t(r.lat,"lng"in r?r.lng:r.lon,r.alt):l===void 0?null:new _t(r,l,d)}var Ve={latLngToPoint:function(r,l){var d=this.projection.project(r),p=this.scale(l);return this.transformation._transform(d,p)},pointToLatLng:function(r,l){var d=this.scale(l),p=this.transformation.untransform(r,d);return this.projection.unproject(p)},project:function(r){return this.projection.project(r)},unproject:function(r){return this.projection.unproject(r)},scale:function(r){return 256*Math.pow(2,r)},zoom:function(r){return Math.log(r/256)/Math.LN2},getProjectedBounds:function(r){if(this.infinite)return null;var l=this.projection.bounds,d=this.scale(r),p=this.transformation.transform(l.min,d),_=this.transformation.transform(l.max,d);return new bt(p,_)},infinite:!1,wrapLatLng:function(r){var l=this.wrapLng?h(r.lng,this.wrapLng,!0):r.lng,d=this.wrapLat?h(r.lat,this.wrapLat,!0):r.lat,p=r.alt;return new _t(d,l,p)},wrapLatLngBounds:function(r){var l=r.getCenter(),d=this.wrapLatLng(l),p=l.lat-d.lat,_=l.lng-d.lng;if(p===0&&_===0)return r;var k=r.getSouthWest(),T=r.getNorthEast(),E=new _t(k.lat-p,k.lng-_),O=new _t(T.lat-p,T.lng-_);return new Q(E,O)}},nn=s({},Ve,{wrapLng:[-180,180],R:6371e3,distance:function(r,l){var d=Math.PI/180,p=r.lat*d,_=l.lat*d,k=Math.sin((l.lat-r.lat)*d/2),T=Math.sin((l.lng-r.lng)*d/2),E=k*k+Math.cos(p)*Math.cos(_)*T*T,O=2*Math.atan2(Math.sqrt(E),Math.sqrt(1-E));return this.R*O}}),ol=6378137,Is={R:ol,MAX_LATITUDE:85.0511287798,project:function(r){var l=Math.PI/180,d=this.MAX_LATITUDE,p=Math.max(Math.min(d,r.lat),-d),_=Math.sin(p*l);return new tt(this.R*r.lng*l,this.R*Math.log((1+_)/(1-_))/2)},unproject:function(r){var l=180/Math.PI;return new _t((2*Math.atan(Math.exp(r.y/this.R))-Math.PI/2)*l,r.x*l/this.R)},bounds:(function(){var r=ol*Math.PI;return new bt([-r,-r],[r,r])})()};function Ns(r,l,d,p){if(D(r)){this._a=r[0],this._b=r[1],this._c=r[2],this._d=r[3];return}this._a=r,this._b=l,this._c=d,this._d=p}Ns.prototype={transform:function(r,l){return this._transform(r.clone(),l)},_transform:function(r,l){return l=l||1,r.x=l*(this._a*r.x+this._b),r.y=l*(this._c*r.y+this._d),r},untransform:function(r,l){return l=l||1,new tt((r.x/l-this._b)/this._a,(r.y/l-this._d)/this._c)}};function ki(r,l,d,p){return new Ns(r,l,d,p)}var Ds=s({},nn,{code:"EPSG:3857",projection:Is,transformation:(function(){var r=.5/(Math.PI*Is.R);return ki(r,.5,-r,.5)})()}),kh=s({},Ds,{code:"EPSG:900913"});function al(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function ll(r,l){var d="",p,_,k,T,E,O;for(p=0,k=r.length;p<k;p++){for(E=r[p],_=0,T=E.length;_<T;_++)O=E[_],d+=(_?"L":"M")+O.x+" "+O.y;d+=l?G.svg?"z":"x":""}return d||"M0 0"}var zs=document.documentElement.style,cr="ActiveXObject"in window,wh=cr&&!document.addEventListener,cl="msLaunchUri"in navigator&&!("documentMode"in document),Rs=Le("webkit"),ul=Le("android"),dl=Le("android 2")||Le("android 3"),Sh=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Ch=ul&&Le("Google")&&Sh<537&&!("AudioNode"in window),Bs=!!window.opera,fl=!cl&&Le("chrome"),hl=Le("gecko")&&!Rs&&!Bs&&!cr,Mh=!fl&&Le("safari"),pl=Le("phantom"),ml="OTransition"in zs,Th=navigator.platform.indexOf("Win")===0,gl=cr&&"transition"in zs,$s="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!dl,_l="MozPerspective"in zs,Ph=!window.L_DISABLE_3D&&(gl||$s||_l)&&!ml&&!pl,wi=typeof orientation<"u"||Le("mobile"),Eh=wi&&Rs,Oh=wi&&$s,yl=!window.PointerEvent&&window.MSPointerEvent,vl=!!(window.PointerEvent||yl),bl="ontouchstart"in window||!!window.TouchEvent,Ah=!window.L_NO_TOUCH&&(bl||vl),Lh=wi&&Bs,Ih=wi&&hl,Nh=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Dh=(function(){var r=!1;try{var l=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("testPassiveEventSupport",m,l),window.removeEventListener("testPassiveEventSupport",m,l)}catch{}return r})(),zh=(function(){return!!document.createElement("canvas").getContext})(),Fs=!!(document.createElementNS&&al("svg").createSVGRect),Rh=!!Fs&&(function(){var r=document.createElement("div");return r.innerHTML="<svg/>",(r.firstChild&&r.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"})(),Bh=!Fs&&(function(){try{var r=document.createElement("div");r.innerHTML='<v:shape adj="1"/>';var l=r.firstChild;return l.style.behavior="url(#default#VML)",l&&typeof l.adj=="object"}catch{return!1}})(),$h=navigator.platform.indexOf("Mac")===0,Fh=navigator.platform.indexOf("Linux")===0;function Le(r){return navigator.userAgent.toLowerCase().indexOf(r)>=0}var G={ie:cr,ielt9:wh,edge:cl,webkit:Rs,android:ul,android23:dl,androidStock:Ch,opera:Bs,chrome:fl,gecko:hl,safari:Mh,phantom:pl,opera12:ml,win:Th,ie3d:gl,webkit3d:$s,gecko3d:_l,any3d:Ph,mobile:wi,mobileWebkit:Eh,mobileWebkit3d:Oh,msPointer:yl,pointer:vl,touch:Ah,touchNative:bl,mobileOpera:Lh,mobileGecko:Ih,retina:Nh,passiveEvents:Dh,canvas:zh,svg:Fs,vml:Bh,inlineSvg:Rh,mac:$h,linux:Fh},xl=G.msPointer?"MSPointerDown":"pointerdown",kl=G.msPointer?"MSPointerMove":"pointermove",wl=G.msPointer?"MSPointerUp":"pointerup",Sl=G.msPointer?"MSPointerCancel":"pointercancel",Vs={touchstart:xl,touchmove:kl,touchend:wl,touchcancel:Sl},Cl={touchstart:Uh,touchmove:ur,touchend:ur,touchcancel:ur},jn={},Ml=!1;function Vh(r,l,d){return l==="touchstart"&&jh(),Cl[l]?(d=Cl[l].bind(this,d),r.addEventListener(Vs[l],d,!1),d):(console.warn("wrong event specified:",l),m)}function Hh(r,l,d){if(!Vs[l]){console.warn("wrong event specified:",l);return}r.removeEventListener(Vs[l],d,!1)}function Zh(r){jn[r.pointerId]=r}function Wh(r){jn[r.pointerId]&&(jn[r.pointerId]=r)}function Tl(r){delete jn[r.pointerId]}function jh(){Ml||(document.addEventListener(xl,Zh,!0),document.addEventListener(kl,Wh,!0),document.addEventListener(wl,Tl,!0),document.addEventListener(Sl,Tl,!0),Ml=!0)}function ur(r,l){if(l.pointerType!==(l.MSPOINTER_TYPE_MOUSE||"mouse")){l.touches=[];for(var d in jn)l.touches.push(jn[d]);l.changedTouches=[l],r(l)}}function Uh(r,l){l.MSPOINTER_TYPE_TOUCH&&l.pointerType===l.MSPOINTER_TYPE_TOUCH&&qt(l),ur(r,l)}function qh(r){var l={},d,p;for(p in r)d=r[p],l[p]=d&&d.bind?d.bind(r):d;return r=l,l.type="dblclick",l.detail=2,l.isTrusted=!1,l._simulated=!0,l}var Kh=200;function Jh(r,l){r.addEventListener("dblclick",l);var d=0,p;function _(k){if(k.detail!==1){p=k.detail;return}if(!(k.pointerType==="mouse"||k.sourceCapabilities&&!k.sourceCapabilities.firesTouchEvents)){var T=Ll(k);if(!(T.some(function(O){return O instanceof HTMLLabelElement&&O.attributes.for})&&!T.some(function(O){return O instanceof HTMLInputElement||O instanceof HTMLSelectElement}))){var E=Date.now();E-d<=Kh?(p++,p===2&&l(qh(k))):p=1,d=E}}}return r.addEventListener("click",_),{dblclick:l,simDblclick:_}}function Gh(r,l){r.removeEventListener("dblclick",l.dblclick),r.removeEventListener("click",l.simDblclick)}var Hs=hr(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Si=hr(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Pl=Si==="webkitTransition"||Si==="OTransition"?Si+"End":"transitionend";function El(r){return typeof r=="string"?document.getElementById(r):r}function Ci(r,l){var d=r.style[l]||r.currentStyle&&r.currentStyle[l];if((!d||d==="auto")&&document.defaultView){var p=document.defaultView.getComputedStyle(r,null);d=p?p[l]:null}return d==="auto"?null:d}function ht(r,l,d){var p=document.createElement(r);return p.className=l||"",d&&d.appendChild(p),p}function wt(r){var l=r.parentNode;l&&l.removeChild(r)}function dr(r){for(;r.firstChild;)r.removeChild(r.firstChild)}function Un(r){var l=r.parentNode;l&&l.lastChild!==r&&l.appendChild(r)}function qn(r){var l=r.parentNode;l&&l.firstChild!==r&&l.insertBefore(r,l.firstChild)}function Zs(r,l){if(r.classList!==void 0)return r.classList.contains(l);var d=fr(r);return d.length>0&&new RegExp("(^|\\s)"+l+"(\\s|$)").test(d)}function st(r,l){if(r.classList!==void 0)for(var d=v(l),p=0,_=d.length;p<_;p++)r.classList.add(d[p]);else if(!Zs(r,l)){var k=fr(r);Ws(r,(k?k+" ":"")+l)}}function Ot(r,l){r.classList!==void 0?r.classList.remove(l):Ws(r,y((" "+fr(r)+" ").replace(" "+l+" "," ")))}function Ws(r,l){r.className.baseVal===void 0?r.className=l:r.className.baseVal=l}function fr(r){return r.correspondingElement&&(r=r.correspondingElement),r.className.baseVal===void 0?r.className:r.className.baseVal}function _e(r,l){"opacity"in r.style?r.style.opacity=l:"filter"in r.style&&Yh(r,l)}function Yh(r,l){var d=!1,p="DXImageTransform.Microsoft.Alpha";try{d=r.filters.item(p)}catch{if(l===1)return}l=Math.round(l*100),d?(d.Enabled=l!==100,d.Opacity=l):r.style.filter+=" progid:"+p+"(opacity="+l+")"}function hr(r){for(var l=document.documentElement.style,d=0;d<r.length;d++)if(r[d]in l)return r[d];return!1}function kn(r,l,d){var p=l||new tt(0,0);r.style[Hs]=(G.ie3d?"translate("+p.x+"px,"+p.y+"px)":"translate3d("+p.x+"px,"+p.y+"px,0)")+(d?" scale("+d+")":"")}function Dt(r,l){r._leaflet_pos=l,G.any3d?kn(r,l):(r.style.left=l.x+"px",r.style.top=l.y+"px")}function wn(r){return r._leaflet_pos||new tt(0,0)}var Mi,Ti,js;if("onselectstart"in document)Mi=function(){rt(window,"selectstart",qt)},Ti=function(){vt(window,"selectstart",qt)};else{var Pi=hr(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Mi=function(){if(Pi){var r=document.documentElement.style;js=r[Pi],r[Pi]="none"}},Ti=function(){Pi&&(document.documentElement.style[Pi]=js,js=void 0)}}function Us(){rt(window,"dragstart",qt)}function qs(){vt(window,"dragstart",qt)}var pr,Ks;function Js(r){for(;r.tabIndex===-1;)r=r.parentNode;r.style&&(mr(),pr=r,Ks=r.style.outlineStyle,r.style.outlineStyle="none",rt(window,"keydown",mr))}function mr(){pr&&(pr.style.outlineStyle=Ks,pr=void 0,Ks=void 0,vt(window,"keydown",mr))}function Ol(r){do r=r.parentNode;while((!r.offsetWidth||!r.offsetHeight)&&r!==document.body);return r}function Gs(r){var l=r.getBoundingClientRect();return{x:l.width/r.offsetWidth||1,y:l.height/r.offsetHeight||1,boundingClientRect:l}}var Xh={__proto__:null,TRANSFORM:Hs,TRANSITION:Si,TRANSITION_END:Pl,get:El,getStyle:Ci,create:ht,remove:wt,empty:dr,toFront:Un,toBack:qn,hasClass:Zs,addClass:st,removeClass:Ot,setClass:Ws,getClass:fr,setOpacity:_e,testProp:hr,setTransform:kn,setPosition:Dt,getPosition:wn,get disableTextSelection(){return Mi},get enableTextSelection(){return Ti},disableImageDrag:Us,enableImageDrag:qs,preventOutline:Js,restoreOutline:mr,getSizedParentNode:Ol,getScale:Gs};function rt(r,l,d,p){if(l&&typeof l=="object")for(var _ in l)Xs(r,_,l[_],d);else{l=v(l);for(var k=0,T=l.length;k<T;k++)Xs(r,l[k],d,p)}return this}var Ie="_leaflet_events";function vt(r,l,d,p){if(arguments.length===1)Al(r),delete r[Ie];else if(l&&typeof l=="object")for(var _ in l)Qs(r,_,l[_],d);else if(l=v(l),arguments.length===2)Al(r,function(E){return V(l,E)!==-1});else for(var k=0,T=l.length;k<T;k++)Qs(r,l[k],d,p);return this}function Al(r,l){for(var d in r[Ie]){var p=d.split(/\d/)[0];(!l||l(p))&&Qs(r,p,null,null,d)}}var Ys={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Xs(r,l,d,p){var _=l+u(d)+(p?"_"+u(p):"");if(r[Ie]&&r[Ie][_])return this;var k=function(E){return d.call(p||r,E||window.event)},T=k;!G.touchNative&&G.pointer&&l.indexOf("touch")===0?k=Vh(r,l,k):G.touch&&l==="dblclick"?k=Jh(r,k):"addEventListener"in r?l==="touchstart"||l==="touchmove"||l==="wheel"||l==="mousewheel"?r.addEventListener(Ys[l]||l,k,G.passiveEvents?{passive:!1}:!1):l==="mouseenter"||l==="mouseleave"?(k=function(E){E=E||window.event,eo(r,E)&&T(E)},r.addEventListener(Ys[l],k,!1)):r.addEventListener(l,T,!1):r.attachEvent("on"+l,k),r[Ie]=r[Ie]||{},r[Ie][_]=k}function Qs(r,l,d,p,_){_=_||l+u(d)+(p?"_"+u(p):"");var k=r[Ie]&&r[Ie][_];if(!k)return this;!G.touchNative&&G.pointer&&l.indexOf("touch")===0?Hh(r,l,k):G.touch&&l==="dblclick"?Gh(r,k):"removeEventListener"in r?r.removeEventListener(Ys[l]||l,k,!1):r.detachEvent("on"+l,k),r[Ie][_]=null}function Sn(r){return r.stopPropagation?r.stopPropagation():r.originalEvent?r.originalEvent._stopped=!0:r.cancelBubble=!0,this}function to(r){return Xs(r,"wheel",Sn),this}function Ei(r){return rt(r,"mousedown touchstart dblclick contextmenu",Sn),r._leaflet_disable_click=!0,this}function qt(r){return r.preventDefault?r.preventDefault():r.returnValue=!1,this}function Cn(r){return qt(r),Sn(r),this}function Ll(r){if(r.composedPath)return r.composedPath();for(var l=[],d=r.target;d;)l.push(d),d=d.parentNode;return l}function Il(r,l){if(!l)return new tt(r.clientX,r.clientY);var d=Gs(l),p=d.boundingClientRect;return new tt((r.clientX-p.left)/d.x-l.clientLeft,(r.clientY-p.top)/d.y-l.clientTop)}var Qh=G.linux&&G.chrome?window.devicePixelRatio:G.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Nl(r){return G.edge?r.wheelDeltaY/2:r.deltaY&&r.deltaMode===0?-r.deltaY/Qh:r.deltaY&&r.deltaMode===1?-r.deltaY*20:r.deltaY&&r.deltaMode===2?-r.deltaY*60:r.deltaX||r.deltaZ?0:r.wheelDelta?(r.wheelDeltaY||r.wheelDelta)/2:r.detail&&Math.abs(r.detail)<32765?-r.detail*20:r.detail?r.detail/-32765*60:0}function eo(r,l){var d=l.relatedTarget;if(!d)return!0;try{for(;d&&d!==r;)d=d.parentNode}catch{return!1}return d!==r}var tp={__proto__:null,on:rt,off:vt,stopPropagation:Sn,disableScrollPropagation:to,disableClickPropagation:Ei,preventDefault:qt,stop:Cn,getPropagationPath:Ll,getMousePosition:Il,getWheelDelta:Nl,isExternalTarget:eo,addListener:rt,removeListener:vt},Dl=pt.extend({run:function(r,l,d,p){this.stop(),this._el=r,this._inProgress=!0,this._duration=d||.25,this._easeOutPower=1/Math.max(p||.5,.2),this._startPos=wn(r),this._offset=l.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=Nt(this._animate,this),this._step()},_step:function(r){var l=+new Date-this._startTime,d=this._duration*1e3;l<d?this._runFrame(this._easeOut(l/d),r):(this._runFrame(1),this._complete())},_runFrame:function(r,l){var d=this._startPos.add(this._offset.multiplyBy(r));l&&d._round(),Dt(this._el,d),this.fire("step")},_complete:function(){Pt(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(r){return 1-Math.pow(1-r,this._easeOutPower)}}),dt=pt.extend({options:{crs:Ds,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(r,l){l=b(this,l),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(r),this._initLayout(),this._onResize=a(this._onResize,this),this._initEvents(),l.maxBounds&&this.setMaxBounds(l.maxBounds),l.zoom!==void 0&&(this._zoom=this._limitZoom(l.zoom)),l.center&&l.zoom!==void 0&&this.setView(ut(l.center),l.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Si&&G.any3d&&!G.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),rt(this._proxy,Pl,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(r,l,d){if(l=l===void 0?this._zoom:this._limitZoom(l),r=this._limitCenter(ut(r),l,this.options.maxBounds),d=d||{},this._stop(),this._loaded&&!d.reset&&d!==!0){d.animate!==void 0&&(d.zoom=s({animate:d.animate},d.zoom),d.pan=s({animate:d.animate,duration:d.duration},d.pan));var p=this._zoom!==l?this._tryAnimatedZoom&&this._tryAnimatedZoom(r,l,d.zoom):this._tryAnimatedPan(r,d.pan);if(p)return clearTimeout(this._sizeTimer),this}return this._resetView(r,l,d.pan&&d.pan.noMoveStart),this},setZoom:function(r,l){return this._loaded?this.setView(this.getCenter(),r,{zoom:l}):(this._zoom=r,this)},zoomIn:function(r,l){return r=r||(G.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+r,l)},zoomOut:function(r,l){return r=r||(G.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-r,l)},setZoomAround:function(r,l,d){var p=this.getZoomScale(l),_=this.getSize().divideBy(2),k=r instanceof tt?r:this.latLngToContainerPoint(r),T=k.subtract(_).multiplyBy(1-1/p),E=this.containerPointToLatLng(_.add(T));return this.setView(E,l,{zoom:d})},_getBoundsCenterZoom:function(r,l){l=l||{},r=r.getBounds?r.getBounds():Et(r);var d=nt(l.paddingTopLeft||l.padding||[0,0]),p=nt(l.paddingBottomRight||l.padding||[0,0]),_=this.getBoundsZoom(r,!1,d.add(p));if(_=typeof l.maxZoom=="number"?Math.min(l.maxZoom,_):_,_===1/0)return{center:r.getCenter(),zoom:_};var k=p.subtract(d).divideBy(2),T=this.project(r.getSouthWest(),_),E=this.project(r.getNorthEast(),_),O=this.unproject(T.add(E).divideBy(2).add(k),_);return{center:O,zoom:_}},fitBounds:function(r,l){if(r=Et(r),!r.isValid())throw new Error("Bounds are not valid.");var d=this._getBoundsCenterZoom(r,l);return this.setView(d.center,d.zoom,l)},fitWorld:function(r){return this.fitBounds([[-90,-180],[90,180]],r)},panTo:function(r,l){return this.setView(r,this._zoom,{pan:l})},panBy:function(r,l){if(r=nt(r).round(),l=l||{},!r.x&&!r.y)return this.fire("moveend");if(l.animate!==!0&&!this.getSize().contains(r))return this._resetView(this.unproject(this.project(this.getCenter()).add(r)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Dl,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),l.noMoveStart||this.fire("movestart"),l.animate!==!1){st(this._mapPane,"leaflet-pan-anim");var d=this._getMapPanePos().subtract(r).round();this._panAnim.run(this._mapPane,d,l.duration||.25,l.easeLinearity)}else this._rawPanBy(r),this.fire("move").fire("moveend");return this},flyTo:function(r,l,d){if(d=d||{},d.animate===!1||!G.any3d)return this.setView(r,l,d);this._stop();var p=this.project(this.getCenter()),_=this.project(r),k=this.getSize(),T=this._zoom;r=ut(r),l=l===void 0?T:l;var E=Math.max(k.x,k.y),O=E*this.getZoomScale(T,l),R=_.distanceTo(p)||1,H=1.42,et=H*H;function ot(zt){var Tr=zt?-1:1,Hp=zt?O:E,Zp=O*O-E*E+Tr*et*et*R*R,Wp=2*Hp*et*R,ho=Zp/Wp,mc=Math.sqrt(ho*ho+1)-ho,jp=mc<1e-9?-18:Math.log(mc);return jp}function ne(zt){return(Math.exp(zt)-Math.exp(-zt))/2}function Ht(zt){return(Math.exp(zt)+Math.exp(-zt))/2}function ve(zt){return ne(zt)/Ht(zt)}var ae=ot(0);function Qn(zt){return E*(Ht(ae)/Ht(ae+H*zt))}function Bp(zt){return E*(Ht(ae)*ve(ae+H*zt)-ne(ae))/et}function $p(zt){return 1-Math.pow(1-zt,1.5)}var Fp=Date.now(),hc=(ot(1)-ae)/H,Vp=d.duration?1e3*d.duration:1e3*hc*.8;function pc(){var zt=(Date.now()-Fp)/Vp,Tr=$p(zt)*hc;zt<=1?(this._flyToFrame=Nt(pc,this),this._move(this.unproject(p.add(_.subtract(p).multiplyBy(Bp(Tr)/R)),T),this.getScaleZoom(E/Qn(Tr),T),{flyTo:!0})):this._move(r,l)._moveEnd(!0)}return this._moveStart(!0,d.noMoveStart),pc.call(this),this},flyToBounds:function(r,l){var d=this._getBoundsCenterZoom(r,l);return this.flyTo(d.center,d.zoom,l)},setMaxBounds:function(r){return r=Et(r),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),r.isValid()?(this.options.maxBounds=r,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(r){var l=this.options.minZoom;return this.options.minZoom=r,this._loaded&&l!==r&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(r):this},setMaxZoom:function(r){var l=this.options.maxZoom;return this.options.maxZoom=r,this._loaded&&l!==r&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(r):this},panInsideBounds:function(r,l){this._enforcingBounds=!0;var d=this.getCenter(),p=this._limitCenter(d,this._zoom,Et(r));return d.equals(p)||this.panTo(p,l),this._enforcingBounds=!1,this},panInside:function(r,l){l=l||{};var d=nt(l.paddingTopLeft||l.padding||[0,0]),p=nt(l.paddingBottomRight||l.padding||[0,0]),_=this.project(this.getCenter()),k=this.project(r),T=this.getPixelBounds(),E=Yt([T.min.add(d),T.max.subtract(p)]),O=E.getSize();if(!E.contains(k)){this._enforcingBounds=!0;var R=k.subtract(E.getCenter()),H=E.extend(k).getSize().subtract(O);_.x+=R.x<0?-H.x:H.x,_.y+=R.y<0?-H.y:H.y,this.panTo(this.unproject(_),l),this._enforcingBounds=!1}return this},invalidateSize:function(r){if(!this._loaded)return this;r=s({animate:!1,pan:!0},r===!0?{animate:!0}:r);var l=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var d=this.getSize(),p=l.divideBy(2).round(),_=d.divideBy(2).round(),k=p.subtract(_);return!k.x&&!k.y?this:(r.animate&&r.pan?this.panBy(k):(r.pan&&this._rawPanBy(k),this.fire("move"),r.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(a(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:l,newSize:d}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(r){if(r=this._locateOptions=s({timeout:1e4,watch:!1},r),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var l=a(this._handleGeolocationResponse,this),d=a(this._handleGeolocationError,this);return r.watch?this._locationWatchId=navigator.geolocation.watchPosition(l,d,r):navigator.geolocation.getCurrentPosition(l,d,r),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(r){if(this._container._leaflet_id){var l=r.code,d=r.message||(l===1?"permission denied":l===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:l,message:"Geolocation error: "+d+"."})}},_handleGeolocationResponse:function(r){if(this._container._leaflet_id){var l=r.coords.latitude,d=r.coords.longitude,p=new _t(l,d),_=p.toBounds(r.coords.accuracy*2),k=this._locateOptions;if(k.setView){var T=this.getBoundsZoom(_);this.setView(p,k.maxZoom?Math.min(T,k.maxZoom):T)}var E={latlng:p,bounds:_,timestamp:r.timestamp};for(var O in r.coords)typeof r.coords[O]=="number"&&(E[O]=r.coords[O]);this.fire("locationfound",E)}},addHandler:function(r,l){if(!l)return this;var d=this[r]=new l(this);return this._handlers.push(d),this.options[r]&&d.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),wt(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(Pt(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var r;for(r in this._layers)this._layers[r].remove();for(r in this._panes)wt(this._panes[r]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(r,l){var d="leaflet-pane"+(r?" leaflet-"+r.replace("Pane","")+"-pane":""),p=ht("div",d,l||this._mapPane);return r&&(this._panes[r]=p),p},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var r=this.getPixelBounds(),l=this.unproject(r.getBottomLeft()),d=this.unproject(r.getTopRight());return new Q(l,d)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(r,l,d){r=Et(r),d=nt(d||[0,0]);var p=this.getZoom()||0,_=this.getMinZoom(),k=this.getMaxZoom(),T=r.getNorthWest(),E=r.getSouthEast(),O=this.getSize().subtract(d),R=Yt(this.project(E,p),this.project(T,p)).getSize(),H=G.any3d?this.options.zoomSnap:1,et=O.x/R.x,ot=O.y/R.y,ne=l?Math.max(et,ot):Math.min(et,ot);return p=this.getScaleZoom(ne,p),H&&(p=Math.round(p/(H/100))*(H/100),p=l?Math.ceil(p/H)*H:Math.floor(p/H)*H),Math.max(_,Math.min(k,p))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new tt(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(r,l){var d=this._getTopLeftPoint(r,l);return new bt(d,d.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(r){return this.options.crs.getProjectedBounds(r===void 0?this.getZoom():r)},getPane:function(r){return typeof r=="string"?this._panes[r]:r},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(r,l){var d=this.options.crs;return l=l===void 0?this._zoom:l,d.scale(r)/d.scale(l)},getScaleZoom:function(r,l){var d=this.options.crs;l=l===void 0?this._zoom:l;var p=d.zoom(r*d.scale(l));return isNaN(p)?1/0:p},project:function(r,l){return l=l===void 0?this._zoom:l,this.options.crs.latLngToPoint(ut(r),l)},unproject:function(r,l){return l=l===void 0?this._zoom:l,this.options.crs.pointToLatLng(nt(r),l)},layerPointToLatLng:function(r){var l=nt(r).add(this.getPixelOrigin());return this.unproject(l)},latLngToLayerPoint:function(r){var l=this.project(ut(r))._round();return l._subtract(this.getPixelOrigin())},wrapLatLng:function(r){return this.options.crs.wrapLatLng(ut(r))},wrapLatLngBounds:function(r){return this.options.crs.wrapLatLngBounds(Et(r))},distance:function(r,l){return this.options.crs.distance(ut(r),ut(l))},containerPointToLayerPoint:function(r){return nt(r).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(r){return nt(r).add(this._getMapPanePos())},containerPointToLatLng:function(r){var l=this.containerPointToLayerPoint(nt(r));return this.layerPointToLatLng(l)},latLngToContainerPoint:function(r){return this.layerPointToContainerPoint(this.latLngToLayerPoint(ut(r)))},mouseEventToContainerPoint:function(r){return Il(r,this._container)},mouseEventToLayerPoint:function(r){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(r))},mouseEventToLatLng:function(r){return this.layerPointToLatLng(this.mouseEventToLayerPoint(r))},_initContainer:function(r){var l=this._container=El(r);if(l){if(l._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");rt(l,"scroll",this._onScroll,this),this._containerId=u(l)},_initLayout:function(){var r=this._container;this._fadeAnimated=this.options.fadeAnimation&&G.any3d,st(r,"leaflet-container"+(G.touch?" leaflet-touch":"")+(G.retina?" leaflet-retina":"")+(G.ielt9?" leaflet-oldie":"")+(G.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var l=Ci(r,"position");l!=="absolute"&&l!=="relative"&&l!=="fixed"&&l!=="sticky"&&(r.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var r=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Dt(this._mapPane,new tt(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(st(r.markerPane,"leaflet-zoom-hide"),st(r.shadowPane,"leaflet-zoom-hide"))},_resetView:function(r,l,d){Dt(this._mapPane,new tt(0,0));var p=!this._loaded;this._loaded=!0,l=this._limitZoom(l),this.fire("viewprereset");var _=this._zoom!==l;this._moveStart(_,d)._move(r,l)._moveEnd(_),this.fire("viewreset"),p&&this.fire("load")},_moveStart:function(r,l){return r&&this.fire("zoomstart"),l||this.fire("movestart"),this},_move:function(r,l,d,p){l===void 0&&(l=this._zoom);var _=this._zoom!==l;return this._zoom=l,this._lastCenter=r,this._pixelOrigin=this._getNewPixelOrigin(r),p?d&&d.pinch&&this.fire("zoom",d):((_||d&&d.pinch)&&this.fire("zoom",d),this.fire("move",d)),this},_moveEnd:function(r){return r&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return Pt(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(r){Dt(this._mapPane,this._getMapPanePos().subtract(r))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(r){this._targets={},this._targets[u(this._container)]=this;var l=r?vt:rt;l(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&l(window,"resize",this._onResize,this),G.any3d&&this.options.transform3DLimit&&(r?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){Pt(this._resizeRequest),this._resizeRequest=Nt(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var r=this._getMapPanePos();Math.max(Math.abs(r.x),Math.abs(r.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(r,l){for(var d=[],p,_=l==="mouseout"||l==="mouseover",k=r.target||r.srcElement,T=!1;k;){if(p=this._targets[u(k)],p&&(l==="click"||l==="preclick")&&this._draggableMoved(p)){T=!0;break}if(p&&p.listens(l,!0)&&(_&&!eo(k,r)||(d.push(p),_))||k===this._container)break;k=k.parentNode}return!d.length&&!T&&!_&&this.listens(l,!0)&&(d=[this]),d},_isClickDisabled:function(r){for(;r&&r!==this._container;){if(r._leaflet_disable_click)return!0;r=r.parentNode}},_handleDOMEvent:function(r){var l=r.target||r.srcElement;if(!(!this._loaded||l._leaflet_disable_events||r.type==="click"&&this._isClickDisabled(l))){var d=r.type;d==="mousedown"&&Js(l),this._fireDOMEvent(r,d)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(r,l,d){if(r.type==="click"){var p=s({},r);p.type="preclick",this._fireDOMEvent(p,p.type,d)}var _=this._findEventTargets(r,l);if(d){for(var k=[],T=0;T<d.length;T++)d[T].listens(l,!0)&&k.push(d[T]);_=k.concat(_)}if(_.length){l==="contextmenu"&&qt(r);var E=_[0],O={originalEvent:r};if(r.type!=="keypress"&&r.type!=="keydown"&&r.type!=="keyup"){var R=E.getLatLng&&(!E._radius||E._radius<=10);O.containerPoint=R?this.latLngToContainerPoint(E.getLatLng()):this.mouseEventToContainerPoint(r),O.layerPoint=this.containerPointToLayerPoint(O.containerPoint),O.latlng=R?E.getLatLng():this.layerPointToLatLng(O.layerPoint)}for(T=0;T<_.length;T++)if(_[T].fire(l,O,!0),O.originalEvent._stopped||_[T].options.bubblingMouseEvents===!1&&V(this._mouseEvents,l)!==-1)return}},_draggableMoved:function(r){return r=r.dragging&&r.dragging.enabled()?r:this,r.dragging&&r.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var r=0,l=this._handlers.length;r<l;r++)this._handlers[r].disable()},whenReady:function(r,l){return this._loaded?r.call(l||this,{target:this}):this.on("load",r,l),this},_getMapPanePos:function(){return wn(this._mapPane)||new tt(0,0)},_moved:function(){var r=this._getMapPanePos();return r&&!r.equals([0,0])},_getTopLeftPoint:function(r,l){var d=r&&l!==void 0?this._getNewPixelOrigin(r,l):this.getPixelOrigin();return d.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(r,l){var d=this.getSize()._divideBy(2);return this.project(r,l)._subtract(d)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(r,l,d){var p=this._getNewPixelOrigin(d,l);return this.project(r,l)._subtract(p)},_latLngBoundsToNewLayerBounds:function(r,l,d){var p=this._getNewPixelOrigin(d,l);return Yt([this.project(r.getSouthWest(),l)._subtract(p),this.project(r.getNorthWest(),l)._subtract(p),this.project(r.getSouthEast(),l)._subtract(p),this.project(r.getNorthEast(),l)._subtract(p)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(r){return this.latLngToLayerPoint(r).subtract(this._getCenterLayerPoint())},_limitCenter:function(r,l,d){if(!d)return r;var p=this.project(r,l),_=this.getSize().divideBy(2),k=new bt(p.subtract(_),p.add(_)),T=this._getBoundsOffset(k,d,l);return Math.abs(T.x)<=1&&Math.abs(T.y)<=1?r:this.unproject(p.add(T),l)},_limitOffset:function(r,l){if(!l)return r;var d=this.getPixelBounds(),p=new bt(d.min.add(r),d.max.add(r));return r.add(this._getBoundsOffset(p,l))},_getBoundsOffset:function(r,l,d){var p=Yt(this.project(l.getNorthEast(),d),this.project(l.getSouthWest(),d)),_=p.min.subtract(r.min),k=p.max.subtract(r.max),T=this._rebound(_.x,-k.x),E=this._rebound(_.y,-k.y);return new tt(T,E)},_rebound:function(r,l){return r+l>0?Math.round(r-l)/2:Math.max(0,Math.ceil(r))-Math.max(0,Math.floor(l))},_limitZoom:function(r){var l=this.getMinZoom(),d=this.getMaxZoom(),p=G.any3d?this.options.zoomSnap:1;return p&&(r=Math.round(r/p)*p),Math.max(l,Math.min(d,r))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Ot(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(r,l){var d=this._getCenterOffset(r)._trunc();return(l&&l.animate)!==!0&&!this.getSize().contains(d)?!1:(this.panBy(d,l),!0)},_createAnimProxy:function(){var r=this._proxy=ht("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(r),this.on("zoomanim",function(l){var d=Hs,p=this._proxy.style[d];kn(this._proxy,this.project(l.center,l.zoom),this.getZoomScale(l.zoom,1)),p===this._proxy.style[d]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){wt(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var r=this.getCenter(),l=this.getZoom();kn(this._proxy,this.project(r,l),this.getZoomScale(l,1))},_catchTransitionEnd:function(r){this._animatingZoom&&r.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(r,l,d){if(this._animatingZoom)return!0;if(d=d||{},!this._zoomAnimated||d.animate===!1||this._nothingToAnimate()||Math.abs(l-this._zoom)>this.options.zoomAnimationThreshold)return!1;var p=this.getZoomScale(l),_=this._getCenterOffset(r)._divideBy(1-1/p);return d.animate!==!0&&!this.getSize().contains(_)?!1:(Nt(function(){this._moveStart(!0,d.noMoveStart||!1)._animateZoom(r,l,!0)},this),!0)},_animateZoom:function(r,l,d,p){this._mapPane&&(d&&(this._animatingZoom=!0,this._animateToCenter=r,this._animateToZoom=l,st(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:r,zoom:l,noUpdate:p}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(a(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Ot(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function ep(r,l){return new dt(r,l)}var Se=he.extend({options:{position:"topright"},initialize:function(r){b(this,r)},getPosition:function(){return this.options.position},setPosition:function(r){var l=this._map;return l&&l.removeControl(this),this.options.position=r,l&&l.addControl(this),this},getContainer:function(){return this._container},addTo:function(r){this.remove(),this._map=r;var l=this._container=this.onAdd(r),d=this.getPosition(),p=r._controlCorners[d];return st(l,"leaflet-control"),d.indexOf("bottom")!==-1?p.insertBefore(l,p.firstChild):p.appendChild(l),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(wt(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(r){this._map&&r&&r.screenX>0&&r.screenY>0&&this._map.getContainer().focus()}}),Oi=function(r){return new Se(r)};dt.include({addControl:function(r){return r.addTo(this),this},removeControl:function(r){return r.remove(),this},_initControlPos:function(){var r=this._controlCorners={},l="leaflet-",d=this._controlContainer=ht("div",l+"control-container",this._container);function p(_,k){var T=l+_+" "+l+k;r[_+k]=ht("div",T,d)}p("top","left"),p("top","right"),p("bottom","left"),p("bottom","right")},_clearControlPos:function(){for(var r in this._controlCorners)wt(this._controlCorners[r]);wt(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var zl=Se.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(r,l,d,p){return d<p?-1:p<d?1:0}},initialize:function(r,l,d){b(this,d),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var p in r)this._addLayer(r[p],p);for(p in l)this._addLayer(l[p],p,!0)},onAdd:function(r){this._initLayout(),this._update(),this._map=r,r.on("zoomend",this._checkDisabledLayers,this);for(var l=0;l<this._layers.length;l++)this._layers[l].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(r){return Se.prototype.addTo.call(this,r),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var r=0;r<this._layers.length;r++)this._layers[r].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(r,l){return this._addLayer(r,l),this._map?this._update():this},addOverlay:function(r,l){return this._addLayer(r,l,!0),this._map?this._update():this},removeLayer:function(r){r.off("add remove",this._onLayerChange,this);var l=this._getLayer(u(r));return l&&this._layers.splice(this._layers.indexOf(l),1),this._map?this._update():this},expand:function(){st(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var r=this._map.getSize().y-(this._container.offsetTop+50);return r<this._section.clientHeight?(st(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=r+"px"):Ot(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Ot(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var r="leaflet-control-layers",l=this._container=ht("div",r),d=this.options.collapsed;l.setAttribute("aria-haspopup",!0),Ei(l),to(l);var p=this._section=ht("section",r+"-list");d&&(this._map.on("click",this.collapse,this),rt(l,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var _=this._layersLink=ht("a",r+"-toggle",l);_.href="#",_.title="Layers",_.setAttribute("role","button"),rt(_,{keydown:function(k){k.keyCode===13&&this._expandSafely()},click:function(k){qt(k),this._expandSafely()}},this),d||this.expand(),this._baseLayersList=ht("div",r+"-base",p),this._separator=ht("div",r+"-separator",p),this._overlaysList=ht("div",r+"-overlays",p),l.appendChild(p)},_getLayer:function(r){for(var l=0;l<this._layers.length;l++)if(this._layers[l]&&u(this._layers[l].layer)===r)return this._layers[l]},_addLayer:function(r,l,d){this._map&&r.on("add remove",this._onLayerChange,this),this._layers.push({layer:r,name:l,overlay:d}),this.options.sortLayers&&this._layers.sort(a(function(p,_){return this.options.sortFunction(p.layer,_.layer,p.name,_.name)},this)),this.options.autoZIndex&&r.setZIndex&&(this._lastZIndex++,r.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;dr(this._baseLayersList),dr(this._overlaysList),this._layerControlInputs=[];var r,l,d,p,_=0;for(d=0;d<this._layers.length;d++)p=this._layers[d],this._addItem(p),l=l||p.overlay,r=r||!p.overlay,_+=p.overlay?0:1;return this.options.hideSingleBase&&(r=r&&_>1,this._baseLayersList.style.display=r?"":"none"),this._separator.style.display=l&&r?"":"none",this},_onLayerChange:function(r){this._handlingClick||this._update();var l=this._getLayer(u(r.target)),d=l.overlay?r.type==="add"?"overlayadd":"overlayremove":r.type==="add"?"baselayerchange":null;d&&this._map.fire(d,l)},_createRadioElement:function(r,l){var d='<input type="radio" class="leaflet-control-layers-selector" name="'+r+'"'+(l?' checked="checked"':"")+"/>",p=document.createElement("div");return p.innerHTML=d,p.firstChild},_addItem:function(r){var l=document.createElement("label"),d=this._map.hasLayer(r.layer),p;r.overlay?(p=document.createElement("input"),p.type="checkbox",p.className="leaflet-control-layers-selector",p.defaultChecked=d):p=this._createRadioElement("leaflet-base-layers_"+u(this),d),this._layerControlInputs.push(p),p.layerId=u(r.layer),rt(p,"click",this._onInputClick,this);var _=document.createElement("span");_.innerHTML=" "+r.name;var k=document.createElement("span");l.appendChild(k),k.appendChild(p),k.appendChild(_);var T=r.overlay?this._overlaysList:this._baseLayersList;return T.appendChild(l),this._checkDisabledLayers(),l},_onInputClick:function(){if(!this._preventClick){var r=this._layerControlInputs,l,d,p=[],_=[];this._handlingClick=!0;for(var k=r.length-1;k>=0;k--)l=r[k],d=this._getLayer(l.layerId).layer,l.checked?p.push(d):l.checked||_.push(d);for(k=0;k<_.length;k++)this._map.hasLayer(_[k])&&this._map.removeLayer(_[k]);for(k=0;k<p.length;k++)this._map.hasLayer(p[k])||this._map.addLayer(p[k]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var r=this._layerControlInputs,l,d,p=this._map.getZoom(),_=r.length-1;_>=0;_--)l=r[_],d=this._getLayer(l.layerId).layer,l.disabled=d.options.minZoom!==void 0&&p<d.options.minZoom||d.options.maxZoom!==void 0&&p>d.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var r=this._section;this._preventClick=!0,rt(r,"click",qt),this.expand();var l=this;setTimeout(function(){vt(r,"click",qt),l._preventClick=!1})}}),np=function(r,l,d){return new zl(r,l,d)},no=Se.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(r){var l="leaflet-control-zoom",d=ht("div",l+" leaflet-bar"),p=this.options;return this._zoomInButton=this._createButton(p.zoomInText,p.zoomInTitle,l+"-in",d,this._zoomIn),this._zoomOutButton=this._createButton(p.zoomOutText,p.zoomOutTitle,l+"-out",d,this._zoomOut),this._updateDisabled(),r.on("zoomend zoomlevelschange",this._updateDisabled,this),d},onRemove:function(r){r.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(r){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(r.shiftKey?3:1))},_zoomOut:function(r){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(r.shiftKey?3:1))},_createButton:function(r,l,d,p,_){var k=ht("a",d,p);return k.innerHTML=r,k.href="#",k.title=l,k.setAttribute("role","button"),k.setAttribute("aria-label",l),Ei(k),rt(k,"click",Cn),rt(k,"click",_,this),rt(k,"click",this._refocusOnMap,this),k},_updateDisabled:function(){var r=this._map,l="leaflet-disabled";Ot(this._zoomInButton,l),Ot(this._zoomOutButton,l),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||r._zoom===r.getMinZoom())&&(st(this._zoomOutButton,l),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||r._zoom===r.getMaxZoom())&&(st(this._zoomInButton,l),this._zoomInButton.setAttribute("aria-disabled","true"))}});dt.mergeOptions({zoomControl:!0}),dt.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new no,this.addControl(this.zoomControl))});var ip=function(r){return new no(r)},Rl=Se.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(r){var l="leaflet-control-scale",d=ht("div",l),p=this.options;return this._addScales(p,l+"-line",d),r.on(p.updateWhenIdle?"moveend":"move",this._update,this),r.whenReady(this._update,this),d},onRemove:function(r){r.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(r,l,d){r.metric&&(this._mScale=ht("div",l,d)),r.imperial&&(this._iScale=ht("div",l,d))},_update:function(){var r=this._map,l=r.getSize().y/2,d=r.distance(r.containerPointToLatLng([0,l]),r.containerPointToLatLng([this.options.maxWidth,l]));this._updateScales(d)},_updateScales:function(r){this.options.metric&&r&&this._updateMetric(r),this.options.imperial&&r&&this._updateImperial(r)},_updateMetric:function(r){var l=this._getRoundNum(r),d=l<1e3?l+" m":l/1e3+" km";this._updateScale(this._mScale,d,l/r)},_updateImperial:function(r){var l=r*3.2808399,d,p,_;l>5280?(d=l/5280,p=this._getRoundNum(d),this._updateScale(this._iScale,p+" mi",p/d)):(_=this._getRoundNum(l),this._updateScale(this._iScale,_+" ft",_/l))},_updateScale:function(r,l,d){r.style.width=Math.round(this.options.maxWidth*d)+"px",r.innerHTML=l},_getRoundNum:function(r){var l=Math.pow(10,(Math.floor(r)+"").length-1),d=r/l;return d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:1,l*d}}),rp=function(r){return new Rl(r)},sp='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',io=Se.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(G.inlineSvg?sp+" ":"")+"Leaflet</a>"},initialize:function(r){b(this,r),this._attributions={}},onAdd:function(r){r.attributionControl=this,this._container=ht("div","leaflet-control-attribution"),Ei(this._container);for(var l in r._layers)r._layers[l].getAttribution&&this.addAttribution(r._layers[l].getAttribution());return this._update(),r.on("layeradd",this._addAttribution,this),this._container},onRemove:function(r){r.off("layeradd",this._addAttribution,this)},_addAttribution:function(r){r.layer.getAttribution&&(this.addAttribution(r.layer.getAttribution()),r.layer.once("remove",function(){this.removeAttribution(r.layer.getAttribution())},this))},setPrefix:function(r){return this.options.prefix=r,this._update(),this},addAttribution:function(r){return r?(this._attributions[r]||(this._attributions[r]=0),this._attributions[r]++,this._update(),this):this},removeAttribution:function(r){return r?(this._attributions[r]&&(this._attributions[r]--,this._update()),this):this},_update:function(){if(this._map){var r=[];for(var l in this._attributions)this._attributions[l]&&r.push(l);var d=[];this.options.prefix&&d.push(this.options.prefix),r.length&&d.push(r.join(", ")),this._container.innerHTML=d.join(' <span aria-hidden="true">|</span> ')}}});dt.mergeOptions({attributionControl:!0}),dt.addInitHook(function(){this.options.attributionControl&&new io().addTo(this)});var op=function(r){return new io(r)};Se.Layers=zl,Se.Zoom=no,Se.Scale=Rl,Se.Attribution=io,Oi.layers=np,Oi.zoom=ip,Oi.scale=rp,Oi.attribution=op;var Ne=he.extend({initialize:function(r){this._map=r},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Ne.addTo=function(r,l){return r.addHandler(l,this),this};var ap={Events:Ut},Bl=G.touch?"touchstart mousedown":"mousedown",rn=pt.extend({options:{clickTolerance:3},initialize:function(r,l,d,p){b(this,p),this._element=r,this._dragStartTarget=l||r,this._preventOutline=d},enable:function(){this._enabled||(rt(this._dragStartTarget,Bl,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(rn._dragging===this&&this.finishDrag(!0),vt(this._dragStartTarget,Bl,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(r){if(this._enabled&&(this._moved=!1,!Zs(this._element,"leaflet-zoom-anim"))){if(r.touches&&r.touches.length!==1){rn._dragging===this&&this.finishDrag();return}if(!(rn._dragging||r.shiftKey||r.which!==1&&r.button!==1&&!r.touches)&&(rn._dragging=this,this._preventOutline&&Js(this._element),Us(),Mi(),!this._moving)){this.fire("down");var l=r.touches?r.touches[0]:r,d=Ol(this._element);this._startPoint=new tt(l.clientX,l.clientY),this._startPos=wn(this._element),this._parentScale=Gs(d);var p=r.type==="mousedown";rt(document,p?"mousemove":"touchmove",this._onMove,this),rt(document,p?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(r){if(this._enabled){if(r.touches&&r.touches.length>1){this._moved=!0;return}var l=r.touches&&r.touches.length===1?r.touches[0]:r,d=new tt(l.clientX,l.clientY)._subtract(this._startPoint);!d.x&&!d.y||Math.abs(d.x)+Math.abs(d.y)<this.options.clickTolerance||(d.x/=this._parentScale.x,d.y/=this._parentScale.y,qt(r),this._moved||(this.fire("dragstart"),this._moved=!0,st(document.body,"leaflet-dragging"),this._lastTarget=r.target||r.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),st(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(d),this._moving=!0,this._lastEvent=r,this._updatePosition())}},_updatePosition:function(){var r={originalEvent:this._lastEvent};this.fire("predrag",r),Dt(this._element,this._newPos),this.fire("drag",r)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(r){Ot(document.body,"leaflet-dragging"),this._lastTarget&&(Ot(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),vt(document,"mousemove touchmove",this._onMove,this),vt(document,"mouseup touchend touchcancel",this._onUp,this),qs(),Ti();var l=this._moved&&this._moving;this._moving=!1,rn._dragging=!1,l&&this.fire("dragend",{noInertia:r,distance:this._newPos.distanceTo(this._startPos)})}});function $l(r,l,d){var p,_=[1,4,2,8],k,T,E,O,R,H,et,ot;for(k=0,H=r.length;k<H;k++)r[k]._code=Mn(r[k],l);for(E=0;E<4;E++){for(et=_[E],p=[],k=0,H=r.length,T=H-1;k<H;T=k++)O=r[k],R=r[T],O._code&et?R._code&et||(ot=gr(R,O,et,l,d),ot._code=Mn(ot,l),p.push(ot)):(R._code&et&&(ot=gr(R,O,et,l,d),ot._code=Mn(ot,l),p.push(ot)),p.push(O));r=p}return r}function Fl(r,l){var d,p,_,k,T,E,O,R,H;if(!r||r.length===0)throw new Error("latlngs not passed");ye(r)||(console.warn("latlngs are not flat! Only the first ring will be used"),r=r[0]);var et=ut([0,0]),ot=Et(r),ne=ot.getNorthWest().distanceTo(ot.getSouthWest())*ot.getNorthEast().distanceTo(ot.getNorthWest());ne<1700&&(et=ro(r));var Ht=r.length,ve=[];for(d=0;d<Ht;d++){var ae=ut(r[d]);ve.push(l.project(ut([ae.lat-et.lat,ae.lng-et.lng])))}for(E=O=R=0,d=0,p=Ht-1;d<Ht;p=d++)_=ve[d],k=ve[p],T=_.y*k.x-k.y*_.x,O+=(_.x+k.x)*T,R+=(_.y+k.y)*T,E+=T*3;E===0?H=ve[0]:H=[O/E,R/E];var Qn=l.unproject(nt(H));return ut([Qn.lat+et.lat,Qn.lng+et.lng])}function ro(r){for(var l=0,d=0,p=0,_=0;_<r.length;_++){var k=ut(r[_]);l+=k.lat,d+=k.lng,p++}return ut([l/p,d/p])}var lp={__proto__:null,clipPolygon:$l,polygonCenter:Fl,centroid:ro};function Vl(r,l){if(!l||!r.length)return r.slice();var d=l*l;return r=dp(r,d),r=up(r,d),r}function Hl(r,l,d){return Math.sqrt(Ai(r,l,d,!0))}function cp(r,l,d){return Ai(r,l,d)}function up(r,l){var d=r.length,p=typeof Uint8Array<"u"?Uint8Array:Array,_=new p(d);_[0]=_[d-1]=1,so(r,_,l,0,d-1);var k,T=[];for(k=0;k<d;k++)_[k]&&T.push(r[k]);return T}function so(r,l,d,p,_){var k=0,T,E,O;for(E=p+1;E<=_-1;E++)O=Ai(r[E],r[p],r[_],!0),O>k&&(T=E,k=O);k>d&&(l[T]=1,so(r,l,d,p,T),so(r,l,d,T,_))}function dp(r,l){for(var d=[r[0]],p=1,_=0,k=r.length;p<k;p++)fp(r[p],r[_])>l&&(d.push(r[p]),_=p);return _<k-1&&d.push(r[k-1]),d}var Zl;function Wl(r,l,d,p,_){var k=p?Zl:Mn(r,d),T=Mn(l,d),E,O,R;for(Zl=T;;){if(!(k|T))return[r,l];if(k&T)return!1;E=k||T,O=gr(r,l,E,d,_),R=Mn(O,d),E===k?(r=O,k=R):(l=O,T=R)}}function gr(r,l,d,p,_){var k=l.x-r.x,T=l.y-r.y,E=p.min,O=p.max,R,H;return d&8?(R=r.x+k*(O.y-r.y)/T,H=O.y):d&4?(R=r.x+k*(E.y-r.y)/T,H=E.y):d&2?(R=O.x,H=r.y+T*(O.x-r.x)/k):d&1&&(R=E.x,H=r.y+T*(E.x-r.x)/k),new tt(R,H,_)}function Mn(r,l){var d=0;return r.x<l.min.x?d|=1:r.x>l.max.x&&(d|=2),r.y<l.min.y?d|=4:r.y>l.max.y&&(d|=8),d}function fp(r,l){var d=l.x-r.x,p=l.y-r.y;return d*d+p*p}function Ai(r,l,d,p){var _=l.x,k=l.y,T=d.x-_,E=d.y-k,O=T*T+E*E,R;return O>0&&(R=((r.x-_)*T+(r.y-k)*E)/O,R>1?(_=d.x,k=d.y):R>0&&(_+=T*R,k+=E*R)),T=r.x-_,E=r.y-k,p?T*T+E*E:new tt(_,k)}function ye(r){return!D(r[0])||typeof r[0][0]!="object"&&typeof r[0][0]<"u"}function jl(r){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),ye(r)}function Ul(r,l){var d,p,_,k,T,E,O,R;if(!r||r.length===0)throw new Error("latlngs not passed");ye(r)||(console.warn("latlngs are not flat! Only the first ring will be used"),r=r[0]);var H=ut([0,0]),et=Et(r),ot=et.getNorthWest().distanceTo(et.getSouthWest())*et.getNorthEast().distanceTo(et.getNorthWest());ot<1700&&(H=ro(r));var ne=r.length,Ht=[];for(d=0;d<ne;d++){var ve=ut(r[d]);Ht.push(l.project(ut([ve.lat-H.lat,ve.lng-H.lng])))}for(d=0,p=0;d<ne-1;d++)p+=Ht[d].distanceTo(Ht[d+1])/2;if(p===0)R=Ht[0];else for(d=0,k=0;d<ne-1;d++)if(T=Ht[d],E=Ht[d+1],_=T.distanceTo(E),k+=_,k>p){O=(k-p)/_,R=[E.x-O*(E.x-T.x),E.y-O*(E.y-T.y)];break}var ae=l.unproject(nt(R));return ut([ae.lat+H.lat,ae.lng+H.lng])}var hp={__proto__:null,simplify:Vl,pointToSegmentDistance:Hl,closestPointOnSegment:cp,clipSegment:Wl,_getEdgeIntersection:gr,_getBitCode:Mn,_sqClosestPointOnSegment:Ai,isFlat:ye,_flat:jl,polylineCenter:Ul},oo={project:function(r){return new tt(r.lng,r.lat)},unproject:function(r){return new _t(r.y,r.x)},bounds:new bt([-180,-90],[180,90])},ao={R:6378137,R_MINOR:6356752314245179e-9,bounds:new bt([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(r){var l=Math.PI/180,d=this.R,p=r.lat*l,_=this.R_MINOR/d,k=Math.sqrt(1-_*_),T=k*Math.sin(p),E=Math.tan(Math.PI/4-p/2)/Math.pow((1-T)/(1+T),k/2);return p=-d*Math.log(Math.max(E,1e-10)),new tt(r.lng*l*d,p)},unproject:function(r){for(var l=180/Math.PI,d=this.R,p=this.R_MINOR/d,_=Math.sqrt(1-p*p),k=Math.exp(-r.y/d),T=Math.PI/2-2*Math.atan(k),E=0,O=.1,R;E<15&&Math.abs(O)>1e-7;E++)R=_*Math.sin(T),R=Math.pow((1-R)/(1+R),_/2),O=Math.PI/2-2*Math.atan(k*R)-T,T+=O;return new _t(T*l,r.x*l/d)}},pp={__proto__:null,LonLat:oo,Mercator:ao,SphericalMercator:Is},mp=s({},nn,{code:"EPSG:3395",projection:ao,transformation:(function(){var r=.5/(Math.PI*ao.R);return ki(r,.5,-r,.5)})()}),ql=s({},nn,{code:"EPSG:4326",projection:oo,transformation:ki(1/180,1,-1/180,.5)}),gp=s({},Ve,{projection:oo,transformation:ki(1,0,-1,0),scale:function(r){return Math.pow(2,r)},zoom:function(r){return Math.log(r)/Math.LN2},distance:function(r,l){var d=l.lng-r.lng,p=l.lat-r.lat;return Math.sqrt(d*d+p*p)},infinite:!0});Ve.Earth=nn,Ve.EPSG3395=mp,Ve.EPSG3857=Ds,Ve.EPSG900913=kh,Ve.EPSG4326=ql,Ve.Simple=gp;var Ce=pt.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(r){return r.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(r){return r&&r.removeLayer(this),this},getPane:function(r){return this._map.getPane(r?this.options[r]||r:this.options.pane)},addInteractiveTarget:function(r){return this._map._targets[u(r)]=this,this},removeInteractiveTarget:function(r){return delete this._map._targets[u(r)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(r){var l=r.target;if(l.hasLayer(this)){if(this._map=l,this._zoomAnimated=l._zoomAnimated,this.getEvents){var d=this.getEvents();l.on(d,this),this.once("remove",function(){l.off(d,this)},this)}this.onAdd(l),this.fire("add"),l.fire("layeradd",{layer:this})}}});dt.include({addLayer:function(r){if(!r._layerAdd)throw new Error("The provided object is not a Layer.");var l=u(r);return this._layers[l]?this:(this._layers[l]=r,r._mapToAdd=this,r.beforeAdd&&r.beforeAdd(this),this.whenReady(r._layerAdd,r),this)},removeLayer:function(r){var l=u(r);return this._layers[l]?(this._loaded&&r.onRemove(this),delete this._layers[l],this._loaded&&(this.fire("layerremove",{layer:r}),r.fire("remove")),r._map=r._mapToAdd=null,this):this},hasLayer:function(r){return u(r)in this._layers},eachLayer:function(r,l){for(var d in this._layers)r.call(l,this._layers[d]);return this},_addLayers:function(r){r=r?D(r)?r:[r]:[];for(var l=0,d=r.length;l<d;l++)this.addLayer(r[l])},_addZoomLimit:function(r){(!isNaN(r.options.maxZoom)||!isNaN(r.options.minZoom))&&(this._zoomBoundLayers[u(r)]=r,this._updateZoomLevels())},_removeZoomLimit:function(r){var l=u(r);this._zoomBoundLayers[l]&&(delete this._zoomBoundLayers[l],this._updateZoomLevels())},_updateZoomLevels:function(){var r=1/0,l=-1/0,d=this._getZoomSpan();for(var p in this._zoomBoundLayers){var _=this._zoomBoundLayers[p].options;r=_.minZoom===void 0?r:Math.min(r,_.minZoom),l=_.maxZoom===void 0?l:Math.max(l,_.maxZoom)}this._layersMaxZoom=l===-1/0?void 0:l,this._layersMinZoom=r===1/0?void 0:r,d!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Kn=Ce.extend({initialize:function(r,l){b(this,l),this._layers={};var d,p;if(r)for(d=0,p=r.length;d<p;d++)this.addLayer(r[d])},addLayer:function(r){var l=this.getLayerId(r);return this._layers[l]=r,this._map&&this._map.addLayer(r),this},removeLayer:function(r){var l=r in this._layers?r:this.getLayerId(r);return this._map&&this._layers[l]&&this._map.removeLayer(this._layers[l]),delete this._layers[l],this},hasLayer:function(r){var l=typeof r=="number"?r:this.getLayerId(r);return l in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(r){var l=Array.prototype.slice.call(arguments,1),d,p;for(d in this._layers)p=this._layers[d],p[r]&&p[r].apply(p,l);return this},onAdd:function(r){this.eachLayer(r.addLayer,r)},onRemove:function(r){this.eachLayer(r.removeLayer,r)},eachLayer:function(r,l){for(var d in this._layers)r.call(l,this._layers[d]);return this},getLayer:function(r){return this._layers[r]},getLayers:function(){var r=[];return this.eachLayer(r.push,r),r},setZIndex:function(r){return this.invoke("setZIndex",r)},getLayerId:function(r){return u(r)}}),_p=function(r,l){return new Kn(r,l)},He=Kn.extend({addLayer:function(r){return this.hasLayer(r)?this:(r.addEventParent(this),Kn.prototype.addLayer.call(this,r),this.fire("layeradd",{layer:r}))},removeLayer:function(r){return this.hasLayer(r)?(r in this._layers&&(r=this._layers[r]),r.removeEventParent(this),Kn.prototype.removeLayer.call(this,r),this.fire("layerremove",{layer:r})):this},setStyle:function(r){return this.invoke("setStyle",r)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var r=new Q;for(var l in this._layers){var d=this._layers[l];r.extend(d.getBounds?d.getBounds():d.getLatLng())}return r}}),yp=function(r,l){return new He(r,l)},Jn=he.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(r){b(this,r)},createIcon:function(r){return this._createIcon("icon",r)},createShadow:function(r){return this._createIcon("shadow",r)},_createIcon:function(r,l){var d=this._getIconUrl(r);if(!d){if(r==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var p=this._createImg(d,l&&l.tagName==="IMG"?l:null);return this._setIconStyles(p,r),(this.options.crossOrigin||this.options.crossOrigin==="")&&(p.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),p},_setIconStyles:function(r,l){var d=this.options,p=d[l+"Size"];typeof p=="number"&&(p=[p,p]);var _=nt(p),k=nt(l==="shadow"&&d.shadowAnchor||d.iconAnchor||_&&_.divideBy(2,!0));r.className="leaflet-marker-"+l+" "+(d.className||""),k&&(r.style.marginLeft=-k.x+"px",r.style.marginTop=-k.y+"px"),_&&(r.style.width=_.x+"px",r.style.height=_.y+"px")},_createImg:function(r,l){return l=l||document.createElement("img"),l.src=r,l},_getIconUrl:function(r){return G.retina&&this.options[r+"RetinaUrl"]||this.options[r+"Url"]}});function vp(r){return new Jn(r)}var Li=Jn.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(r){return typeof Li.imagePath!="string"&&(Li.imagePath=this._detectIconPath()),(this.options.imagePath||Li.imagePath)+Jn.prototype._getIconUrl.call(this,r)},_stripUrl:function(r){var l=function(d,p,_){var k=p.exec(d);return k&&k[_]};return r=l(r,/^url\((['"])?(.+)\1\)$/,2),r&&l(r,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var r=ht("div","leaflet-default-icon-path",document.body),l=Ci(r,"background-image")||Ci(r,"backgroundImage");if(document.body.removeChild(r),l=this._stripUrl(l),l)return l;var d=document.querySelector('link[href$="leaflet.css"]');return d?d.href.substring(0,d.href.length-11-1):""}}),Kl=Ne.extend({initialize:function(r){this._marker=r},addHooks:function(){var r=this._marker._icon;this._draggable||(this._draggable=new rn(r,r,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),st(r,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Ot(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(r){var l=this._marker,d=l._map,p=this._marker.options.autoPanSpeed,_=this._marker.options.autoPanPadding,k=wn(l._icon),T=d.getPixelBounds(),E=d.getPixelOrigin(),O=Yt(T.min._subtract(E).add(_),T.max._subtract(E).subtract(_));if(!O.contains(k)){var R=nt((Math.max(O.max.x,k.x)-O.max.x)/(T.max.x-O.max.x)-(Math.min(O.min.x,k.x)-O.min.x)/(T.min.x-O.min.x),(Math.max(O.max.y,k.y)-O.max.y)/(T.max.y-O.max.y)-(Math.min(O.min.y,k.y)-O.min.y)/(T.min.y-O.min.y)).multiplyBy(p);d.panBy(R,{animate:!1}),this._draggable._newPos._add(R),this._draggable._startPos._add(R),Dt(l._icon,this._draggable._newPos),this._onDrag(r),this._panRequest=Nt(this._adjustPan.bind(this,r))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(r){this._marker.options.autoPan&&(Pt(this._panRequest),this._panRequest=Nt(this._adjustPan.bind(this,r)))},_onDrag:function(r){var l=this._marker,d=l._shadow,p=wn(l._icon),_=l._map.layerPointToLatLng(p);d&&Dt(d,p),l._latlng=_,r.latlng=_,r.oldLatLng=this._oldLatLng,l.fire("move",r).fire("drag",r)},_onDragEnd:function(r){Pt(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",r)}}),_r=Ce.extend({options:{icon:new Li,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(r,l){b(this,l),this._latlng=ut(r)},onAdd:function(r){this._zoomAnimated=this._zoomAnimated&&r.options.markerZoomAnimation,this._zoomAnimated&&r.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(r){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&r.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(r){var l=this._latlng;return this._latlng=ut(r),this.update(),this.fire("move",{oldLatLng:l,latlng:this._latlng})},setZIndexOffset:function(r){return this.options.zIndexOffset=r,this.update()},getIcon:function(){return this.options.icon},setIcon:function(r){return this.options.icon=r,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var r=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(r)}return this},_initIcon:function(){var r=this.options,l="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),d=r.icon.createIcon(this._icon),p=!1;d!==this._icon&&(this._icon&&this._removeIcon(),p=!0,r.title&&(d.title=r.title),d.tagName==="IMG"&&(d.alt=r.alt||"")),st(d,l),r.keyboard&&(d.tabIndex="0",d.setAttribute("role","button")),this._icon=d,r.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&rt(d,"focus",this._panOnFocus,this);var _=r.icon.createShadow(this._shadow),k=!1;_!==this._shadow&&(this._removeShadow(),k=!0),_&&(st(_,l),_.alt=""),this._shadow=_,r.opacity<1&&this._updateOpacity(),p&&this.getPane().appendChild(this._icon),this._initInteraction(),_&&k&&this.getPane(r.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&vt(this._icon,"focus",this._panOnFocus,this),wt(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&wt(this._shadow),this._shadow=null},_setPos:function(r){this._icon&&Dt(this._icon,r),this._shadow&&Dt(this._shadow,r),this._zIndex=r.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(r){this._icon&&(this._icon.style.zIndex=this._zIndex+r)},_animateZoom:function(r){var l=this._map._latLngToNewLayerPoint(this._latlng,r.zoom,r.center).round();this._setPos(l)},_initInteraction:function(){if(this.options.interactive&&(st(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),Kl)){var r=this.options.draggable;this.dragging&&(r=this.dragging.enabled(),this.dragging.disable()),this.dragging=new Kl(this),r&&this.dragging.enable()}},setOpacity:function(r){return this.options.opacity=r,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var r=this.options.opacity;this._icon&&_e(this._icon,r),this._shadow&&_e(this._shadow,r)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var r=this._map;if(r){var l=this.options.icon.options,d=l.iconSize?nt(l.iconSize):nt(0,0),p=l.iconAnchor?nt(l.iconAnchor):nt(0,0);r.panInside(this._latlng,{paddingTopLeft:p,paddingBottomRight:d.subtract(p)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function bp(r,l){return new _r(r,l)}var sn=Ce.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(r){this._renderer=r.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(r){return b(this,r),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&r&&Object.prototype.hasOwnProperty.call(r,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),yr=sn.extend({options:{fill:!0,radius:10},initialize:function(r,l){b(this,l),this._latlng=ut(r),this._radius=this.options.radius},setLatLng:function(r){var l=this._latlng;return this._latlng=ut(r),this.redraw(),this.fire("move",{oldLatLng:l,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(r){return this.options.radius=this._radius=r,this.redraw()},getRadius:function(){return this._radius},setStyle:function(r){var l=r&&r.radius||this._radius;return sn.prototype.setStyle.call(this,r),this.setRadius(l),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var r=this._radius,l=this._radiusY||r,d=this._clickTolerance(),p=[r+d,l+d];this._pxBounds=new bt(this._point.subtract(p),this._point.add(p))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(r){return r.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function xp(r,l){return new yr(r,l)}var lo=yr.extend({initialize:function(r,l,d){if(typeof l=="number"&&(l=s({},d,{radius:l})),b(this,l),this._latlng=ut(r),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(r){return this._mRadius=r,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var r=[this._radius,this._radiusY||this._radius];return new Q(this._map.layerPointToLatLng(this._point.subtract(r)),this._map.layerPointToLatLng(this._point.add(r)))},setStyle:sn.prototype.setStyle,_project:function(){var r=this._latlng.lng,l=this._latlng.lat,d=this._map,p=d.options.crs;if(p.distance===nn.distance){var _=Math.PI/180,k=this._mRadius/nn.R/_,T=d.project([l+k,r]),E=d.project([l-k,r]),O=T.add(E).divideBy(2),R=d.unproject(O).lat,H=Math.acos((Math.cos(k*_)-Math.sin(l*_)*Math.sin(R*_))/(Math.cos(l*_)*Math.cos(R*_)))/_;(isNaN(H)||H===0)&&(H=k/Math.cos(Math.PI/180*l)),this._point=O.subtract(d.getPixelOrigin()),this._radius=isNaN(H)?0:O.x-d.project([R,r-H]).x,this._radiusY=O.y-T.y}else{var et=p.unproject(p.project(this._latlng).subtract([this._mRadius,0]));this._point=d.latLngToLayerPoint(this._latlng),this._radius=this._point.x-d.latLngToLayerPoint(et).x}this._updateBounds()}});function kp(r,l,d){return new lo(r,l,d)}var Ze=sn.extend({options:{smoothFactor:1,noClip:!1},initialize:function(r,l){b(this,l),this._setLatLngs(r)},getLatLngs:function(){return this._latlngs},setLatLngs:function(r){return this._setLatLngs(r),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(r){for(var l=1/0,d=null,p=Ai,_,k,T=0,E=this._parts.length;T<E;T++)for(var O=this._parts[T],R=1,H=O.length;R<H;R++){_=O[R-1],k=O[R];var et=p(r,_,k,!0);et<l&&(l=et,d=p(r,_,k))}return d&&(d.distance=Math.sqrt(l)),d},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Ul(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(r,l){return l=l||this._defaultShape(),r=ut(r),l.push(r),this._bounds.extend(r),this.redraw()},_setLatLngs:function(r){this._bounds=new Q,this._latlngs=this._convertLatLngs(r)},_defaultShape:function(){return ye(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(r){for(var l=[],d=ye(r),p=0,_=r.length;p<_;p++)d?(l[p]=ut(r[p]),this._bounds.extend(l[p])):l[p]=this._convertLatLngs(r[p]);return l},_project:function(){var r=new bt;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,r),this._bounds.isValid()&&r.isValid()&&(this._rawPxBounds=r,this._updateBounds())},_updateBounds:function(){var r=this._clickTolerance(),l=new tt(r,r);this._rawPxBounds&&(this._pxBounds=new bt([this._rawPxBounds.min.subtract(l),this._rawPxBounds.max.add(l)]))},_projectLatlngs:function(r,l,d){var p=r[0]instanceof _t,_=r.length,k,T;if(p){for(T=[],k=0;k<_;k++)T[k]=this._map.latLngToLayerPoint(r[k]),d.extend(T[k]);l.push(T)}else for(k=0;k<_;k++)this._projectLatlngs(r[k],l,d)},_clipPoints:function(){var r=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(r))){if(this.options.noClip){this._parts=this._rings;return}var l=this._parts,d,p,_,k,T,E,O;for(d=0,_=0,k=this._rings.length;d<k;d++)for(O=this._rings[d],p=0,T=O.length;p<T-1;p++)E=Wl(O[p],O[p+1],r,p,!0),E&&(l[_]=l[_]||[],l[_].push(E[0]),(E[1]!==O[p+1]||p===T-2)&&(l[_].push(E[1]),_++))}},_simplifyPoints:function(){for(var r=this._parts,l=this.options.smoothFactor,d=0,p=r.length;d<p;d++)r[d]=Vl(r[d],l)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(r,l){var d,p,_,k,T,E,O=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(r))return!1;for(d=0,k=this._parts.length;d<k;d++)for(E=this._parts[d],p=0,T=E.length,_=T-1;p<T;_=p++)if(!(!l&&p===0)&&Hl(r,E[_],E[p])<=O)return!0;return!1}});function wp(r,l){return new Ze(r,l)}Ze._flat=jl;var Gn=Ze.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Fl(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(r){var l=Ze.prototype._convertLatLngs.call(this,r),d=l.length;return d>=2&&l[0]instanceof _t&&l[0].equals(l[d-1])&&l.pop(),l},_setLatLngs:function(r){Ze.prototype._setLatLngs.call(this,r),ye(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return ye(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var r=this._renderer._bounds,l=this.options.weight,d=new tt(l,l);if(r=new bt(r.min.subtract(d),r.max.add(d)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(r))){if(this.options.noClip){this._parts=this._rings;return}for(var p=0,_=this._rings.length,k;p<_;p++)k=$l(this._rings[p],r,!0),k.length&&this._parts.push(k)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(r){var l=!1,d,p,_,k,T,E,O,R;if(!this._pxBounds||!this._pxBounds.contains(r))return!1;for(k=0,O=this._parts.length;k<O;k++)for(d=this._parts[k],T=0,R=d.length,E=R-1;T<R;E=T++)p=d[T],_=d[E],p.y>r.y!=_.y>r.y&&r.x<(_.x-p.x)*(r.y-p.y)/(_.y-p.y)+p.x&&(l=!l);return l||Ze.prototype._containsPoint.call(this,r,!0)}});function Sp(r,l){return new Gn(r,l)}var We=He.extend({initialize:function(r,l){b(this,l),this._layers={},r&&this.addData(r)},addData:function(r){var l=D(r)?r:r.features,d,p,_;if(l){for(d=0,p=l.length;d<p;d++)_=l[d],(_.geometries||_.geometry||_.features||_.coordinates)&&this.addData(_);return this}var k=this.options;if(k.filter&&!k.filter(r))return this;var T=vr(r,k);return T?(T.feature=kr(r),T.defaultOptions=T.options,this.resetStyle(T),k.onEachFeature&&k.onEachFeature(r,T),this.addLayer(T)):this},resetStyle:function(r){return r===void 0?this.eachLayer(this.resetStyle,this):(r.options=s({},r.defaultOptions),this._setLayerStyle(r,this.options.style),this)},setStyle:function(r){return this.eachLayer(function(l){this._setLayerStyle(l,r)},this)},_setLayerStyle:function(r,l){r.setStyle&&(typeof l=="function"&&(l=l(r.feature)),r.setStyle(l))}});function vr(r,l){var d=r.type==="Feature"?r.geometry:r,p=d?d.coordinates:null,_=[],k=l&&l.pointToLayer,T=l&&l.coordsToLatLng||co,E,O,R,H;if(!p&&!d)return null;switch(d.type){case"Point":return E=T(p),Jl(k,r,E,l);case"MultiPoint":for(R=0,H=p.length;R<H;R++)E=T(p[R]),_.push(Jl(k,r,E,l));return new He(_);case"LineString":case"MultiLineString":return O=br(p,d.type==="LineString"?0:1,T),new Ze(O,l);case"Polygon":case"MultiPolygon":return O=br(p,d.type==="Polygon"?1:2,T),new Gn(O,l);case"GeometryCollection":for(R=0,H=d.geometries.length;R<H;R++){var et=vr({geometry:d.geometries[R],type:"Feature",properties:r.properties},l);et&&_.push(et)}return new He(_);case"FeatureCollection":for(R=0,H=d.features.length;R<H;R++){var ot=vr(d.features[R],l);ot&&_.push(ot)}return new He(_);default:throw new Error("Invalid GeoJSON object.")}}function Jl(r,l,d,p){return r?r(l,d):new _r(d,p&&p.markersInheritOptions&&p)}function co(r){return new _t(r[1],r[0],r[2])}function br(r,l,d){for(var p=[],_=0,k=r.length,T;_<k;_++)T=l?br(r[_],l-1,d):(d||co)(r[_]),p.push(T);return p}function uo(r,l){return r=ut(r),r.alt!==void 0?[g(r.lng,l),g(r.lat,l),g(r.alt,l)]:[g(r.lng,l),g(r.lat,l)]}function xr(r,l,d,p){for(var _=[],k=0,T=r.length;k<T;k++)_.push(l?xr(r[k],ye(r[k])?0:l-1,d,p):uo(r[k],p));return!l&&d&&_.length>0&&_.push(_[0].slice()),_}function Yn(r,l){return r.feature?s({},r.feature,{geometry:l}):kr(l)}function kr(r){return r.type==="Feature"||r.type==="FeatureCollection"?r:{type:"Feature",properties:{},geometry:r}}var fo={toGeoJSON:function(r){return Yn(this,{type:"Point",coordinates:uo(this.getLatLng(),r)})}};_r.include(fo),lo.include(fo),yr.include(fo),Ze.include({toGeoJSON:function(r){var l=!ye(this._latlngs),d=xr(this._latlngs,l?1:0,!1,r);return Yn(this,{type:(l?"Multi":"")+"LineString",coordinates:d})}}),Gn.include({toGeoJSON:function(r){var l=!ye(this._latlngs),d=l&&!ye(this._latlngs[0]),p=xr(this._latlngs,d?2:l?1:0,!0,r);return l||(p=[p]),Yn(this,{type:(d?"Multi":"")+"Polygon",coordinates:p})}}),Kn.include({toMultiPoint:function(r){var l=[];return this.eachLayer(function(d){l.push(d.toGeoJSON(r).geometry.coordinates)}),Yn(this,{type:"MultiPoint",coordinates:l})},toGeoJSON:function(r){var l=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(l==="MultiPoint")return this.toMultiPoint(r);var d=l==="GeometryCollection",p=[];return this.eachLayer(function(_){if(_.toGeoJSON){var k=_.toGeoJSON(r);if(d)p.push(k.geometry);else{var T=kr(k);T.type==="FeatureCollection"?p.push.apply(p,T.features):p.push(T)}}}),d?Yn(this,{geometries:p,type:"GeometryCollection"}):{type:"FeatureCollection",features:p}}});function Gl(r,l){return new We(r,l)}var Cp=Gl,wr=Ce.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(r,l,d){this._url=r,this._bounds=Et(l),b(this,d)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(st(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){wt(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(r){return this.options.opacity=r,this._image&&this._updateOpacity(),this},setStyle:function(r){return r.opacity&&this.setOpacity(r.opacity),this},bringToFront:function(){return this._map&&Un(this._image),this},bringToBack:function(){return this._map&&qn(this._image),this},setUrl:function(r){return this._url=r,this._image&&(this._image.src=r),this},setBounds:function(r){return this._bounds=Et(r),this._map&&this._reset(),this},getEvents:function(){var r={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(r.zoomanim=this._animateZoom),r},setZIndex:function(r){return this.options.zIndex=r,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var r=this._url.tagName==="IMG",l=this._image=r?this._url:ht("img");if(st(l,"leaflet-image-layer"),this._zoomAnimated&&st(l,"leaflet-zoom-animated"),this.options.className&&st(l,this.options.className),l.onselectstart=m,l.onmousemove=m,l.onload=a(this.fire,this,"load"),l.onerror=a(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(l.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),r){this._url=l.src;return}l.src=this._url,l.alt=this.options.alt},_animateZoom:function(r){var l=this._map.getZoomScale(r.zoom),d=this._map._latLngBoundsToNewLayerBounds(this._bounds,r.zoom,r.center).min;kn(this._image,d,l)},_reset:function(){var r=this._image,l=new bt(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),d=l.getSize();Dt(r,l.min),r.style.width=d.x+"px",r.style.height=d.y+"px"},_updateOpacity:function(){_e(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var r=this.options.errorOverlayUrl;r&&this._url!==r&&(this._url=r,this._image.src=r)},getCenter:function(){return this._bounds.getCenter()}}),Mp=function(r,l,d){return new wr(r,l,d)},Yl=wr.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var r=this._url.tagName==="VIDEO",l=this._image=r?this._url:ht("video");if(st(l,"leaflet-image-layer"),this._zoomAnimated&&st(l,"leaflet-zoom-animated"),this.options.className&&st(l,this.options.className),l.onselectstart=m,l.onmousemove=m,l.onloadeddata=a(this.fire,this,"load"),r){for(var d=l.getElementsByTagName("source"),p=[],_=0;_<d.length;_++)p.push(d[_].src);this._url=d.length>0?p:[l.src];return}D(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(l.style,"objectFit")&&(l.style.objectFit="fill"),l.autoplay=!!this.options.autoplay,l.loop=!!this.options.loop,l.muted=!!this.options.muted,l.playsInline=!!this.options.playsInline;for(var k=0;k<this._url.length;k++){var T=ht("source");T.src=this._url[k],l.appendChild(T)}}});function Tp(r,l,d){return new Yl(r,l,d)}var Xl=wr.extend({_initImage:function(){var r=this._image=this._url;st(r,"leaflet-image-layer"),this._zoomAnimated&&st(r,"leaflet-zoom-animated"),this.options.className&&st(r,this.options.className),r.onselectstart=m,r.onmousemove=m}});function Pp(r,l,d){return new Xl(r,l,d)}var De=Ce.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(r,l){r&&(r instanceof _t||D(r))?(this._latlng=ut(r),b(this,l)):(b(this,r),this._source=l),this.options.content&&(this._content=this.options.content)},openOn:function(r){return r=arguments.length?r:this._source._map,r.hasLayer(this)||r.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(r){return this._map?this.close():(arguments.length?this._source=r:r=this._source,this._prepareOpen(),this.openOn(r._map)),this},onAdd:function(r){this._zoomAnimated=r._zoomAnimated,this._container||this._initLayout(),r._fadeAnimated&&_e(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),r._fadeAnimated&&_e(this._container,1),this.bringToFront(),this.options.interactive&&(st(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(r){r._fadeAnimated?(_e(this._container,0),this._removeTimeout=setTimeout(a(wt,void 0,this._container),200)):wt(this._container),this.options.interactive&&(Ot(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(r){return this._latlng=ut(r),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(r){return this._content=r,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var r={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(r.zoomanim=this._animateZoom),r},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Un(this._container),this},bringToBack:function(){return this._map&&qn(this._container),this},_prepareOpen:function(r){var l=this._source;if(!l._map)return!1;if(l instanceof He){l=null;var d=this._source._layers;for(var p in d)if(d[p]._map){l=d[p];break}if(!l)return!1;this._source=l}if(!r)if(l.getCenter)r=l.getCenter();else if(l.getLatLng)r=l.getLatLng();else if(l.getBounds)r=l.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(r),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var r=this._contentNode,l=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof l=="string")r.innerHTML=l;else{for(;r.hasChildNodes();)r.removeChild(r.firstChild);r.appendChild(l)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var r=this._map.latLngToLayerPoint(this._latlng),l=nt(this.options.offset),d=this._getAnchor();this._zoomAnimated?Dt(this._container,r.add(d)):l=l.add(r).add(d);var p=this._containerBottom=-l.y,_=this._containerLeft=-Math.round(this._containerWidth/2)+l.x;this._container.style.bottom=p+"px",this._container.style.left=_+"px"}},_getAnchor:function(){return[0,0]}});dt.include({_initOverlay:function(r,l,d,p){var _=l;return _ instanceof r||(_=new r(p).setContent(l)),d&&_.setLatLng(d),_}}),Ce.include({_initOverlay:function(r,l,d,p){var _=d;return _ instanceof r?(b(_,p),_._source=this):(_=l&&!p?l:new r(p,this),_.setContent(d)),_}});var Sr=De.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(r){return r=arguments.length?r:this._source._map,!r.hasLayer(this)&&r._popup&&r._popup.options.autoClose&&r.removeLayer(r._popup),r._popup=this,De.prototype.openOn.call(this,r)},onAdd:function(r){De.prototype.onAdd.call(this,r),r.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof sn||this._source.on("preclick",Sn))},onRemove:function(r){De.prototype.onRemove.call(this,r),r.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof sn||this._source.off("preclick",Sn))},getEvents:function(){var r=De.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(r.preclick=this.close),this.options.keepInView&&(r.moveend=this._adjustPan),r},_initLayout:function(){var r="leaflet-popup",l=this._container=ht("div",r+" "+(this.options.className||"")+" leaflet-zoom-animated"),d=this._wrapper=ht("div",r+"-content-wrapper",l);if(this._contentNode=ht("div",r+"-content",d),Ei(l),to(this._contentNode),rt(l,"contextmenu",Sn),this._tipContainer=ht("div",r+"-tip-container",l),this._tip=ht("div",r+"-tip",this._tipContainer),this.options.closeButton){var p=this._closeButton=ht("a",r+"-close-button",l);p.setAttribute("role","button"),p.setAttribute("aria-label","Close popup"),p.href="#close",p.innerHTML='<span aria-hidden="true">&#215;</span>',rt(p,"click",function(_){qt(_),this.close()},this)}},_updateLayout:function(){var r=this._contentNode,l=r.style;l.width="",l.whiteSpace="nowrap";var d=r.offsetWidth;d=Math.min(d,this.options.maxWidth),d=Math.max(d,this.options.minWidth),l.width=d+1+"px",l.whiteSpace="",l.height="";var p=r.offsetHeight,_=this.options.maxHeight,k="leaflet-popup-scrolled";_&&p>_?(l.height=_+"px",st(r,k)):Ot(r,k),this._containerWidth=this._container.offsetWidth},_animateZoom:function(r){var l=this._map._latLngToNewLayerPoint(this._latlng,r.zoom,r.center),d=this._getAnchor();Dt(this._container,l.add(d))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var r=this._map,l=parseInt(Ci(this._container,"marginBottom"),10)||0,d=this._container.offsetHeight+l,p=this._containerWidth,_=new tt(this._containerLeft,-d-this._containerBottom);_._add(wn(this._container));var k=r.layerPointToContainerPoint(_),T=nt(this.options.autoPanPadding),E=nt(this.options.autoPanPaddingTopLeft||T),O=nt(this.options.autoPanPaddingBottomRight||T),R=r.getSize(),H=0,et=0;k.x+p+O.x>R.x&&(H=k.x+p-R.x+O.x),k.x-H-E.x<0&&(H=k.x-E.x),k.y+d+O.y>R.y&&(et=k.y+d-R.y+O.y),k.y-et-E.y<0&&(et=k.y-E.y),(H||et)&&(this.options.keepInView&&(this._autopanning=!0),r.fire("autopanstart").panBy([H,et]))}},_getAnchor:function(){return nt(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Ep=function(r,l){return new Sr(r,l)};dt.mergeOptions({closePopupOnClick:!0}),dt.include({openPopup:function(r,l,d){return this._initOverlay(Sr,r,l,d).openOn(this),this},closePopup:function(r){return r=arguments.length?r:this._popup,r&&r.close(),this}}),Ce.include({bindPopup:function(r,l){return this._popup=this._initOverlay(Sr,this._popup,r,l),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(r){return this._popup&&(this instanceof He||(this._popup._source=this),this._popup._prepareOpen(r||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(r){return this._popup&&this._popup.setContent(r),this},getPopup:function(){return this._popup},_openPopup:function(r){if(!(!this._popup||!this._map)){Cn(r);var l=r.layer||r.target;if(this._popup._source===l&&!(l instanceof sn)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(r.latlng);return}this._popup._source=l,this.openPopup(r.latlng)}},_movePopup:function(r){this._popup.setLatLng(r.latlng)},_onKeyPress:function(r){r.originalEvent.keyCode===13&&this._openPopup(r)}});var Cr=De.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(r){De.prototype.onAdd.call(this,r),this.setOpacity(this.options.opacity),r.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(r){De.prototype.onRemove.call(this,r),r.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var r=De.prototype.getEvents.call(this);return this.options.permanent||(r.preclick=this.close),r},_initLayout:function(){var r="leaflet-tooltip",l=r+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=ht("div",l),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+u(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(r){var l,d,p=this._map,_=this._container,k=p.latLngToContainerPoint(p.getCenter()),T=p.layerPointToContainerPoint(r),E=this.options.direction,O=_.offsetWidth,R=_.offsetHeight,H=nt(this.options.offset),et=this._getAnchor();E==="top"?(l=O/2,d=R):E==="bottom"?(l=O/2,d=0):E==="center"?(l=O/2,d=R/2):E==="right"?(l=0,d=R/2):E==="left"?(l=O,d=R/2):T.x<k.x?(E="right",l=0,d=R/2):(E="left",l=O+(H.x+et.x)*2,d=R/2),r=r.subtract(nt(l,d,!0)).add(H).add(et),Ot(_,"leaflet-tooltip-right"),Ot(_,"leaflet-tooltip-left"),Ot(_,"leaflet-tooltip-top"),Ot(_,"leaflet-tooltip-bottom"),st(_,"leaflet-tooltip-"+E),Dt(_,r)},_updatePosition:function(){var r=this._map.latLngToLayerPoint(this._latlng);this._setPosition(r)},setOpacity:function(r){this.options.opacity=r,this._container&&_e(this._container,r)},_animateZoom:function(r){var l=this._map._latLngToNewLayerPoint(this._latlng,r.zoom,r.center);this._setPosition(l)},_getAnchor:function(){return nt(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),Op=function(r,l){return new Cr(r,l)};dt.include({openTooltip:function(r,l,d){return this._initOverlay(Cr,r,l,d).openOn(this),this},closeTooltip:function(r){return r.close(),this}}),Ce.include({bindTooltip:function(r,l){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Cr,this._tooltip,r,l),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(r){if(!(!r&&this._tooltipHandlersAdded)){var l=r?"off":"on",d={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?d.add=this._openTooltip:(d.mouseover=this._openTooltip,d.mouseout=this.closeTooltip,d.click=this._openTooltip,this._map?this._addFocusListeners():d.add=this._addFocusListeners),this._tooltip.options.sticky&&(d.mousemove=this._moveTooltip),this[l](d),this._tooltipHandlersAdded=!r}},openTooltip:function(r){return this._tooltip&&(this instanceof He||(this._tooltip._source=this),this._tooltip._prepareOpen(r)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(r){return this._tooltip&&this._tooltip.setContent(r),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(r){var l=typeof r.getElement=="function"&&r.getElement();l&&(rt(l,"focus",function(){this._tooltip._source=r,this.openTooltip()},this),rt(l,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(r){var l=typeof r.getElement=="function"&&r.getElement();l&&l.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(r){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var l=this;this._map.once("moveend",function(){l._openOnceFlag=!1,l._openTooltip(r)});return}this._tooltip._source=r.layer||r.target,this.openTooltip(this._tooltip.options.sticky?r.latlng:void 0)}},_moveTooltip:function(r){var l=r.latlng,d,p;this._tooltip.options.sticky&&r.originalEvent&&(d=this._map.mouseEventToContainerPoint(r.originalEvent),p=this._map.containerPointToLayerPoint(d),l=this._map.layerPointToLatLng(p)),this._tooltip.setLatLng(l)}});var Ql=Jn.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(r){var l=r&&r.tagName==="DIV"?r:document.createElement("div"),d=this.options;if(d.html instanceof Element?(dr(l),l.appendChild(d.html)):l.innerHTML=d.html!==!1?d.html:"",d.bgPos){var p=nt(d.bgPos);l.style.backgroundPosition=-p.x+"px "+-p.y+"px"}return this._setIconStyles(l,"icon"),l},createShadow:function(){return null}});function Ap(r){return new Ql(r)}Jn.Default=Li;var Ii=Ce.extend({options:{tileSize:256,opacity:1,updateWhenIdle:G.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(r){b(this,r)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(r){r._addZoomLimit(this)},onRemove:function(r){this._removeAllTiles(),wt(this._container),r._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Un(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(qn(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(r){return this.options.opacity=r,this._updateOpacity(),this},setZIndex:function(r){return this.options.zIndex=r,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var r=this._clampZoom(this._map.getZoom());r!==this._tileZoom&&(this._tileZoom=r,this._updateLevels()),this._update()}return this},getEvents:function(){var r={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=f(this._onMoveEnd,this.options.updateInterval,this)),r.move=this._onMove),this._zoomAnimated&&(r.zoomanim=this._animateZoom),r},createTile:function(){return document.createElement("div")},getTileSize:function(){var r=this.options.tileSize;return r instanceof tt?r:new tt(r,r)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(r){for(var l=this.getPane().children,d=-r(-1/0,1/0),p=0,_=l.length,k;p<_;p++)k=l[p].style.zIndex,l[p]!==this._container&&k&&(d=r(d,+k));isFinite(d)&&(this.options.zIndex=d+r(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!G.ielt9){_e(this._container,this.options.opacity);var r=+new Date,l=!1,d=!1;for(var p in this._tiles){var _=this._tiles[p];if(!(!_.current||!_.loaded)){var k=Math.min(1,(r-_.loaded)/200);_e(_.el,k),k<1?l=!0:(_.active?d=!0:this._onOpaqueTile(_),_.active=!0)}}d&&!this._noPrune&&this._pruneTiles(),l&&(Pt(this._fadeFrame),this._fadeFrame=Nt(this._updateOpacity,this))}},_onOpaqueTile:m,_initContainer:function(){this._container||(this._container=ht("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var r=this._tileZoom,l=this.options.maxZoom;if(r!==void 0){for(var d in this._levels)d=Number(d),this._levels[d].el.children.length||d===r?(this._levels[d].el.style.zIndex=l-Math.abs(r-d),this._onUpdateLevel(d)):(wt(this._levels[d].el),this._removeTilesAtZoom(d),this._onRemoveLevel(d),delete this._levels[d]);var p=this._levels[r],_=this._map;return p||(p=this._levels[r]={},p.el=ht("div","leaflet-tile-container leaflet-zoom-animated",this._container),p.el.style.zIndex=l,p.origin=_.project(_.unproject(_.getPixelOrigin()),r).round(),p.zoom=r,this._setZoomTransform(p,_.getCenter(),_.getZoom()),m(p.el.offsetWidth),this._onCreateLevel(p)),this._level=p,p}},_onUpdateLevel:m,_onRemoveLevel:m,_onCreateLevel:m,_pruneTiles:function(){if(this._map){var r,l,d=this._map.getZoom();if(d>this.options.maxZoom||d<this.options.minZoom){this._removeAllTiles();return}for(r in this._tiles)l=this._tiles[r],l.retain=l.current;for(r in this._tiles)if(l=this._tiles[r],l.current&&!l.active){var p=l.coords;this._retainParent(p.x,p.y,p.z,p.z-5)||this._retainChildren(p.x,p.y,p.z,p.z+2)}for(r in this._tiles)this._tiles[r].retain||this._removeTile(r)}},_removeTilesAtZoom:function(r){for(var l in this._tiles)this._tiles[l].coords.z===r&&this._removeTile(l)},_removeAllTiles:function(){for(var r in this._tiles)this._removeTile(r)},_invalidateAll:function(){for(var r in this._levels)wt(this._levels[r].el),this._onRemoveLevel(Number(r)),delete this._levels[r];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(r,l,d,p){var _=Math.floor(r/2),k=Math.floor(l/2),T=d-1,E=new tt(+_,+k);E.z=+T;var O=this._tileCoordsToKey(E),R=this._tiles[O];return R&&R.active?(R.retain=!0,!0):(R&&R.loaded&&(R.retain=!0),T>p?this._retainParent(_,k,T,p):!1)},_retainChildren:function(r,l,d,p){for(var _=2*r;_<2*r+2;_++)for(var k=2*l;k<2*l+2;k++){var T=new tt(_,k);T.z=d+1;var E=this._tileCoordsToKey(T),O=this._tiles[E];if(O&&O.active){O.retain=!0;continue}else O&&O.loaded&&(O.retain=!0);d+1<p&&this._retainChildren(_,k,d+1,p)}},_resetView:function(r){var l=r&&(r.pinch||r.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),l,l)},_animateZoom:function(r){this._setView(r.center,r.zoom,!0,r.noUpdate)},_clampZoom:function(r){var l=this.options;return l.minNativeZoom!==void 0&&r<l.minNativeZoom?l.minNativeZoom:l.maxNativeZoom!==void 0&&l.maxNativeZoom<r?l.maxNativeZoom:r},_setView:function(r,l,d,p){var _=Math.round(l);this.options.maxZoom!==void 0&&_>this.options.maxZoom||this.options.minZoom!==void 0&&_<this.options.minZoom?_=void 0:_=this._clampZoom(_);var k=this.options.updateWhenZooming&&_!==this._tileZoom;(!p||k)&&(this._tileZoom=_,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),_!==void 0&&this._update(r),d||this._pruneTiles(),this._noPrune=!!d),this._setZoomTransforms(r,l)},_setZoomTransforms:function(r,l){for(var d in this._levels)this._setZoomTransform(this._levels[d],r,l)},_setZoomTransform:function(r,l,d){var p=this._map.getZoomScale(d,r.zoom),_=r.origin.multiplyBy(p).subtract(this._map._getNewPixelOrigin(l,d)).round();G.any3d?kn(r.el,_,p):Dt(r.el,_)},_resetGrid:function(){var r=this._map,l=r.options.crs,d=this._tileSize=this.getTileSize(),p=this._tileZoom,_=this._map.getPixelWorldBounds(this._tileZoom);_&&(this._globalTileRange=this._pxBoundsToTileRange(_)),this._wrapX=l.wrapLng&&!this.options.noWrap&&[Math.floor(r.project([0,l.wrapLng[0]],p).x/d.x),Math.ceil(r.project([0,l.wrapLng[1]],p).x/d.y)],this._wrapY=l.wrapLat&&!this.options.noWrap&&[Math.floor(r.project([l.wrapLat[0],0],p).y/d.x),Math.ceil(r.project([l.wrapLat[1],0],p).y/d.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(r){var l=this._map,d=l._animatingZoom?Math.max(l._animateToZoom,l.getZoom()):l.getZoom(),p=l.getZoomScale(d,this._tileZoom),_=l.project(r,this._tileZoom).floor(),k=l.getSize().divideBy(p*2);return new bt(_.subtract(k),_.add(k))},_update:function(r){var l=this._map;if(l){var d=this._clampZoom(l.getZoom());if(r===void 0&&(r=l.getCenter()),this._tileZoom!==void 0){var p=this._getTiledPixelBounds(r),_=this._pxBoundsToTileRange(p),k=_.getCenter(),T=[],E=this.options.keepBuffer,O=new bt(_.getBottomLeft().subtract([E,-E]),_.getTopRight().add([E,-E]));if(!(isFinite(_.min.x)&&isFinite(_.min.y)&&isFinite(_.max.x)&&isFinite(_.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var R in this._tiles){var H=this._tiles[R].coords;(H.z!==this._tileZoom||!O.contains(new tt(H.x,H.y)))&&(this._tiles[R].current=!1)}if(Math.abs(d-this._tileZoom)>1){this._setView(r,d);return}for(var et=_.min.y;et<=_.max.y;et++)for(var ot=_.min.x;ot<=_.max.x;ot++){var ne=new tt(ot,et);if(ne.z=this._tileZoom,!!this._isValidTile(ne)){var Ht=this._tiles[this._tileCoordsToKey(ne)];Ht?Ht.current=!0:T.push(ne)}}if(T.sort(function(ae,Qn){return ae.distanceTo(k)-Qn.distanceTo(k)}),T.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var ve=document.createDocumentFragment();for(ot=0;ot<T.length;ot++)this._addTile(T[ot],ve);this._level.el.appendChild(ve)}}}},_isValidTile:function(r){var l=this._map.options.crs;if(!l.infinite){var d=this._globalTileRange;if(!l.wrapLng&&(r.x<d.min.x||r.x>d.max.x)||!l.wrapLat&&(r.y<d.min.y||r.y>d.max.y))return!1}if(!this.options.bounds)return!0;var p=this._tileCoordsToBounds(r);return Et(this.options.bounds).overlaps(p)},_keyToBounds:function(r){return this._tileCoordsToBounds(this._keyToTileCoords(r))},_tileCoordsToNwSe:function(r){var l=this._map,d=this.getTileSize(),p=r.scaleBy(d),_=p.add(d),k=l.unproject(p,r.z),T=l.unproject(_,r.z);return[k,T]},_tileCoordsToBounds:function(r){var l=this._tileCoordsToNwSe(r),d=new Q(l[0],l[1]);return this.options.noWrap||(d=this._map.wrapLatLngBounds(d)),d},_tileCoordsToKey:function(r){return r.x+":"+r.y+":"+r.z},_keyToTileCoords:function(r){var l=r.split(":"),d=new tt(+l[0],+l[1]);return d.z=+l[2],d},_removeTile:function(r){var l=this._tiles[r];l&&(wt(l.el),delete this._tiles[r],this.fire("tileunload",{tile:l.el,coords:this._keyToTileCoords(r)}))},_initTile:function(r){st(r,"leaflet-tile");var l=this.getTileSize();r.style.width=l.x+"px",r.style.height=l.y+"px",r.onselectstart=m,r.onmousemove=m,G.ielt9&&this.options.opacity<1&&_e(r,this.options.opacity)},_addTile:function(r,l){var d=this._getTilePos(r),p=this._tileCoordsToKey(r),_=this.createTile(this._wrapCoords(r),a(this._tileReady,this,r));this._initTile(_),this.createTile.length<2&&Nt(a(this._tileReady,this,r,null,_)),Dt(_,d),this._tiles[p]={el:_,coords:r,current:!0},l.appendChild(_),this.fire("tileloadstart",{tile:_,coords:r})},_tileReady:function(r,l,d){l&&this.fire("tileerror",{error:l,tile:d,coords:r});var p=this._tileCoordsToKey(r);d=this._tiles[p],d&&(d.loaded=+new Date,this._map._fadeAnimated?(_e(d.el,0),Pt(this._fadeFrame),this._fadeFrame=Nt(this._updateOpacity,this)):(d.active=!0,this._pruneTiles()),l||(st(d.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:d.el,coords:r})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),G.ielt9||!this._map._fadeAnimated?Nt(this._pruneTiles,this):setTimeout(a(this._pruneTiles,this),250)))},_getTilePos:function(r){return r.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(r){var l=new tt(this._wrapX?h(r.x,this._wrapX):r.x,this._wrapY?h(r.y,this._wrapY):r.y);return l.z=r.z,l},_pxBoundsToTileRange:function(r){var l=this.getTileSize();return new bt(r.min.unscaleBy(l).floor(),r.max.unscaleBy(l).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var r in this._tiles)if(!this._tiles[r].loaded)return!1;return!0}});function Lp(r){return new Ii(r)}var Xn=Ii.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(r,l){this._url=r,l=b(this,l),l.detectRetina&&G.retina&&l.maxZoom>0?(l.tileSize=Math.floor(l.tileSize/2),l.zoomReverse?(l.zoomOffset--,l.minZoom=Math.min(l.maxZoom,l.minZoom+1)):(l.zoomOffset++,l.maxZoom=Math.max(l.minZoom,l.maxZoom-1)),l.minZoom=Math.max(0,l.minZoom)):l.zoomReverse?l.minZoom=Math.min(l.maxZoom,l.minZoom):l.maxZoom=Math.max(l.minZoom,l.maxZoom),typeof l.subdomains=="string"&&(l.subdomains=l.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(r,l){return this._url===r&&l===void 0&&(l=!0),this._url=r,l||this.redraw(),this},createTile:function(r,l){var d=document.createElement("img");return rt(d,"load",a(this._tileOnLoad,this,l,d)),rt(d,"error",a(this._tileOnError,this,l,d)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(d.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(d.referrerPolicy=this.options.referrerPolicy),d.alt="",d.src=this.getTileUrl(r),d},getTileUrl:function(r){var l={r:G.retina?"@2x":"",s:this._getSubdomain(r),x:r.x,y:r.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var d=this._globalTileRange.max.y-r.y;this.options.tms&&(l.y=d),l["-y"]=d}return P(this._url,s(l,this.options))},_tileOnLoad:function(r,l){G.ielt9?setTimeout(a(r,this,null,l),0):r(null,l)},_tileOnError:function(r,l,d){var p=this.options.errorTileUrl;p&&l.getAttribute("src")!==p&&(l.src=p),r(d,l)},_onTileRemove:function(r){r.tile.onload=null},_getZoomForUrl:function(){var r=this._tileZoom,l=this.options.maxZoom,d=this.options.zoomReverse,p=this.options.zoomOffset;return d&&(r=l-r),r+p},_getSubdomain:function(r){var l=Math.abs(r.x+r.y)%this.options.subdomains.length;return this.options.subdomains[l]},_abortLoading:function(){var r,l;for(r in this._tiles)if(this._tiles[r].coords.z!==this._tileZoom&&(l=this._tiles[r].el,l.onload=m,l.onerror=m,!l.complete)){l.src=$;var d=this._tiles[r].coords;wt(l),delete this._tiles[r],this.fire("tileabort",{tile:l,coords:d})}},_removeTile:function(r){var l=this._tiles[r];if(l)return l.el.setAttribute("src",$),Ii.prototype._removeTile.call(this,r)},_tileReady:function(r,l,d){if(!(!this._map||d&&d.getAttribute("src")===$))return Ii.prototype._tileReady.call(this,r,l,d)}});function tc(r,l){return new Xn(r,l)}var ec=Xn.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(r,l){this._url=r;var d=s({},this.defaultWmsParams);for(var p in l)p in this.options||(d[p]=l[p]);l=b(this,l);var _=l.detectRetina&&G.retina?2:1,k=this.getTileSize();d.width=k.x*_,d.height=k.y*_,this.wmsParams=d},onAdd:function(r){this._crs=this.options.crs||r.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var l=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[l]=this._crs.code,Xn.prototype.onAdd.call(this,r)},getTileUrl:function(r){var l=this._tileCoordsToNwSe(r),d=this._crs,p=Yt(d.project(l[0]),d.project(l[1])),_=p.min,k=p.max,T=(this._wmsVersion>=1.3&&this._crs===ql?[_.y,_.x,k.y,k.x]:[_.x,_.y,k.x,k.y]).join(","),E=Xn.prototype.getTileUrl.call(this,r);return E+S(this.wmsParams,E,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+T},setParams:function(r,l){return s(this.wmsParams,r),l||this.redraw(),this}});function Ip(r,l){return new ec(r,l)}Xn.WMS=ec,tc.wms=Ip;var je=Ce.extend({options:{padding:.1},initialize:function(r){b(this,r),u(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),st(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var r={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(r.zoomanim=this._onAnimZoom),r},_onAnimZoom:function(r){this._updateTransform(r.center,r.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(r,l){var d=this._map.getZoomScale(l,this._zoom),p=this._map.getSize().multiplyBy(.5+this.options.padding),_=this._map.project(this._center,l),k=p.multiplyBy(-d).add(_).subtract(this._map._getNewPixelOrigin(r,l));G.any3d?kn(this._container,k,d):Dt(this._container,k)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var r in this._layers)this._layers[r]._reset()},_onZoomEnd:function(){for(var r in this._layers)this._layers[r]._project()},_updatePaths:function(){for(var r in this._layers)this._layers[r]._update()},_update:function(){var r=this.options.padding,l=this._map.getSize(),d=this._map.containerPointToLayerPoint(l.multiplyBy(-r)).round();this._bounds=new bt(d,d.add(l.multiplyBy(1+r*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),nc=je.extend({options:{tolerance:0},getEvents:function(){var r=je.prototype.getEvents.call(this);return r.viewprereset=this._onViewPreReset,r},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){je.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var r=this._container=document.createElement("canvas");rt(r,"mousemove",this._onMouseMove,this),rt(r,"click dblclick mousedown mouseup contextmenu",this._onClick,this),rt(r,"mouseout",this._handleMouseOut,this),r._leaflet_disable_events=!0,this._ctx=r.getContext("2d")},_destroyContainer:function(){Pt(this._redrawRequest),delete this._ctx,wt(this._container),vt(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var r;this._redrawBounds=null;for(var l in this._layers)r=this._layers[l],r._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){je.prototype._update.call(this);var r=this._bounds,l=this._container,d=r.getSize(),p=G.retina?2:1;Dt(l,r.min),l.width=p*d.x,l.height=p*d.y,l.style.width=d.x+"px",l.style.height=d.y+"px",G.retina&&this._ctx.scale(2,2),this._ctx.translate(-r.min.x,-r.min.y),this.fire("update")}},_reset:function(){je.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(r){this._updateDashArray(r),this._layers[u(r)]=r;var l=r._order={layer:r,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=l),this._drawLast=l,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(r){this._requestRedraw(r)},_removePath:function(r){var l=r._order,d=l.next,p=l.prev;d?d.prev=p:this._drawLast=p,p?p.next=d:this._drawFirst=d,delete r._order,delete this._layers[u(r)],this._requestRedraw(r)},_updatePath:function(r){this._extendRedrawBounds(r),r._project(),r._update(),this._requestRedraw(r)},_updateStyle:function(r){this._updateDashArray(r),this._requestRedraw(r)},_updateDashArray:function(r){if(typeof r.options.dashArray=="string"){var l=r.options.dashArray.split(/[, ]+/),d=[],p,_;for(_=0;_<l.length;_++){if(p=Number(l[_]),isNaN(p))return;d.push(p)}r.options._dashArray=d}else r.options._dashArray=r.options.dashArray},_requestRedraw:function(r){this._map&&(this._extendRedrawBounds(r),this._redrawRequest=this._redrawRequest||Nt(this._redraw,this))},_extendRedrawBounds:function(r){if(r._pxBounds){var l=(r.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new bt,this._redrawBounds.extend(r._pxBounds.min.subtract([l,l])),this._redrawBounds.extend(r._pxBounds.max.add([l,l]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var r=this._redrawBounds;if(r){var l=r.getSize();this._ctx.clearRect(r.min.x,r.min.y,l.x,l.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var r,l=this._redrawBounds;if(this._ctx.save(),l){var d=l.getSize();this._ctx.beginPath(),this._ctx.rect(l.min.x,l.min.y,d.x,d.y),this._ctx.clip()}this._drawing=!0;for(var p=this._drawFirst;p;p=p.next)r=p.layer,(!l||r._pxBounds&&r._pxBounds.intersects(l))&&r._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(r,l){if(this._drawing){var d,p,_,k,T=r._parts,E=T.length,O=this._ctx;if(E){for(O.beginPath(),d=0;d<E;d++){for(p=0,_=T[d].length;p<_;p++)k=T[d][p],O[p?"lineTo":"moveTo"](k.x,k.y);l&&O.closePath()}this._fillStroke(O,r)}}},_updateCircle:function(r){if(!(!this._drawing||r._empty())){var l=r._point,d=this._ctx,p=Math.max(Math.round(r._radius),1),_=(Math.max(Math.round(r._radiusY),1)||p)/p;_!==1&&(d.save(),d.scale(1,_)),d.beginPath(),d.arc(l.x,l.y/_,p,0,Math.PI*2,!1),_!==1&&d.restore(),this._fillStroke(d,r)}},_fillStroke:function(r,l){var d=l.options;d.fill&&(r.globalAlpha=d.fillOpacity,r.fillStyle=d.fillColor||d.color,r.fill(d.fillRule||"evenodd")),d.stroke&&d.weight!==0&&(r.setLineDash&&r.setLineDash(l.options&&l.options._dashArray||[]),r.globalAlpha=d.opacity,r.lineWidth=d.weight,r.strokeStyle=d.color,r.lineCap=d.lineCap,r.lineJoin=d.lineJoin,r.stroke())},_onClick:function(r){for(var l=this._map.mouseEventToLayerPoint(r),d,p,_=this._drawFirst;_;_=_.next)d=_.layer,d.options.interactive&&d._containsPoint(l)&&(!(r.type==="click"||r.type==="preclick")||!this._map._draggableMoved(d))&&(p=d);this._fireEvent(p?[p]:!1,r)},_onMouseMove:function(r){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var l=this._map.mouseEventToLayerPoint(r);this._handleMouseHover(r,l)}},_handleMouseOut:function(r){var l=this._hoveredLayer;l&&(Ot(this._container,"leaflet-interactive"),this._fireEvent([l],r,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(r,l){if(!this._mouseHoverThrottled){for(var d,p,_=this._drawFirst;_;_=_.next)d=_.layer,d.options.interactive&&d._containsPoint(l)&&(p=d);p!==this._hoveredLayer&&(this._handleMouseOut(r),p&&(st(this._container,"leaflet-interactive"),this._fireEvent([p],r,"mouseover"),this._hoveredLayer=p)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,r),this._mouseHoverThrottled=!0,setTimeout(a(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(r,l,d){this._map._fireDOMEvent(l,d||l.type,r)},_bringToFront:function(r){var l=r._order;if(l){var d=l.next,p=l.prev;if(d)d.prev=p;else return;p?p.next=d:d&&(this._drawFirst=d),l.prev=this._drawLast,this._drawLast.next=l,l.next=null,this._drawLast=l,this._requestRedraw(r)}},_bringToBack:function(r){var l=r._order;if(l){var d=l.next,p=l.prev;if(p)p.next=d;else return;d?d.prev=p:p&&(this._drawLast=p),l.prev=null,l.next=this._drawFirst,this._drawFirst.prev=l,this._drawFirst=l,this._requestRedraw(r)}}});function ic(r){return G.canvas?new nc(r):null}var Ni=(function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(r){return document.createElement("<lvml:"+r+' class="lvml">')}}catch{}return function(r){return document.createElement("<"+r+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}})(),Np={_initContainer:function(){this._container=ht("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(je.prototype._update.call(this),this.fire("update"))},_initPath:function(r){var l=r._container=Ni("shape");st(l,"leaflet-vml-shape "+(this.options.className||"")),l.coordsize="1 1",r._path=Ni("path"),l.appendChild(r._path),this._updateStyle(r),this._layers[u(r)]=r},_addPath:function(r){var l=r._container;this._container.appendChild(l),r.options.interactive&&r.addInteractiveTarget(l)},_removePath:function(r){var l=r._container;wt(l),r.removeInteractiveTarget(l),delete this._layers[u(r)]},_updateStyle:function(r){var l=r._stroke,d=r._fill,p=r.options,_=r._container;_.stroked=!!p.stroke,_.filled=!!p.fill,p.stroke?(l||(l=r._stroke=Ni("stroke")),_.appendChild(l),l.weight=p.weight+"px",l.color=p.color,l.opacity=p.opacity,p.dashArray?l.dashStyle=D(p.dashArray)?p.dashArray.join(" "):p.dashArray.replace(/( *, *)/g," "):l.dashStyle="",l.endcap=p.lineCap.replace("butt","flat"),l.joinstyle=p.lineJoin):l&&(_.removeChild(l),r._stroke=null),p.fill?(d||(d=r._fill=Ni("fill")),_.appendChild(d),d.color=p.fillColor||p.color,d.opacity=p.fillOpacity):d&&(_.removeChild(d),r._fill=null)},_updateCircle:function(r){var l=r._point.round(),d=Math.round(r._radius),p=Math.round(r._radiusY||d);this._setPath(r,r._empty()?"M0 0":"AL "+l.x+","+l.y+" "+d+","+p+" 0,"+65535*360)},_setPath:function(r,l){r._path.v=l},_bringToFront:function(r){Un(r._container)},_bringToBack:function(r){qn(r._container)}},Mr=G.vml?Ni:al,Di=je.extend({_initContainer:function(){this._container=Mr("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Mr("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){wt(this._container),vt(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){je.prototype._update.call(this);var r=this._bounds,l=r.getSize(),d=this._container;(!this._svgSize||!this._svgSize.equals(l))&&(this._svgSize=l,d.setAttribute("width",l.x),d.setAttribute("height",l.y)),Dt(d,r.min),d.setAttribute("viewBox",[r.min.x,r.min.y,l.x,l.y].join(" ")),this.fire("update")}},_initPath:function(r){var l=r._path=Mr("path");r.options.className&&st(l,r.options.className),r.options.interactive&&st(l,"leaflet-interactive"),this._updateStyle(r),this._layers[u(r)]=r},_addPath:function(r){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(r._path),r.addInteractiveTarget(r._path)},_removePath:function(r){wt(r._path),r.removeInteractiveTarget(r._path),delete this._layers[u(r)]},_updatePath:function(r){r._project(),r._update()},_updateStyle:function(r){var l=r._path,d=r.options;l&&(d.stroke?(l.setAttribute("stroke",d.color),l.setAttribute("stroke-opacity",d.opacity),l.setAttribute("stroke-width",d.weight),l.setAttribute("stroke-linecap",d.lineCap),l.setAttribute("stroke-linejoin",d.lineJoin),d.dashArray?l.setAttribute("stroke-dasharray",d.dashArray):l.removeAttribute("stroke-dasharray"),d.dashOffset?l.setAttribute("stroke-dashoffset",d.dashOffset):l.removeAttribute("stroke-dashoffset")):l.setAttribute("stroke","none"),d.fill?(l.setAttribute("fill",d.fillColor||d.color),l.setAttribute("fill-opacity",d.fillOpacity),l.setAttribute("fill-rule",d.fillRule||"evenodd")):l.setAttribute("fill","none"))},_updatePoly:function(r,l){this._setPath(r,ll(r._parts,l))},_updateCircle:function(r){var l=r._point,d=Math.max(Math.round(r._radius),1),p=Math.max(Math.round(r._radiusY),1)||d,_="a"+d+","+p+" 0 1,0 ",k=r._empty()?"M0 0":"M"+(l.x-d)+","+l.y+_+d*2+",0 "+_+-d*2+",0 ";this._setPath(r,k)},_setPath:function(r,l){r._path.setAttribute("d",l)},_bringToFront:function(r){Un(r._path)},_bringToBack:function(r){qn(r._path)}});G.vml&&Di.include(Np);function rc(r){return G.svg||G.vml?new Di(r):null}dt.include({getRenderer:function(r){var l=r.options.renderer||this._getPaneRenderer(r.options.pane)||this.options.renderer||this._renderer;return l||(l=this._renderer=this._createRenderer()),this.hasLayer(l)||this.addLayer(l),l},_getPaneRenderer:function(r){if(r==="overlayPane"||r===void 0)return!1;var l=this._paneRenderers[r];return l===void 0&&(l=this._createRenderer({pane:r}),this._paneRenderers[r]=l),l},_createRenderer:function(r){return this.options.preferCanvas&&ic(r)||rc(r)}});var sc=Gn.extend({initialize:function(r,l){Gn.prototype.initialize.call(this,this._boundsToLatLngs(r),l)},setBounds:function(r){return this.setLatLngs(this._boundsToLatLngs(r))},_boundsToLatLngs:function(r){return r=Et(r),[r.getSouthWest(),r.getNorthWest(),r.getNorthEast(),r.getSouthEast()]}});function Dp(r,l){return new sc(r,l)}Di.create=Mr,Di.pointsToPath=ll,We.geometryToLayer=vr,We.coordsToLatLng=co,We.coordsToLatLngs=br,We.latLngToCoords=uo,We.latLngsToCoords=xr,We.getFeature=Yn,We.asFeature=kr,dt.mergeOptions({boxZoom:!0});var oc=Ne.extend({initialize:function(r){this._map=r,this._container=r._container,this._pane=r._panes.overlayPane,this._resetStateTimeout=0,r.on("unload",this._destroy,this)},addHooks:function(){rt(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){vt(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){wt(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(r){if(!r.shiftKey||r.which!==1&&r.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),Mi(),Us(),this._startPoint=this._map.mouseEventToContainerPoint(r),rt(document,{contextmenu:Cn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(r){this._moved||(this._moved=!0,this._box=ht("div","leaflet-zoom-box",this._container),st(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(r);var l=new bt(this._point,this._startPoint),d=l.getSize();Dt(this._box,l.min),this._box.style.width=d.x+"px",this._box.style.height=d.y+"px"},_finish:function(){this._moved&&(wt(this._box),Ot(this._container,"leaflet-crosshair")),Ti(),qs(),vt(document,{contextmenu:Cn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(r){if(!(r.which!==1&&r.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(a(this._resetState,this),0);var l=new Q(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(l).fire("boxzoomend",{boxZoomBounds:l})}},_onKeyDown:function(r){r.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});dt.addInitHook("addHandler","boxZoom",oc),dt.mergeOptions({doubleClickZoom:!0});var ac=Ne.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(r){var l=this._map,d=l.getZoom(),p=l.options.zoomDelta,_=r.originalEvent.shiftKey?d-p:d+p;l.options.doubleClickZoom==="center"?l.setZoom(_):l.setZoomAround(r.containerPoint,_)}});dt.addInitHook("addHandler","doubleClickZoom",ac),dt.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var lc=Ne.extend({addHooks:function(){if(!this._draggable){var r=this._map;this._draggable=new rn(r._mapPane,r._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),r.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),r.on("zoomend",this._onZoomEnd,this),r.whenReady(this._onZoomEnd,this))}st(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Ot(this._map._container,"leaflet-grab"),Ot(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var r=this._map;if(r._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var l=Et(this._map.options.maxBounds);this._offsetLimit=Yt(this._map.latLngToContainerPoint(l.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(l.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;r.fire("movestart").fire("dragstart"),r.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(r){if(this._map.options.inertia){var l=this._lastTime=+new Date,d=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(d),this._times.push(l),this._prunePositions(l)}this._map.fire("move",r).fire("drag",r)},_prunePositions:function(r){for(;this._positions.length>1&&r-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var r=this._map.getSize().divideBy(2),l=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=l.subtract(r).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(r,l){return r-(r-l)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var r=this._draggable._newPos.subtract(this._draggable._startPos),l=this._offsetLimit;r.x<l.min.x&&(r.x=this._viscousLimit(r.x,l.min.x)),r.y<l.min.y&&(r.y=this._viscousLimit(r.y,l.min.y)),r.x>l.max.x&&(r.x=this._viscousLimit(r.x,l.max.x)),r.y>l.max.y&&(r.y=this._viscousLimit(r.y,l.max.y)),this._draggable._newPos=this._draggable._startPos.add(r)}},_onPreDragWrap:function(){var r=this._worldWidth,l=Math.round(r/2),d=this._initialWorldOffset,p=this._draggable._newPos.x,_=(p-l+d)%r+l-d,k=(p+l+d)%r-l-d,T=Math.abs(_+d)<Math.abs(k+d)?_:k;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=T},_onDragEnd:function(r){var l=this._map,d=l.options,p=!d.inertia||r.noInertia||this._times.length<2;if(l.fire("dragend",r),p)l.fire("moveend");else{this._prunePositions(+new Date);var _=this._lastPos.subtract(this._positions[0]),k=(this._lastTime-this._times[0])/1e3,T=d.easeLinearity,E=_.multiplyBy(T/k),O=E.distanceTo([0,0]),R=Math.min(d.inertiaMaxSpeed,O),H=E.multiplyBy(R/O),et=R/(d.inertiaDeceleration*T),ot=H.multiplyBy(-et/2).round();!ot.x&&!ot.y?l.fire("moveend"):(ot=l._limitOffset(ot,l.options.maxBounds),Nt(function(){l.panBy(ot,{duration:et,easeLinearity:T,noMoveStart:!0,animate:!0})}))}}});dt.addInitHook("addHandler","dragging",lc),dt.mergeOptions({keyboard:!0,keyboardPanDelta:80});var cc=Ne.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(r){this._map=r,this._setPanDelta(r.options.keyboardPanDelta),this._setZoomDelta(r.options.zoomDelta)},addHooks:function(){var r=this._map._container;r.tabIndex<=0&&(r.tabIndex="0"),rt(r,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),vt(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var r=document.body,l=document.documentElement,d=r.scrollTop||l.scrollTop,p=r.scrollLeft||l.scrollLeft;this._map._container.focus(),window.scrollTo(p,d)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(r){var l=this._panKeys={},d=this.keyCodes,p,_;for(p=0,_=d.left.length;p<_;p++)l[d.left[p]]=[-1*r,0];for(p=0,_=d.right.length;p<_;p++)l[d.right[p]]=[r,0];for(p=0,_=d.down.length;p<_;p++)l[d.down[p]]=[0,r];for(p=0,_=d.up.length;p<_;p++)l[d.up[p]]=[0,-1*r]},_setZoomDelta:function(r){var l=this._zoomKeys={},d=this.keyCodes,p,_;for(p=0,_=d.zoomIn.length;p<_;p++)l[d.zoomIn[p]]=r;for(p=0,_=d.zoomOut.length;p<_;p++)l[d.zoomOut[p]]=-r},_addHooks:function(){rt(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){vt(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(r){if(!(r.altKey||r.ctrlKey||r.metaKey)){var l=r.keyCode,d=this._map,p;if(l in this._panKeys){if(!d._panAnim||!d._panAnim._inProgress)if(p=this._panKeys[l],r.shiftKey&&(p=nt(p).multiplyBy(3)),d.options.maxBounds&&(p=d._limitOffset(nt(p),d.options.maxBounds)),d.options.worldCopyJump){var _=d.wrapLatLng(d.unproject(d.project(d.getCenter()).add(p)));d.panTo(_)}else d.panBy(p)}else if(l in this._zoomKeys)d.setZoom(d.getZoom()+(r.shiftKey?3:1)*this._zoomKeys[l]);else if(l===27&&d._popup&&d._popup.options.closeOnEscapeKey)d.closePopup();else return;Cn(r)}}});dt.addInitHook("addHandler","keyboard",cc),dt.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var uc=Ne.extend({addHooks:function(){rt(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){vt(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(r){var l=Nl(r),d=this._map.options.wheelDebounceTime;this._delta+=l,this._lastMousePos=this._map.mouseEventToContainerPoint(r),this._startTime||(this._startTime=+new Date);var p=Math.max(d-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(a(this._performZoom,this),p),Cn(r)},_performZoom:function(){var r=this._map,l=r.getZoom(),d=this._map.options.zoomSnap||0;r._stop();var p=this._delta/(this._map.options.wheelPxPerZoomLevel*4),_=4*Math.log(2/(1+Math.exp(-Math.abs(p))))/Math.LN2,k=d?Math.ceil(_/d)*d:_,T=r._limitZoom(l+(this._delta>0?k:-k))-l;this._delta=0,this._startTime=null,T&&(r.options.scrollWheelZoom==="center"?r.setZoom(l+T):r.setZoomAround(this._lastMousePos,l+T))}});dt.addInitHook("addHandler","scrollWheelZoom",uc);var zp=600;dt.mergeOptions({tapHold:G.touchNative&&G.safari&&G.mobile,tapTolerance:15});var dc=Ne.extend({addHooks:function(){rt(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){vt(this._map._container,"touchstart",this._onDown,this)},_onDown:function(r){if(clearTimeout(this._holdTimeout),r.touches.length===1){var l=r.touches[0];this._startPos=this._newPos=new tt(l.clientX,l.clientY),this._holdTimeout=setTimeout(a(function(){this._cancel(),this._isTapValid()&&(rt(document,"touchend",qt),rt(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",l))},this),zp),rt(document,"touchend touchcancel contextmenu",this._cancel,this),rt(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function r(){vt(document,"touchend",qt),vt(document,"touchend touchcancel",r)},_cancel:function(){clearTimeout(this._holdTimeout),vt(document,"touchend touchcancel contextmenu",this._cancel,this),vt(document,"touchmove",this._onMove,this)},_onMove:function(r){var l=r.touches[0];this._newPos=new tt(l.clientX,l.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(r,l){var d=new MouseEvent(r,{bubbles:!0,cancelable:!0,view:window,screenX:l.screenX,screenY:l.screenY,clientX:l.clientX,clientY:l.clientY});d._simulated=!0,l.target.dispatchEvent(d)}});dt.addInitHook("addHandler","tapHold",dc),dt.mergeOptions({touchZoom:G.touch,bounceAtZoomLimits:!0});var fc=Ne.extend({addHooks:function(){st(this._map._container,"leaflet-touch-zoom"),rt(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Ot(this._map._container,"leaflet-touch-zoom"),vt(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(r){var l=this._map;if(!(!r.touches||r.touches.length!==2||l._animatingZoom||this._zooming)){var d=l.mouseEventToContainerPoint(r.touches[0]),p=l.mouseEventToContainerPoint(r.touches[1]);this._centerPoint=l.getSize()._divideBy(2),this._startLatLng=l.containerPointToLatLng(this._centerPoint),l.options.touchZoom!=="center"&&(this._pinchStartLatLng=l.containerPointToLatLng(d.add(p)._divideBy(2))),this._startDist=d.distanceTo(p),this._startZoom=l.getZoom(),this._moved=!1,this._zooming=!0,l._stop(),rt(document,"touchmove",this._onTouchMove,this),rt(document,"touchend touchcancel",this._onTouchEnd,this),qt(r)}},_onTouchMove:function(r){if(!(!r.touches||r.touches.length!==2||!this._zooming)){var l=this._map,d=l.mouseEventToContainerPoint(r.touches[0]),p=l.mouseEventToContainerPoint(r.touches[1]),_=d.distanceTo(p)/this._startDist;if(this._zoom=l.getScaleZoom(_,this._startZoom),!l.options.bounceAtZoomLimits&&(this._zoom<l.getMinZoom()&&_<1||this._zoom>l.getMaxZoom()&&_>1)&&(this._zoom=l._limitZoom(this._zoom)),l.options.touchZoom==="center"){if(this._center=this._startLatLng,_===1)return}else{var k=d._add(p)._divideBy(2)._subtract(this._centerPoint);if(_===1&&k.x===0&&k.y===0)return;this._center=l.unproject(l.project(this._pinchStartLatLng,this._zoom).subtract(k),this._zoom)}this._moved||(l._moveStart(!0,!1),this._moved=!0),Pt(this._animRequest);var T=a(l._move,l,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=Nt(T,this,!0),qt(r)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,Pt(this._animRequest),vt(document,"touchmove",this._onTouchMove,this),vt(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});dt.addInitHook("addHandler","touchZoom",fc),dt.BoxZoom=oc,dt.DoubleClickZoom=ac,dt.Drag=lc,dt.Keyboard=cc,dt.ScrollWheelZoom=uc,dt.TapHold=dc,dt.TouchZoom=fc,e.Bounds=bt,e.Browser=G,e.CRS=Ve,e.Canvas=nc,e.Circle=lo,e.CircleMarker=yr,e.Class=he,e.Control=Se,e.DivIcon=Ql,e.DivOverlay=De,e.DomEvent=tp,e.DomUtil=Xh,e.Draggable=rn,e.Evented=pt,e.FeatureGroup=He,e.GeoJSON=We,e.GridLayer=Ii,e.Handler=Ne,e.Icon=Jn,e.ImageOverlay=wr,e.LatLng=_t,e.LatLngBounds=Q,e.Layer=Ce,e.LayerGroup=Kn,e.LineUtil=hp,e.Map=dt,e.Marker=_r,e.Mixin=ap,e.Path=sn,e.Point=tt,e.PolyUtil=lp,e.Polygon=Gn,e.Polyline=Ze,e.Popup=Sr,e.PosAnimation=Dl,e.Projection=pp,e.Rectangle=sc,e.Renderer=je,e.SVG=Di,e.SVGOverlay=Xl,e.TileLayer=Xn,e.Tooltip=Cr,e.Transformation=Ns,e.Util=Wn,e.VideoOverlay=Yl,e.bind=a,e.bounds=Yt,e.canvas=ic,e.circle=kp,e.circleMarker=xp,e.control=Oi,e.divIcon=Ap,e.extend=s,e.featureGroup=yp,e.geoJSON=Gl,e.geoJson=Cp,e.gridLayer=Lp,e.icon=vp,e.imageOverlay=Mp,e.latLng=ut,e.latLngBounds=Et,e.layerGroup=_p,e.map=ep,e.marker=bp,e.point=nt,e.polygon=Sp,e.polyline=wp,e.popup=Ep,e.rectangle=Dp,e.setOptions=b,e.stamp=u,e.svg=rc,e.svgOverlay=Pp,e.tileLayer=tc,e.tooltip=Op,e.transformation=ki,e.version=i,e.videoOverlay=Tp;var Rp=window.L;e.noConflict=function(){return window.L=Rp,this},window.L=e}))})(Fi,Fi.exports)),Fi.exports}var vh=uk();const dk=lm(vh),fk=og({__proto__:null,default:dk},[vh]),hk={class:"relative overflow-hidden w-full aspect-video"},pk={class:"flex gap-2 p-2 absolute bottom-0 left-1/2 -translate-x-1/2"},sl=ct({__name:"map.client",props:{zoom:{default:15},controls:{type:Boolean,default:!0},gpxFile:{}},emits:["ready"],async setup(n,{emit:t}){let e,i;const s=([e,i]=gc(()=>_c(()=>Promise.resolve().then(()=>fk),void 0,import.meta.url)),e=await e,i(),e).default;[e,i]=gc(()=>_c(()=>import("./TgcNmIV-.js"),[],import.meta.url)),await e,i();let o;const a=t,c=n,u=Z(!1),f=Z(null),h=()=>{o?.setZoom(o.getZoom()+1)},m=()=>{o?.setZoom(o.getZoom()-1)},g=()=>{a("ready",s,o),u.value=!0},y=()=>{f.value&&(o=s.map(f.value,{worldCopyJump:!0,scrollWheelZoom:!1,minZoom:3,zoomControl:!1}).whenReady(g),s.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'<a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors'}).addTo(o),c.gpxFile&&new L.GPX(c.gpxFile,{async:!0,polyline_options:{color:"#f06723",weight:3},marker_options:{endIconUrl:"leaf-green.png",startIconUrl:"leaf-red.png",wptIcons:{}}}).on("loaded",v=>{v.target.getBounds(),o.fitBounds(v.target.getBounds())}).on("layeradd",v=>{console.log(v.layer._layers)}).addTo(o))};return ce(()=>c.gpxFile,()=>{y()}),te(async()=>{y()}),(v,b)=>{const S=Lt;return I(),W("div",hk,[A("div",{class:"bg-white w-full h-full rounded-md",ref_key:"mapEl",ref:f},null,512),A("div",pk,[x(S,{variant:"secondary",size:"icon",onClick:h},{default:C(()=>[x(w(ds))]),_:1}),x(S,{variant:"secondary",size:"icon",onClick:m},{default:C(()=>[x(w(qu))]),_:1})])])}}}),mk=da(sl),gk={class:"flex flex-wrap gap-2 items-center"},_k={class:"flex gap-2"},yk={class:"w-full text-center block p-3 border border-dashed rounded-md"},vk=ct({__name:"mapUpload",props:{trailRace:{}},emits:["update"],setup(n,{emit:t}){const e=n,{axios:i}=ge(),s=t,o=Z(!1),a=Z(!1),c=Z(!1),u=Z(""),f=Z(null),h=g=>{const y=g.target.files??[];if(y?.length==0)return;const v=new FileReader,b=y[0];v.onload=()=>{f.value=b.name,u.value=v.result},b&&v.readAsDataURL(b)},m=async()=>{a.value=!0,await i.put(`/events/${e.trailRace.id}/upload_map_file`,{file:u.value}),a.value=!1,s("update")};return te(()=>{e.trailRace.image_id||(c.value=!0)}),(g,y)=>{const v=Lt,b=tn,S=en,M=_n,P=mk,D=Qe,V=Xe;return I(),W(at,null,[A("div",gk,[y[3]||(y[3]=A("h2",{class:"text-xs uppercase grow mb-2"},"Upload map file",-1)),A("div",_k,[w(u)?(I(),j(v,{key:0,variant:"secondary",size:"sm",onClick:m,disabled:w(a),permissions:"event_edit"},{default:C(()=>[w(a)?(I(),j(w(Ye),{key:1,class:"animate-spin relative"})):(I(),j(w(_i),{key:0})),y[2]||(y[2]=N(" Save ",-1))]),_:1},8,["disabled"])):lt("",!0),x(v,{variant:"destructive",size:"icon",onClick:y[0]||(y[0]=$=>o.value=!0)},{default:C(()=>[x(w(fa))]),_:1})]),A("label",yk,[A("input",{type:"file",onChange:h,class:"hidden",accept:".gpx"},null,32),A("span",null,q(w(f)??"Upload .gpx file"),1)])]),x(V,{open:w(o),"onUpdate:open":y[1]||(y[1]=$=>o.value=!1)},{default:C(()=>[x(D,{class:"sm:max-w-[1000px]"},{default:C(()=>[x(M,null,{default:C(()=>[x(b,null,{default:C(()=>[...y[4]||(y[4]=[N("Map",-1)])]),_:1}),x(S,null,{default:C(()=>[...y[5]||(y[5]=[N("Some text",-1)])]),_:1})]),_:1}),x(P,{"map-id":"someId",center:[27.756846786775668,85.3124535214843],gpxFile:w(la)(n.trailRace.map_file?.file_name)},null,8,["gpxFile"])]),_:1})]),_:1},8,["open"])],64)}}}),oa=ca("stage",()=>{const n=Z([]),t=Z(!1),{axios:e}=ge();return{stages:n,isLoading:t,fetch:async a=>{t.value=!0;const{data:c}=await e.get(`/events/${a}/stages`);c&&(n.value=c),t.value=!1},save:async(a,c)=>{const u=c.id?"put":"post",f=c.id?`/events/stages/${c.id}`:`/events/${a}/stages`;await e[u](f,c)},destory:async a=>{await e.delete(`/events/stages/${a}`)}}}),bk={key:0,class:"w-full h-[480px] relative"},xk=["src"],kk={key:0,class:"w-full h-[480px]"},wk=["src"],Sk={class:"w-full flex flex-col gap-2 relative"},Ck={class:"py-4 px-4 flex border border-dashed rounded-sm"},Mk={class:"text-gray-700 flex-grow"},Tk={class:"text-right"},Pk=ct({__name:"form",props:{eventId:{},stage:{}},emits:["update"],setup(n,{emit:t}){const e=n,i=t,{save:s}=oa(),o=Z(!1),a=Z(""),c=Z(null),u=Z(),f=Z(),h=Z({thumbnail:!1}),m=async b=>{o.value=!0,await s(e.eventId,b),o.value=!1,i("update")},g=(b,S)=>{const M=b.target.files??[];if(M?.length==0)return;const P=new FileReader,D=M[0];P.onload=()=>{a.value=D.name,c.value&&c.value.setFieldValue(S,P.result)},D&&P.readAsDataURL(D)},y=b=>{c.value&&c.value.resetField(b)},v=()=>{c.value&&(c.value.setFieldValue("event_id",e.eventId),e.stage&&(c.value.setValues({id:e.stage.id,name:e.stage.name,excerpt:e.stage.excerpt,description:e.stage.description,location:e.stage.location,difficulty:e.stage.difficulty,distance:e.stage.distance,thumbnail:e.stage.thumbnail.file_name}),e.stage.thumbnail.file_name&&(h.value.thumbnail=!0)))};return ce(u,()=>{c.value&&c.value.setFieldValue("start",`${u.value.year}-${u.value.month}-${u.value.day}`)}),ce(f,()=>{c.value&&c.value.setFieldValue("end",`${f.value.year}-${f.value.month}-${f.value.day}`)}),ce(c,()=>{v()}),ua(()=>{c.value&&v()}),(b,S)=>{const M=Lt,P=yi,D=fs,V=Ku,$=rl;return I(),j(w(vi),{onSubmit:m,"validation-schema":w(cm),class:"flex flex-col gap-4 relative",ref_key:"form",ref:c},{default:C(({values:U})=>[w(h).thumbnail?(I(),W("div",bk,[A("img",{src:w(gi)(n.stage?.thumbnail.file_name),class:"size-full object-cover"},null,8,xk),x(M,{onClick:S[0]||(S[0]=K=>w(h).thumbnail=!1),class:"absolute top-2 right-2"},{default:C(()=>[...S[4]||(S[4]=[N("change image",-1)])]),_:1})])):(I(),W(at,{key:1},[U.thumbnail?(I(),W("div",kk,[A("img",{src:U.thumbnail,class:"size-full object-cover"},null,8,wk),x(M,{onClick:S[1]||(S[1]=K=>w(h).thumbnail=!0),class:"absolute top-2 right-2"},{default:C(()=>[...S[5]||(S[5]=[N("cancel",-1)])]),_:1})])):lt("",!0),A("div",Sk,[A("label",Ck,[A("input",{type:"file",onChange:S[2]||(S[2]=K=>g(K,"thumbnail")),accept:".jpg, .jpeg, .png, image/jpeg, image/png",class:"hidden"},null,32),A("span",Mk,q(w(a)?w(a):"Upload image file"),1)]),w(a)?(I(),j(M,{key:0,type:"button",onClick:S[3]||(S[3]=()=>{y("thumbnail"),a.value=""}),size:"icon",modifier:"outline",class:"absolute top-1/2 right-2 -translate-y-1/2"},{default:C(()=>[x(w(us))]),_:1})):lt("",!0),x(w(Mt),{name:"thumbnail"})])],64)),x(w(gt),{name:"event_id",as:"div",class:"flex flex-col gap-2"},{default:C(({field:K})=>[x(P,Ct({type:"hidden"},K,{id:"esf__name"}),null,16)]),_:1}),x(w(gt),{name:"id",as:"div",class:"flex flex-col gap-2"},{default:C(({field:K})=>[x(P,Ct({type:"hidden"},K,{id:"esf__id"}),null,16)]),_:1}),x(w(gt),{name:"name",as:"div",class:"flex flex-col gap-2"},{default:C(({field:K})=>[x(D,{for:"esf__name"},{default:C(()=>[...S[6]||(S[6]=[N("Name",-1)])]),_:1}),x(P,Ct(K,{id:"esf__name"}),null,16),x(w(Mt),{name:"name"})]),_:1}),x(w(gt),{name:"excerpt",as:"div",class:"flex flex-col gap-2"},{default:C(({field:K})=>[x(D,{for:"esf__excerpt"},{default:C(()=>[...S[7]||(S[7]=[N("Excerpt",-1)])]),_:1}),x(V,Ct(K,{id:"esf__excerpt"}),null,16),x(w(Mt),{name:"excerpt"})]),_:1}),x(w(gt),{name:"location",as:"div",class:"flex flex-col gap-2"},{default:C(({field:K})=>[x(D,{for:"esf__location"},{default:C(()=>[...S[8]||(S[8]=[N("Location",-1)])]),_:1}),x(P,Ct(K,{id:"esf__location"}),null,16),x(w(Mt),{name:"location"})]),_:1}),x(w(gt),{name:"description",as:"div",class:"flex flex-col gap-2"},{default:C(({value:K,handleChange:B})=>[x($,{"model-value":K??"","onUpdate:modelValue":B,disabled:!1,timer:1e3},null,8,["model-value","onUpdate:modelValue"])]),_:1}),A("div",Tk,[x(M,{type:"submit",disabled:w(o)},{default:C(()=>[w(o)?(I(),j(w(Ye),{key:0,class:"animate-spin"})):(I(),j(w(_i),{key:1})),S[9]||(S[9]=N(" Save ",-1))]),_:1},8,["disabled"])])]),_:1},8,["validation-schema"])}}}),Ek=da(sl),Ok={class:"flex gap-4"},Ak={class:"flex flex-col gap-2 relative"},Lk={class:"py-4 px-4 flex border border-dashed rounded-sm"},Ik={class:"text-gray-700 flex-grow"},Nk={class:"text-right"},Dk=ct({__name:"Form",props:{stageId:{},category:{}},emits:["update"],setup(n,{emit:t}){const e=t,i=n,{axios:s}=ge(),o=Z(!1),a=Z(),c=Z(""),u=Z(),f=Z(),h=Z({map:!1,thumbnail:!1}),m=async({id:v,...b})=>{o.value=!0;const S=v?"put":"post",M=v?`/events/${i.stageId}/stage_categories/${v}`:`/events/${i.stageId}/stage_categories`;await s[S](M,b),e("update"),o.value=!1},g=(v,b)=>{const S=v.target.files??[];if(S?.length==0)return;const M=new FileReader,P=S[0];M.onload=()=>{c.value=P.name,a.value&&a.value.setFieldValue(b,M.result)},P&&M.readAsDataURL(P)},y=v=>{a.value&&a.value.resetField(v)};return ce(u,()=>{a.value&&a.value.setFieldValue("start",`${u.value.year}-${u.value.month}-${u.value.day}`)}),ce(f,()=>{a.value&&a.value.setFieldValue("end",`${f.value.year}-${f.value.month}-${f.value.day}`)}),te(()=>{a.value&&(a.value.setFieldValue("stage_id",i.stageId),i.category&&(a.value.setValues({id:i.category.id,name:i.category.name,excerpt:i.category.excerpt,description:i.category.description,distance:i.category.distance,difficulty:i.category.difficulty,location:i.category.location,start:i.category.start,end:i.category.end}),i.category.start&&(a.value.setFieldValue("start",i.category.start),u.value=vc(Me(i.category.start).format("YYYY-MM-DD"))),i.category.end&&(a.value.setFieldValue("end",i.category.end),f.value=vc(Me(i.category.end).format("YYYY-MM-DD")))))}),(v,b)=>{const S=yi,M=fs,P=Ku,D=Um,V=ms,$=ps,U=_s,K=gs,B=hs,ft=rl,kt=Lt,Nt=qm,Pt=tn,Wn=en,he=Ek,xi=Qe,Ut=Xe;return I(),j(w(vi),{"validation-schema":w(um),onSubmit:m,class:"flex flex-col gap-4",ref_key:"form",ref:a},{default:C(()=>[x(w(gt),{name:"id"},{default:C(({field:pt})=>[x(S,Ct({type:"hidden"},pt),null,16)]),_:1}),x(w(gt),{name:"stage_id"},{default:C(({field:pt})=>[x(S,Ct({type:"hidden"},pt),null,16)]),_:1}),x(w(gt),{name:"name",as:"div",class:"flex flex-col gap-1"},{default:C(({field:pt})=>[x(M,{for:"scf__name"},{default:C(()=>[...b[4]||(b[4]=[N("Name",-1)])]),_:1}),x(S,po(mo(pt)),null,16),x(w(Mt),{name:"name"})]),_:1}),x(w(gt),{name:"excerpt",as:"div",class:"flex flex-col gap-1"},{default:C(({field:pt})=>[x(M,{for:"scf__excerpt"},{default:C(()=>[...b[5]||(b[5]=[N("Short description",-1)])]),_:1}),x(P,po(mo(pt)),null,16),x(w(Mt),{name:"excerpt"})]),_:1}),A("div",Ok,[x(w(gt),{name:"start",as:"div",class:"w-1/4 flex flex-col gap-2"},{default:C(()=>[x(M,{for:"ef__start"},{default:C(()=>[...b[6]||(b[6]=[N("Start Date",-1)])]),_:1}),x(D,{label:"Start date","model-value":w(u),"onUpdate:modelValue":b[0]||(b[0]=pt=>u.value=pt)},null,8,["model-value"]),x(w(Mt),{name:"start"})]),_:1}),x(w(gt),{name:"end",as:"div",class:"w-1/4 flex flex-col gap-2"},{default:C(()=>[x(M,{for:"ef__end"},{default:C(()=>[...b[7]||(b[7]=[N("End Date",-1)])]),_:1}),x(D,{label:"End date","min-value":w(u),"model-value":w(f),"onUpdate:modelValue":b[1]||(b[1]=pt=>f.value=pt)},null,8,["min-value","model-value"]),x(w(Mt),{name:"end"})]),_:1}),x(w(gt),{name:"difficulty",as:"div",class:"w-1/4 flex flex-col gap-2"},{default:C(({field:pt})=>[x(M,{for:"ef__difficulty"},{default:C(()=>[...b[8]||(b[8]=[N("Difficulty",-1)])]),_:1}),x(B,Ct(pt,{autocomplete:"sex","default-value":n.category?.difficulty}),{default:C(()=>[x($,{class:"w-full"},{default:C(()=>[x(V,{placeholder:"Select a difficulty"})]),_:1}),x(K,null,{default:C(()=>[(I(),W(at,null,At(["moderate","easy","difficult"],tt=>x(U,{value:tt},{default:C(()=>[N(q(tt),1)]),_:2},1032,["value"])),64))]),_:1})]),_:1},16,["default-value"]),x(w(Mt),{name:"difficulty"})]),_:1}),x(w(gt),{name:"distance",as:"div",class:"w-1/4 flex flex-col gap-2"},{default:C(({field:pt})=>[x(M,{for:"ef__distance"},{default:C(()=>[...b[9]||(b[9]=[N("Distance",-1)])]),_:1}),x(S,Ct(pt,{id:"ef__distance"}),null,16),x(w(Mt),{name:"distance"})]),_:1})]),x(w(gt),{name:"location",as:"div",class:"flex flex-col gap-1"},{default:C(({field:pt})=>[x(M,{for:"scf__location"},{default:C(()=>[...b[10]||(b[10]=[N("Location",-1)])]),_:1}),x(S,po(mo(pt)),null,16),x(w(Mt),{name:"location"})]),_:1}),x(w(gt),{name:"description",as:"div",class:"flex flex-col gap-2"},{default:C(({value:pt,handleChange:tt})=>[x(ft,{"model-value":pt??"","onUpdate:modelValue":tt,disabled:!1,timer:1e3},null,8,["model-value","onUpdate:modelValue"]),x(w(Mt),{name:"description"})]),_:1}),A("div",Ak,[w(h).map?(I(),j(Ut,{key:1},{default:C(()=>[x(Nt,{"as-child":""},{default:C(()=>[x(kt,{type:"button",size:"icon",variant:"ghost"},{default:C(()=>[x(w(fa))]),_:1})]),_:1}),x(xi,{class:"sm:max-w-[1000px]"},{default:C(()=>[x(Pt,null,{default:C(()=>[N(q(n.category?.name)+"'s map",1)]),_:1}),x(Wn,null,{default:C(()=>[...b[11]||(b[11]=[N("lorem",-1)])]),_:1}),x(he,{"gpx-file":w(la)(n.category?.map_file.file_name)},null,8,["gpx-file"])]),_:1})]),_:1})):(I(),W(at,{key:0},[A("label",Lk,[A("input",{type:"file",onChange:b[2]||(b[2]=pt=>g(pt,"map")),accept:".gpx",class:"hidden"},null,32),A("span",Ik,q(w(c)?w(c):"Upload GPX file"),1)]),w(c)?(I(),j(kt,{key:0,type:"button",onClick:b[3]||(b[3]=()=>{y("map"),c.value=""}),size:"icon",modifier:"outline",class:"absolute top-1/2 right-2 -translate-y-1/2"},{default:C(()=>[x(w(us))]),_:1})):lt("",!0),x(w(Mt),{name:"map"})],64))]),A("div",Nk,[x(kt,{type:"submit",disabled:w(o)},{default:C(()=>[w(o)?(I(),j(w(Ye),{key:0,class:"animate-spin"})):(I(),j(w(_i),{key:1})),b[12]||(b[12]=N(" Save ",-1))]),_:1},8,["disabled"])])]),_:1},8,["validation-schema"])}}}),bh=ca("checkpoints",()=>{const n=Z([]),t=Z(!1),{axios:e}=ge();return{checkpoints:n,isLoading:t,fetch:async c=>{t.value=!0;const{data:u}=await e.get(`/events/${c}/checkpoints`);u&&(n.value=u),t.value=!1},save:async(c,u)=>{const f=u.id?"put":"post",h=u.id?`/events/checkpoints/${u.id}`:`/events/${c}/checkpoints`;await e[f](h,u)},destory:async c=>{await e.delete(`/events/checkpoints/${c}`)},assignVolunteerToCheckpoint:async(c,u)=>{await e.patch(`events/checkpoints/assign_volunteer/${c}`,u)}}}),zk={class:"text-right"},Rk=ct({__name:"form",props:{stageCategoryId:{},checkpoint:{}},emits:["update"],setup(n,{emit:t}){const e=n,i=t,{save:s}=bh(),o=Z(!1),a=Z(null),c=async h=>{o.value=!0,await s(e.stageCategoryId,h),o.value=!1,i("update"),f()},u=()=>{a.value&&(a.value.setFieldValue("stage_category_id",e.stageCategoryId),e.checkpoint&&a.value.setValues({id:e.checkpoint.id,name:e.checkpoint.name}))},f=()=>{a.value?.resetForm()};return ce(a,()=>{u()}),ua(()=>{a.value&&u()}),(h,m)=>{const g=yi,y=fs,v=Lt;return I(),j(w(vi),{onSubmit:c,"validation-schema":w(dm),class:"flex flex-col gap-4",ref_key:"form",ref:a},{default:C(()=>[x(w(gt),{name:"stage_category_id",as:"div",class:"flex flex-col gap-2"},{default:C(({field:b})=>[x(g,Ct({type:"hidden"},b,{id:"esf__name"}),null,16)]),_:1}),x(w(gt),{name:"id",as:"div",class:"flex flex-col gap-2"},{default:C(({field:b})=>[x(g,Ct({type:"hidden"},b,{id:"esf__id"}),null,16)]),_:1}),x(w(gt),{name:"name",as:"div",class:"flex flex-col gap-2"},{default:C(({field:b})=>[x(y,{for:"esf__name"},{default:C(()=>[...m[0]||(m[0]=[N("Name",-1)])]),_:1}),x(g,Ct(b,{id:"esf__name"}),null,16),x(w(Mt),{name:"name"})]),_:1}),A("div",zk,[x(v,{type:"submit",disabled:w(o)},{default:C(()=>[w(o)?(I(),j(w(Ye),{key:0})):(I(),j(w(_i),{key:1})),m[1]||(m[1]=N(" Save ",-1))]),_:1},8,["disabled"])])]),_:1},8,["validation-schema"])}}}),Bk={class:"pt-8 pl-8"},$k={class:"flex gap-2 pb-4 mb-5 border-b"},Fk={class:"divide-y space-y-3"},Vk=["value"],Hk={class:"grow space-y-1"},Zk={class:"block"},Wk={class:"flex justify-end gap-2"},jk=ct({__name:"list",props:{stageCategoryId:{}},emits:["update"],setup(n,{emit:t}){const e=t,i=n,{axios:s}=ge(),o=Z([]),a=Z(!1),c=Z(null),u=async()=>{const{data:h}=await s.get(`/events/${i.stageCategoryId}/checkpoints`);o.value=h},f=async h=>{await s.delete(`/events/checkpoints/${h}`)};return te(async()=>{await u()}),(h,m)=>{const g=Lt,y=ir,v=tn,b=en,S=_n,M=Qe,P=Xe;return I(),W(at,null,[A("div",Bk,[A("div",$k,[m[4]||(m[4]=A("div",{class:"grow"},[A("h3",null,"Checkpoints")],-1)),x(g,{variant:"secondary",size:"sm",modifier:"outline",onClick:m[0]||(m[0]=D=>a.value=!0)},{default:C(()=>[x(w(ds)),m[3]||(m[3]=N(" Add a Checkpoint ",-1))]),_:1})]),A("ul",Fk,[(I(!0),W(at,null,At(w(o),D=>(I(),W("li",{class:"flex gap-2 pb-3",value:D.id},[A("div",Hk,[A("strong",Zk,q(D.name),1),D.volunteers.length>0?(I(),j(y,{key:0,variant:"outline"},{default:C(()=>[N(" has "+q(D.volunteers.length)+" volunteer"+q(D.volunteers.length>1?"s":"")+" assigned ",1)]),_:2},1024)):lt("",!0)]),A("div",Wk,[x(g,{variant:"secondary",modifier:"outline",size:"icon",onClick:()=>{a.value=!0,c.value=D}},{default:C(()=>[x(w(ys))]),_:1},8,["onClick"]),x(g,{modifier:"outline",variant:"destructive",size:"icon",onClick:async()=>{await f(D.id),await u()}},{default:C(()=>[x(w(ha))]),_:1},8,["onClick"])])],8,Vk))),256))])]),x(P,{open:w(a),"onUpdate:open":m[2]||(m[2]=D=>a.value=!1)},{default:C(()=>[x(M,null,{default:C(()=>[x(S,null,{default:C(()=>[x(v,null,{default:C(()=>[...m[5]||(m[5]=[N("Stage form",-1)])]),_:1}),x(b,null,{default:C(()=>[...m[6]||(m[6]=[N("Lorem, ipsum dolor sit amet consectetur adipisicing elit. Possimus assumenda, maxime distinctio at facere nesciunt vero eius neque voluptates numquam libero vel provident aliquam, iusto, dolorum non. Laboriosam, eveniet quibusdam.",-1)])]),_:1})]),_:1}),x(Rk,{stageCategoryId:n.stageCategoryId,checkpoint:w(c),onUpdate:m[1]||(m[1]=()=>{a.value=!1,c.value=null,u(),e("update")})},null,8,["stageCategoryId","checkpoint"])]),_:1})]),_:1},8,["open"])],64)}}}),Uk={class:"space-y-2"},qk={class:"flex justify-center items-center p-3 border border-dashed border-gray-300 rounded-md"},Kk=["src"],Jk={key:1,class:"text-center"},Gk={class:"text-right"},Yk=ct({__name:"form",props:{stageCategoryId:{},availablePayments:{},payment:{}},emits:["update"],setup(n,{emit:t}){const e=t,i=n,{axios:s}=ge(),o=ju("form"),a=Z(!1),c=le(()=>fm.filter(m=>!i.availablePayments.includes(m))),u=async m=>{a.value=!0;const g=i.payment?"put":"post",y=i.payment?`/payments/${i.payment.id}`:"/payments";await s[g](y,m),a.value=!1,e("update")},f=m=>{const y=m.target.files;if(y&&y.length>0){const v=new FileReader;v.onload=b=>{o.value?.setFieldValue("image",b.target?.result)},v.readAsDataURL(y[0])}};return te(()=>{i.payment&&(o.value?.setFieldValue("amount",i.payment.amount),o.value?.setFieldValue("type",i.payment.type))}),(m,g)=>{const y=yi,v=ms,b=ps,S=_s,M=gs,P=hs,D=Lt;return I(),W(at,null,[g[4]||(g[4]=A("div",{class:"flex items-center gap-2"},[A("h1",null,"Upload payment details here")],-1)),x(w(vi),{ref_key:"form",ref:o,"validation-schema":w(hm),onSubmit:u,class:"space-y-4"},{default:C(({values:V})=>[x(w(gt),{name:"stage_category_id",type:"hidden",value:n.stageCategoryId},{default:C(({field:$})=>[A("input",Ct({type:"hidden"},$),null,16)]),_:1},8,["value"]),x(w(gt),{name:"payment_id",type:"hidden",value:n.payment?.id},{default:C(({field:$})=>[A("input",Ct({type:"hidden"},$),null,16)]),_:1},8,["value"]),x(w(gt),{name:"amount",as:"div",class:"space-y-2"},{default:C(({field:$})=>[g[0]||(g[0]=A("label",{for:"pf__amount"},"Amount",-1)),x(y,Ct($,{id:"pf__amount"}),null,16),x(w(Mt),{name:"amount"})]),_:1}),x(w(gt),{name:"type",as:"div",class:"space-y-2"},{default:C(({value:$,handleChange:U})=>[g[1]||(g[1]=A("label",{for:"pf__type"},"Payment Type",-1)),x(P,{"model-value":$,id:"pf__type","onUpdate:modelValue":U},{default:C(()=>[x(b,null,{default:C(()=>[x(v,{placeholder:"Select payment type"})]),_:1}),x(M,null,{default:C(()=>[(I(!0),W(at,null,At(w(c),K=>(I(),j(S,{value:K},{default:C(()=>[N(q(K),1)]),_:2},1032,["value"]))),256))]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"]),x(w(Mt),{name:"type"})]),_:1}),A("div",Uk,[A("label",qk,[A("input",{type:"file",accept:"image/*",onChange:f,class:"sr-only"},null,32),n.payment?.screenshot||V.image?(I(),W("img",{key:0,src:n.payment?.screenshot?w(gi)(n.payment?.screenshot.file_name):V.image,alt:"Image",class:"w-24 h-24 object-contain"},null,8,Kk)):(I(),W("div",Jk,[...g[2]||(g[2]=[A("strong",{class:"text-lg block"},"Upload image",-1)])]))]),x(w(Mt),{name:"image"})]),A("div",Gk,[x(D,{type:"submit",loading:w(a)},{default:C(()=>[w(a)?(I(),j(w(Ye),{key:0,class:"mr-2 animate-spin"})):lt("",!0),g[3]||(g[3]=N(" Submit ",-1))]),_:1},8,["loading"])])]),_:1},8,["validation-schema"])],64)}}}),Xk={class:"py-8 pl-8 border-b"},Qk={class:"flex gap-2 pb-4 mb-2 border-b"},tw={class:"divide-y divide-accent"},ew={class:"flex gap-2 items-center py-2"},nw={class:"grow"},xh=ct({__name:"list",props:{stageCategoryId:{},payments:{}},emits:["update"],setup(n,{emit:t}){const e=t,i=n,s=Z(!1),o=Z(null),a=le(()=>i.payments.map(c=>c.type)||[]);return(c,u)=>{const f=Lt,h=ir,m=tn,g=en,y=_n,v=Qe,b=Xe;return I(),W(at,null,[A("div",Xk,[A("div",Qk,[u[4]||(u[4]=A("strong",{class:"grow"},"Payments:",-1)),w(a).length<2?(I(),j(f,{key:0,variant:"secondary",onClick:u[0]||(u[0]=S=>s.value=!0)},{default:C(()=>[...u[3]||(u[3]=[N(" Add payment details ",-1)])]),_:1})):lt("",!0)]),A("ul",tw,[(I(!0),W(at,null,At(n.payments,S=>(I(),W("li",ew,[A("div",nw,[x(h,{variant:"info"},{default:C(()=>[N(q(S.type),1)]),_:2},1024),N(" Rs."+q(S.amount),1)]),x(f,{variant:"secondary",size:"icon",modifier:"outline",onClick:M=>{s.value=!0,o.value=S}},{default:C(()=>[x(w(ys))]),_:1},8,["onClick"])]))),256))])]),x(b,{open:w(s),"onUpdate:open":u[2]||(u[2]=S=>{s.value=!1,o.value=null})},{default:C(()=>[x(v,{class:"sm:max-w-[600px] max-h-full overflow-y-auto"},{default:C(()=>[x(y,null,{default:C(()=>[x(m,null,{default:C(()=>[N(q(w(o)?"Edit payment details":"Add payment details"),1)]),_:1}),x(g)]),_:1}),x(Yk,{"available-payments":w(a),"stage-category-id":n.stageCategoryId,payment:w(o),onUpdate:u[1]||(u[1]=async()=>{s.value=!1,o.value=null,e("update")})},null,8,["available-payments","stage-category-id","payment"])]),_:1})]),_:1},8,["open"])],64)}}}),iw={class:"flex gap-2"},rw={class:"grow"},sw=["textContent"],ow={class:"flex gap-2"},aw={class:"border-t border-dashed pt-4"},lw=ct({__name:"Item",props:{stageCategory:{}},emits:["event_started","event_ended","update","edit","delete"],setup(n,{emit:t}){const e=n,i=t,{axios:s}=ge(),o=le(()=>Me().isAfter(Me(e.stageCategory.end,"YYYY-MM-DDTHH:mm:ss.T").endOf("day"))),a=le(()=>Me().isBetween(Me(e.stageCategory.end,"YYYY-MM-DDTHH:mm:ss.T").startOf("day"),Me(e.stageCategory.end,"YYYY-MM-DDTHH:mm:ss.T").endOf("day"))),c=le(()=>Me(e.stageCategory.end,"YYYY-MM-DDTHH:mm:ss.T").get("hour")!==0),u=async()=>{await s.patch(`/events/stage_categories/${e.stageCategory.id}/start`),i("event_started")},f=async()=>{await s.patch(`/events/stage_categories/${e.stageCategory.id}/end`),i("event_ended")};return(h,m)=>{const g=Lt;return I(),W("div",null,[!w(o)&&w(a)?(I(),j(g,{key:0,onClick:u},{default:C(()=>[...m[3]||(m[3]=[N("Start",-1)])]),_:1})):lt("",!0),w(c)&&!w(o)?(I(),j(g,{key:1,onClick:f},{default:C(()=>[...m[4]||(m[4]=[N("End",-1)])]),_:1})):lt("",!0),A("div",iw,[A("div",rw,[A("strong",null,q(n.stageCategory.name),1),A("p",{class:"mb-4",textContent:q(n.stageCategory.excerpt)},null,8,sw)]),A("div",ow,[x(g,{variant:"secondary",size:"icon",modifier:"outline",onClick:m[0]||(m[0]=y=>i("edit"))},{default:C(()=>[x(w(ys))]),_:1}),x(g,{variant:"destructive",size:"icon",modifier:"outline",onClick:m[1]||(m[1]=y=>i("delete"))},{default:C(()=>[x(w(ha))]),_:1})])]),A("div",aw,[x(xh,{"stage-category-id":n.stageCategory.id,payments:n.stageCategory.payment,onUpdate:m[2]||(m[2]=y=>i("update"))},null,8,["stage-category-id","payments"]),x(jk,{"stage-category-id":n.stageCategory.id},null,8,["stage-category-id"])])])}}}),cw={class:"pt-8 pl-8"},uw={class:"flex gap-2 pb-4 mb-5 border-b"},dw={class:"flex gap-2"},fw={key:0,class:"pb-8 space-y-16"},hw=ct({__name:"List",props:{stageId:{}},emits:["update"],setup(n,{emit:t}){const e=t,i=n,{axios:s}=ge(),o=Z(!1),a=Z(null),c=Z([]),u=async()=>{const{data:f}=await s.get(`/events/${i.stageId}/stage_categories`);c.value=f};return te(()=>{u()}),(f,h)=>{const m=Lt,g=tn,y=en,v=_n,b=Qe,S=Xe;return I(),W(at,null,[A("div",cw,[A("div",uw,[h[7]||(h[7]=A("div",{class:"grow"},[A("h2",null,"Category")],-1)),A("div",dw,[x(m,{variant:"secondary",size:"sm",modifier:"outline",onClick:h[0]||(h[0]=M=>o.value=!0)},{default:C(()=>[x(w(ds)),h[6]||(h[6]=N(" Add a Category ",-1))]),_:1})])]),w(c).length>0?(I(),W("div",fw,[(I(!0),W(at,null,At(w(c),M=>(I(),j(lw,{"stage-category":M,onEvent_started:h[1]||(h[1]=P=>e("update")),onEvent_ended:h[2]||(h[2]=P=>e("update")),onUpdate:h[3]||(h[3]=P=>u()),onEdit:P=>{a.value=M,o.value=!0}},null,8,["stage-category","onEdit"]))),256))])):lt("",!0)]),x(S,{open:w(o),"onUpdate:open":h[5]||(h[5]=M=>{o.value=!1,a.value=null})},{default:C(()=>[x(b,{class:"sm:max-w-[1000px] max-h-full overflow-y-auto"},{default:C(()=>[x(v,null,{default:C(()=>[x(g,null,{default:C(()=>[N(q(w(a)?"Edit "+w(a).name:"Add category"),1)]),_:1}),x(y,null,{default:C(()=>[...h[8]||(h[8]=[N(" This form determines the category for the selected stage area. ",-1)])]),_:1})]),_:1}),x(Dk,{"stage-id":n.stageId,category:w(a),onUpdate:h[4]||(h[4]=async()=>{o.value=!1,await u(),e("update")})},null,8,["stage-id","category"])]),_:1})]),_:1},8,["open"])],64)}}}),pw=da(sl),mw={class:"text-right mb-12"},gw={class:"space-y-4"},_w={class:"grow"},yw={class:"flex justify-end gap-2 pb-4 mb-8 border-b"},vw={class:"space-y-2"},bw={class:"text-xl"},xw={class:"space-x-3"},kw=["textContent"],ww=ct({__name:"list",props:{eventId:{}},emits:["update"],setup(n,{emit:t}){const e=t,i=n,{fetch:s,destory:o}=oa(),{stages:a}=Uu(oa()),c=Z(!1),u=Z(null),f=Z(null);return te(async()=>{await s(i.eventId)}),(h,m)=>{const g=Lt,y=ed,v=td,b=ir,S=Qu,M=Xu,P=tn,D=en,V=_n,$=Qe,U=Xe,K=pw;return I(),W(at,null,[A("div",mw,[x(g,{variant:"secondary",onClick:m[0]||(m[0]=B=>c.value=!0)},{default:C(()=>[x(w(ds)),m[5]||(m[5]=N(" Add stage ",-1))]),_:1})]),A("div",gw,[x(M,{orientation:"vertical","default-value":w(a)[0]?.id,class:"flex-row gap-4"},{default:C(()=>[x(v,{class:"flex-col h-full"},{default:C(()=>[(I(!0),W(at,null,At(w(a),B=>(I(),j(y,{value:B.id},{default:C(()=>[N(q(B.name),1)]),_:2},1032,["value"]))),256))]),_:1}),A("div",_w,[(I(!0),W(at,null,At(w(a),B=>(I(),j(S,{value:B.id},{default:C(()=>[A("div",yw,[x(g,{variant:"runner",size:"icon",onClick:()=>{u.value=B}},{default:C(()=>[x(w(fa))]),_:1},8,["onClick"]),x(g,{variant:"destructive",onClick:async()=>{await w(o)(B.id),w(s)(n.eventId)}},{default:C(()=>[x(w(ha))]),_:1},8,["onClick"]),x(g,{size:"icon",onClick:()=>{c.value=!0,f.value=B}},{default:C(()=>[x(w(ys))]),_:1},8,["onClick"])]),A("div",vw,[A("h2",bw,q(B.name),1),A("div",xw,[B.runners.length>0?(I(),j(b,{key:0},{default:C(()=>[N("runners "+q(B.runners.length),1)]),_:2},1024)):lt("",!0),B.volunteers.length>0?(I(),j(b,{key:1},{default:C(()=>[N("volunteers "+q(B.volunteers.length),1)]),_:2},1024)):lt("",!0)]),A("p",{textContent:q(B.excerpt)},null,8,kw),x(hw,{"stage-id":B.id,onUpdate:m[1]||(m[1]=ft=>e("update"))},null,8,["stage-id"])])]),_:2},1032,["value"]))),256))])]),_:1},8,["default-value"])]),x(U,{open:w(c),"onUpdate:open":m[3]||(m[3]=B=>c.value=!1)},{default:C(()=>[x($,{class:"sm:max-w-[1000px] max-h-full overflow-y-auto"},{default:C(()=>[x(V,null,{default:C(()=>[x(P,null,{default:C(()=>[...m[6]||(m[6]=[N("Stage form",-1)])]),_:1}),x(D,null,{default:C(()=>[...m[7]||(m[7]=[N("Lorem, ipsum dolor sit amet consectetur adipisicing elit. Possimus assumenda, maxime. ",-1)])]),_:1})]),_:1}),x(Pk,{"event-id":n.eventId,stage:w(f),onUpdate:m[2]||(m[2]=()=>{c.value=!1,f.value=null,w(s)(n.eventId),e("update")})},null,8,["event-id","stage"])]),_:1})]),_:1},8,["open"]),x(U,{open:w(u)!=null,"onUpdate:open":m[4]||(m[4]=B=>u.value=null)},{default:C(()=>[x($,{class:"sm:max-w-[1000px]"},{default:C(()=>[x(V,null,{default:C(()=>[x(P,null,{default:C(()=>[...m[8]||(m[8]=[N("Map",-1)])]),_:1}),x(D,null,{default:C(()=>[...m[9]||(m[9]=[N("Some text",-1)])]),_:1})]),_:1}),w(u)?(I(),j(K,{key:0,"map-id":"someId",center:[27.756846786775668,85.3124535214843],gpxFile:w(la)(w(u)?.map_file.file_name)},null,8,["gpxFile"])):lt("",!0)]),_:1})]),_:1},8,["open"])],64)}}}),Bu=ca("gallery",()=>{const n=Z([]),{axios:t}=ge();return{galleries:n,fetch:async o=>{const{data:a}=await t.get(`/events/${o}/galleries`);n.value=a},save:async(o,a)=>{await t.post(`/events/${o}/galleries`,{images:a})},destory:async(o,a)=>{await t.delete(`/events/${o}/galleries/${a}`)}}}),Sw={class:"flex flex-wrap gap-4"},Cw={class:"w-[calc(25%-16px)] h-[250px] rounded overflow-hidden relative border border-dashed hover:border-gray-600 transition-colors"},Mw={key:1,class:"w-full h-full flex justify-center items-center p-3"},Tw={class:"w-[calc(25%-16px)] h-[250px] p-2 rounded overflow-hidden relative border border-dashed"},Pw=["src"],Ew={class:"w-[calc(25%-16px)] h-[250px] p-2 rounded overflow-hidden relative border border-dashed"},Ow=["src"],Aw=ct({__name:"list",props:{eventId:{}},setup(n){const t=n,{galleries:e}=Uu(Bu()),{fetch:i,save:s,destory:o}=Bu(),a=Z([]),c=Z(!1),u=m=>{if(m.target==null)return;const g=m.target.files;if(g&&g?.length>0)for(const y of g){const v=new FileReader;v.readAsDataURL(y),v.onload=()=>{a.value.push(v.result)}}},f=m=>{a.value.splice(m,1)},h=async()=>{c.value=!0,await s(t.eventId,a.value),i(t.eventId),a.value=[],c.value=!1};return ce(()=>t.eventId,()=>{i(t.eventId)}),te(()=>{i(t.eventId)}),(m,g)=>{const y=Lt;return I(),W("div",Sw,[A("div",Cw,[w(a).length>0?(I(),j(y,{key:0,class:"absolute top-1/2 right-1/2 translate-x-1/2 -translate-y-1/2",onClick:h},{default:C(()=>[...g[0]||(g[0]=[N(" Save ",-1)])]),_:1})):(I(),W("label",Mw,[A("input",{type:"file",accept:"image/*",onChange:u,multiple:"",class:"sr-only"},null,32),g[1]||(g[1]=A("div",{class:"text-center"},[A("strong",{class:"text-lg block"},"Upload image"),A("span",{class:"text-xs"},"You can upload multiple images")],-1))]))]),(I(!0),W(at,null,At(w(a),(v,b)=>(I(),W("figure",Tw,[A("img",{src:v,alt:"image description",class:"w-full h-full object-contain object-center"},null,8,Pw),x(y,{variant:"secondary",size:"icon",class:"absolute top-2 right-2 z-[2]",onClick:S=>f(b)},{default:C(()=>[x(w(us))]),_:1},8,["onClick"])]))),256)),(I(!0),W(at,null,At(w(e),v=>(I(),W("figure",Ew,[A("img",{src:w(gi)(v.file_name),alt:"image description",class:"w-full h-full object-contain object-center"},null,8,Ow),x(y,{variant:"secondary",size:"icon",class:"absolute top-2 right-2 z-[2]",onClick:async()=>{await w(o)(n.eventId,v.id),w(i)(n.eventId)}},{default:C(()=>[x(w(Vm))]),_:1},8,["onClick"])]))),256))])}}}),Lw={class:"text-right"},Iw=ct({__name:"AssignCheckpointForm",props:{volunteer:{},checkpoints:{}},emits:["update"],setup(n,{emit:t}){const e=t,i=n,{assignVolunteerToCheckpoint:s}=bh(),o=Z(!1),a=Z();le(()=>[...new Set(i.checkpoints.map(u=>(a.value?.values.checkpoints??[]).includes(u.id)?u.stage_category_id:null).filter(u=>u!=null))]);const c=async u=>{o.value=!0,await s(i.volunteer.id,u),o.value=!1,e("update")};return(u,f)=>{const h=wm,m=fs,g=Lt;return I(),j(w(vi),{ref_key:"form",ref:a,onSubmit:c,class:"space-y-4 pt-8 max-w-[460px]"},{default:C(({values:y})=>[(I(!0),W(at,null,At(n.checkpoints,v=>(I(),j(w(gt),{as:"div",type:"checkbox",name:"checkpoints",value:v.id,class:"flex gap-2"},{default:C(({handleChange:b,value:S})=>[x(h,{"onUpdate:modelValue":b,id:v.id,"model-value":S?.includes(v.id)},null,8,["onUpdate:modelValue","id","model-value"]),x(m,{for:v.id},{default:C(()=>[N(q(v.name),1)]),_:2},1032,["for"])]),_:2},1032,["value"]))),256)),A("div",Lw,[x(g,{variant:"default",type:"submit",class:"w-full sm:w-auto px-8 py-3 h-12 text-base font-medium",disabled:w(o),"aria-busy":w(o)},{default:C(()=>[w(o)?(I(),j(w(Ye),{key:0,size:20,class:"animate-spin mr-2"})):lt("",!0),f[0]||(f[0]=N(" Assign ",-1))]),_:1},8,["disabled","aria-busy"])])]),_:1},512)}}}),Nw={class:"divide-y space-y-4 [&>li]:pb-4"},Dw={class:"flex gap-2 items-center"},zw={class:"grow space-y-1"},Rw={class:"text-lg block"},Bw={key:0},$w=ct({__name:"list",props:{stages:{}},emits:["update"],setup(n,{emit:t}){const e=t,i=Z(null),s=Z([]);return(o,a)=>{const c=ir,u=Lt,f=tn,h=en,m=_n,g=Iw,y=Qe,v=Xe;return I(),W(at,null,[A("ul",Nw,[(I(!0),W(at,null,At(n.stages,b=>(I(),W(at,null,[(I(!0),W(at,null,At(b.volunteers,S=>(I(),W("li",Dw,[A("div",zw,[A("strong",Rw,q(S.personal.first_name)+" "+q(S.personal.middle_name)+" "+q(S.personal.last_name),1),x(c,{variant:"outline"},{default:C(()=>[N(q(S.stages.map(M=>M.name).join(", ")),1)]),_:2},1024),S?.checkpoints.length>0?(I(),W("p",Bw,[a[2]||(a[2]=A("span",{class:"font-semibold text-xs uppercase text-gray-300"},"Assigned to:",-1)),N(" "+q(S?.checkpoints.map(M=>M.name).join(", ")),1)])):lt("",!0)]),S.checkpoints.length==0?(I(),j(u,{key:0,variant:"secondary",modifier:"outline",onClick:()=>{i.value=S,s.value=b.stage_categories.map(M=>M.checkpoints).reduce((M,P)=>[...M,...P],[])}},{default:C(()=>[...a[3]||(a[3]=[N("Assign to checkpoint",-1)])]),_:1},8,["onClick"])):lt("",!0)]))),256))],64))),256))]),w(i)?(I(),j(v,{key:0,open:w(i)!=null,"onUpdate:open":a[1]||(a[1]=b=>i.value=null)},{default:C(()=>[x(y,null,{default:C(()=>[x(m,null,{default:C(()=>[x(f,{class:"text-2xl"},{default:C(()=>[...a[4]||(a[4]=[N("Assign volunteers to checkpoint",-1)])]),_:1}),x(h,null,{default:C(()=>[...a[5]||(a[5]=[N("You can indiviually assign volunteers to the available checkpoints ",-1)])]),_:1})]),_:1}),x(g,{volunteer:w(i),checkpoints:w(s),onUpdate:a[0]||(a[0]=()=>{i.value=null,e("update")})},null,8,["volunteer","checkpoints"])]),_:1})]),_:1},8,["open"])):lt("",!0)],64)}}}),Fw=ct({__name:"InputGroup",props:{class:{}},setup(n){const t=n;return(e,i)=>(I(),W("div",{"data-slot":"input-group",role:"group",class:Bt(w(pa)("group/input-group border-input dark:bg-input/30 relative flex w-full items-center rounded-md border shadow-xs transition-[color,box-shadow] outline-none","h-9 min-w-0 has-[>textarea]:h-auto","has-[>[data-align=inline-start]]:[&>input]:pl-2","has-[>[data-align=inline-end]]:[&>input]:pr-2","has-[>[data-align=block-start]]:h-auto has-[>[data-align=block-start]]:flex-col has-[>[data-align=block-start]]:[&>input]:pb-3","has-[>[data-align=block-end]]:h-auto has-[>[data-align=block-end]]:flex-col has-[>[data-align=block-end]]:[&>input]:pt-3","has-[[data-slot=input-group-control]:focus-visible]:border-ring has-[[data-slot=input-group-control]:focus-visible]:ring-ring/50 has-[[data-slot=input-group-control]:focus-visible]:ring-[3px]","has-[[data-slot][aria-invalid=true]]:ring-destructive/20 has-[[data-slot][aria-invalid=true]]:border-destructive dark:has-[[data-slot][aria-invalid=true]]:ring-destructive/40",t.class))},[$e(e.$slots,"default")],2))}}),Vw=["data-align"],Hw=ct({__name:"InputGroupAddon",props:{align:{default:"inline-start"},class:{}},setup(n){const t=n;function e(i){const s=i.currentTarget,o=i.target;o&&o.closest("button")||s&&s?.parentElement&&s.parentElement?.querySelector("input")?.focus()}return(i,s)=>(I(),W("div",{role:"group","data-slot":"input-group-addon","data-align":t.align,class:Bt(w(pa)(w(Ww)({align:t.align}),t.class)),onClick:e},[$e(i.$slots,"default")],10,Vw))}}),Zw=ct({__name:"InputGroupInput",props:{class:{}},setup(n){const t=n;return(e,i)=>(I(),j(w(yi),{"data-slot":"input-group-control",class:Bt(w(pa)("flex-1 rounded-none border-0 bg-transparent shadow-none focus-visible:ring-0 dark:bg-transparent",t.class))},null,8,["class"]))}}),Ww=Qp("text-muted-foreground flex h-auto cursor-text items-center justify-center gap-2 py-1.5 text-sm font-medium select-none [&>svg:not([class*='size-'])]:size-4 [&>kbd]:rounded-[calc(var(--radius)-5px)] group-data-[disabled=true]/input-group:opacity-50",{variants:{align:{"inline-start":"order-first pl-3 has-[>button]:ml-[-0.45rem] has-[>kbd]:ml-[-0.35rem]","inline-end":"order-last pr-3 has-[>button]:mr-[-0.45rem] has-[>kbd]:mr-[-0.35rem]","block-start":"order-first w-full justify-start px-3 pt-3 [.border-b]:pb-3 group-has-[>input]/input-group:pt-2.5","block-end":"order-last w-full justify-start px-3 pb-3 [.border-t]:pt-3 group-has-[>input]/input-group:pb-2.5"}},defaultVariants:{align:"inline-start"}}),jw={class:"no-italic block"},Uw={class:"block"},qw={class:"block"},Kw=ct({__name:"RunnerItem",props:{runner:{}},emits:["show:runner","show:payment","updated:payment"],setup(n,{emit:t}){const e=t,i=n,s=le(()=>i.runner.payments.length>0);return(o,a)=>{const c=ir,u=ga,f=Lt,h=Jm,m=Ym,g=Xm,y=Qm,v=Gm,b=Km,S=ma,M=va,P=_a,D=ya;return I(),W(at,null,[x(S,null,{default:C(()=>[x(u,null,{default:C(()=>[A("em",jw,q(n.runner.bib),1),A("strong",Uw,q(n.runner.personal.first_name)+" "+q(n.runner.personal.middle_name)+" "+q(n.runner.personal.last_name),1),x(c,null,{default:C(()=>[N(q(w(Me)().diff(w(Me)(n.runner.personal.date_of_birth),"years"))+" "+q(n.runner.personal?.gender?.name.charAt(0).toUpperCase()),1)]),_:1})]),_:1}),x(u,null,{default:C(()=>[N(q(n.runner.payments[0]?.status),1)]),_:1}),x(u,null,{default:C(()=>[N(q(n.runner.payments[0]?.type),1)]),_:1}),x(u,{class:"text-center"},{default:C(()=>[A("div",qw,[A("span",{class:Bt({flag:!0,["flag-"+n.runner.personal.country.abbr]:!0})},null,2)]),N(" "+q(n.runner.personal?.country?.name),1)]),_:1}),x(u,null,{default:C(()=>[N(q(n.runner.personal?.gender?.name),1)]),_:1}),x(u,{class:"text-right"},{default:C(()=>[x(b,null,{default:C(()=>[x(h,{"as-child":""},{default:C(()=>[x(f,{size:"sm",modifier:"link"},{default:C(()=>[x(w(tg))]),_:1})]),_:1}),x(v,null,{default:C(()=>[x(m,{class:"text-gray-500",onClick:a[0]||(a[0]=V=>e("show:runner"))},{default:C(()=>[...a[5]||(a[5]=[N(" See runner details ",-1)])]),_:1}),w(s)?(I(),j(m,{key:0,class:"text-gray-500",onClick:a[1]||(a[1]=V=>e("show:payment"))},{default:C(()=>[...a[6]||(a[6]=[N(" See payment details ",-1)])]),_:1})):lt("",!0),x(g,null,{default:C(()=>[...a[7]||(a[7]=[N("Actions",-1)])]),_:1}),x(y),x(m,{class:"text-green-500",onClick:a[2]||(a[2]=V=>e("updated:payment","COMPLETED",n.runner.payments[0].id))},{default:C(()=>[...a[8]||(a[8]=[N(" Completed ",-1)])]),_:1}),x(m,{class:"text-yellow-500",onClick:a[3]||(a[3]=V=>e("updated:payment","PENDING",n.runner.payments[0].id))},{default:C(()=>[...a[9]||(a[9]=[N(" Pending ",-1)])]),_:1}),x(m,{class:"text-red-500",onClick:a[4]||(a[4]=V=>e("updated:payment","FAILED",n.runner.payments[0].id))},{default:C(()=>[...a[10]||(a[10]=[N(" Failed ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n.runner.volunteer_on_checkpoints?.length?(I(),j(S,{key:0},{default:C(()=>[x(u,{colspan:"6"},{default:C(()=>[x(P,null,{default:C(()=>[(I(!0),W(at,null,At(n.runner.volunteer_on_checkpoints,V=>(I(),j(S,null,{default:C(()=>[x(u,{colspan:"6"},{default:C(()=>[x(D,null,{default:C(()=>[x(M,null,{default:C(()=>[x(S,null,{default:C(()=>[x(u,null,{default:C(()=>[...a[11]||(a[11]=[N("Checkpoint",-1)])]),_:1}),x(u,null,{default:C(()=>[...a[12]||(a[12]=[N("Time",-1)])]),_:1})]),_:1})]),_:1}),x(P,null,{default:C(()=>[x(S,null,{default:C(()=>[x(u,null,{default:C(()=>[N(q(V?.checkpoint?.name),1)]),_:2},1024),x(u,null,{default:C(()=>[N(q(V?.timer),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1})]),_:1})):lt("",!0)],64)}}}),Jw={class:"bg-gray-100 space-y-6 mb-12 border border-dashed border-gray-400 p-3 rounded-xl"},Gw={class:"space-y-3"},Yw={class:"flex items-center gap-3"},Xw={class:"flex justify-end gap-2"},Qw={class:"text-sm text-gray-300"},tS={class:"space-y-4 divide-y divide-gray-200 text-sm"},eS={class:"space-y-2 pb-4"},nS={class:"flex justify-between"},iS={class:"flex justify-between"},rS={class:"flex justify-between"},sS={class:"flex justify-between"},oS={key:0,class:"text-xs border p-1 rounded-sm"},aS=["src"],lS={key:0,class:"text-center block p-3 text-gray-500 bg-accent rounded"},cS=ct({__name:"list",props:{stages:{}},emits:["update"],setup(n,{emit:t}){const{axios:e}=ge(),i=pm(),s=n,o=Z(!1),a=Z([]),c=Z(null),u=Z(null),f=Z(null),h=Vu(""),m=Z(null),g=Z(null);mm(["command","/"],()=>{Hu(()=>{document.querySelector(".search-input")?.focus()})});const y=le(()=>c.value?s.stages.find(M=>M.id===c.value)?.stage_categories||[]:[]),v=async()=>{const M=i.params.id;if(M&&c.value){o.value=!0;const P=c.value,{data:D}=await e.get(`/events/${M}/${P}/runners`,{params:{s:h.value,payment_status:u.value,stage_category:m.value,payment_type:f.value}});a.value=D,o.value=!1}},b=async(M,P)=>{console.log(M,P),await e.put(`/events/${i.params.id}/payments/${P}`,{status:M}),v()},S=()=>{c.value=null,h.value="",u.value=null,m.value=null,f.value=null,a.value=[],v()};return ce([u,c,m,f],v),gm(h,v,{debounce:1e3}),te(v),(M,P)=>{const D=ms,V=ps,$=_s,U=gs,K=hs,B=Lt,ft=Zw,kt=Hw,Nt=Fw,Pt=Ju,Wn=ma,he=va,xi=ga,Ut=_a,pt=ya,tt=tn,lr=en,nt=_n,bt=Qe,Yt=Xe;return I(),W(at,null,[A("div",Jw,[P[19]||(P[19]=A("h2",{class:"text-xl text-gray-400"},"Filters:",-1)),A("div",Gw,[A("div",Yw,[x(K,{modelValue:w(c),"onUpdate:modelValue":P[0]||(P[0]=Q=>ni(c)?c.value=Q:null),disabled:w(o)},{default:C(()=>[x(V,{class:"w-[200px]",size:"sm"},{default:C(()=>[P[9]||(P[9]=N(" Stage: ",-1)),x(D,{placeholder:""})]),_:1}),x(U,null,{default:C(()=>[(I(!0),W(at,null,At(n.stages,Q=>(I(),j($,{value:Q.id},{default:C(()=>[N(q(Q.name),1)]),_:2},1032,["value"]))),256))]),_:1})]),_:1},8,["modelValue","disabled"]),x(K,{modelValue:w(m),"onUpdate:modelValue":P[1]||(P[1]=Q=>ni(m)?m.value=Q:null),disabled:w(o)},{default:C(()=>[x(V,{class:"w-[200px]",size:"sm"},{default:C(()=>[P[10]||(P[10]=N(" Category: ",-1)),x(D,{placeholder:""})]),_:1}),x(U,null,{default:C(()=>[(I(!0),W(at,null,At(w(y),Q=>(I(),j($,{value:Q.id},{default:C(()=>[N(q(Q.name),1)]),_:2},1032,["value"]))),256))]),_:1})]),_:1},8,["modelValue","disabled"]),w(m)?(I(),j(B,{key:0,size:"sm",modifier:"link",onClick:P[2]||(P[2]=Q=>m.value=null)},{default:C(()=>[...P[11]||(P[11]=[N("X",-1)])]),_:1})):lt("",!0),x(K,{modelValue:w(u),"onUpdate:modelValue":P[3]||(P[3]=Q=>ni(u)?u.value=Q:null),disabled:w(o)},{default:C(()=>[x(V,{class:"w-[200px]",size:"sm"},{default:C(()=>[P[12]||(P[12]=N(" Payment: ",-1)),x(D,{placeholder:""})]),_:1}),x(U,null,{default:C(()=>[(I(!0),W(at,null,At(w(_m),Q=>(I(),j($,{value:Q},{default:C(()=>[N(q(Q),1)]),_:2},1032,["value"]))),256))]),_:1})]),_:1},8,["modelValue","disabled"]),w(u)?(I(),j(B,{key:1,size:"sm",modifier:"link",onClick:P[4]||(P[4]=Q=>u.value=null)},{default:C(()=>[...P[13]||(P[13]=[N("X",-1)])]),_:1})):lt("",!0),x(K,{modelValue:w(f),"onUpdate:modelValue":P[5]||(P[5]=Q=>ni(f)?f.value=Q:null),disabled:w(o)},{default:C(()=>[x(V,{class:"w-[200px]",size:"sm"},{default:C(()=>[P[14]||(P[14]=N(" Payment Type: ",-1)),x(D,{placeholder:""})]),_:1}),x(U,null,{default:C(()=>[(I(!0),W(at,null,At(w(ym),Q=>(I(),j($,{value:Q},{default:C(()=>[N(q(Q),1)]),_:2},1032,["value"]))),256))]),_:1})]),_:1},8,["modelValue","disabled"]),w(f)?(I(),j(B,{key:2,size:"sm",modifier:"link",onClick:P[6]||(P[6]=Q=>f.value=null)},{default:C(()=>[...P[15]||(P[15]=[N("X",-1)])]),_:1})):lt("",!0)]),x(Nt,{size:"sm"},{default:C(()=>[x(ft,{class:"search-input",modelValue:w(h),"onUpdate:modelValue":P[7]||(P[7]=Q=>ni(h)?h.value=Q:null),placeholder:"Search by name or bib"},null,8,["modelValue"]),x(kt,{align:"inline-end",class:"text-gray-300"},{default:C(()=>[x(w(Hm)),P[16]||(P[16]=N(" + / ",-1))]),_:1})]),_:1}),A("div",Xw,[x(B,{variant:"secondary",size:"sm",modifier:"link",onClick:v},{default:C(()=>[...P[17]||(P[17]=[N("reload",-1)])]),_:1}),x(B,{size:"sm",modifier:"link",onClick:S,disabled:w(o)},{default:C(()=>[...P[18]||(P[18]=[N("reset all",-1)])]),_:1},8,["disabled"])])])]),A("span",Qw,"showing "+q(w(a).length)+" runner"+q(w(a).length===1?"":"s"),1),x(pt,null,{default:C(()=>[x(he,null,{default:C(()=>[x(Wn,null,{default:C(()=>[x(Pt,null,{default:C(()=>[...P[20]||(P[20]=[N("Name",-1)])]),_:1}),x(Pt,null,{default:C(()=>[...P[21]||(P[21]=[N("Payment",-1)])]),_:1}),x(Pt,null,{default:C(()=>[...P[22]||(P[22]=[N("Payment Type",-1)])]),_:1}),x(Pt,{class:"text-center"},{default:C(()=>[...P[23]||(P[23]=[N("Country",-1)])]),_:1}),x(Pt,null,{default:C(()=>[...P[24]||(P[24]=[N("Gender",-1)])]),_:1}),x(Pt,{class:"text-right"},{default:C(()=>[...P[25]||(P[25]=[N("Action",-1)])]),_:1})]),_:1})]),_:1}),x(Ut,null,{default:C(()=>[(I(!0),W(at,null,At(w(a),Q=>(I(),j(Kw,{runner:Q,"onShow:payment":Et=>g.value=Q,"onUpdated:payment":b},null,8,["runner","onShow:payment"]))),256)),w(a).length===0?(I(),j(Wn,{key:0},{default:C(()=>[x(xi,{colspan:"6"},{default:C(()=>[...P[26]||(P[26]=[A("span",{class:"text-center block p-3 text-gray-500 bg-accent rounded"}," No runners found ",-1)])]),_:1})]),_:1})):lt("",!0)]),_:1})]),_:1}),x(Yt,{open:w(g)!=null,"onUpdate:open":P[8]||(P[8]=Q=>g.value=null)},{default:C(()=>[x(bt,{class:"max-h-[600px] overflow-y-auto"},{default:C(()=>[x(nt,null,{default:C(()=>[x(tt,{class:"text-lg"},{default:C(()=>[...P[27]||(P[27]=[N("Payment",-1)])]),_:1}),x(lr,{class:"text-base"},{default:C(()=>[P[28]||(P[28]=N(" Payment details for ",-1)),A("strong",null,q(w(g)?.personal.first_name)+" "+q(w(g)?.personal.middle_name)+" "+q(w(g)?.personal.last_name),1)]),_:1})]),_:1}),A("div",tS,[(I(!0),W(at,null,At(w(g)?.payments,Q=>(I(),W("div",eS,[A("div",nS,[P[29]||(P[29]=A("span",null,"Payment Type",-1)),A("span",null,q(Q.type),1)]),A("div",iS,[P[30]||(P[30]=A("span",null,"Payment Status",-1)),A("span",null,q(Q.status),1)]),A("div",rS,[P[31]||(P[31]=A("span",null,"Payment Amount",-1)),A("span",null,q(Q.amount),1)]),A("div",sS,[P[32]||(P[32]=A("span",null,"Payment Date",-1)),A("span",null,q(w(Me)(Q.created_at).fromNow()),1)]),Q?.screenshot?(I(),W("figure",oS,[P[33]||(P[33]=A("figcaption",null,"Screenshot of payment",-1)),A("img",{src:w(gi)(Q?.screenshot?.file_name)},null,8,aS)])):lt("",!0)]))),256)),w(g)?.payments.length===0?(I(),W("span",lS,[P[34]||(P[34]=N(" No payments information found for ",-1)),A("strong",null,q(w(g)?.personal.first_name),1)])):lt("",!0)])]),_:1})]),_:1},8,["open"])],64)}}}),uS={class:"space-y-2"},dS={class:"flex justify-center items-center p-3 border border-dashed border-gray-300 rounded-md"},fS=["src"],hS={key:1,class:"text-center"},pS={class:"text-right"},mS=ct({__name:"form",props:{eventId:{},sponsor:{}},emits:["close"],setup(n,{emit:t}){const e=t,i=n,s=ju("form"),{axios:o}=ge(),a=Z(!1),c=Z([]),u=async g=>{a.value=!0;const y=i.sponsor?"put":"post",v=i.sponsor?`/events/${i.eventId}/sponsors/${i.sponsor.id}`:`/events/${i.eventId}/sponsors`;await o[y](v,g),a.value=!1,e("close")},f=g=>{const v=g.target.files;if(v&&v.length>0){const b=new FileReader;b.onload=S=>{s.value?.setFieldValue("image",S.target?.result)},b.readAsDataURL(v[0])}},h=async()=>{const{data:g}=await o.get("/sponsor_types");c.value=g},m=()=>{i.sponsor&&(s.value?.setFieldValue("name",i.sponsor.name),s.value?.setFieldValue("description",i.sponsor.description),s.value?.setFieldValue("type",i.sponsor.sponsorType.id),s.value?.setFieldValue("url",i.sponsor.url),s.value?.setFieldValue("thumbnail_id",i.sponsor.thumbnail.id))};return te(async()=>{await h(),m()}),(g,y)=>{const v=yi,b=ms,S=ps,M=_s,P=gs,D=hs,V=Lt;return I(),j(w(vi),{ref_key:"form",ref:s,"validation-schema":w(vm),class:"space-y-4 pt-8",onSubmit:u},{default:C(({values:$})=>[x(w(gt),{name:"event_id",type:"hidden",value:n.eventId},{default:C(({field:U})=>[A("input",Ct({type:"hidden"},U),null,16)]),_:1},8,["value"]),x(w(gt),{name:"name",as:"div",class:"space-y-2"},{default:C(({field:U})=>[y[0]||(y[0]=A("label",{for:"name"},"Name",-1)),x(v,Ct({type:"text",id:"name"},U),null,16),x(w(Mt),{name:"name"})]),_:1}),x(w(gt),{name:"description",as:"div",class:"space-y-2"},{default:C(({field:U})=>[y[1]||(y[1]=A("label",{for:"description"},"Description",-1)),x(v,Ct({type:"text",id:"description"},U),null,16),x(w(Mt),{name:"description"})]),_:1}),x(w(gt),{name:"type",as:"div",class:"space-y-2"},{default:C(({value:U,handleChange:K})=>[y[2]||(y[2]=A("label",{for:"type"},"Type",-1)),x(D,{"model-value":U,"onUpdate:modelValue":K},{default:C(()=>[x(S,{class:"w-full"},{default:C(()=>[x(b,{placeholder:"Select a type"})]),_:1}),x(P,null,{default:C(()=>[(I(!0),W(at,null,At(w(c),B=>(I(),j(M,{value:B.id},{default:C(()=>[N(q(B.name),1)]),_:2},1032,["value"]))),256))]),_:1})]),_:1},8,["model-value","onUpdate:modelValue"]),x(w(Mt),{name:"type"})]),_:1}),x(w(gt),{name:"url",as:"div",class:"space-y-2"},{default:C(({field:U})=>[y[3]||(y[3]=A("label",{for:"url"},"URL",-1)),x(v,Ct({type:"text",id:"url"},U),null,16),x(w(Mt),{name:"url"})]),_:1}),A("div",uS,[A("label",dS,[A("input",{type:"file",accept:"image/*",onChange:f,class:"sr-only"},null,32),$.image?(I(),W("img",{key:0,src:$.image,alt:"Image",class:"w-24 h-24 object-contain"},null,8,fS)):(I(),W("div",hS,[...y[4]||(y[4]=[A("strong",{class:"text-lg block"},"Upload image",-1)])]))]),x(w(Mt),{name:"image"})]),A("div",pS,[x(V,{variant:"secondary",type:"submit",disabled:w(a)},{default:C(()=>[w(a)?(I(),j(w(Ye),{key:0,class:"mr-2 h-4 w-4 animate-spin"})):lt("",!0),y[5]||(y[5]=N(" Submit ",-1))]),_:1},8,["disabled"])])]),_:1},8,["validation-schema"])}}}),gS={class:"text-right mb-12"},_S=ct({__name:"list",props:{eventId:{}},setup(n){const t=n,{axios:e}=ge(),i=Z([]),s=Z(!1),o=Z(null),a=async()=>{const{data:c}=await e.get(`/events/${t.eventId}/sponsors`);i.value=c};return te(a),(c,u)=>{const f=Lt,h=Ju,m=ma,g=va,y=ng,v=ig,b=eg,S=ga,M=_a,P=ya,D=tn,V=en,$=_n,U=Qe,K=Xe;return I(),W(at,null,[A("div",gS,[x(f,{type:"button",onClick:u[0]||(u[0]=B=>s.value=!0)},{default:C(()=>[...u[3]||(u[3]=[N("Add Sponsor",-1)])]),_:1})]),x(P,null,{default:C(()=>[x(g,null,{default:C(()=>[x(m,null,{default:C(()=>[x(h,null,{default:C(()=>[...u[4]||(u[4]=[N("Name",-1)])]),_:1}),x(h,null,{default:C(()=>[...u[5]||(u[5]=[N("Description",-1)])]),_:1}),x(h,null,{default:C(()=>[...u[6]||(u[6]=[N("Type",-1)])]),_:1}),x(h,null,{default:C(()=>[...u[7]||(u[7]=[N("URL",-1)])]),_:1}),x(h,null,{default:C(()=>[...u[8]||(u[8]=[N("Actions",-1)])]),_:1})]),_:1})]),_:1}),x(M,null,{default:C(()=>[(I(!0),W(at,null,At(w(i),B=>(I(),j(m,{key:B.id},{default:C(()=>[x(S,null,{default:C(()=>[x(b,{class:"w-12 h-12 inline-block align-middle"},{default:C(()=>[x(y,{src:w(gi)(B.thumbnail.file_name)},null,8,["src"]),x(v,null,{default:C(()=>[N(q(B.name.charAt(0).toUpperCase()),1)]),_:2},1024)]),_:2},1024),N(" "+q(B.name),1)]),_:2},1024),x(S,null,{default:C(()=>[N(q(B.description),1)]),_:2},1024),x(S,null,{default:C(()=>[N(q(B.sponsorType.name),1)]),_:2},1024),x(S,null,{default:C(()=>[N(q(B.url),1)]),_:2},1024),x(S,null,{default:C(()=>[x(f,{type:"button",variant:"secondary",onClick:ft=>{o.value=B,s.value=!0}},{default:C(()=>[...u[9]||(u[9]=[N("Edit",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),x(K,{open:w(s),"onUpdate:open":u[2]||(u[2]=B=>s.value=!1)},{default:C(()=>[x(U,null,{default:C(()=>[x($,null,{default:C(()=>[x(D,null,{default:C(()=>[...u[10]||(u[10]=[N("Add Sponsor",-1)])]),_:1}),x(V,null,{default:C(()=>[...u[11]||(u[11]=[N(" Add a new sponsor to the event ",-1)])]),_:1})]),_:1}),x(mS,{"event-id":t.eventId,sponsor:w(o),onClose:u[1]||(u[1]=B=>{s.value=!1,a()})},null,8,["event-id","sponsor"])]),_:1})]),_:1},8,["open"])],64)}}}),yS=ct({__name:"list",props:{eventId:{type:String,required:!0}},setup(n){return(t,e)=>null}}),vS={class:"bg-white flex items-center gap-4 px-4 pt-4 pb-20 -mt-16 rounded-xl relative z-10"},bS={class:"flex-grow"},xS={class:"text-2xl"},kS={class:"flex gap-2 items-center"},wS={class:"flex flex-col gap-4"},SS={class:"text-md"},CS={class:"text"},MC=ct({__name:"[id]",setup(n){rg({title:"Events"});const t=Zu(),{get:e}=Wu(),i=Z(null),s=Z(!1),o=async()=>{i.value=await e(t.params.id)};return ua(()=>{s.value=!0,o(),s.value=!1}),(a,c)=>{const u=Lt,f=ed,h=td,m=Qu,g=Xu;return w(i)?(I(),W(at,{key:0},[x(Sg,{"trail-race":w(i),onUpdate:o},null,8,["trail-race"]),A("div",vS,[A("div",bS,[A("h1",xS,q(w(i)?.name),1)]),A("div",kS,[x(u,{onClick:o,variant:"secondary",modifier:"outline",size:"icon"},{default:C(()=>[x(w(sg),{class:Bt({"animate-spin":w(s)})},null,8,["class"])]),_:1}),x(u,{onClick:c[0]||(c[0]=y=>("navigateTo"in a?a.navigateTo:w(bm))({name:"dashboard-events"}))},{default:C(()=>[x(w(Zm)),c[1]||(c[1]=N(" Back ",-1))]),_:1})])]),x(g,{"default-value":"detail",class:"text-gray-600"},{default:C(()=>[x(h,{class:"uppercase"},{default:C(()=>[x(f,{value:"detail"},{default:C(()=>[...c[2]||(c[2]=[N(" Details ",-1)])]),_:1}),x(f,{value:"stages"},{default:C(()=>[...c[3]||(c[3]=[N(" Stages ",-1)])]),_:1}),x(f,{value:"runners"},{default:C(()=>[...c[4]||(c[4]=[N(" Runners ",-1)])]),_:1}),x(f,{value:"volunteers"},{default:C(()=>[...c[5]||(c[5]=[N(" Volunteers ",-1)])]),_:1}),x(f,{value:"gallery"},{default:C(()=>[...c[6]||(c[6]=[N(" Galleries ",-1)])]),_:1}),x(f,{value:"sponsor"},{default:C(()=>[...c[7]||(c[7]=[N(" Sponsors ",-1)])]),_:1}),x(f,{value:"settings"},{default:C(()=>[...c[8]||(c[8]=[N(" Settings ",-1)])]),_:1})]),_:1}),x(m,{value:"detail"},{default:C(()=>[A("div",wS,[A("dl",SS,[c[9]||(c[9]=A("dt",null,"Starts:",-1)),A("dd",null,q(w(yc)(w(i)?.start)),1),c[10]||(c[10]=A("dt",null,"Ends:",-1)),A("dd",null,q(w(yc)(w(i)?.end)),1)]),A("div",CS,q(w(i).excerpt),1),x(vk,{"trail-race":w(i),onUpdate:o},null,8,["trail-race"]),x(lk,{"trail-race":w(i),onUpdate:o},null,8,["trail-race"])])]),_:1}),x(m,{value:"stages"},{default:C(()=>[x(ww,{"event-id":w(t).params.id,onUpdate:o},null,8,["event-id"])]),_:1}),x(m,{value:"runners"},{default:C(()=>[x(cS,{stages:w(i).stages,onUpdate:o},null,8,["stages"])]),_:1}),x(m,{value:"volunteers"},{default:C(()=>[x($w,{stages:w(i).stages,onUpdate:o},null,8,["stages"])]),_:1}),x(m,{value:"gallery"},{default:C(()=>[x(Aw,{"event-id":w(t).params.id},null,8,["event-id"])]),_:1}),x(m,{value:"sponsor"},{default:C(()=>[x(_S,{"event-id":w(t).params.id},null,8,["event-id"])]),_:1}),x(m,{value:"payments"},{default:C(()=>[x(xh,{"event-id":w(t).params.id},null,8,["event-id"])]),_:1}),x(m,{value:"settings"},{default:C(()=>[x(yS,{"event-id":w(t).params.id},null,8,["event-id"])]),_:1})]),_:1})],64)):lt("",!0)}}});export{MC as default};
